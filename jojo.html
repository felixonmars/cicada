<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-06-03 Fri 18:44 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="XIE Yuheng" />
<link rel="stylesheet" href="http://xieyuheng.github.io/asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
<div id="content">
<h1 class="title">jojo</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org325ad5b"><span class="done todo">todo</span> </a></li>
<li><a href="#org449da5f">helper</a>
<ul>
<li><a href="#org28f59e">header</a></li>
<li><a href="#org820932a">bool</a></li>
<li><a href="#org931e4a2">number</a></li>
<li><a href="#orgc2326b9">char</a></li>
<li><a href="#orge810f9d">string</a>
<ul>
<li><a href="#org2fbcb98">string</a></li>
<li><a href="#orgcc89f51">string_equal</a></li>
<li><a href="#orgd938a06">nat_string_p</a></li>
<li><a href="#org4dd667e">int_string_p</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd96b697">hashtable</a>
<ul>
<li><a href="#orgad13d60">primitive</a></li>
<li><a href="#org394a671">name &amp; jojo</a></li>
<li><a href="#org4193dfb">bind &amp; nametable_entry</a></li>
<li><a href="#org12b1b27">new_nametable_entry</a></li>
<li><a href="#orgca3a407">nametable_entry_[occured|entry_used|no_collision]</a></li>
<li><a href="#org324a534">nametable</a></li>
<li><a href="#org3e170c6">string_to_sum</a></li>
<li><a href="#org5aebcfd">nametable_keyeq</a></li>
<li><a href="#org2ec7ea">nametable_hash</a></li>
<li><a href="#orga750bed">string_area</a></li>
<li><a href="#org52369de">copy_to_string_area</a></li>
<li><a href="#orgbcb74a9">nametable_insert</a></li>
<li><a href="#orgcd18b3e">nametable_search</a></li>
<li><a href="#org6d3b18f">nametable_entry_print</a></li>
<li><a href="#org828bc9d">nametable_report_orbit</a></li>
<li><a href="#orgd34da8f">nametable_report</a></li>
<li><a href="#orgb28ed68">nametable_print</a></li>
<li><a href="#orgb7354a9">k2n &amp; n2k</a></li>
<li><a href="#orgd994f20">init_nametable</a></li>
<li><a href="#org5574544">jojo_area</a></li>
<li><a href="#orgaa74e5d">here</a></li>
<li><a href="#org4ab176f">nametable_set_cell</a></li>
<li><a href="#org3fb924f">nametable_set_primitive</a></li>
<li><a href="#orgbf5d1dc">nametable_get_cell</a></li>
<li><a href="#orge9602c">nametable_get_primitive</a></li>
<li><a href="#org15de882">nametable_get_jojo</a></li>
<li><a href="#org7d7355b"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orga4d27a6">as &amp; rs</a>
<ul>
<li><a href="#orgd1d51af">as</a></li>
<li><a href="#orgf3c270">rs</a></li>
</ul>
</li>
<li><a href="#org65da685">define</a>
<ul>
<li><a href="#org787e795">define_primitive</a></li>
<li><a href="#orgc7453a9">define_function</a></li>
<li><a href="#orgc2dde80">define_variable</a></li>
</ul>
</li>
<li><a href="#orgf12a98">apply</a>
<ul>
<li><a href="#org19d133d">apply</a></li>
<li><a href="#orgde5314c">p_apply</a></li>
</ul>
</li>
<li><a href="#org8689a8d">eval</a>
<ul>
<li><a href="#orgdcaf49c">eval</a></li>
<li><a href="#orgf525204">eval_jo</a></li>
</ul>
</li>
<li><a href="#org2dcae8"><b>stack_operation</b></a>
<ul>
<li><a href="#org5d25cc6">p_dup</a></li>
<li><a href="#orge1b9799">p_print_stack</a></li>
<li><a href="#org8e8bb27">export_stack_operation</a></li>
</ul>
</li>
<li><a href="#orge6c21d7"><b>ending</b></a>
<ul>
<li><a href="#orgf8a250">p_end</a></li>
<li><a href="#org5cd65cf">p_bye</a></li>
<li><a href="#org6da68cc">export_ending</a></li>
</ul>
</li>
<li><a href="#org2a29588"><b>control</b></a>
<ul>
<li><a href="#org8e4591b">p_jump_back</a></li>
<li><a href="#org6643930">p_jump_over</a></li>
<li><a href="#orgc4c7280">i_lit</a></li>
<li><a href="#orgdf5dc97">i_tail_call</a></li>
<li><a href="#orgcd6ad0">p_jump_if_false</a></li>
<li><a href="#org58d160c">export_control</a></li>
</ul>
</li>
<li><a href="#org27cc371"><b>int</b></a>
<ul>
<li><a href="#orge843dee">p_mul</a></li>
<li><a href="#org1bb11d4">k_int</a></li>
<li><a href="#orgb48cdb3">export_int</a></li>
</ul>
</li>
<li><a href="#org70d0459"><span class="todo _gt__lt_">&gt;&lt;</span> <b>byte</b></a></li>
<li><a href="#org12d8fc5"><b>io</b></a>
<ul>
<li><a href="#orgc66bbe">read_symbol</a></li>
<li><a href="#orgae8386c">p_read_symbol</a></li>
<li><a href="#org49baa2a">p_simple_wirte</a></li>
<li><a href="#org23f1fc3">export_io</a></li>
</ul>
</li>
<li><a href="#orgcfc0efa"><b>bool</b></a>
<ul>
<li><a href="#orgb377d34">p_true</a></li>
<li><a href="#org3e25d73">p_false</a></li>
<li><a href="#orga557f6c">export_bool</a></li>
</ul>
</li>
<li><a href="#orgfb952cb"><b>keyword</b></a>
<ul>
<li><a href="#org6f641f1">k_comment</a></li>
<li><a href="#org6ae1971">k_if</a>
<ul>
<li><a href="#orgfe22dc3"><span class="todo note">note</span> </a></li>
<li><a href="#orgfc77ac8">compile_question</a></li>
<li><a href="#org4998166">compile_answer</a></li>
<li><a href="#orgca1bc41">k_if</a></li>
</ul>
</li>
<li><a href="#orgeae399">k_tail_call</a></li>
<li><a href="#org25be2f0">export_keyword</a></li>
</ul>
</li>
<li><a href="#org1f56f6"><b>top_level_keyword</b></a>
<ul>
<li><a href="#org56b35c">p_define_function</a></li>
<li><a href="#org3a0e994">export_top_level_keyword</a></li>
</ul>
</li>
<li><a href="#org68c66b9"><b>misc</b></a>
<ul>
<li><a href="#orge4af154">do_nothing</a></li>
<li><a href="#orgf25cdc3">export_mise</a></li>
</ul>
</li>
<li><a href="#org834ccd0"><b>play</b></a>
<ul>
<li><a href="#org9485763">k1</a></li>
<li><a href="#org325d865">export_play</a></li>
</ul>
</li>
<li><a href="#org5a81923"><b>repl</b></a>
<ul>
<li><a href="#org8b1d31">export_repl</a></li>
</ul>
</li>
<li><a href="#org30e556f">the_story_begins</a>
<ul>
<li><a href="#orgefb076d">the_story_begins</a></li>
<li><a href="#org9b17954">main</a></li>
</ul>
</li>
</ul>
</div>
</div>
<hr  />

<ul class="org-ul">
<li><p>the implementation of the interpreter (<a href="https://github.com/xieyuheng/jojo">source</a>)</p></li></ul>

<hr  />

<div id="outline-container-org325ad5b" class="outline-2">
<h2 id="org325ad5b"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-org325ad5b">
<ul class="org-ul">
<li><p>string</p></li>
<li><p>vector</p></li>
<li><p>fix jump</p></li></ul>
</div>
</div>

<div id="outline-container-org449da5f" class="outline-2">
<h2 id="org449da5f">helper</h2>
<div class="outline-text-2" id="text-org449da5f">
</div><div id="outline-container-org28f59e" class="outline-3">
<h3 id="org28f59e">header</h3>
<div class="outline-text-3" id="text-org28f59e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdio.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;ctype.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdlib.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdint.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;setjmp.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;string.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org820932a" class="outline-3">
<h3 id="org820932a">bool</h3>
<div class="outline-text-3" id="text-org820932a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">enum</span> { <span style="color: #ae81ff;">false</span>, <span style="color: #ae81ff;">true</span> } <span style="color: #66d9ef; font-weight: bold;">bool</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org931e4a2" class="outline-3">
<h3 id="org931e4a2">number</h3>
<div class="outline-text-3" id="text-org931e4a2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span>
<span style="color: #a6e22e;">max</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &lt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}

<span style="color: #66d9ef; font-weight: bold;">int</span>
<span style="color: #a6e22e;">min</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &gt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2326b9" class="outline-3">
<h3 id="orgc2326b9">char</h3>
<div class="outline-text-3" id="text-orgc2326b9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span>
<span style="color: #a6e22e;">isbarcket</span>
(<span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (c == <span style="color: #e6db74;">'('</span> ||
          c == <span style="color: #e6db74;">')'</span> ||
          c == <span style="color: #e6db74;">'['</span> ||
          c == <span style="color: #e6db74;">']'</span> ||
          c == <span style="color: #e6db74;">'{'</span> ||
          c == <span style="color: #e6db74;">'}'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge810f9d" class="outline-3">
<h3 id="orge810f9d">string</h3>
<div class="outline-text-3" id="text-orge810f9d">
</div><div id="outline-container-org2fbcb98" class="outline-4">
<h4 id="org2fbcb98">string</h4>
<div class="outline-text-4" id="text-org2fbcb98">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #66d9ef; font-weight: bold;">string</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc89f51" class="outline-4">
<h4 id="orgcc89f51">string_equal</h4>
<div class="outline-text-4" id="text-orgcc89f51">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span>
<span style="color: #a6e22e;">string_equal</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s2</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (strcmp(s1, s2) == 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd938a06" class="outline-4">
<h4 id="orgd938a06">nat_string_p</h4>
<div class="outline-text-4" id="text-orgd938a06">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span>
<span style="color: #a6e22e;">nat_string_p</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (str[i] != 0) {
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>isdigit(str[i])) {
      <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
      }
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4dd667e" class="outline-4">
<h4 id="org4dd667e">int_string_p</h4>
<div class="outline-text-4" id="text-org4dd667e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span>
<span style="color: #a6e22e;">int_string_p</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (str[0] == <span style="color: #e6db74;">'-'</span> ||
      str[0] == <span style="color: #e6db74;">'+'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str + 1);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str);
  }
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd96b697" class="outline-2">
<h2 id="orgd96b697">hashtable</h2>
<div class="outline-text-2" id="text-orgd96b697">
</div><div id="outline-container-orgad13d60" class="outline-3">
<h3 id="orgad13d60">primitive</h3>
<div class="outline-text-3" id="text-orgad13d60">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">void</span> (*<span style="color: #66d9ef; font-weight: bold;">primitive</span>)();
</pre>
</div>
</div>
</div>

<div id="outline-container-org394a671" class="outline-3">
<h3 id="org394a671">name &amp; jojo</h3>
<div class="outline-text-3" id="text-org394a671">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #66d9ef; font-weight: bold;">name</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">size</span>;
  <span style="color: #66d9ef; font-weight: bold;">name</span> *<span style="color: #fd971f;">array</span>;
} <span style="color: #66d9ef; font-weight: bold;">jojo</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4193dfb" class="outline-3">
<h3 id="org4193dfb">bind &amp; nametable_entry</h3>
<div class="outline-text-3" id="text-org4193dfb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">union</span> {
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">cell</span>;
  <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>;
  <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span>;
} <span style="color: #66d9ef; font-weight: bold;">bind</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>;
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">type</span>;
  <span style="color: #66d9ef; font-weight: bold;">bind</span> <span style="color: #fd971f;">value</span>;
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">orbit_length</span>;
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">orbiton</span>;
} <span style="color: #66d9ef; font-weight: bold;">nametable_entry</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org12b1b27" class="outline-3">
<h3 id="org12b1b27">new_nametable_entry</h3>
<div class="outline-text-3" id="text-org12b1b27">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #a6e22e;">k2n</span> (<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>);

<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span>
<span style="color: #a6e22e;">new_nametable_entry</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">e</span> = {
    .index = index,
    .key = 0,
    .type = k2n(<span style="color: #e6db74;">"none"</span>),
    .value.cell = 0,
    .orbit_length = 0,
    .orbiton = 0
  };
  <span style="color: #f92672; font-weight: bold;">return</span> e;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca3a407" class="outline-3">
<h3 id="orgca3a407">nametable_entry_[occured|entry_used|no_collision]</h3>
<div class="outline-text-3" id="text-orgca3a407">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span>
<span style="color: #a6e22e;">nametable_entry_occured</span>
(<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.key != 0;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span>
<span style="color: #a6e22e;">nametable_entry_used</span>
(<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.type != k2n(<span style="color: #e6db74;">"none"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span>
<span style="color: #a6e22e;">nametable_entry_no_collision</span>
(<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.index == e.orbiton;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org324a534" class="outline-3">
<h3 id="org324a534">nametable</h3>
<div class="outline-text-3" id="text-org324a534">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">prime table size</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000003   about 976 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000033</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100003    about 97 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">997</span>
<span style="color: #a6e22e;">#define</span> <span style="color: #fd971f;">nametable_size</span> 100003
<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">nametable</span>[nametable_size];
<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">nametable_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e170c6" class="outline-3">
<h3 id="org3e170c6">string_to_sum</h3>
<div class="outline-text-3" id="text-org3e170c6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span>
<span style="color: #a6e22e;">string_to_sum</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">sum</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">max_step</span> = 10;
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; strlen(str)) {
    sum = sum + str[i] * (2 &lt;&lt; min(i, max_step));
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5aebcfd" class="outline-3">
<h3 id="org5aebcfd">nametable_keyeq</h3>
<div class="outline-text-3" id="text-org5aebcfd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span>
<span style="color: #a6e22e;">nametable_keyeq</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k2</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> string_equal(k1, k2);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ec7ea" class="outline-3">
<h3 id="org2ec7ea">nametable_hash</h3>
<div class="outline-text-3" id="text-org2ec7ea">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span>
<span style="color: #a6e22e;">nametable_hash</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>, <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (counter + string_to_sum(key)) % nametable_size;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga750bed" class="outline-3">
<h3 id="orga750bed">string_area</h3>
<div class="outline-text-3" id="text-orga750bed">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">string_area</span>[4 * 1024 * 1024];
<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">string_area_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org52369de" class="outline-3">
<h3 id="org52369de">copy_to_string_area</h3>
<div class="outline-text-3" id="text-org52369de">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span>
<span style="color: #a6e22e;">copy_to_string_area</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> *<span style="color: #fd971f;">str1</span>;
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">i</span> = 0;
  str1 = (string_area + string_area_counter);
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #f92672; font-weight: bold;">if</span> (str[i] == 0) {
      str1[i] = str[i];
      i++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      str1[i] = str[i];
      i++;
    }
  }
  string_area_counter = i + string_area_counter;
  <span style="color: #f92672; font-weight: bold;">return</span> str1;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbcb74a9" class="outline-3">
<h3 id="orgbcb74a9">nametable_insert</h3>
<div class="outline-text-3" id="text-orgbcb74a9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes the hash_table is filled</span>
<span style="color: #a6e22e;">nametable_insert</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">orbit_index</span> = nametable_hash(key, 0);
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span> = nametable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>nametable_entry_occured(nametable[index])) {
      key = copy_to_string_area(key);
      nametable[index].key = key;
      nametable[index].orbiton = orbit_index;
      nametable[orbit_index].orbit_length = 1 + counter;
      nametable_counter = 1 + nametable_counter;
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (nametable_keyeq(key, nametable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == nametable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd18b3e" class="outline-3">
<h3 id="orgcd18b3e">nametable_search</h3>
<div class="outline-text-3" id="text-orgcd18b3e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes key not occured</span>
<span style="color: #a6e22e;">nametable_search</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span> = nametable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>nametable_entry_occured(nametable[index])) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (nametable_keyeq(key, nametable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == nametable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d3b18f" class="outline-3">
<h3 id="org6d3b18f">nametable_entry_print</h3>
<div class="outline-text-3" id="text-org6d3b18f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">n2k</span> (<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>);

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">nametable_entry_print</span>
(<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">entry</span>) {
  printf(<span style="color: #e6db74;">"%s : "</span>, n2k(entry.type));
  <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == k2n(<span style="color: #e6db74;">"cell"</span>)) {
    printf(<span style="color: #e6db74;">"%d"</span>, entry.value.cell);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == k2n(<span style="color: #e6db74;">"primitive"</span>)) {
    printf(<span style="color: #e6db74;">"%d"</span>, entry.value.primitive);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == k2n(<span style="color: #e6db74;">"jojo"</span>)) {
    printf(<span style="color: #e6db74;">"%d "</span>, entry.value.jojo.size);
    printf(<span style="color: #e6db74;">"[ "</span>, entry.value.jojo.size);
    <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">i</span>;
    <span style="color: #f92672; font-weight: bold;">for</span> (i=0; i &lt; entry.value.jojo.size; i=i+1) {
      printf(<span style="color: #e6db74;">"%d "</span>, entry.value.jojo.array[i]);
    }
    printf(<span style="color: #e6db74;">"]"</span>, entry.value.jojo.size);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org828bc9d" class="outline-3">
<h3 id="org828bc9d">nametable_report_orbit</h3>
<div class="outline-text-3" id="text-org828bc9d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">nametable_report_orbit</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">while</span> (counter &lt; nametable[index].orbit_length) {
    <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span> = nametable[index].key;
    <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">next_index</span> = nametable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (index == nametable[next_index].orbiton) {
      printf(<span style="color: #e6db74;">"  - %d %s\n"</span>, next_index, nametable[next_index].key);
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (nametable_entry_used(nametable[next_index])) {
      printf(<span style="color: #e6db74;">"    = "</span>);
      nametable_entry_print(nametable[next_index]);
      printf(<span style="color: #e6db74;">"\n"</span>);
    }
    counter = 1 + counter;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd34da8f" class="outline-3">
<h3 id="orgd34da8f">nametable_report</h3>
<div class="outline-text-3" id="text-orgd34da8f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">nametable_report</span>
() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- nametable_report\n"</span>);
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; nametable_size) {
    <span style="color: #f92672; font-weight: bold;">if</span> (nametable_entry_occured(nametable[index]) &amp;&amp;
        nametable_entry_no_collision(nametable[index])) {
      printf(<span style="color: #e6db74;">"  - %d %s // %d\n"</span>,
             index, nametable[index].key, nametable[index].orbit_length);
      <span style="color: #f92672; font-weight: bold;">if</span> (nametable_entry_used(nametable[index])) {
        printf(<span style="color: #e6db74;">"    = "</span>);
        nametable_entry_print(nametable[index]);
        printf(<span style="color: #e6db74;">"\n"</span>);
      }
      nametable_report_orbit(index, 1);
    }
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %d\n"</span>, nametable_counter);
  printf(<span style="color: #e6db74;">"- free : %d\n"</span>, nametable_size - nametable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb28ed68" class="outline-3">
<h3 id="orgb28ed68">nametable_print</h3>
<div class="outline-text-3" id="text-orgb28ed68">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">nametable_print</span>
() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- nametable_print\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; nametable_size) {
    printf(<span style="color: #e6db74;">"  - %d %s %d // %d\n"</span>,
           index,
           nametable[index].key,
           nametable[index].value,
           nametable[index].orbit_length);
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %d\n"</span>, nametable_counter);
  printf(<span style="color: #e6db74;">"- free : %d\n"</span>, nametable_size - nametable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7354a9" class="outline-3">
<h3 id="orgb7354a9">k2n &amp; n2k</h3>
<div class="outline-text-3" id="text-orgb7354a9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">name</span>
<span style="color: #a6e22e;">k2n</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable_insert(str);
}

<span style="color: #66d9ef; font-weight: bold;">string</span>
<span style="color: #a6e22e;">n2k</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable[index].key;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd994f20" class="outline-3">
<h3 id="orgd994f20">init_nametable</h3>
<div class="outline-text-3" id="text-orgd994f20">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">init_nametable</span>
() {
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; nametable_size) {
    nametable[i] = new_nametable_entry(i);
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5574544" class="outline-3">
<h3 id="org5574544">jojo_area</h3>
<div class="outline-text-3" id="text-org5574544">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">jojo_area</span>[1024 * 1024];
<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">jojo_area_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa74e5d" class="outline-3">
<h3 id="orgaa74e5d">here</h3>
<div class="outline-text-3" id="text-orgaa74e5d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">here</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">n</span>) {
  jojo_area[jojo_area_counter] = n;
  jojo_area_counter++;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ab176f" class="outline-3">
<h3 id="org4ab176f">nametable_set_cell</h3>
<div class="outline-text-3" id="text-org4ab176f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">nametable_set_cell</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">cell</span>) {
  nametable[index].type = k2n(<span style="color: #e6db74;">"cell"</span>);
  nametable[index].value.cell = cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3fb924f" class="outline-3">
<h3 id="org3fb924f">nametable_set_primitive</h3>
<div class="outline-text-3" id="text-org3fb924f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">nametable_set_primitive</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>) {
  nametable[index].type = k2n(<span style="color: #e6db74;">"primitive"</span>);
  nametable[index].value.primitive = primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf5d1dc" class="outline-3">
<h3 id="orgbf5d1dc">nametable_get_cell</h3>
<div class="outline-text-3" id="text-orgbf5d1dc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span>
<span style="color: #a6e22e;">nametable_get_cell</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable[index].value.cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge9602c" class="outline-3">
<h3 id="orge9602c">nametable_get_primitive</h3>
<div class="outline-text-3" id="text-orge9602c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">primitive</span>
<span style="color: #a6e22e;">nametable_get_primitive</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable[index].value.primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org15de882" class="outline-3">
<h3 id="org15de882">nametable_get_jojo</h3>
<div class="outline-text-3" id="text-org15de882">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jojo</span>
<span style="color: #a6e22e;">nametable_get_jojo</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable[index].value.jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d7355b" class="outline-3">
<h3 id="org7d7355b"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org7d7355b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">nametable_test</span>
() {
  k2n(<span style="color: #e6db74;">"testkey0"</span>);
  k2n(<span style="color: #e6db74;">"testkey1"</span>);
  k2n(<span style="color: #e6db74;">"testkey2"</span>);
  k2n(<span style="color: #e6db74;">"testkey3"</span>);
  k2n(<span style="color: #e6db74;">"testkey4"</span>);

  k2n(<span style="color: #e6db74;">"testkey0"</span>);
  k2n(<span style="color: #e6db74;">"testkey1"</span>);
  k2n(<span style="color: #e6db74;">"testkey2"</span>);
  k2n(<span style="color: #e6db74;">"testkey3"</span>);
  k2n(<span style="color: #e6db74;">"testkey4"</span>);

  k2n(<span style="color: #e6db74;">"testtestkey0"</span>);
  k2n(<span style="color: #e6db74;">"testtestkey1"</span>);
  k2n(<span style="color: #e6db74;">"testtestkey2"</span>);
  k2n(<span style="color: #e6db74;">"testtestkey3"</span>);
  k2n(<span style="color: #e6db74;">"testtestkey4"</span>);

  k2n(<span style="color: #e6db74;">"testtesttestkey0"</span>);
  k2n(<span style="color: #e6db74;">"testtesttestkey1"</span>);
  k2n(<span style="color: #e6db74;">"testtesttestkey2"</span>);
  k2n(<span style="color: #e6db74;">"testtesttestkey3"</span>);
  k2n(<span style="color: #e6db74;">"testtesttestkey4"</span>);

  k2n(<span style="color: #e6db74;">"testtesttesttestkey0"</span>);
  k2n(<span style="color: #e6db74;">"testtesttesttestkey1"</span>);
  k2n(<span style="color: #e6db74;">"testtesttesttestkey2"</span>);
  k2n(<span style="color: #e6db74;">"testtesttesttestkey3"</span>);
  k2n(<span style="color: #e6db74;">"testtesttesttestkey4"</span>);

  nametable_set_cell(k2n(<span style="color: #e6db74;">"k1"</span>), 1);
  nametable_report();

  nametable_set_cell(k2n(<span style="color: #e6db74;">"k1"</span>), 0);
  nametable_report();

  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">nametable_print();</span>
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga4d27a6" class="outline-2">
<h2 id="orga4d27a6">as &amp; rs</h2>
<div class="outline-text-2" id="text-orga4d27a6">
</div><div id="outline-container-orgd1d51af" class="outline-3">
<h3 id="orgd1d51af">as</h3>
<div class="outline-text-3" id="text-orgd1d51af">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #66d9ef; font-weight: bold;">argument_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">argument_stack</span> <span style="color: #fd971f;">as</span>;
<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">as_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">as_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">as_push</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">value</span>) {
  as[as_pointer] = value;
  as_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">int</span>
<span style="color: #a6e22e;">as_pop</span>
() {
  as_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> as[as_pointer];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3c270" class="outline-3">
<h3 id="orgf3c270">rs</h3>
<div class="outline-text-3" id="text-orgf3c270">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #66d9ef; font-weight: bold;">return_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">return_stack</span> <span style="color: #fd971f;">rs</span>;
<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">rs_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">rs_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">rs_push</span>
(<span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">value</span>) {
  rs[rs_pointer] = value;
  rs_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">name</span>*
<span style="color: #a6e22e;">rs_pop</span>
() {
  rs_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> rs[rs_pointer];
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org65da685" class="outline-2">
<h2 id="org65da685">define</h2>
<div class="outline-text-2" id="text-org65da685">
</div><div id="outline-container-org787e795" class="outline-3">
<h3 id="org787e795">define_primitive</h3>
<div class="outline-text-3" id="text-org787e795">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">define_primitive</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">fun</span>) {
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">index</span> = k2n(str);
  nametable_set_primitive(index, fun);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7453a9" class="outline-3">
<h3 id="orgc7453a9">define_function</h3>
<div class="outline-text-3" id="text-orgc7453a9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">define_function</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">size</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> *<span style="color: #fd971f;">str_array</span>) {
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">index</span> = k2n(str);
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">i</span>;
  <span style="color: #66d9ef; font-weight: bold;">name</span> *<span style="color: #fd971f;">array</span>;
  array = (jojo_area + jojo_area_counter);
  <span style="color: #f92672; font-weight: bold;">for</span> (i=0; i &lt; size; i=i+1) {
    array[i] = k2n(str_array[i]);
  }
  jojo_area_counter = size + jojo_area_counter;
  nametable[index].type = k2n(<span style="color: #e6db74;">"jojo"</span>);
  nametable[index].value.jojo.size = size;
  nametable[index].value.jojo.array = array;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2dde80" class="outline-3">
<h3 id="orgc2dde80">define_variable</h3>
<div class="outline-text-3" id="text-orgc2dde80">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">define_variable</span>
(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">cell</span>) {
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">index</span> = k2n(str);
  nametable_set_cell(index, cell);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf12a98" class="outline-2">
<h2 id="orgf12a98">apply</h2>
<div class="outline-text-2" id="text-orgf12a98">
</div><div id="outline-container-org19d133d" class="outline-3">
<h3 id="org19d133d">apply</h3>
<div class="outline-text-3" id="text-org19d133d">
<ul class="org-ul">
<li><p>be careful when calling this function in primitive</p><p>because after rs_push a jojo</p><p>one need to exit current primitive to run the jojo</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">apply</span>
(<span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>nametable_entry_used(nametable[jo])) {
    printf(<span style="color: #e6db74;">"undefined name : %s\n"</span>, n2k(jo));
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">jo_type</span> = nametable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = nametable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"jojo"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = nametable_get_jojo(jo);
    rs_push(jojo.array);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"cell"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">cell</span> = nametable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde5314c" class="outline-3">
<h3 id="orgde5314c">p_apply</h3>
<div class="outline-text-3" id="text-orgde5314c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_apply</span>
() {
  apply(as_pop());
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8689a8d" class="outline-2">
<h2 id="org8689a8d">eval</h2>
<div class="outline-text-2" id="text-org8689a8d">
</div><div id="outline-container-orgdcaf49c" class="outline-3">
<h3 id="orgdcaf49c">eval</h3>
<div class="outline-text-3" id="text-orgdcaf49c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jmp_buf</span> <span style="color: #fd971f;">jmp_buffer</span>;

<span style="color: #66d9ef; font-weight: bold;">bool</span>
<span style="color: #a6e22e;">exit_eval</span>
() {
  longjmp(jmp_buffer, 666);
}

<span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">eval</span>
() {
  <span style="color: #f92672; font-weight: bold;">if</span> (666 == setjmp(jmp_buffer)) {
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">rs_base</span> = rs_pointer;
    <span style="color: #f92672; font-weight: bold;">while</span> (rs_pointer &gt;= rs_base) {
      <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
      rs_push(function_body + 1);
      <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">int</span>*)function_body;
      apply(jo);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf525204" class="outline-3">
<h3 id="orgf525204">eval_jo</h3>
<div class="outline-text-3" id="text-orgf525204">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">eval_jo</span>
(<span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">jo_type</span> = nametable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = nametable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"jojo"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = nametable_get_jojo(jo);
    rs_push(jojo.array);
    eval();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"cell"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">cell</span> = nametable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2dcae8" class="outline-2">
<h2 id="org2dcae8"><b>stack_operation</b></h2>
<div class="outline-text-2" id="text-org2dcae8">
</div><div id="outline-container-org5d25cc6" class="outline-3">
<h3 id="org5d25cc6">p_dup</h3>
<div class="outline-text-3" id="text-org5d25cc6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_dup</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(int int -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1b9799" class="outline-3">
<h3 id="orge1b9799">p_print_stack</h3>
<div class="outline-text-3" id="text-orge1b9799">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_print_stack</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  <span style="color: #f92672; font-weight: bold;">if</span> (as_pointer &lt; as_base) {
    printf(<span style="color: #e6db74;">"  * %d *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- below the stack --\n"</span>);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    printf(<span style="color: #e6db74;">"  * %d *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- "</span>);
    <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">i</span> = as_base;
    <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; as_pointer) {
      printf(<span style="color: #e6db74;">"%d "</span>, as[i]);
      i++;
    }
    printf(<span style="color: #e6db74;">"--\n"</span>);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e8bb27" class="outline-3">
<h3 id="org8e8bb27">export_stack_operation</h3>
<div class="outline-text-3" id="text-org8e8bb27">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_stack_operation</span>
() {
  define_primitive(<span style="color: #e6db74;">"dup"</span>, p_dup);
  define_primitive(<span style="color: #e6db74;">"print-stack"</span>, p_print_stack);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge6c21d7" class="outline-2">
<h2 id="orge6c21d7"><b>ending</b></h2>
<div class="outline-text-2" id="text-orge6c21d7">
</div><div id="outline-container-orgf8a250" class="outline-3">
<h3 id="orgf8a250">p_end</h3>
<div class="outline-text-3" id="text-orgf8a250">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_end</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(rs: addr -&gt;)</span>
  rs_pop();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cd65cf" class="outline-3">
<h3 id="org5cd65cf">p_bye</h3>
<div class="outline-text-3" id="text-org5cd65cf">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_bye</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; [exit])</span>
  printf(<span style="color: #e6db74;">"bye bye ^-^/\n"</span>);
  exit_eval();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6da68cc" class="outline-3">
<h3 id="org6da68cc">export_ending</h3>
<div class="outline-text-3" id="text-org6da68cc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_ending</span>
() {
  define_primitive(<span style="color: #e6db74;">"end"</span>, p_end);
  define_primitive(<span style="color: #e6db74;">"bye"</span>, p_bye);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2a29588" class="outline-2">
<h2 id="org2a29588"><b>control</b></h2>
<div class="outline-text-2" id="text-org2a29588">
</div><div id="outline-container-org8e4591b" class="outline-3">
<h3 id="org8e4591b">p_jump_back</h3>
<div class="outline-text-3" id="text-org8e4591b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_jump_back</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(offset -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body - as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6643930" class="outline-3">
<h3 id="org6643930">p_jump_over</h3>
<div class="outline-text-3" id="text-org6643930">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_jump_over</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(offset -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body + as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4c7280" class="outline-3">
<h3 id="orgc4c7280">i_lit</h3>
<div class="outline-text-3" id="text-orgc4c7280">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">i_lit</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body + 1);
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">int</span>*)function_body;
  as_push(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf5dc97" class="outline-3">
<h3 id="orgdf5dc97">i_tail_call</h3>
<div class="outline-text-3" id="text-orgdf5dc97">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">i_tail_call</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">int</span>*)function_body;
  apply(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd6ad0" class="outline-3">
<h3 id="orgcd6ad0">p_jump_if_false</h3>
<div class="outline-text-3" id="text-orgcd6ad0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_jump_if_false</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool addr -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #f92672; font-weight: bold;">if</span> (b == 0) {
    rs_pop();
    rs_push(a);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org58d160c" class="outline-3">
<h3 id="org58d160c">export_control</h3>
<div class="outline-text-3" id="text-org58d160c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_control</span>
() {
  define_primitive(<span style="color: #e6db74;">"jump-back"</span>, p_jump_back);
  define_primitive(<span style="color: #e6db74;">"jump-over"</span>, p_jump_over);
  define_primitive(<span style="color: #e6db74;">"i/lit"</span>, i_lit);
  define_primitive(<span style="color: #e6db74;">"i/tail-call"</span>, i_tail_call);
  define_primitive(<span style="color: #e6db74;">"jump-if-false"</span>, p_jump_if_false);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org27cc371" class="outline-2">
<h2 id="org27cc371"><b>int</b></h2>
<div class="outline-text-2" id="text-org27cc371">
</div><div id="outline-container-orge843dee" class="outline-3">
<h3 id="orge843dee">p_mul</h3>
<div class="outline-text-3" id="text-orge843dee">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_mul</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(integer integer -&gt; integer)</span>
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">b</span> = as_pop();
  as_push(a * b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bb11d4" class="outline-3">
<h3 id="org1bb11d4">k_int</h3>
<div class="outline-text-3" id="text-org1bb11d4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">k_int</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [jojo_area])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(n2k(s))) {
      here(k2n(<span style="color: #e6db74;">"i/lit"</span>));
      here(atoi(n2k(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-int string in (# ...) : %s"</span>, n2k(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb48cdb3" class="outline-3">
<h3 id="orgb48cdb3">export_int</h3>
<div class="outline-text-3" id="text-orgb48cdb3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_int</span>
() {
  define_primitive(<span style="color: #e6db74;">"mul"</span>, p_mul);
  define_primitive(<span style="color: #e6db74;">"#"</span>, k_int);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org70d0459" class="outline-2">
<h2 id="org70d0459"><span class="todo _gt__lt_">&gt;&lt;</span> <b>byte</b></h2>
<div class="outline-text-2" id="text-org70d0459">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">uint8_t</span> <span style="color: #66d9ef; font-weight: bold;">byte</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org12d8fc5" class="outline-2">
<h2 id="org12d8fc5"><b>io</b></h2>
<div class="outline-text-2" id="text-org12d8fc5">
</div><div id="outline-container-orgc66bbe" class="outline-3">
<h3 id="orgc66bbe">read_symbol</h3>
<div class="outline-text-3" id="text-orgc66bbe">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">name</span>
<span style="color: #a6e22e;">read_symbol</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; symbol)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buf</span>[1024];
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">cur</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">collecting</span> = <span style="color: #ae81ff;">false</span>;
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>;
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">go</span> = <span style="color: #ae81ff;">true</span>;
  <span style="color: #f92672; font-weight: bold;">while</span> (go) {
    c = getchar();
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>collecting) {
      <span style="color: #f92672; font-weight: bold;">if</span> (isspace(c)) {
        <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        collecting = <span style="color: #ae81ff;">true</span>;
        buf[cur] = c;
        cur++;
        <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c)) {
          go = <span style="color: #ae81ff;">false</span>;
        }
      }
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c) ||
          isspace(c)) {
        ungetc(c, stdin);
        go = <span style="color: #ae81ff;">false</span>;
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        buf[cur] = c;
        cur++;
      }
    }
  }
  buf[cur] = 0;
  <span style="color: #f92672; font-weight: bold;">return</span> k2n(buf);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae8386c" class="outline-3">
<h3 id="orgae8386c">p_read_symbol</h3>
<div class="outline-text-3" id="text-orgae8386c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_read_symbol</span>
() {
  as_push(read_symbol());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org49baa2a" class="outline-3">
<h3 id="org49baa2a">p_simple_wirte</h3>
<div class="outline-text-3" id="text-org49baa2a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_simple_wirte</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(integer -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%d\n"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org23f1fc3" class="outline-3">
<h3 id="org23f1fc3">export_io</h3>
<div class="outline-text-3" id="text-org23f1fc3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_io</span>
() {
  define_primitive(<span style="color: #e6db74;">"read-symbol"</span>, p_read_symbol);
  define_primitive(<span style="color: #e6db74;">"simple-wirte"</span>, p_simple_wirte);
  define_primitive(<span style="color: #e6db74;">"."</span>, p_simple_wirte);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcfc0efa" class="outline-2">
<h2 id="orgcfc0efa"><b>bool</b></h2>
<div class="outline-text-2" id="text-orgcfc0efa">
</div><div id="outline-container-orgb377d34" class="outline-3">
<h3 id="orgb377d34">p_true</h3>
<div class="outline-text-3" id="text-orgb377d34">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_true</span>
() {
  as_push(1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e25d73" class="outline-3">
<h3 id="org3e25d73">p_false</h3>
<div class="outline-text-3" id="text-org3e25d73">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_false</span>
() {
  as_push(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga557f6c" class="outline-3">
<h3 id="orga557f6c">export_bool</h3>
<div class="outline-text-3" id="text-orga557f6c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_bool</span>
() {
  define_primitive(<span style="color: #e6db74;">"true"</span>, p_true);
  define_primitive(<span style="color: #e6db74;">"false"</span>, p_false);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb952cb" class="outline-2">
<h2 id="orgfb952cb"><b>keyword</b></h2>
<div class="outline-text-2" id="text-orgfb952cb">
</div><div id="outline-container-org6f641f1" class="outline-3">
<h3 id="org6f641f1">k_comment</h3>
<div class="outline-text-3" id="text-org6f641f1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">k_comment</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      k_comment();
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ae1971" class="outline-3">
<h3 id="org6ae1971">k_if</h3>
<div class="outline-text-3" id="text-org6ae1971">
</div><div id="outline-container-orgfe22dc3" class="outline-4">
<h4 id="orgfe22dc3"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-orgfe22dc3">
<ul class="org-ul">
<li><p>(if a b p? -&gt; c d)</p><p>a b p?</p><p>[jump] jumk_if_false</p><p>c d</p><p>:jump</p></li>

<li><p>because the use of as_snapshot</p><p>bar can not be nested in antecedent</p></li></ul>
</div>
</div>

<div id="outline-container-orgfc77ac8" class="outline-4">
<h4 id="orgfc77ac8">compile_question</h4>
<div class="outline-text-4" id="text-orgfc77ac8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">compile_question</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [jojo_area])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      eval_jo(read_symbol());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"-&gt;"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4998166" class="outline-4">
<h4 id="org4998166">compile_answer</h4>
<div class="outline-text-4" id="text-org4998166">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">compile_answer</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [jojo_area])</span>
  here(k2n(<span style="color: #e6db74;">"i/lit"</span>));
  <span style="color: #66d9ef; font-weight: bold;">int</span>* <span style="color: #fd971f;">offset_place</span> = (jojo_area + jojo_area_counter);
  jojo_area_counter++;
  here(k2n(<span style="color: #e6db74;">"jump-if-false"</span>));
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      eval_jo(read_symbol());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
  offset_place[0] = (jojo_area + jojo_area_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca1bc41" class="outline-4">
<h4 id="orgca1bc41">k_if</h4>
<div class="outline-text-4" id="text-orgca1bc41">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">k_if</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [jojo_area])</span>
  compile_question();
  compile_answer();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeae399" class="outline-3">
<h3 id="orgeae399">k_tail_call</h3>
<div class="outline-text-3" id="text-orgeae399">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">k_tail_call</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [jojo_area])</span>
  here(k2n(<span style="color: #e6db74;">"i/tail-call"</span>));
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
  here(s);
  k_comment();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org25be2f0" class="outline-3">
<h3 id="org25be2f0">export_keyword</h3>
<div class="outline-text-3" id="text-org25be2f0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_keyword</span>
() {
  define_primitive(<span style="color: #e6db74;">":"</span>, k_comment);
  define_primitive(<span style="color: #e6db74;">"if"</span>, k_if);
  define_primitive(<span style="color: #e6db74;">"taca"</span>, k_tail_call);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1f56f6" class="outline-2">
<h2 id="org1f56f6"><b>top_level_keyword</b></h2>
<div class="outline-text-2" id="text-org1f56f6">
</div><div id="outline-container-org56b35c" class="outline-3">
<h3 id="org56b35c">p_define_function</h3>
<div class="outline-text-3" id="text-org56b35c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">p_define_function</span>
() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [nametable])</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">index</span>;
  index = read_symbol();
  <span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">old_jojo_area_counter</span> = jojo_area_counter;
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">array</span> = jojo_area + jojo_area_counter;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      eval_jo(read_symbol());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      here(k2n(<span style="color: #e6db74;">"end"</span>));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
  nametable[index].type = k2n(<span style="color: #e6db74;">"jojo"</span>);
  nametable[index].value.jojo.size = jojo_area_counter - old_jojo_area_counter;
  nametable[index].value.jojo.array = array;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a0e994" class="outline-3">
<h3 id="org3a0e994">export_top_level_keyword</h3>
<div class="outline-text-3" id="text-org3a0e994">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_top_level_keyword</span>
() {
  define_primitive(<span style="color: #e6db74;">"~"</span>, p_define_function);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org68c66b9" class="outline-2">
<h2 id="org68c66b9"><b>misc</b></h2>
<div class="outline-text-2" id="text-org68c66b9">
</div><div id="outline-container-orge4af154" class="outline-3">
<h3 id="orge4af154">do_nothing</h3>
<div class="outline-text-3" id="text-orge4af154">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">do_nothing</span>
() {
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf25cdc3" class="outline-3">
<h3 id="orgf25cdc3">export_mise</h3>
<div class="outline-text-3" id="text-orgf25cdc3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_mise</span>
() {
  define_primitive(<span style="color: #e6db74;">"("</span>, do_nothing);
  define_primitive(<span style="color: #e6db74;">"apply"</span>, p_apply);
  define_primitive(<span style="color: #e6db74;">"nametable-report"</span>, nametable_report);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org834ccd0" class="outline-2">
<h2 id="org834ccd0"><b>play</b></h2>
<div class="outline-text-2" id="text-org834ccd0">
</div><div id="outline-container-org9485763" class="outline-3">
<h3 id="org9485763">k1</h3>
<div class="outline-text-3" id="text-org9485763">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">k1</span>
() {
  as_push(atoi(<span style="color: #e6db74;">"12345"</span>));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org325d865" class="outline-3">
<h3 id="org325d865">export_play</h3>
<div class="outline-text-3" id="text-org325d865">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_play</span>
() {
  define_primitive(<span style="color: #e6db74;">"k1"</span>, k1);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5a81923" class="outline-2">
<h2 id="org5a81923"><b>repl</b></h2>
<div class="outline-text-2" id="text-org5a81923">
</div><div id="outline-container-org8b1d31" class="outline-3">
<h3 id="org8b1d31">export_repl</h3>
<div class="outline-text-3" id="text-org8b1d31">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">export_repl</span>
() {
  define_variable(<span style="color: #e6db74;">"little-test-number"</span>, 4);
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">basic-repl can not be defined as primitive</span>
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">p_basic_repl</span>[] = {
    <span style="color: #e6db74;">"read-symbol"</span>,
    <span style="color: #e6db74;">"apply"</span>,
    <span style="color: #e6db74;">"little-test-number"</span>,
    <span style="color: #e6db74;">"jump-back"</span>
  };
  define_function(<span style="color: #e6db74;">"basic-repl"</span>, 4, p_basic_repl);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org30e556f" class="outline-2">
<h2 id="org30e556f">the_story_begins</h2>
<div class="outline-text-2" id="text-org30e556f">
</div><div id="outline-container-orgefb076d" class="outline-3">
<h3 id="orgefb076d">the_story_begins</h3>
<div class="outline-text-3" id="text-orgefb076d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>
<span style="color: #a6e22e;">the_story_begins</span>
() {

  init_nametable();

  export_stack_operation();
  export_ending();
  export_control();
  export_int();
  export_io();
  export_bool();
  export_keyword();
  export_top_level_keyword();
  export_mise();
  export_repl();
  export_play();

  <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">first_jojo</span> = nametable_get_jojo(k2n(<span style="color: #e6db74;">"basic-repl"</span>));
  rs_push(first_jojo.array);
  eval();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b17954" class="outline-3">
<h3 id="org9b17954">main</h3>
<div class="outline-text-3" id="text-org9b17954">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span>
<span style="color: #a6e22e;">main</span>
(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">argc</span>, <span style="color: #66d9ef; font-weight: bold;">string</span>* <span style="color: #fd971f;">argv</span>) {
  the_story_begins();
  <span style="color: #f92672; font-weight: bold;">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
</body>
</html>
