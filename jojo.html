<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-07-07 Thu 03:31 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="XIE Yuheng" />
<link rel="stylesheet" href="http://xieyuheng.github.io/asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
長悲嘆而掩面兮 憐其獨於夢睹
</div>
<div id="content">
<h1 class="title">jojo</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org36cfbd3"><span class="done todo">todo</span> </a></li>
<li><a href="#orgf06a7eb"><span class="todo note">note</span> </a>
<ul>
<li><a href="#orge4324a9">naming convention</a></li>
</ul>
</li>
<li><a href="#org97fcabd">helper</a>
<ul>
<li><a href="#org3944309">header</a></li>
<li><a href="#org6869e29">bool</a></li>
<li><a href="#org6879074">cell</a></li>
<li><a href="#orgddb3909">int</a></li>
<li><a href="#orgf1b05f0">byte</a></li>
<li><a href="#org40ac66c">char</a></li>
<li><a href="#org30bd39b">char_to_nat</a></li>
<li><a href="#org1ade8b5">string</a>
<ul>
<li><a href="#org5cf9b99">string</a></li>
<li><a href="#org9570699">string_equal</a></li>
<li><a href="#org713ebcc">nat_string_p</a></li>
<li><a href="#org2b2abd3">int_string_p</a></li>
<li><a href="#orgba8120f">string_to_based_[nat|int]</a></li>
<li><a href="#orge195eef">string_to_[dec|bin|oct|hex]</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org1229731">jotable</a>
<ul>
<li><a href="#orgf594e6f">primitive</a></li>
<li><a href="#org6897325">jo &amp; jojo</a></li>
<li><a href="#orged31668">bind &amp; jotable_entry</a></li>
<li><a href="#orgd86c401">proto_jotable_entry</a></li>
<li><a href="#org18a93f9">jotable_entry_[occured|entry_used|no_collision]</a></li>
<li><a href="#org8cee47f">jotable</a></li>
<li><a href="#org4aec4e9">string_to_sum</a></li>
<li><a href="#org6b02fad">jotable_keyeq</a></li>
<li><a href="#orgf7cbecd">jotable_hash</a></li>
<li><a href="#orga454aac">string_area</a></li>
<li><a href="#orgb681b51">copy_to_string_area</a></li>
<li><a href="#org5eaa3cc">jotable_insert</a></li>
<li><a href="#org7532b41">jotable_search</a></li>
<li><a href="#org78c9a51">jotable_entry_print</a></li>
<li><a href="#org6d9183a">jotable_report_orbit</a></li>
<li><a href="#orgcf5b5c0">jotable_report</a></li>
<li><a href="#orgbad61e">jotable_print</a></li>
<li><a href="#orgeed1a6e">str2jo &amp; jo2str</a></li>
<li><a href="#org90e5892">init_jotable</a></li>
<li><a href="#orgc7c3b9">jojo_area</a></li>
<li><a href="#orgb67290">here</a>
<ul>
<li><a href="#orgbc79b5b">compiling_stack</a></li>
<li><a href="#org70d15f">init_compiling_stack</a></li>
<li><a href="#org1524b1c">here</a></li>
</ul>
</li>
<li><a href="#org584289f">jotable_set_cell</a></li>
<li><a href="#org2f9d4f">jotable_set_primitive</a></li>
<li><a href="#org68da42a">jotable_get_cell</a></li>
<li><a href="#orgcfc0c1b">jotable_get_primitive</a></li>
<li><a href="#org1f11439">jotable_get_jojo</a></li>
<li><a href="#org5b9f234"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orgbe2cefb">defprim</a>
<ul>
<li><a href="#orgb1e2a19">defprim_record</a></li>
<li><a href="#orge90a9a">defprim_report</a></li>
<li><a href="#org468349d">defprim</a></li>
</ul>
</li>
<li><a href="#orge526d51">as &amp; rs</a>
<ul>
<li><a href="#org5454e3e">as</a></li>
<li><a href="#orgf8df2dc">rs</a></li>
</ul>
</li>
<li><a href="#orgee37907">jo_apply &amp; apply</a>
<ul>
<li><a href="#org14ccc2a"><span class="todo note">note</span> </a></li>
<li><a href="#org8cbad62">jo_apply</a></li>
<li><a href="#orgc1dd97">p_jo_apply</a></li>
<li><a href="#org7ec9590">apply</a></li>
<li><a href="#orgd473698">p_apply</a></li>
</ul>
</li>
<li><a href="#org3edfde9">eval</a>
<ul>
<li><a href="#org620461b">eval</a></li>
<li><a href="#org53c3a51">eval_jo</a></li>
<li><a href="#org8498818">eval_key</a></li>
<li><a href="#org535aa9c">eval_jojo</a></li>
</ul>
</li>
<li><a href="#org207303d"><b>stack_operation</b></a>
<ul>
<li><a href="#org13c76df">cell_copy</a></li>
<li><a href="#orgac35552">p_drop</a></li>
<li><a href="#org7ec3c71">p_dup</a></li>
<li><a href="#orgbdcf133">p_over</a></li>
<li><a href="#org39612b7">p_tuck</a></li>
<li><a href="#org3e72581">p_swap</a></li>
<li><a href="#org7a142c9">p_xy_swap</a></li>
<li><a href="#org22eda9e">p_print_stack</a></li>
<li><a href="#orgf5051d1">p_stack_base</a></li>
<li><a href="#orgab2648e">p_stack_pointer</a></li>
<li><a href="#orgffb0390">export_stack_operation</a></li>
</ul>
</li>
<li><a href="#orgb0c6f62"><b>ending</b></a>
<ul>
<li><a href="#org115493d">p_end</a></li>
<li><a href="#org89d5e4b">p_bye</a></li>
<li><a href="#org3cbeaf5">export_ending</a></li>
</ul>
</li>
<li><a href="#orgfb0de2b"><b>control</b></a>
<ul>
<li><a href="#orgd96b1d">i_lit</a></li>
<li><a href="#org947d474">i_tail_call</a></li>
<li><a href="#org813d74a">p_jump_if_false</a></li>
<li><a href="#org221aba">export_control</a></li>
</ul>
</li>
<li><a href="#orge14b9a1"><b>bool</b></a>
<ul>
<li><a href="#orgd431f4c">p_true</a></li>
<li><a href="#org7f46d01">p_false</a></li>
<li><a href="#org88ad05d">p_not</a></li>
<li><a href="#org45ea2b0">p_and</a></li>
<li><a href="#org53144e7">p_or</a></li>
<li><a href="#orgb03d3e1">export_bool</a></li>
</ul>
</li>
<li><a href="#org512bd45"><b>bit</b></a>
<ul>
<li><a href="#org9d6fd52">p_true_bit</a></li>
<li><a href="#org13db7f">p_false_bit</a></li>
<li><a href="#org63bf951">p_bit_and</a></li>
<li><a href="#org77dae10">p_bit_or</a></li>
<li><a href="#orgdd98e9">p_bit_xor</a></li>
<li><a href="#org7ca1394">p_bit_not</a></li>
<li><a href="#orgdf043d9">p_bit_shift_left</a></li>
<li><a href="#org5ef4aa1"><span class="todo note">note</span> shift_right &amp; arithmetic_shift_right</a></li>
<li><a href="#org5d37b18">export_bit</a></li>
</ul>
</li>
<li><a href="#org398a796"><b>int</b></a>
<ul>
<li><a href="#org2470ea6">p_add</a></li>
<li><a href="#org6dbafb6">p_sub</a></li>
<li><a href="#orgc5417cf">p_mul</a></li>
<li><a href="#org9ddff0">p_div</a></li>
<li><a href="#org7f7b578">p_mod</a></li>
<li><a href="#orgd6e992e">p_n_eq_p</a></li>
<li><a href="#org428431e">p_eq_p</a></li>
<li><a href="#orgfd9d04a">p_gt_p</a></li>
<li><a href="#orge48d496">p_lt_p</a></li>
<li><a href="#org13966c">p_gteq_p</a></li>
<li><a href="#org81ce9f3">p_lteq_p</a></li>
<li><a href="#org3e04906">k_int</a></li>
<li><a href="#orgfa0a423">k_bin</a></li>
<li><a href="#orgbbce71a">k_oct</a></li>
<li><a href="#org5556596">k_hex</a></li>
<li><a href="#org3eebd5f">p_int_print</a></li>
<li><a href="#orgad20b3b">p_dot</a></li>
<li><a href="#org5251185">export_int</a></li>
</ul>
</li>
<li><a href="#org6e72e71"><b>memory</b></a>
<ul>
<li><a href="#org318befe">p_allocate</a></li>
<li><a href="#orga09c444">p_free</a></li>
<li><a href="#org9ab257a">k_var</a></li>
<li><a href="#orgf9ede9b">p_set</a></li>
<li><a href="#org80003f0">p_get</a></li>
<li><a href="#org6e53e54">p_set_byte</a></li>
<li><a href="#orga88103">p_get_byte</a></li>
<li><a href="#org56de507">export_memory</a></li>
</ul>
</li>
<li><a href="#orgb7cb632"><b>byte</b></a>
<ul>
<li><a href="#org802e9b2">reading_stack</a></li>
<li><a href="#orgf2692ce">real_reading_path</a></li>
<li><a href="#org24ee162">read_byte</a></li>
<li><a href="#orgef2fad">byte_unread</a></li>
<li><a href="#org169b874">p_read_byte</a></li>
<li><a href="#orgba218dc">p_byte_unread</a></li>
<li><a href="#orgf978270">p_byte_print</a></li>
<li><a href="#orgc5412b3">export_byte</a></li>
</ul>
</li>
<li><a href="#orge1318a5"><b>jo</b></a>
<ul>
<li><a href="#org281ff86">loading_stack</a></li>
<li><a href="#org975ab47">alias_add</a></li>
<li><a href="#org8c9ab53">alias_find</a></li>
<li><a href="#org7bcb99e">read_jo_without_prefix</a></li>
<li><a href="#org474c1dd">read_jo</a></li>
<li><a href="#orgda9a644">p_read_jo_without_prefix</a></li>
<li><a href="#orgc3a5ea9">p_read_jo</a></li>
<li><a href="#org8199a5e">cat_2_jo</a></li>
<li><a href="#org8fe97e5">cat_3_jo</a></li>
<li><a href="#orgf9b4343">p_jo_used_p</a></li>
<li><a href="#org5c2d5f3">p_jo_to_string</a></li>
<li><a href="#orgd034eaf">p_string_length_to_jo</a></li>
<li><a href="#org6e37496">p_string_to_jo</a></li>
<li><a href="#org77eb0c3">p_null</a></li>
<li><a href="#org67d0b8d">k_jo</a></li>
<li><a href="#org4a65da2">export_jo</a></li>
</ul>
</li>
<li><a href="#orgc2e6a23"><b>string</b></a>
<ul>
<li><a href="#org923a0d9">k_string_one</a></li>
<li><a href="#orgb3f8978">k_string</a></li>
<li><a href="#orgf77b2cc">p_string_length</a></li>
<li><a href="#orgbb0bfb0">p_string_print</a></li>
<li><a href="#orgebd7dae">p_string_append_to_buffer</a></li>
<li><a href="#org7c7f577">export_string</a></li>
</ul>
</li>
<li><a href="#org523d1fa"><b>file</b></a>
<ul>
<li><a href="#orgfa0137b">file_readable_p</a></li>
<li><a href="#org239699b">dir_ok_p</a></li>
<li><a href="#orga6f5b8c">p_file_readable_p</a></li>
<li><a href="#orgfc3a3a8">p_dir_ok_p</a></li>
<li><a href="#org685ef69">export_file</a></li>
</ul>
</li>
<li><a href="#org5f4aab6"><b>system</b></a>
<ul>
<li><a href="#org8687442">p_current_dir</a></li>
<li><a href="#org54c766b">p_command_run</a></li>
<li><a href="#org510a5dd">p_n_command_run</a></li>
<li><a href="#orgc545a6d">p_argument_counter</a></li>
<li><a href="#org9234b7e">p_index_to_argument_string</a></li>
<li><a href="#orgb1990bc">p_var_string_to_env_string</a></li>
<li><a href="#orgd9519b7">export_system</a></li>
</ul>
</li>
<li><a href="#org982a760"><b>module</b></a>
<ul>
<li><a href="#org8b931bc">module_record</a></li>
<li><a href="#org12434ab">module_stack</a></li>
<li><a href="#org2502558">load_file</a></li>
<li><a href="#org5d8faae">p_load_file</a></li>
<li><a href="#orga198c1c">k_include_one</a></li>
<li><a href="#org44e056">k_include</a></li>
<li><a href="#org8108d9c">find_module_file_jo</a></li>
<li><a href="#org52ff9f7">find_module_dir_jo</a></li>
<li><a href="#org2a433fc">p_find_module_file_jo</a></li>
<li><a href="#orge534c6c">p_find_module_dir_jo</a></li>
<li><a href="#org3635394">import_module</a></li>
<li><a href="#org5a20638">k_dep_load</a></li>
<li><a href="#orgb3c299e">k_dep</a></li>
<li><a href="#orgb78f0a1">k_module</a></li>
<li><a href="#orgeb03c13">module_report_one</a></li>
<li><a href="#org646db56">module_report</a></li>
<li><a href="#orga3fbb74">export_module</a></li>
</ul>
</li>
<li><a href="#orgb999990"><b>ffi</b></a>
<ul>
<li><a href="#orge3dddab">ccall</a></li>
<li><a href="#orgbccd830">get_clib</a></li>
<li><a href="#org690ede7">k_clib_one</a></li>
<li><a href="#org808e2b">k_clib</a></li>
<li><a href="#orge66bbc2">export_ffi</a></li>
</ul>
</li>
<li><a href="#orgdece33"><b>top_level</b></a>
<ul>
<li><a href="#orgb37ea66">prim_jo_p &amp; fun_jo_p &amp; var_jo_p &amp; used_jo_p</a></li>
<li><a href="#orgcbe9d3">jo_to_jo_in_module</a></li>
<li><a href="#org5a6de65">read_jo_in_module</a></li>
<li><a href="#org2408d0e">k_defun</a>
<ul>
<li><a href="#orgb19b028">defun_record</a></li>
<li><a href="#orgd9516ea">p_defun_record</a></li>
<li><a href="#org32914f4">defun_report</a></li>
<li><a href="#org5d67bf5">defun_stack</a></li>
<li><a href="#org84627a4">k_defun</a></li>
</ul>
</li>
<li><a href="#org1c0f250">k_declare</a>
<ul>
<li><a href="#orge07a66e"><span class="todo note">note</span> </a></li>
<li><a href="#org721bb16">k_declare_one</a></li>
<li><a href="#org871d05b">k_declare</a></li>
</ul>
</li>
<li><a href="#org210d141">k_run</a></li>
<li><a href="#org8c4fd9e">k_defvar</a>
<ul>
<li><a href="#orgafefdea">defvar_record</a></li>
<li><a href="#org66f1f36">p_defvar_record</a></li>
<li><a href="#orgb70b5d5">defvar_report</a></li>
<li><a href="#org7d57f1e">k_defvar</a></li>
</ul>
</li>
<li><a href="#orgb51202a">p_top_repl</a></li>
<li><a href="#org29e1aa5">export_top_level</a></li>
</ul>
</li>
<li><a href="#orgf74c0b0"><b>keyword</b></a>
<ul>
<li><a href="#org5caa594">k_ignore</a></li>
<li><a href="#org30ef12e">compile_jojo_until_meet_jo</a></li>
<li><a href="#orgab5215d">k_compile_jojo_until_meet_jo</a></li>
<li><a href="#org45e4819">k_compile_jojo</a></li>
<li><a href="#org44f1dd6">k_if</a></li>
<li><a href="#orgd043c56">k_tail_call</a></li>
<li><a href="#orgd7fe7c5">k_loop</a></li>
<li><a href="#orgf6abab4">k_recur</a></li>
<li><a href="#org1a62640">p_compiling_stack_tos</a></li>
<li><a href="#org8a5cede">i_jojo</a></li>
<li><a href="#orge530eca">k_jojo</a></li>
<li><a href="#orgae10a8f">export_keyword</a></li>
</ul>
</li>
<li><a href="#orgc70d2a3"><b>misc</b></a>
<ul>
<li><a href="#org258825c">do_nothing</a></li>
<li><a href="#orgcfa3387">p_here</a></li>
<li><a href="#orgef6e0c">bar-ket</a></li>
<li><a href="#orga9b276e">p_cell_size</a></li>
<li><a href="#orgc6694fd">p_newline</a></li>
<li><a href="#org43a3a79">export_mise</a></li>
</ul>
</li>
<li><a href="#org9ed714"><b>play</b></a>
<ul>
<li><a href="#orgc0bd4a1">p1</a></li>
<li><a href="#org5a572d2">p2</a></li>
<li><a href="#org8d88a04">p3</a></li>
<li><a href="#orgc0ab6cc">export_play</a></li>
</ul>
</li>
<li><a href="#org57df822">main</a>
<ul>
<li><a href="#orgc1d7f49">init_top_repl</a></li>
<li><a href="#orgff947f4">main</a></li>
</ul>
</li>
</ul>
</div>
</div>
<hr  />

<ul class="org-ul">
<li><p>the implementation of the interpreter (<a href="https://github.com/xieyuheng/jojo">source</a>)</p></li></ul>

<hr  />

<div id="outline-container-org36cfbd3" class="outline-2">
<h2 id="org36cfbd3"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-org36cfbd3">
<ul class="org-ul">
<li><p>[test] test framework</p><p>make good use of separated module.jo</p></li>
<li><p>separate functions to module</p></li>
<li><p>(loop) and (recur) in jojo</p></li>
<li><p>fix semantic of case no "in between"</p></li>
<li><p>[safe] error report for every limited number</p><p>jo-max-length</p></li>
<li><p>[safe] to handle all the error</p></li>
<li><p>[debug] print jojo body</p></li>
<li><p>[debug] print return-stack</p></li>
<li><p>[debug] debug repl</p></li>
<li><p>[debug] trace</p></li>
<li><p>[debug] step</p></li>
<li><p>[doc] [maybe] by teaching</p></li>
<li><p>[maybe] package manager</p></li>
<li><p>better jotable for being compiler target</p></li></ul>
</div>
</div>

<div id="outline-container-orgf06a7eb" class="outline-2">
<h2 id="orgf06a7eb"><span class="todo note">note</span> </h2>
<div class="outline-text-2" id="text-orgf06a7eb">
</div><div id="outline-container-orge4324a9" class="outline-3">
<h3 id="orge4324a9">naming convention</h3>
<div class="outline-text-3" id="text-orge4324a9">
<ul class="org-ul">
<li><p>"-" phrase</p><p>verb/type (&#x2026; -&gt; type) (&#x2026; -&gt; [type])</p><p>type/verb (type -&gt; &#x2026;) ([type] -&gt; &#x2026;)</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-org97fcabd" class="outline-2">
<h2 id="org97fcabd">helper</h2>
<div class="outline-text-2" id="text-org97fcabd">
</div><div id="outline-container-org3944309" class="outline-3">
<h3 id="org3944309">header</h3>
<div class="outline-text-3" id="text-org3944309">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdio.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;ctype.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdlib.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdint.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;setjmp.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;string.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;dlfcn.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;unistd.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;sys/types.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;dirent.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6869e29" class="outline-3">
<h3 id="org6869e29">bool</h3>
<div class="outline-text-3" id="text-org6869e29">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">enum</span> { <span style="color: #ae81ff;">false</span>, <span style="color: #ae81ff;">true</span> } <span style="color: #66d9ef; font-weight: bold;">bool</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6879074" class="outline-3">
<h3 id="org6879074">cell</h3>
<div class="outline-text-3" id="text-org6879074">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">intptr_t</span> <span style="color: #66d9ef; font-weight: bold;">cell</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell_size</span> = <span style="color: #f92672; font-weight: bold;">sizeof</span>(cell);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgddb3909" class="outline-3">
<h3 id="orgddb3909">int</h3>
<div class="outline-text-3" id="text-orgddb3909">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">max</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &lt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">min</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &gt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">power</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">result</span> = 1;
  <span style="color: #f92672; font-weight: bold;">while</span> (n &gt;= 1) {
    result = result * a;
    n--;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1b05f0" class="outline-3">
<h3 id="orgf1b05f0">byte</h3>
<div class="outline-text-3" id="text-orgf1b05f0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">unsigned</span> <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #66d9ef; font-weight: bold;">byte</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org40ac66c" class="outline-3">
<h3 id="org40ac66c">char</h3>
<div class="outline-text-3" id="text-org40ac66c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">isbarcket</span>(<span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (c == <span style="color: #e6db74;">'('</span> ||
          c == <span style="color: #e6db74;">')'</span> ||
          c == <span style="color: #e6db74;">'['</span> ||
          c == <span style="color: #e6db74;">']'</span> ||
          c == <span style="color: #e6db74;">'{'</span> ||
          c == <span style="color: #e6db74;">'}'</span> ||
          c == <span style="color: #e6db74;">'"'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org30bd39b" class="outline-3">
<h3 id="org30bd39b">char_to_nat</h3>
<div class="outline-text-3" id="text-org30bd39b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">char_to_nat</span>(<span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (c &gt;= <span style="color: #e6db74;">'0'</span> &amp;&amp; c &lt;= <span style="color: #e6db74;">'9'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> (c - <span style="color: #e6db74;">'0'</span>);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (c &gt;= <span style="color: #e6db74;">'A'</span> &amp;&amp; c &lt;= <span style="color: #e6db74;">'Z'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> (c - <span style="color: #e6db74;">'A'</span>) + 10;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (c &gt;= <span style="color: #e6db74;">'a'</span> &amp;&amp; c &lt;= <span style="color: #e6db74;">'z'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> (c - <span style="color: #e6db74;">'a'</span>) + 10;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> 0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ade8b5" class="outline-3">
<h3 id="org1ade8b5">string</h3>
<div class="outline-text-3" id="text-org1ade8b5">
</div><div id="outline-container-org5cf9b99" class="outline-4">
<h4 id="org5cf9b99">string</h4>
<div class="outline-text-4" id="text-org5cf9b99">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #66d9ef; font-weight: bold;">string</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org9570699" class="outline-4">
<h4 id="org9570699">string_equal</h4>
<div class="outline-text-4" id="text-org9570699">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">string_equal</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s2</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (strcmp(s1, s2) == 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org713ebcc" class="outline-4">
<h4 id="org713ebcc">nat_string_p</h4>
<div class="outline-text-4" id="text-org713ebcc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">nat_string_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (str[i] != 0) {
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>isdigit(str[i])) {
      <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
      }
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b2abd3" class="outline-4">
<h4 id="org2b2abd3">int_string_p</h4>
<div class="outline-text-4" id="text-org2b2abd3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">int_string_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (str[0] == <span style="color: #e6db74;">'-'</span> ||
      str[0] == <span style="color: #e6db74;">'+'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str + 1);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba8120f" class="outline-4">
<h4 id="orgba8120f">string_to_based_[nat|int]</h4>
<div class="outline-text-4" id="text-orgba8120f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_based_nat</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">base</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">result</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">len</span> = strlen(str);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; len) {
    result = result + (char_to_nat(str[i]) * power(base, (len - i - 1)));
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> result;
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_based_int</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">base</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (str[0] == <span style="color: #e6db74;">'-'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> - string_to_based_nat(str, base);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_nat(str, base);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge195eef" class="outline-4">
<h4 id="orge195eef">string_to_[dec|bin|oct|hex]</h4>
<div class="outline-text-4" id="text-orge195eef">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_dec</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) { <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_int(str, 10); }
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_bin</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) { <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_int(str,  2); }
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_oct</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) { <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_int(str,  8); }
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_hex</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) { <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_int(str, 16); }
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org1229731" class="outline-2">
<h2 id="org1229731">jotable</h2>
<div class="outline-text-2" id="text-org1229731">
</div><div id="outline-container-orgf594e6f" class="outline-3">
<h3 id="orgf594e6f">primitive</h3>
<div class="outline-text-3" id="text-orgf594e6f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">void</span> (*<span style="color: #66d9ef; font-weight: bold;">primitive</span>)();
</pre>
</div>
</div>
</div>

<div id="outline-container-org6897325" class="outline-3">
<h3 id="org6897325">jo &amp; jojo</h3>
<div class="outline-text-3" id="text-org6897325">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #66d9ef; font-weight: bold;">jo</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">size</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> *<span style="color: #fd971f;">array</span>;
} <span style="color: #66d9ef; font-weight: bold;">jojo</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orged31668" class="outline-3">
<h3 id="orged31668">bind &amp; jotable_entry</h3>
<div class="outline-text-3" id="text-orged31668">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">union</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span>;
  <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>;
  <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span>;
} <span style="color: #66d9ef; font-weight: bold;">bind</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">type</span>;
  <span style="color: #66d9ef; font-weight: bold;">bind</span> <span style="color: #fd971f;">value</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbit_length</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbiton</span>;
} <span style="color: #66d9ef; font-weight: bold;">jotable_entry</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd86c401" class="outline-3">
<h3 id="orgd86c401">proto_jotable_entry</h3>
<div class="outline-text-3" id="text-orgd86c401">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">str2jo</span> (<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>);

<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #a6e22e;">proto_jotable_entry</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span> = {
    .index = index,
    .key = 0,
    .type = str2jo(<span style="color: #e6db74;">"none"</span>),
    .value.cell = 0,
    .orbit_length = 0,
    .orbiton = 0
  };
  <span style="color: #f92672; font-weight: bold;">return</span> e;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org18a93f9" class="outline-3">
<h3 id="org18a93f9">jotable_entry_[occured|entry_used|no_collision]</h3>
<div class="outline-text-3" id="text-org18a93f9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_entry_occured</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.key != 0;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_entry_used</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.type != str2jo(<span style="color: #e6db74;">"none"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_entry_no_collision</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.index == e.orbiton;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8cee47f" class="outline-3">
<h3 id="org8cee47f">jotable</h3>
<div class="outline-text-3" id="text-org8cee47f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">prime table size</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000003   about 976 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000033</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100003    about 97 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">997</span>
<span style="color: #a6e22e;">#define</span> <span style="color: #fd971f;">jotable_size</span> 100003
<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">jotable</span>[jotable_size];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jotable_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4aec4e9" class="outline-3">
<h3 id="org4aec4e9">string_to_sum</h3>
<div class="outline-text-3" id="text-org4aec4e9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_sum</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">sum</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">max_step</span> = 10;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; strlen(str)) {
    sum = sum + ((<span style="color: #66d9ef; font-weight: bold;">byte</span>) str[i]) * (2 &lt;&lt; min(i, max_step));
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b02fad" class="outline-3">
<h3 id="org6b02fad">jotable_keyeq</h3>
<div class="outline-text-3" id="text-org6b02fad">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_keyeq</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k2</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> string_equal(k1, k2);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7cbecd" class="outline-3">
<h3 id="orgf7cbecd">jotable_hash</h3>
<div class="outline-text-3" id="text-orgf7cbecd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_hash</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (counter + string_to_sum(key)) % jotable_size;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga454aac" class="outline-3">
<h3 id="orga454aac">string_area</h3>
<div class="outline-text-3" id="text-orga454aac">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">string_area</span>[4 * 1024 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">string_area_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb681b51" class="outline-3">
<h3 id="orgb681b51">copy_to_string_area</h3>
<div class="outline-text-3" id="text-orgb681b51">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">copy_to_string_area</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> *<span style="color: #fd971f;">str1</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  str1 = (string_area + string_area_counter);
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #f92672; font-weight: bold;">if</span> (str[i] == 0) {
      str1[i] = str[i];
      i++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      str1[i] = str[i];
      i++;
    }
  }
  string_area_counter = i + string_area_counter;
  <span style="color: #f92672; font-weight: bold;">return</span> str1;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5eaa3cc" class="outline-3">
<h3 id="org5eaa3cc">jotable_insert</h3>
<div class="outline-text-3" id="text-org5eaa3cc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes the hash_table is filled</span>
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_insert</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbit_index</span> = jotable_hash(key, 0);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = jotable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_occured(jotable[index])) {
      key = copy_to_string_area(key);
      jotable[index].key = key;
      jotable[index].orbiton = orbit_index;
      jotable[orbit_index].orbit_length = 1 + counter;
      jotable_counter = 1 + jotable_counter;
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable_keyeq(key, jotable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == jotable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7532b41" class="outline-3">
<h3 id="org7532b41">jotable_search</h3>
<div class="outline-text-3" id="text-org7532b41">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes key not occured</span>
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_search</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = jotable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_occured(jotable[index])) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable_keyeq(key, jotable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == jotable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org78c9a51" class="outline-3">
<h3 id="org78c9a51">jotable_entry_print</h3>
<div class="outline-text-3" id="text-org78c9a51">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">jo2str</span> (<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>);

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_entry_print</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">entry</span>) {
  printf(<span style="color: #e6db74;">"%s : "</span>, jo2str(entry.type));
  <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == str2jo(<span style="color: #e6db74;">"variable"</span>)) {
    printf(<span style="color: #e6db74;">"%ld"</span>, entry.value.cell);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == str2jo(<span style="color: #e6db74;">"primitive"</span>)) {
    printf(<span style="color: #e6db74;">"%ld"</span>, entry.value.primitive);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == str2jo(<span style="color: #e6db74;">"function"</span>)) {
    printf(<span style="color: #e6db74;">"%ld "</span>, entry.value.jojo.size);
    printf(<span style="color: #e6db74;">"[ "</span>);
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span>;
    <span style="color: #f92672; font-weight: bold;">for</span> (i=0; i &lt; entry.value.jojo.size; i=i+1) {
      printf(<span style="color: #e6db74;">"%ld "</span>, entry.value.jojo.array[i]);
    }
    printf(<span style="color: #e6db74;">"]"</span>);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d9183a" class="outline-3">
<h3 id="org6d9183a">jotable_report_orbit</h3>
<div class="outline-text-3" id="text-org6d9183a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_report_orbit</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">while</span> (counter &lt; jotable[index].orbit_length) {
    <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span> = jotable[index].key;
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">next_index</span> = jotable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (index == jotable[next_index].orbiton) {
      printf(<span style="color: #e6db74;">"  | %ld %s\n"</span>, next_index, jotable[next_index].key);
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[next_index])) {
      printf(<span style="color: #e6db74;">"    = "</span>);
      jotable_entry_print(jotable[next_index]);
      printf(<span style="color: #e6db74;">"\n"</span>);
    }
    counter = 1 + counter;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf5b5c0" class="outline-3">
<h3 id="orgcf5b5c0">jotable_report</h3>
<div class="outline-text-3" id="text-orgcf5b5c0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_report</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- jotable_report\n"</span>);
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; jotable_size) {
    <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_occured(jotable[index]) &amp;&amp;
        jotable_entry_no_collision(jotable[index])) {
      printf(<span style="color: #e6db74;">"  - %ld %s // %ld\n"</span>,
             index, jotable[index].key, jotable[index].orbit_length);
      <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[index])) {
        printf(<span style="color: #e6db74;">"    = "</span>);
        jotable_entry_print(jotable[index]);
        printf(<span style="color: #e6db74;">"\n"</span>);
      }
      jotable_report_orbit(index, 1);
    }
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %ld\n"</span>, jotable_counter);
  printf(<span style="color: #e6db74;">"- free : %ld\n"</span>, jotable_size - jotable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbad61e" class="outline-3">
<h3 id="orgbad61e">jotable_print</h3>
<div class="outline-text-3" id="text-orgbad61e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_print</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- jotable_print\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; jotable_size) {
    printf(<span style="color: #e6db74;">"  - %ld %s %ld // %ld\n"</span>,
           index,
           jotable[index].key,
           jotable[index].value,
           jotable[index].orbit_length);
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %ld\n"</span>, jotable_counter);
  printf(<span style="color: #e6db74;">"- free : %ld\n"</span>, jotable_size - jotable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeed1a6e" class="outline-3">
<h3 id="orgeed1a6e">str2jo &amp; jo2str</h3>
<div class="outline-text-3" id="text-orgeed1a6e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">str2jo</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable_insert(str);
}

<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">jo2str</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].key;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org90e5892" class="outline-3">
<h3 id="org90e5892">init_jotable</h3>
<div class="outline-text-3" id="text-org90e5892">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_jotable</span>() {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; jotable_size) {
    jotable[i] = proto_jotable_entry(i);
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7c3b9" class="outline-3">
<h3 id="orgc7c3b9">jojo_area</h3>
<div class="outline-text-3" id="text-orgc7c3b9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jojo_area</span>[1024 * 1024];
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb67290" class="outline-3">
<h3 id="orgb67290">here</h3>
<div class="outline-text-3" id="text-orgb67290">
</div><div id="outline-container-orgbc79b5b" class="outline-4">
<h4 id="orgbc79b5b">compiling_stack</h4>
<div class="outline-text-4" id="text-orgbc79b5b">
<ul class="org-ul">
<li><p>to redirect compiling location for "run"</p><p>"run" compiles function to a temporary place and run it</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #66d9ef; font-weight: bold;">compiling_stack_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">compiling_stack_t</span> <span style="color: #fd971f;">compiling_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">compiling_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">compiling_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compiling_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">value</span>) {
  compiling_stack[compiling_stack_pointer] = value;
  compiling_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">compiling_stack_pop</span>() {
  compiling_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack[compiling_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compiling_stack_inc</span>() {
  compiling_stack[compiling_stack_pointer - 1] =
    compiling_stack[compiling_stack_pointer - 1] + 1;
}


<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">compiling_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack[compiling_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">compiling_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack_pointer == compiling_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org70d15f" class="outline-4">
<h4 id="org70d15f">init_compiling_stack</h4>
<div class="outline-text-4" id="text-org70d15f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_compiling_stack</span>() {
  compiling_stack_push(jojo_area);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1524b1c" class="outline-4">
<h4 id="org1524b1c">here</h4>
<div class="outline-text-4" id="text-org1524b1c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">here</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">pointer</span> = compiling_stack_pop();
  pointer[0] = n;
  compiling_stack_push(pointer + 1);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org584289f" class="outline-3">
<h3 id="org584289f">jotable_set_cell</h3>
<div class="outline-text-3" id="text-org584289f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_set_cell</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span>) {
  jotable[index].type = str2jo(<span style="color: #e6db74;">"variable"</span>);
  jotable[index].value.cell = cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f9d4f" class="outline-3">
<h3 id="org2f9d4f">jotable_set_primitive</h3>
<div class="outline-text-3" id="text-org2f9d4f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_set_primitive</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>) {
  jotable[index].type = str2jo(<span style="color: #e6db74;">"primitive"</span>);
  jotable[index].value.primitive = primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org68da42a" class="outline-3">
<h3 id="org68da42a">jotable_get_cell</h3>
<div class="outline-text-3" id="text-org68da42a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_get_cell</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].value.cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcfc0c1b" class="outline-3">
<h3 id="orgcfc0c1b">jotable_get_primitive</h3>
<div class="outline-text-3" id="text-orgcfc0c1b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #a6e22e;">jotable_get_primitive</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].value.primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f11439" class="outline-3">
<h3 id="org1f11439">jotable_get_jojo</h3>
<div class="outline-text-3" id="text-org1f11439">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #a6e22e;">jotable_get_jojo</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].value.jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b9f234" class="outline-3">
<h3 id="org5b9f234"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org5b9f234">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_test</span>() {
  str2jo(<span style="color: #e6db74;">"testkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testtestkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testtesttestkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testtesttesttestkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey4"</span>);

  jotable_set_cell(str2jo(<span style="color: #e6db74;">"k1"</span>), 1);
  jotable_report();

  jotable_set_cell(str2jo(<span style="color: #e6db74;">"k1"</span>), 0);
  jotable_report();

  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">jotable_print();</span>
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbe2cefb" class="outline-2">
<h2 id="orgbe2cefb">defprim</h2>
<div class="outline-text-2" id="text-orgbe2cefb">
</div><div id="outline-container-orgb1e2a19" class="outline-3">
<h3 id="orgb1e2a19">defprim_record</h3>
<div class="outline-text-3" id="text-orgb1e2a19">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">defprim_record</span>[64 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defprim_record_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge90a9a" class="outline-3">
<h3 id="orge90a9a">defprim_report</h3>
<div class="outline-text-3" id="text-orge90a9a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defprim_report</span>() {
  printf(<span style="color: #e6db74;">"- defprim_report // counter : %ld\n"</span>, defprim_record_counter);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; defprim_record_counter) {
    printf(<span style="color: #e6db74;">"  %s\n"</span>, jo2str(defprim_record[i]));
    i++;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org468349d" class="outline-3">
<h3 id="org468349d">defprim</h3>
<div class="outline-text-3" id="text-org468349d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_ignore</span>();
<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">used_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>);
<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">jo_to_jo_in_module</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">alias_jo</span>);

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defprim</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">fun</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = jo_to_jo_in_module(str2jo(str));
  <span style="color: #f92672; font-weight: bold;">if</span> (used_jo_p(index)) {
    printf(<span style="color: #e6db74;">"- defprim can not re-define : %s\n"</span>, jo2str(index));
    printf(<span style="color: #e6db74;">"  it already defined as : %s\n"</span>, jo2str(jotable[index].type));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  defprim_record[defprim_record_counter] = index;
  defprim_record_counter++;
  defprim_record[defprim_record_counter] = 0;
  jotable_set_primitive(index, fun);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge526d51" class="outline-2">
<h2 id="orge526d51">as &amp; rs</h2>
<div class="outline-text-2" id="text-orge526d51">
</div><div id="outline-container-org5454e3e" class="outline-3">
<h3 id="org5454e3e">as</h3>
<div class="outline-text-3" id="text-org5454e3e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #66d9ef; font-weight: bold;">argument_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">argument_stack</span> <span style="color: #fd971f;">as</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">as_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">as_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">as_push</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">value</span>) {
  as[as_pointer] = value;
  as_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">as_pop</span>() {
  as_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> as[as_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">as_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> as[as_pointer - 1];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8df2dc" class="outline-3">
<h3 id="orgf8df2dc">rs</h3>
<div class="outline-text-3" id="text-orgf8df2dc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #66d9ef; font-weight: bold;">return_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">return_stack</span> <span style="color: #fd971f;">rs</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">rs_push</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">value</span>) {
  rs[rs_pointer] = value;
  rs_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">rs_pop</span>() {
  rs_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> rs[rs_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">rs_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> rs[rs_pointer - 1];
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgee37907" class="outline-2">
<h2 id="orgee37907">jo_apply &amp; apply</h2>
<div class="outline-text-2" id="text-orgee37907">
</div><div id="outline-container-org14ccc2a" class="outline-3">
<h3 id="org14ccc2a"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org14ccc2a">
<ul class="org-ul">
<li><p>be careful when calling apply function in primitive</p><p>because after rs_push a jojo</p><p>one need to exit current primitive to run the jojo</p></li></ul>
</div>
</div>

<div id="outline-container-org8cbad62" class="outline-3">
<h3 id="org8cbad62">jo_apply</h3>
<div class="outline-text-3" id="text-org8cbad62">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jo_apply</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_used(jotable[jo])) {
    printf(<span style="color: #e6db74;">"undefined jo : %s\n"</span>, jo2str(jo));
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo_type</span> = jotable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = jotable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"function"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = jotable_get_jojo(jo);
    rs_push(jojo.array);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"variable"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span> = jotable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1dd97" class="outline-3">
<h3 id="orgc1dd97">p_jo_apply</h3>
<div class="outline-text-3" id="text-orgc1dd97">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_apply</span>() {
  jo_apply(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ec9590" class="outline-3">
<h3 id="org7ec9590">apply</h3>
<div class="outline-text-3" id="text-org7ec9590">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">apply</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">jojo_array</span>) {
  rs_push(jojo_array);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd473698" class="outline-3">
<h3 id="orgd473698">p_apply</h3>
<div class="outline-text-3" id="text-orgd473698">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_apply</span>() {
  apply(as_pop());
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3edfde9" class="outline-2">
<h2 id="org3edfde9">eval</h2>
<div class="outline-text-2" id="text-org3edfde9">
</div><div id="outline-container-org620461b" class="outline-3">
<h3 id="org620461b">eval</h3>
<div class="outline-text-3" id="text-org620461b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jmp_buf</span> <span style="color: #fd971f;">eval_jmp_buffer</span>;

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">exit_eval</span>() {
  longjmp(eval_jmp_buffer, 666);
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (666 == setjmp(eval_jmp_buffer)) {
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_base</span> = rs_pointer;
    <span style="color: #f92672; font-weight: bold;">while</span> (rs_pointer &gt;= rs_base) {
      <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
      rs_push(function_body + 1);
      <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
      jo_apply(jo);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org53c3a51" class="outline-3">
<h3 id="org53c3a51">eval_jo</h3>
<div class="outline-text-3" id="text-org53c3a51">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo_type</span> = jotable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = jotable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"function"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = jotable_get_jojo(jo);
    rs_push(jojo.array);
    eval();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"variable"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span> = jotable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8498818" class="outline-3">
<h3 id="org8498818">eval_key</h3>
<div class="outline-text-3" id="text-org8498818">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_ignore</span>();

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_key</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_used(jotable[jo])) {
    printf(<span style="color: #e6db74;">"undefined keyword : %s\n"</span>, jo2str(jo));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  eval_jo(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org535aa9c" class="outline-3">
<h3 id="org535aa9c">eval_jojo</h3>
<div class="outline-text-3" id="text-org535aa9c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_jojo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">array</span>) {
  rs_push(array);
  eval();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org207303d" class="outline-2">
<h2 id="org207303d"><b>stack_operation</b></h2>
<div class="outline-text-2" id="text-org207303d">
</div><div id="outline-container-org13c76df" class="outline-3">
<h3 id="org13c76df">cell_copy</h3>
<div class="outline-text-3" id="text-org13c76df">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">cell_copy</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">length</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">from</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">to</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; length) {
    to[i] = from[i];
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac35552" class="outline-3">
<h3 id="orgac35552">p_drop</h3>
<div class="outline-text-3" id="text-orgac35552">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_drop</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a -&gt;)</span>
  as_pop();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ec3c71" class="outline-3">
<h3 id="org7ec3c71">p_dup</h3>
<div class="outline-text-3" id="text-org7ec3c71">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dup</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a a -&gt; a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbdcf133" class="outline-3">
<h3 id="orgbdcf133">p_over</h3>
<div class="outline-text-3" id="text-orgbdcf133">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_over</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; a b a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a);
  as_push(b);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org39612b7" class="outline-3">
<h3 id="org39612b7">p_tuck</h3>
<div class="outline-text-3" id="text-org39612b7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_tuck</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; b a b)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(b);
  as_push(a);
  as_push(b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e72581" class="outline-3">
<h3 id="org3e72581">p_swap</h3>
<div class="outline-text-3" id="text-org3e72581">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_swap</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; b a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(b);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a142c9" class="outline-3">
<h3 id="org7a142c9">p_xy_swap</h3>
<div class="outline-text-3" id="text-org7a142c9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_xy_swap</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(xxx yyy x y -&gt; yyy xxx)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">y</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">x</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">yp</span> = calloc(y, cell_size);
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">xp</span> = calloc(x, cell_size);
  cell_copy(y, (as + (as_pointer - y)), yp);
  cell_copy(x, (as + (as_pointer - y - x)), xp);
  cell_copy(y, yp, (as + (as_pointer - y - x)));
  cell_copy(x, xp, (as + (as_pointer - x)));
  free(yp);
  free(xp);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org22eda9e" class="outline-3">
<h3 id="org22eda9e">p_print_stack</h3>
<div class="outline-text-3" id="text-org22eda9e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_print_stack</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  printf(<span style="color: #e6db74;">"\n"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (as_pointer &lt; as_base) {
    printf(<span style="color: #e6db74;">"  * %ld *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- below the stack --\n"</span>);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    printf(<span style="color: #e6db74;">"  * %ld *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- "</span>);
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = as_base;
    <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; as_pointer) {
      printf(<span style="color: #e6db74;">"%ld "</span>, as[i]);
      i++;
    }
    printf(<span style="color: #e6db74;">"--\n"</span>);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5051d1" class="outline-3">
<h3 id="orgf5051d1">p_stack_base</h3>
<div class="outline-text-3" id="text-orgf5051d1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_stack_base</span>() {
  as_push(as + as_base);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab2648e" class="outline-3">
<h3 id="orgab2648e">p_stack_pointer</h3>
<div class="outline-text-3" id="text-orgab2648e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_stack_pointer</span>() {
  as_push(as + as_pointer);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffb0390" class="outline-3">
<h3 id="orgffb0390">export_stack_operation</h3>
<div class="outline-text-3" id="text-orgffb0390">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_stack_operation</span>() {
  defprim(<span style="color: #e6db74;">"drop"</span>, p_drop);
  defprim(<span style="color: #e6db74;">"dup"</span>, p_dup);
  defprim(<span style="color: #e6db74;">"over"</span>, p_over);
  defprim(<span style="color: #e6db74;">"tuck"</span>, p_tuck);
  defprim(<span style="color: #e6db74;">"swap"</span>, p_swap);
  defprim(<span style="color: #e6db74;">"xy-swap"</span>, p_xy_swap);
  defprim(<span style="color: #e6db74;">"print-stack"</span>, p_print_stack);
  defprim(<span style="color: #e6db74;">"stack-pointer"</span>, p_stack_pointer);
  defprim(<span style="color: #e6db74;">"stack-base"</span>, p_stack_base);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb0c6f62" class="outline-2">
<h2 id="orgb0c6f62"><b>ending</b></h2>
<div class="outline-text-2" id="text-orgb0c6f62">
</div><div id="outline-container-org115493d" class="outline-3">
<h3 id="org115493d">p_end</h3>
<div class="outline-text-3" id="text-org115493d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_end</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(rs: addr -&gt;)</span>
  rs_pop();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org89d5e4b" class="outline-3">
<h3 id="org89d5e4b">p_bye</h3>
<div class="outline-text-3" id="text-org89d5e4b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bye</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; [exit])</span>
  printf(<span style="color: #e6db74;">"bye bye ^-^/\n"</span>);
  exit(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3cbeaf5" class="outline-3">
<h3 id="org3cbeaf5">export_ending</h3>
<div class="outline-text-3" id="text-org3cbeaf5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_ending</span>() {
  defprim(<span style="color: #e6db74;">"end"</span>, p_end);
  defprim(<span style="color: #e6db74;">"bye"</span>, p_bye);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb0de2b" class="outline-2">
<h2 id="orgfb0de2b"><b>control</b></h2>
<div class="outline-text-2" id="text-orgfb0de2b">
</div><div id="outline-container-orgd96b1d" class="outline-3">
<h3 id="orgd96b1d">i_lit</h3>
<div class="outline-text-3" id="text-orgd96b1d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_lit</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body + 1);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
  as_push(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org947d474" class="outline-3">
<h3 id="org947d474">i_tail_call</h3>
<div class="outline-text-3" id="text-org947d474">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_tail_call</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
  jo_apply(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org813d74a" class="outline-3">
<h3 id="org813d74a">p_jump_if_false</h3>
<div class="outline-text-3" id="text-org813d74a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jump_if_false</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool addr -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #f92672; font-weight: bold;">if</span> (b == 0) {
    rs_pop();
    rs_push(a);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org221aba" class="outline-3">
<h3 id="org221aba">export_control</h3>
<div class="outline-text-3" id="text-org221aba">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_control</span>() {
  defprim(<span style="color: #e6db74;">"instruction/lit"</span>, i_lit);
  defprim(<span style="color: #e6db74;">"instruction/tail-call"</span>, i_tail_call);
  defprim(<span style="color: #e6db74;">"jump-if-false"</span>, p_jump_if_false);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge14b9a1" class="outline-2">
<h2 id="orge14b9a1"><b>bool</b></h2>
<div class="outline-text-2" id="text-orge14b9a1">
</div><div id="outline-container-orgd431f4c" class="outline-3">
<h3 id="orgd431f4c">p_true</h3>
<div class="outline-text-3" id="text-orgd431f4c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_true</span>() {
  as_push(1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f46d01" class="outline-3">
<h3 id="org7f46d01">p_false</h3>
<div class="outline-text-3" id="text-org7f46d01">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_false</span>() {
  as_push(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org88ad05d" class="outline-3">
<h3 id="org88ad05d">p_not</h3>
<div class="outline-text-3" id="text-org88ad05d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_not</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(<span style="color: #960050;">!</span>a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org45ea2b0" class="outline-3">
<h3 id="org45ea2b0">p_and</h3>
<div class="outline-text-3" id="text-org45ea2b0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_and</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool bool -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  as_push(a&amp;&amp;b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org53144e7" class="outline-3">
<h3 id="org53144e7">p_or</h3>
<div class="outline-text-3" id="text-org53144e7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_or</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool bool -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  as_push(a||b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb03d3e1" class="outline-3">
<h3 id="orgb03d3e1">export_bool</h3>
<div class="outline-text-3" id="text-orgb03d3e1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_bool</span>() {
  defprim(<span style="color: #e6db74;">"true"</span>, p_true);
  defprim(<span style="color: #e6db74;">"false"</span>, p_false);
  defprim(<span style="color: #e6db74;">"not"</span>, p_not);
  defprim(<span style="color: #e6db74;">"and"</span>, p_and);
  defprim(<span style="color: #e6db74;">"or"</span>, p_or);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org512bd45" class="outline-2">
<h2 id="org512bd45"><b>bit</b></h2>
<div class="outline-text-2" id="text-org512bd45">
</div><div id="outline-container-org9d6fd52" class="outline-3">
<h3 id="org9d6fd52">p_true_bit</h3>
<div class="outline-text-3" id="text-org9d6fd52">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_true_bit</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = -1;
  as_push(i);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org13db7f" class="outline-3">
<h3 id="org13db7f">p_false_bit</h3>
<div class="outline-text-3" id="text-org13db7f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_false_bit</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; cell)</span>
  as_push(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org63bf951" class="outline-3">
<h3 id="org63bf951">p_bit_and</h3>
<div class="outline-text-3" id="text-org63bf951">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_and</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a&amp;b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org77dae10" class="outline-3">
<h3 id="org77dae10">p_bit_or</h3>
<div class="outline-text-3" id="text-org77dae10">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_or</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a|b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd98e9" class="outline-3">
<h3 id="orgdd98e9">p_bit_xor</h3>
<div class="outline-text-3" id="text-orgdd98e9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_xor</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a^b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ca1394" class="outline-3">
<h3 id="org7ca1394">p_bit_not</h3>
<div class="outline-text-3" id="text-org7ca1394">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_not</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(~a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf043d9" class="outline-3">
<h3 id="orgdf043d9">p_bit_shift_left</h3>
<div class="outline-text-3" id="text-orgdf043d9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_shift_left</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell step -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">s</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a&lt;&lt;s);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ef4aa1" class="outline-3">
<h3 id="org5ef4aa1"><span class="todo note">note</span> shift_right &amp; arithmetic_shift_right</h3>
<div class="outline-text-3" id="text-org5ef4aa1">
<ul class="org-ul">
<li><p>must not use &gt;&gt; because its meaning is not sure in c</p></li></ul>
</div>
</div>

<div id="outline-container-org5d37b18" class="outline-3">
<h3 id="org5d37b18">export_bit</h3>
<div class="outline-text-3" id="text-org5d37b18">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_bit</span>() {
  defprim(<span style="color: #e6db74;">"true/bit"</span>, p_true_bit);
  defprim(<span style="color: #e6db74;">"false/bit"</span>, p_false_bit);
  defprim(<span style="color: #e6db74;">"bit/not"</span>, p_bit_not);
  defprim(<span style="color: #e6db74;">"bit/and"</span>, p_bit_and);
  defprim(<span style="color: #e6db74;">"bit/xor"</span>, p_bit_xor);
  defprim(<span style="color: #e6db74;">"bit/or"</span>, p_bit_or);
  defprim(<span style="color: #e6db74;">"bit/shift-left"</span>, p_bit_shift_left);
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">defprim("bit/shift-right", p_bit_shift_right);</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">defprim("bit/arithmetic-shift-right", p_bit_arithmetic_shift_right);</span>
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org398a796" class="outline-2">
<h2 id="org398a796"><b>int</b></h2>
<div class="outline-text-2" id="text-org398a796">
</div><div id="outline-container-org2470ea6" class="outline-3">
<h3 id="org2470ea6">p_add</h3>
<div class="outline-text-3" id="text-org2470ea6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_add</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a + b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6dbafb6" class="outline-3">
<h3 id="org6dbafb6">p_sub</h3>
<div class="outline-text-3" id="text-org6dbafb6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_sub</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a - b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5417cf" class="outline-3">
<h3 id="orgc5417cf">p_mul</h3>
<div class="outline-text-3" id="text-orgc5417cf">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_mul</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a * b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ddff0" class="outline-3">
<h3 id="org9ddff0">p_div</h3>
<div class="outline-text-3" id="text-org9ddff0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_div</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a / b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f7b578" class="outline-3">
<h3 id="org7f7b578">p_mod</h3>
<div class="outline-text-3" id="text-org7f7b578">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_mod</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a % b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6e992e" class="outline-3">
<h3 id="orgd6e992e">p_n_eq_p</h3>
<div class="outline-text-3" id="text-orgd6e992e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_n_eq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a ... b ... n -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">old_n</span> = n;
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">cursor1</span> = (as + as_pointer - n);
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">cursor2</span> = (as + as_pointer - n - n);
  <span style="color: #f92672; font-weight: bold;">while</span> (n &gt; 0) {
    <span style="color: #f92672; font-weight: bold;">if</span> (cursor1[n-1] != cursor2[n-1]) {
      as_pointer = as_pointer - old_n - old_n;
      as_push(<span style="color: #ae81ff;">false</span>);
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    n--;
  }
  as_pointer = as_pointer - old_n - old_n;
  as_push(<span style="color: #ae81ff;">true</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org428431e" class="outline-3">
<h3 id="org428431e">p_eq_p</h3>
<div class="outline-text-3" id="text-org428431e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_eq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a == b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd9d04a" class="outline-3">
<h3 id="orgfd9d04a">p_gt_p</h3>
<div class="outline-text-3" id="text-orgfd9d04a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_gt_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &gt; b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge48d496" class="outline-3">
<h3 id="orge48d496">p_lt_p</h3>
<div class="outline-text-3" id="text-orge48d496">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_lt_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &lt; b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org13966c" class="outline-3">
<h3 id="org13966c">p_gteq_p</h3>
<div class="outline-text-3" id="text-org13966c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_gteq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &gt;= b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org81ce9f3" class="outline-3">
<h3 id="org81ce9f3">p_lteq_p</h3>
<div class="outline-text-3" id="text-org81ce9f3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_lteq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &lt;= b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e04906" class="outline-3">
<h3 id="org3e04906">k_int</h3>
<div class="outline-text-3" id="text-org3e04906">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo</span>();

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_int</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(jo2str(s))) {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(string_to_dec(jo2str(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (int ...) : %s"</span>, jo2str(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa0a423" class="outline-3">
<h3 id="orgfa0a423">k_bin</h3>
<div class="outline-text-3" id="text-orgfa0a423">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_bin</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(jo2str(s))) {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(string_to_bin(jo2str(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (int ...) : %s"</span>, jo2str(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbbce71a" class="outline-3">
<h3 id="orgbbce71a">k_oct</h3>
<div class="outline-text-3" id="text-orgbbce71a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_oct</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(jo2str(s))) {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(string_to_oct(jo2str(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (int ...) : %s"</span>, jo2str(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5556596" class="outline-3">
<h3 id="org5556596">k_hex</h3>
<div class="outline-text-3" id="text-org5556596">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_hex</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(jo2str(s))) {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(string_to_hex(jo2str(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (int ...) : %s"</span>, jo2str(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3eebd5f" class="outline-3">
<h3 id="org3eebd5f">p_int_print</h3>
<div class="outline-text-3" id="text-org3eebd5f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_int_print</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%ld"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad20b3b" class="outline-3">
<h3 id="orgad20b3b">p_dot</h3>
<div class="outline-text-3" id="text-orgad20b3b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dot</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%ld "</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5251185" class="outline-3">
<h3 id="org5251185">export_int</h3>
<div class="outline-text-3" id="text-org5251185">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_int</span>() {
  defprim(<span style="color: #e6db74;">"add"</span>, p_add);
  defprim(<span style="color: #e6db74;">"sub"</span>, p_sub);

  defprim(<span style="color: #e6db74;">"mul"</span>, p_mul);
  defprim(<span style="color: #e6db74;">"div"</span>, p_div);
  defprim(<span style="color: #e6db74;">"mod"</span>, p_mod);

  defprim(<span style="color: #e6db74;">"neg"</span>, p_not);

  defprim(<span style="color: #e6db74;">"n-eq?"</span>, p_n_eq_p);

  defprim(<span style="color: #e6db74;">"eq?"</span>, p_eq_p);
  defprim(<span style="color: #e6db74;">"gt?"</span>, p_gt_p);
  defprim(<span style="color: #e6db74;">"lt?"</span>, p_lt_p);
  defprim(<span style="color: #e6db74;">"gteq?"</span>, p_gteq_p);
  defprim(<span style="color: #e6db74;">"lteq?"</span>, p_lteq_p);

  defprim(<span style="color: #e6db74;">"int"</span>, k_int);
  defprim(<span style="color: #e6db74;">"dec"</span>, k_int);
  defprim(<span style="color: #e6db74;">"bin"</span>, k_bin);
  defprim(<span style="color: #e6db74;">"oct"</span>, k_oct);
  defprim(<span style="color: #e6db74;">"hex"</span>, k_hex);

  defprim(<span style="color: #e6db74;">"int/print"</span>, p_int_print);
  defprim(<span style="color: #e6db74;">"dot"</span>, p_dot);
  defprim(<span style="color: #e6db74;">"int/dot"</span>, p_dot);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6e72e71" class="outline-2">
<h2 id="org6e72e71"><b>memory</b></h2>
<div class="outline-text-2" id="text-org6e72e71">
</div><div id="outline-container-org318befe" class="outline-3">
<h3 id="org318befe">p_allocate</h3>
<div class="outline-text-3" id="text-org318befe">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_allocate</span> () {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(size -&gt; addr)</span>
  as_push(calloc(as_pop(), 1));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga09c444" class="outline-3">
<h3 id="orga09c444">p_free</h3>
<div class="outline-text-3" id="text-orga09c444">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_free</span> () {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(addr -&gt;)</span>
  free(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ab257a" class="outline-3">
<h3 id="org9ab257a">k_var</h3>
<div class="outline-text-3" id="text-org9ab257a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_var</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_jo();
  here(&amp;(jotable[index].value.cell));
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9ede9b" class="outline-3">
<h3 id="orgf9ede9b">p_set</h3>
<div class="outline-text-3" id="text-orgf9ede9b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_set</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell addr -&gt;)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">address</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">value</span> = as_pop();
  address[0] = value;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org80003f0" class="outline-3">
<h3 id="org80003f0">p_get</h3>
<div class="outline-text-3" id="text-org80003f0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_get</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(addr -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">address</span> = as_pop();
  as_push(address[0]);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e53e54" class="outline-3">
<h3 id="org6e53e54">p_set_byte</h3>
<div class="outline-text-3" id="text-org6e53e54">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_set_byte</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell addr -&gt;)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">address</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">value</span> = as_pop();
  address[0] = value;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga88103" class="outline-3">
<h3 id="orga88103">p_get_byte</h3>
<div class="outline-text-3" id="text-orga88103">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_get_byte</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(addr -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">address</span> = as_pop();
  as_push(address[0]);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org56de507" class="outline-3">
<h3 id="org56de507">export_memory</h3>
<div class="outline-text-3" id="text-org56de507">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_memory</span>() {
  defprim(<span style="color: #e6db74;">"allocate"</span>, p_allocate);
  defprim(<span style="color: #e6db74;">"free"</span>, p_free);
  defprim(<span style="color: #e6db74;">"var"</span>, k_var);
  defprim(<span style="color: #e6db74;">"set"</span>, p_set);
  defprim(<span style="color: #e6db74;">"get"</span>, p_get);
  defprim(<span style="color: #e6db74;">"set-byte"</span>, p_set_byte);
  defprim(<span style="color: #e6db74;">"get-byte"</span>, p_get_byte);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb7cb632" class="outline-2">
<h2 id="orgb7cb632"><b>byte</b></h2>
<div class="outline-text-2" id="text-orgb7cb632">
</div><div id="outline-container-org802e9b2" class="outline-3">
<h3 id="org802e9b2">reading_stack</h3>
<div class="outline-text-3" id="text-org802e9b2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">file_handle</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">file</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">dir</span>;
} <span style="color: #66d9ef; font-weight: bold;">reading_point</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #66d9ef; font-weight: bold;">reading_stack_t</span>[64];

<span style="color: #66d9ef; font-weight: bold;">reading_stack_t</span> <span style="color: #fd971f;">reading_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">reading_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">reading_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">reading_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #fd971f;">value</span>) {
  reading_stack[reading_stack_pointer] = value;
  reading_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #a6e22e;">reading_stack_pop</span>() {
  reading_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack[reading_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #a6e22e;">reading_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack[reading_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">reading_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack_pointer == reading_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2692ce" class="outline-3">
<h3 id="orgf2692ce">real_reading_path</h3>
<div class="outline-text-3" id="text-orgf2692ce">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">real_reading_path</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>, <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">buffer</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (path[0] == <span style="color: #e6db74;">'/'</span>) {
    realpath(path, buffer);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    realpath(path, buffer);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    buffer[0] = 0;
    strcat(buffer, reading_stack_tos().dir);
    strcat(buffer, <span style="color: #e6db74;">"/"</span>);
    strcat(buffer, path);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org24ee162" class="outline-3">
<h3 id="org24ee162">read_byte</h3>
<div class="outline-text-3" id="text-org24ee162">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #a6e22e;">read_byte</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    <span style="color: #f92672; font-weight: bold;">return</span> fgetc(stdin);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = fgetc(reading_stack_tos().file_handle);
    <span style="color: #f92672; font-weight: bold;">if</span> (c == EOF) {
      <span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #fd971f;">rp</span> = reading_stack_pop();
      fclose(rp.file_handle);
      free(rp.file);
      free(rp.dir);
      <span style="color: #f92672; font-weight: bold;">return</span> read_byte();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">return</span> c;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef2fad" class="outline-3">
<h3 id="orgef2fad">byte_unread</h3>
<div class="outline-text-3" id="text-orgef2fad">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">byte_unread</span>(<span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    ungetc(c, stdin);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    ungetc(c, reading_stack_tos().file_handle);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org169b874" class="outline-3">
<h3 id="org169b874">p_read_byte</h3>
<div class="outline-text-3" id="text-org169b874">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_byte</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; byte)</span>
  as_push(read_byte());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba218dc" class="outline-3">
<h3 id="orgba218dc">p_byte_unread</h3>
<div class="outline-text-3" id="text-orgba218dc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_byte_unread</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(byte -&gt; [reading_stack])</span>
  byte_unread(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf978270" class="outline-3">
<h3 id="orgf978270">p_byte_print</h3>
<div class="outline-text-3" id="text-orgf978270">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_byte_print</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(byte -&gt;)</span>
  printf(<span style="color: #e6db74;">"%c"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5412b3" class="outline-3">
<h3 id="orgc5412b3">export_byte</h3>
<div class="outline-text-3" id="text-orgc5412b3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_byte</span>() {
  defprim(<span style="color: #e6db74;">"read/byte"</span>, p_read_byte);
  defprim(<span style="color: #e6db74;">"byte/unread"</span>, p_byte_unread);
  defprim(<span style="color: #e6db74;">"byte/print"</span>, p_byte_print);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge1318a5" class="outline-2">
<h2 id="orge1318a5"><b>jo</b></h2>
<div class="outline-text-2" id="text-orge1318a5">
</div><div id="outline-container-org281ff86" class="outline-3">
<h3 id="org281ff86">loading_stack</h3>
<div class="outline-text-3" id="text-org281ff86">
<ul class="org-ul">
<li><p>a hook for read_jo</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">nick</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>;
} <span style="color: #66d9ef; font-weight: bold;">alias</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #66d9ef; font-weight: bold;">loading_stack_t</span>[64];

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">alias_record_size</span> = 1024;

<span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">loading_stack_area</span>[64][1024];

<span style="color: #66d9ef; font-weight: bold;">loading_stack_t</span> <span style="color: #fd971f;">loading_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">loading_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">loading_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">loading_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #fd971f;">value</span>) {
  loading_stack[loading_stack_pointer] = value;
  loading_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #a6e22e;">loading_stack_pop</span>() {
  loading_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> loading_stack[loading_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #a6e22e;">loading_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> loading_stack[loading_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">loading_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> loading_stack_pointer == loading_stack_base;
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_loading_stack</span>() {
  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">record</span>[alias_record_size];
  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">a</span> = {.nick = 0, .name = 0};
  record[0] = a;
  loading_stack_push(record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org975ab47" class="outline-3">
<h3 id="org975ab47">alias_add</h3>
<div class="outline-text-3" id="text-org975ab47">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">alias_add</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">nick</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #fd971f;">alias_record</span> = loading_stack_tos();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; alias_record_size) {
    <span style="color: #f92672; font-weight: bold;">if</span> (alias_record[i].nick == 0 &amp;&amp;
        alias_record[i].name == 0) {
      alias_record[i].nick = nick;
      alias_record[i].name = name;
      alias_record[i+1].nick = 0;
      alias_record[i+1].name = 0;
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      i++;
    }
  }
  printf(<span style="color: #e6db74;">"alias_add fail alias_record is full\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c9ab53" class="outline-3">
<h3 id="org8c9ab53">alias_find</h3>
<div class="outline-text-3" id="text-org8c9ab53">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">alias_find</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">nick</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #fd971f;">alias_record</span> = loading_stack_tos();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #f92672; font-weight: bold;">if</span> (alias_record[i].nick == 0 &amp;&amp;
        alias_record[i].name == 0) {
      <span style="color: #f92672; font-weight: bold;">return</span> 0;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (alias_record[i].nick == nick) {
      <span style="color: #f92672; font-weight: bold;">return</span> alias_record[i].name;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      i++;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7bcb99e" class="outline-3">
<h3 id="org7bcb99e">read_jo_without_prefix</h3>
<div class="outline-text-3" id="text-org7bcb99e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo_without_prefix</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #fd971f;">buf</span>[1024];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cur</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">collecting</span> = <span style="color: #ae81ff;">false</span>;
  <span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #fd971f;">c</span>;
  <span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #fd971f;">go</span> = <span style="color: #ae81ff;">true</span>;
  <span style="color: #f92672; font-weight: bold;">while</span> (go) {
    c = read_byte();
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>collecting) {
      <span style="color: #f92672; font-weight: bold;">if</span> (isspace(c)) {
        <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        collecting = <span style="color: #ae81ff;">true</span>;
        buf[cur] = c;
        cur++;
        <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c)) {
          go = <span style="color: #ae81ff;">false</span>;
        }
      }
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c) ||
          isspace(c)) {
        byte_unread(c);
        go = <span style="color: #ae81ff;">false</span>;
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        buf[cur] = c;
        cur++;
      }
    }
  }
  buf[cur] = 0;
  <span style="color: #f92672; font-weight: bold;">return</span> str2jo(buf);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org474c1dd" class="outline-3">
<h3 id="org474c1dd">read_jo</h3>
<div class="outline-text-3" id="text-org474c1dd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo0</span> = read_jo_without_prefix();
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo1</span> = alias_find(jo0);
  <span style="color: #f92672; font-weight: bold;">if</span> (jo1 != 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> jo1;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> jo0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda9a644" class="outline-3">
<h3 id="orgda9a644">p_read_jo_without_prefix</h3>
<div class="outline-text-3" id="text-orgda9a644">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_jo_without_prefix</span>() {
  as_push(read_jo_without_prefix());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3a5ea9" class="outline-3">
<h3 id="orgc3a5ea9">p_read_jo</h3>
<div class="outline-text-3" id="text-orgc3a5ea9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_jo</span>() {
  as_push(read_jo());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8199a5e" class="outline-3">
<h3 id="org8199a5e">cat_2_jo</h3>
<div class="outline-text-3" id="text-org8199a5e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">cat_2_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">x</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">y</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">str</span>[2 * 1024];
  str[0] = 0;
  strcat(str, jo2str(x));
  strcat(str, jo2str(y));
  <span style="color: #f92672; font-weight: bold;">return</span> str2jo(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8fe97e5" class="outline-3">
<h3 id="org8fe97e5">cat_3_jo</h3>
<div class="outline-text-3" id="text-org8fe97e5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">cat_3_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">x</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">y</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">z</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">str</span>[3 * 1024];
  str[0] = 0;
  strcat(str, jo2str(x));
  strcat(str, jo2str(y));
  strcat(str, jo2str(z));
  <span style="color: #f92672; font-weight: bold;">return</span> str2jo(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9b4343" class="outline-3">
<h3 id="orgf9b4343">p_jo_used_p</h3>
<div class="outline-text-3" id="text-orgf9b4343">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_used_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span> = as_pop();
  as_push(jotable_entry_used(jotable[jo]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c2d5f3" class="outline-3">
<h3 id="org5c2d5f3">p_jo_to_string</h3>
<div class="outline-text-3" id="text-org5c2d5f3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_to_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span> = as_pop();
  as_push(jo2str(jo));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd034eaf" class="outline-3">
<h3 id="orgd034eaf">p_string_length_to_jo</h3>
<div class="outline-text-3" id="text-orgd034eaf">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_length_to_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string length -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">len</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">str</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[2 * 1024];
  strncpy(buffer, str, len);
  buffer[len] = 0;
  as_push(str2jo(buffer));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e37496" class="outline-3">
<h3 id="org6e37496">p_string_to_jo</h3>
<div class="outline-text-3" id="text-org6e37496">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_to_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = as_pop();
  as_push(str2jo(str));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org77eb0c3" class="outline-3">
<h3 id="org77eb0c3">p_null</h3>
<div class="outline-text-3" id="text-org77eb0c3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_null</span>() {
  as_push(str2jo(<span style="color: #e6db74;">"null"</span>));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org67d0b8d" class="outline-3">
<h3 id="org67d0b8d">k_jo</h3>
<div class="outline-text-3" id="text-org67d0b8d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(s);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a65da2" class="outline-3">
<h3 id="org4a65da2">export_jo</h3>
<div class="outline-text-3" id="text-org4a65da2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_jo</span>() {
  defprim(<span style="color: #e6db74;">"null"</span>, p_null);
  defprim(<span style="color: #e6db74;">"read/jo"</span>, p_read_jo);
  defprim(<span style="color: #e6db74;">"read/jo/without-prefix"</span>, p_read_jo_without_prefix);
  defprim(<span style="color: #e6db74;">"jo/used?"</span>, p_jo_used_p);
  defprim(<span style="color: #e6db74;">"jo-&gt;string"</span>, p_jo_to_string);
  defprim(<span style="color: #e6db74;">"string-&gt;jo"</span>, p_string_to_jo);
  defprim(<span style="color: #e6db74;">"string/length-&gt;jo"</span>, p_string_length_to_jo);
  defprim(<span style="color: #e6db74;">"jo"</span>, k_jo);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc2e6a23" class="outline-2">
<h2 id="orgc2e6a23"><b>string</b></h2>
<div class="outline-text-2" id="text-orgc2e6a23">
</div><div id="outline-container-org923a0d9" class="outline-3">
<h3 id="org923a0d9">k_string_one</h3>
<div class="outline-text-3" id="text-org923a0d9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_string_one</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[1024 * 1024];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cursor</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = read_byte();
    <span style="color: #f92672; font-weight: bold;">if</span> (c == <span style="color: #e6db74;">'"'</span>) {
      buffer[cursor] = 0;
      cursor++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      buffer[cursor] = c;
      cursor++;
    }
  }
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = malloc(cursor);
  strcpy(str, buffer);
  here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
  here(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3f8978" class="outline-3">
<h3 id="orgb3f8978">k_string</h3>
<div class="outline-text-3" id="text-orgb3f8978">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"\""</span>)) {
      k_string_one();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf77b2cc" class="outline-3">
<h3 id="orgf77b2cc">p_string_length</h3>
<div class="outline-text-3" id="text-orgf77b2cc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_length</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; length)</span>
  as_push(strlen(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb0bfb0" class="outline-3">
<h3 id="orgbb0bfb0">p_string_print</h3>
<div class="outline-text-3" id="text-orgbb0bfb0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_print</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%s"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebd7dae" class="outline-3">
<h3 id="orgebd7dae">p_string_append_to_buffer</h3>
<div class="outline-text-3" id="text-orgebd7dae">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_append_to_buffer</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(buffer, string -&gt; buffer)</span>
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">buffer</span> = as_tos();
  strcat(buffer, str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c7f577" class="outline-3">
<h3 id="org7c7f577">export_string</h3>
<div class="outline-text-3" id="text-org7c7f577">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_string</span>() {
  defprim(<span style="color: #e6db74;">"string"</span>, k_string);
  defprim(<span style="color: #e6db74;">"string/print"</span>, p_string_print);
  defprim(<span style="color: #e6db74;">"string/length"</span>, p_string_length);
  defprim(<span style="color: #e6db74;">"string/append-to-buffer"</span>, p_string_append_to_buffer);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org523d1fa" class="outline-2">
<h2 id="org523d1fa"><b>file</b></h2>
<div class="outline-text-2" id="text-org523d1fa">
</div><div id="outline-container-orgfa0137b" class="outline-3">
<h3 id="orgfa0137b">file_readable_p</h3>
<div class="outline-text-3" id="text-orgfa0137b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">file_readable_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>) {
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">fp</span> = fopen(path, <span style="color: #e6db74;">"r"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>fp) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    fclose(fp);
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org239699b" class="outline-3">
<h3 id="org239699b">dir_ok_p</h3>
<div class="outline-text-3" id="text-org239699b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">dir_ok_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>) {
  <span style="color: #66d9ef; font-weight: bold;">DIR</span>* <span style="color: #fd971f;">dir</span> = opendir(path);
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>dir) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    closedir(dir);
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6f5b8c" class="outline-3">
<h3 id="orga6f5b8c">p_file_readable_p</h3>
<div class="outline-text-3" id="text-orga6f5b8c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_file_readable_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(file -&gt; bool)</span>
  as_push(file_readable_p(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc3a3a8" class="outline-3">
<h3 id="orgfc3a3a8">p_dir_ok_p</h3>
<div class="outline-text-3" id="text-orgfc3a3a8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dir_ok_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(dir -&gt; bool)</span>
  as_push(dir_ok_p(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org685ef69" class="outline-3">
<h3 id="org685ef69">export_file</h3>
<div class="outline-text-3" id="text-org685ef69">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_file</span>() {
  defprim(<span style="color: #e6db74;">"file/readable?"</span>, p_file_readable_p);
  defprim(<span style="color: #e6db74;">"dir/ok?"</span>, p_dir_ok_p);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5f4aab6" class="outline-2">
<h2 id="org5f4aab6"><b>system</b></h2>
<div class="outline-text-2" id="text-org5f4aab6">
</div><div id="outline-container-org8687442" class="outline-3">
<h3 id="org8687442">p_current_dir</h3>
<div class="outline-text-3" id="text-org8687442">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_current_dir</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buf</span>[1024];
  as_push(getcwd(buf, 1024));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org54c766b" class="outline-3">
<h3 id="org54c766b">p_command_run</h3>
<div class="outline-text-3" id="text-org54c766b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_command_run</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; *)</span>
  system(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org510a5dd" class="outline-3">
<h3 id="org510a5dd">p_n_command_run</h3>
<div class="outline-text-3" id="text-org510a5dd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_n_command_run</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(..., string, n -&gt; *)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = malloc(4 * 1024);
  str[0] = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; n) {
    strcat(str, as[as_pointer - n + i]);
    i++;
  }
  as_pointer = as_pointer - n;
  system(str);
  free(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc545a6d" class="outline-3">
<h3 id="orgc545a6d">p_argument_counter</h3>
<div class="outline-text-3" id="text-orgc545a6d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">argument_counter</span>;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_argument_counter</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; argument_counter)</span>
  as_push(argument_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9234b7e" class="outline-3">
<h3 id="org9234b7e">p_index_to_argument_string</h3>
<div class="outline-text-3" id="text-org9234b7e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span>* <span style="color: #fd971f;">argument_string_array</span>;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_index_to_argument_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(index -&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">argument_string</span> = argument_string_array[index];
  as_push(argument_string);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1990bc" class="outline-3">
<h3 id="orgb1990bc">p_var_string_to_env_string</h3>
<div class="outline-text-3" id="text-orgb1990bc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_var_string_to_env_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">var_string</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">env_string</span> = getenv(var_string);
  as_push(env_string);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9519b7" class="outline-3">
<h3 id="orgd9519b7">export_system</h3>
<div class="outline-text-3" id="text-orgd9519b7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_system</span>() {
  defprim(<span style="color: #e6db74;">"current-dir"</span>, p_current_dir);
  defprim(<span style="color: #e6db74;">"command/run"</span>, p_command_run);
  defprim(<span style="color: #e6db74;">"n-command/run"</span>, p_n_command_run);
  defprim(<span style="color: #e6db74;">"argument-counter"</span>, p_argument_counter);
  defprim(<span style="color: #e6db74;">"index-&gt;argument-string"</span>, p_index_to_argument_string);
  defprim(<span style="color: #e6db74;">"var-string-&gt;env-string"</span>, p_var_string_to_env_string);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org982a760" class="outline-2">
<h2 id="org982a760"><b>module</b></h2>
<div class="outline-text-2" id="text-org982a760">
</div><div id="outline-container-org8b931bc" class="outline-3">
<h3 id="org8b931bc">module_record</h3>
<div class="outline-text-3" id="text-org8b931bc">
<ul class="org-ul">
<li><p>just record what modules are loaded</p><p>and their meta-data</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">dir</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">export</span>;
} <span style="color: #66d9ef; font-weight: bold;">module</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #66d9ef; font-weight: bold;">module_record_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">module_record_t</span> <span style="color: #fd971f;">module_record</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_record_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_record_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_record_push</span>(<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">value</span>) {
  module_record[module_record_pointer] = value;
  module_record_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">module_record_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> module_record_pointer == module_record_base;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">module_record_find</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; module_record_pointer) {
    <span style="color: #f92672; font-weight: bold;">if</span> (name == module_record[i].name) {
      <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
    }
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">module_record_get_export</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = module_record_base;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; module_record_pointer) {
    <span style="color: #f92672; font-weight: bold;">if</span> (name == module_record[i].name) {
      <span style="color: #f92672; font-weight: bold;">return</span> module_record[i].export;
    }
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_record_set_export</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">export</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = module_record_base;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; module_record_pointer) {
    <span style="color: #f92672; font-weight: bold;">if</span> (name == module_record[i].name) {
      module_record[i].export = export;
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    i++;
  }
  printf(<span style="color: #e6db74;">"- module_record_set_export fail\n"</span>);
  printf(<span style="color: #e6db74;">"  can not find module: %s\n"</span>, jo2str(name));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org12434ab" class="outline-3">
<h3 id="org12434ab">module_stack</h3>
<div class="outline-text-3" id="text-org12434ab">
<ul class="org-ul">
<li><p>just record what modules are loaded</p><p>and their meta-data</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #66d9ef; font-weight: bold;">module_stack_t</span>[128];

<span style="color: #66d9ef; font-weight: bold;">module_stack_t</span> <span style="color: #fd971f;">module_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">value</span>) {
  module_stack[module_stack_pointer] = value;
  module_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">module_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> module_stack_pointer == module_stack_base;
}

<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #a6e22e;">module_stack_pop</span>() {
  module_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> module_stack[module_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #a6e22e;">module_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> module_stack[module_stack_pointer - 1];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2502558" class="outline-3">
<h3 id="org2502558">load_file</h3>
<div class="outline-text-3" id="text-org2502558">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">load_file</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">[reading_stack]</span>
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">fp</span> = fopen(path, <span style="color: #e6db74;">"r"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span>(<span style="color: #960050;">!</span>fp) {
    perror(<span style="color: #e6db74;">"File opening failed"</span>);
    printf(<span style="color: #e6db74;">"load_file fail : %s\n"</span>, path);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">file_buffer</span> = malloc(PATH_MAX);
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">dir_buffer</span> = malloc(PATH_MAX);
  realpath(path, file_buffer);
  realpath(path, dir_buffer);
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">dir_addr</span> = dirname(dir_buffer);
  <span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #fd971f;">rp</span> = {
    .file_handle = fp,
    .file = file_buffer,
    .dir = dir_addr
  };
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">printf("- load_file\n");</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">printf("  fp: %d\n", fp);</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">printf("  file: %s\n", file_buffer);</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">printf("  dir_buffer: %s #%ld\n", dir_buffer, dir_buffer);</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">printf("  dir_addr: %s #%ld\n", dir_addr, dir_addr);</span>
  reading_stack_push(rp);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d8faae" class="outline-3">
<h3 id="org5d8faae">p_load_file</h3>
<div class="outline-text-3" id="text-org5d8faae">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_load_file</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; [reading_stack])</span>
  load_file(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga198c1c" class="outline-3">
<h3 id="orga198c1c">k_include_one</h3>
<div class="outline-text-3" id="text-orga198c1c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_include_one</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[PATH_MAX];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cursor</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = read_byte();
    <span style="color: #f92672; font-weight: bold;">if</span> (c == <span style="color: #e6db74;">'"'</span>) {
      buffer[cursor] = 0;
      cursor++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      buffer[cursor] = c;
      cursor++;
    }
  }
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer1</span>[PATH_MAX];
  real_reading_path(buffer, buffer1);
  load_file(buffer1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org44e056" class="outline-3">
<h3 id="org44e056">k_include</h3>
<div class="outline-text-3" id="text-org44e056">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_include</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"\""</span>)) {
      k_include_one();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8108d9c" class="outline-3">
<h3 id="org8108d9c">find_module_file_jo</h3>
<div class="outline-text-3" id="text-org8108d9c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">user_module_dir</span> = <span style="color: #e6db74;">"/.jojo/module/"</span>;
<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">system_module_dir</span> = <span style="color: #e6db74;">""</span>;

<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">find_module_file_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">path</span>[4 * 1024];
  path[0] = 0;
  strcat(path, getenv(<span style="color: #e6db74;">"HOME"</span>));
  strcat(path, user_module_dir);
  strcat(path, jo2str(name));
  strcat(path, <span style="color: #e6db74;">"/"</span>);
  strcat(path, <span style="color: #e6db74;">"module.jo"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (file_readable_p(path)) {
    <span style="color: #f92672; font-weight: bold;">return</span> str2jo(path);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> 0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org52ff9f7" class="outline-3">
<h3 id="org52ff9f7">find_module_dir_jo</h3>
<div class="outline-text-3" id="text-org52ff9f7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">find_module_dir_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">path</span>[4 * 1024];
  path[0] = 0;
  strcat(path, getenv(<span style="color: #e6db74;">"HOME"</span>));
  strcat(path, user_module_dir);
  strcat(path, jo2str(name));
  strcat(path, <span style="color: #e6db74;">"/"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (dir_ok_p(path)) {
    <span style="color: #f92672; font-weight: bold;">return</span> str2jo(path);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> 0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a433fc" class="outline-3">
<h3 id="org2a433fc">p_find_module_file_jo</h3>
<div class="outline-text-3" id="text-org2a433fc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_find_module_file_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(prefix-jo -&gt; module-file-jo)</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  as_push(find_module_file_jo(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge534c6c" class="outline-3">
<h3 id="orge534c6c">p_find_module_dir_jo</h3>
<div class="outline-text-3" id="text-orge534c6c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_find_module_dir_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(prefix-jo -&gt; module-dir-jo)</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  as_push(find_module_dir_jo(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3635394" class="outline-3">
<h3 id="org3635394">import_module</h3>
<div class="outline-text-3" id="text-org3635394">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">import_module</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">export</span> = module_record_get_export(name);
  <span style="color: #f92672; font-weight: bold;">if</span> (export == 0) {
    printf(<span style="color: #e6db74;">"import_module fail to import: %s\n"</span>, jo2str(name));
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (export[i] != 0) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">new_jo</span> = cat_3_jo(name,
                         str2jo(<span style="color: #e6db74;">"/"</span>),
                         export[i]);
    alias_add(export[i], new_jo);
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a20638" class="outline-3">
<h3 id="org5a20638">k_dep_load</h3>
<div class="outline-text-3" id="text-org5a20638">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">k_dep_load</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">module_file_jo</span> = find_module_file_jo(name);
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">module_dir_jo</span> = find_module_dir_jo(name);
  <span style="color: #f92672; font-weight: bold;">if</span> (module_file_jo == 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }

  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">export</span>[1];
  export[0] = 0;
  <span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">m</span> = {
    .name = name,
    .dir = module_dir_jo,
    .export = export
  };
  module_record_push(m);
  module_stack_push(m);

  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">a</span> = {.nick = 0, .name = 0};
  loading_stack_area[loading_stack_pointer][0] = a;
  loading_stack_push(loading_stack_area[loading_stack_pointer]);

  load_file(jo2str(module_file_jo));

  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3c299e" class="outline-3">
<h3 id="orgb3c299e">k_dep</h3>
<div class="outline-text-3" id="text-orgb3c299e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_dep</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [loading_stack])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span> = read_jo_without_prefix();
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>module_record_find(name)) {
    <span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #fd971f;">result</span> = k_dep_load(name);
    <span style="color: #f92672; font-weight: bold;">if</span> (result == <span style="color: #ae81ff;">false</span>) {
      printf(<span style="color: #e6db74;">"k_dep fail to load module : %s\n"</span>, jo2str(name));
      k_ignore();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
        <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
        <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
          eval_key(read_jo());
        }
        <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
          loading_stack_pop();
          module_stack_pop();
          <span style="color: #f92672; font-weight: bold;">break</span>;
        }
        <span style="color: #f92672; font-weight: bold;">else</span> {
          <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
        }
      }
    }
  }
  import_module(name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb78f0a1" class="outline-3">
<h3 id="orgb78f0a1">k_module</h3>
<div class="outline-text-3" id="text-orgb78f0a1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_module</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [loading_stack_tos])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span> = read_jo_without_prefix();
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">&gt;&lt;&gt;&lt;&gt;&lt; check module name</span>

  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">export</span> = compiling_stack_tos();
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo_without_prefix();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      here(0);
      module_record_set_export(name, export);
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>alias_find(s) == 0) {
      printf(<span style="color: #e6db74;">"k_module fail, alias used : %s\n"</span>, jo2str(s));
      k_ignore();
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb03c13" class="outline-3">
<h3 id="orgeb03c13">module_report_one</h3>
<div class="outline-text-3" id="text-orgeb03c13">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_report_one</span>(<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">m</span>) {
  printf(<span style="color: #e6db74;">"  - %s -- %s\n"</span>, jo2str(m.name), jo2str(m.dir));
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (m.export[i] != 0) {
    printf(<span style="color: #e6db74;">"    %s\n"</span>, jo2str(m.export[i]));
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org646db56" class="outline-3">
<h3 id="org646db56">module_report</h3>
<div class="outline-text-3" id="text-org646db56">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_report</span>() {
  printf(<span style="color: #e6db74;">"- module_report\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = module_record_base;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; module_record_pointer) {
    module_report_one(module_record[i]);
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3fbb74" class="outline-3">
<h3 id="orga3fbb74">export_module</h3>
<div class="outline-text-3" id="text-orga3fbb74">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_module</span>() {
  defprim(<span style="color: #e6db74;">"load-file"</span>, p_load_file);

  defprim(<span style="color: #e6db74;">"find-module-file-jo"</span>, p_find_module_file_jo);
  defprim(<span style="color: #e6db74;">"find-module-dir-jo"</span>, p_find_module_dir_jo);

  defprim(<span style="color: #e6db74;">"include"</span>, k_include);
  defprim(<span style="color: #e6db74;">"dep"</span>, k_dep);
  defprim(<span style="color: #e6db74;">"module"</span>, k_module);
  defprim(<span style="color: #e6db74;">"module/report"</span>, module_report);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb999990" class="outline-2">
<h2 id="orgb999990"><b>ffi</b></h2>
<div class="outline-text-2" id="text-orgb999990">
</div><div id="outline-container-orge3dddab" class="outline-3">
<h3 id="orge3dddab">ccall</h3>
<div class="outline-text-3" id="text-orge3dddab">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">ccall</span> (<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">void</span>* <span style="color: #fd971f;">lib</span>) {
  <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">fun</span> = dlsym(lib, str);
  <span style="color: #f92672; font-weight: bold;">if</span> (fun == <span style="color: #ae81ff;">NULL</span>) {
    printf(<span style="color: #e6db74;">"can not find %s function lib : %s\n"</span>,
           str, dlerror());
  };
  fun();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbccd830" class="outline-3">
<h3 id="orgbccd830">get_clib</h3>
<div class="outline-text-3" id="text-orgbccd830">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>* <span style="color: #a6e22e;">get_clib</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">rel_path</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">path</span>[PATH_MAX];
  real_reading_path(rel_path, path);
  <span style="color: #66d9ef; font-weight: bold;">void</span>* <span style="color: #fd971f;">lib</span> = dlopen(path, RTLD_LAZY);
  <span style="color: #f92672; font-weight: bold;">if</span> (lib == <span style="color: #ae81ff;">NULL</span>) {
    printf(<span style="color: #e6db74;">"fail to open library : %s : %s\n"</span>,
           path, dlerror());
  };
  <span style="color: #f92672; font-weight: bold;">return</span> lib;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org690ede7" class="outline-3">
<h3 id="org690ede7">k_clib_one</h3>
<div class="outline-text-3" id="text-org690ede7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_clib_one</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[PATH_MAX];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cursor</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = read_byte();
    <span style="color: #f92672; font-weight: bold;">if</span> (c == <span style="color: #e6db74;">'"'</span>) {
      buffer[cursor] = 0;
      cursor++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      buffer[cursor] = c;
      cursor++;
    }
  }
  ccall(<span style="color: #e6db74;">"export"</span>, get_clib(buffer));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org808e2b" class="outline-3">
<h3 id="org808e2b">k_clib</h3>
<div class="outline-text-3" id="text-org808e2b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_clib</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"\""</span>)) {
      k_clib_one();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge66bbc2" class="outline-3">
<h3 id="orge66bbc2">export_ffi</h3>
<div class="outline-text-3" id="text-orge66bbc2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_ffi</span>() {
  defprim(<span style="color: #e6db74;">"clib"</span>, k_clib);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdece33" class="outline-2">
<h2 id="orgdece33"><b>top_level</b></h2>
<div class="outline-text-2" id="text-orgdece33">
</div><div id="outline-container-orgb37ea66" class="outline-3">
<h3 id="orgb37ea66">prim_jo_p &amp; fun_jo_p &amp; var_jo_p &amp; used_jo_p</h3>
<div class="outline-text-3" id="text-orgb37ea66">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">prim_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].type == str2jo(<span style="color: #e6db74;">"primitive"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">fun_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].type == str2jo(<span style="color: #e6db74;">"function"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">var_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].type == str2jo(<span style="color: #e6db74;">"variable"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">used_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span>
    prim_jo_p(index) ||
    fun_jo_p(index) ||
    var_jo_p(index);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbe9d3" class="outline-3">
<h3 id="orgcbe9d3">jo_to_jo_in_module</h3>
<div class="outline-text-3" id="text-orgcbe9d3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">jo_to_jo_in_module</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">alias_jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (module_stack_empty_p()) {
    <span style="color: #f92672; font-weight: bold;">return</span> alias_jo;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">new_jo</span> = cat_3_jo(module_stack_tos().name,
                         str2jo(<span style="color: #e6db74;">"/"</span>),
                         alias_jo);
    alias_add(alias_jo, new_jo);
    <span style="color: #f92672; font-weight: bold;">return</span> new_jo;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a6de65" class="outline-3">
<h3 id="org5a6de65">read_jo_in_module</h3>
<div class="outline-text-3" id="text-org5a6de65">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo_in_module</span>() {
  jo_to_jo_in_module(read_jo());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2408d0e" class="outline-3">
<h3 id="org2408d0e">k_defun</h3>
<div class="outline-text-3" id="text-org2408d0e">
</div><div id="outline-container-orgb19b028" class="outline-4">
<h4 id="orgb19b028">defun_record</h4>
<div class="outline-text-4" id="text-orgb19b028">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">defun_record</span>[64 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defun_record_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9516ea" class="outline-4">
<h4 id="orgd9516ea">p_defun_record</h4>
<div class="outline-text-4" id="text-orgd9516ea">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_defun_record</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; addr)</span>
  as_push(defun_record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org32914f4" class="outline-4">
<h4 id="org32914f4">defun_report</h4>
<div class="outline-text-4" id="text-org32914f4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defun_report</span>() {
  printf(<span style="color: #e6db74;">"- defun_report // counter : %ld\n"</span>, defun_record_counter);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; defun_record_counter) {
    printf(<span style="color: #e6db74;">"  %s\n"</span>, jo2str(defun_record[i]));
    i++;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d67bf5" class="outline-4">
<h4 id="org5d67bf5">defun_stack</h4>
<div class="outline-text-4" id="text-org5d67bf5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #66d9ef; font-weight: bold;">defun_stack_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">defun_stack_t</span> <span style="color: #fd971f;">defun_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defun_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defun_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defun_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">value</span>) {
  defun_stack[defun_stack_pointer] = value;
  defun_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">defun_stack_pop</span>() {
  defun_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> defun_stack[defun_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defun_stack_inc</span>() {
  defun_stack[defun_stack_pointer - 1] =
    defun_stack[defun_stack_pointer - 1] + 1;
}


<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">defun_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> defun_stack[defun_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">defun_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> defun_stack_pointer == defun_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org84627a4" class="outline-4">
<h4 id="org84627a4">k_defun</h4>
<div class="outline-text-4" id="text-org84627a4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_compile_jojo</span>();

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_defun</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile] [jotable])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_jo_in_module();
  <span style="color: #f92672; font-weight: bold;">if</span> (used_jo_p(index)) {
    printf(<span style="color: #e6db74;">"- defun can not re-define : %s\n"</span>, jo2str(index));
    printf(<span style="color: #e6db74;">"  it already defined as : %s\n"</span>, jo2str(jotable[index].type));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  defun_stack_push(index);
  defun_record[defun_record_counter] = index;
  defun_record_counter++;
  defun_record[defun_record_counter] = 0;
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">array</span> = compiling_stack_tos();
  k_compile_jojo();
  here(str2jo(<span style="color: #e6db74;">"end"</span>));
  jotable[index].type = str2jo(<span style="color: #e6db74;">"function"</span>);
  jotable[index].value.jojo.size = compiling_stack_tos() - array;
  jotable[index].value.jojo.array = array;
  defun_stack_pop();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1c0f250" class="outline-3">
<h3 id="org1c0f250">k_declare</h3>
<div class="outline-text-3" id="text-org1c0f250">
</div><div id="outline-container-orge07a66e" class="outline-4">
<h4 id="orge07a66e"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-orge07a66e">
<ul class="org-ul">
<li><p>no compile before define</p><p>declare helps mutual recursive function</p></li></ul>
</div>
</div>

<div id="outline-container-org721bb16" class="outline-4">
<h4 id="org721bb16">k_declare_one</h4>
<div class="outline-text-4" id="text-org721bb16">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_declare_one</span>() {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_jo_in_module();
  jotable[index].type = str2jo(<span style="color: #e6db74;">"declared"</span>);
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org871d05b" class="outline-4">
<h4 id="org871d05b">k_declare</h4>
<div class="outline-text-4" id="text-org871d05b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_declare</span>() {
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      k_declare_one();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org210d141" class="outline-3">
<h3 id="org210d141">k_run</h3>
<div class="outline-text-3" id="text-org210d141">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_run</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">array</span>[64 * 1024];
  compiling_stack_push(array);
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      here(str2jo(<span style="color: #e6db74;">"end"</span>));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
  compiling_stack_pop();
  eval_jojo(array);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c4fd9e" class="outline-3">
<h3 id="org8c4fd9e">k_defvar</h3>
<div class="outline-text-3" id="text-org8c4fd9e">
</div><div id="outline-container-orgafefdea" class="outline-4">
<h4 id="orgafefdea">defvar_record</h4>
<div class="outline-text-4" id="text-orgafefdea">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">defvar_record</span>[64 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defvar_record_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org66f1f36" class="outline-4">
<h4 id="org66f1f36">p_defvar_record</h4>
<div class="outline-text-4" id="text-org66f1f36">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_defvar_record</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; addr)</span>
  as_push(defvar_record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb70b5d5" class="outline-4">
<h4 id="orgb70b5d5">defvar_report</h4>
<div class="outline-text-4" id="text-orgb70b5d5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defvar_report</span>() {
  printf(<span style="color: #e6db74;">"- defvar_report // counter : %ld\n"</span>, defvar_record_counter);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; defvar_record_counter) {
    printf(<span style="color: #e6db74;">"  %s\n"</span>, jo2str(defvar_record[i]));
    i++;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d57f1e" class="outline-4">
<h4 id="org7d57f1e">k_defvar</h4>
<div class="outline-text-4" id="text-org7d57f1e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_defvar</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile] [jotable])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_jo_in_module();
  <span style="color: #f92672; font-weight: bold;">if</span> (used_jo_p(index)) {
    printf(<span style="color: #e6db74;">"- defvar can not re-define : %s\n"</span>, jo2str(index));
    printf(<span style="color: #e6db74;">"  it already defined as : %s\n"</span>, jo2str(jotable[index].type));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  defvar_record[defvar_record_counter] = index;
  defvar_record_counter++;
  defvar_record[defvar_record_counter] = 0;
  k_run();
  jotable_set_cell(index, as_pop());
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb51202a" class="outline-3">
<h3 id="orgb51202a">p_top_repl</h3>
<div class="outline-text-3" id="text-orgb51202a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_top_repl</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org29e1aa5" class="outline-3">
<h3 id="org29e1aa5">export_top_level</h3>
<div class="outline-text-3" id="text-org29e1aa5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_top_level</span>() {
  defprim(<span style="color: #e6db74;">"defun-record"</span>, p_defun_record);
  defprim(<span style="color: #e6db74;">"defun/report"</span>, defun_report);

  defprim(<span style="color: #e6db74;">"defun"</span>, k_defun);

  defprim(<span style="color: #e6db74;">"declare"</span>, k_declare);

  defprim(<span style="color: #e6db74;">"run"</span>, k_run);

  defprim(<span style="color: #e6db74;">"defvar-record"</span>, p_defvar_record);
  defprim(<span style="color: #e6db74;">"defvar/report"</span>, defvar_report);
  defprim(<span style="color: #e6db74;">"defvar"</span>, k_defvar);

  defprim(<span style="color: #e6db74;">"top-repl"</span>, p_top_repl);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf74c0b0" class="outline-2">
<h2 id="orgf74c0b0"><b>keyword</b></h2>
<div class="outline-text-2" id="text-orgf74c0b0">
</div><div id="outline-container-org5caa594" class="outline-3">
<h3 id="org5caa594">k_ignore</h3>
<div class="outline-text-3" id="text-org5caa594">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_ignore</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      k_ignore();
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org30ef12e" class="outline-3">
<h3 id="org30ef12e">compile_jojo_until_meet_jo</h3>
<div class="outline-text-3" id="text-org30ef12e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compile_jojo_until_meet_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">end</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == end) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[s]) ||
             defun_stack_empty_p() ||
             defun_stack_tos() == s) {
      here(s);
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">no compile before define</span>
      printf(<span style="color: #e6db74;">"- k_compile_jojo undefined : %s\n"</span>, jo2str(s));
      k_ignore();
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab5215d" class="outline-3">
<h3 id="orgab5215d">k_compile_jojo_until_meet_jo</h3>
<div class="outline-text-3" id="text-orgab5215d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_compile_jojo_until_meet_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; [compile])</span>
  compile_jojo_until_meet_jo(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org45e4819" class="outline-3">
<h3 id="org45e4819">k_compile_jojo</h3>
<div class="outline-text-3" id="text-org45e4819">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_compile_jojo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  compile_jojo_until_meet_jo(str2jo(<span style="color: #e6db74;">")"</span>));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org44f1dd6" class="outline-3">
<h3 id="org44f1dd6">k_if</h3>
<div class="outline-text-3" id="text-org44f1dd6">
<ul class="org-ul">
<li><p>(if a b p? -&gt; c d)</p></li>

<li><p>a b p?</p><p>[jump] jumk_if_false</p><p>c d</p><p>:jump</p></li>

<li><p>because the use of as_snapshot</p><p>bar can not be nested in antecedent</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_if</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  compile_jojo_until_meet_jo(str2jo(<span style="color: #e6db74;">"-&gt;"</span>));
  here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">offset_place</span> = compiling_stack_tos();
  compiling_stack_inc();
  here(str2jo(<span style="color: #e6db74;">"jump-if-false"</span>));
  k_compile_jojo();
  offset_place[0] = compiling_stack_tos();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd043c56" class="outline-3">
<h3 id="orgd043c56">k_tail_call</h3>
<div class="outline-text-3" id="text-orgd043c56">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_tail_call</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">no check for "no compile before define"</span>
  here(str2jo(<span style="color: #e6db74;">"instruction/tail-call"</span>));
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
  here(s);
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7fe7c5" class="outline-3">
<h3 id="orgd7fe7c5">k_loop</h3>
<div class="outline-text-3" id="text-orgd7fe7c5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_loop</span>() {
  here(str2jo(<span style="color: #e6db74;">"instruction/tail-call"</span>));
  here(defun_stack_tos());
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6abab4" class="outline-3">
<h3 id="orgf6abab4">k_recur</h3>
<div class="outline-text-3" id="text-orgf6abab4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_recur</span>() {
 here(defun_stack_tos());
 k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a62640" class="outline-3">
<h3 id="org1a62640">p_compiling_stack_tos</h3>
<div class="outline-text-3" id="text-org1a62640">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_compiling_stack_tos</span>() {
  as_push(compiling_stack_tos());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a5cede" class="outline-3">
<h3 id="org8a5cede">i_jojo</h3>
<div class="outline-text-3" id="text-org8a5cede">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_jojo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body[0]);
  as_push(function_body + 1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge530eca" class="outline-3">
<h3 id="orge530eca">k_jojo</h3>
<div class="outline-text-3" id="text-orge530eca">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_jojo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  here(str2jo(<span style="color: #e6db74;">"instruction/jojo"</span>));
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">offset_place</span> = compiling_stack_tos();
  compiling_stack_inc();
  k_compile_jojo();
  here(str2jo(<span style="color: #e6db74;">"end"</span>));
  offset_place[0] = compiling_stack_tos();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae10a8f" class="outline-3">
<h3 id="orgae10a8f">export_keyword</h3>
<div class="outline-text-3" id="text-orgae10a8f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_keyword</span>() {
  defprim(<span style="color: #e6db74;">"ignore"</span>, k_ignore);
  defprim(<span style="color: #e6db74;">":"</span>, k_ignore);

  defprim(<span style="color: #e6db74;">"compiling-stack/tos"</span>, p_compiling_stack_tos);
  defprim(<span style="color: #e6db74;">"compiling-stack/inc"</span>, compiling_stack_inc);

  defprim(<span style="color: #e6db74;">"if"</span>, k_if);
  defprim(<span style="color: #e6db74;">"do"</span>, k_compile_jojo);
  defprim(<span style="color: #e6db74;">"compile-jojo/until-meet-jo"</span>, k_compile_jojo_until_meet_jo);
  defprim(<span style="color: #e6db74;">"else"</span>, k_compile_jojo);
  defprim(<span style="color: #e6db74;">"tail-call"</span>, k_tail_call);
  defprim(<span style="color: #e6db74;">"loop"</span>, k_loop);
  defprim(<span style="color: #e6db74;">"recur"</span>, k_recur);

  defprim(<span style="color: #e6db74;">"jojo"</span>, k_jojo);
  defprim(<span style="color: #e6db74;">"instruction/jojo"</span>, i_jojo);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc70d2a3" class="outline-2">
<h2 id="orgc70d2a3"><b>misc</b></h2>
<div class="outline-text-2" id="text-orgc70d2a3">
</div><div id="outline-container-org258825c" class="outline-3">
<h3 id="org258825c">do_nothing</h3>
<div class="outline-text-3" id="text-org258825c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">do_nothing</span>() {
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcfa3387" class="outline-3">
<h3 id="orgcfa3387">p_here</h3>
<div class="outline-text-3" id="text-orgcfa3387">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_here</span>() {
  here(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef6e0c" class="outline-3">
<h3 id="orgef6e0c">bar-ket</h3>
<div class="outline-text-3" id="text-orgef6e0c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_round_bar</span>() { as_push(str2jo(<span style="color: #e6db74;">"("</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_round_ket</span>() { as_push(str2jo(<span style="color: #e6db74;">")"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_square_bar</span>() { as_push(str2jo(<span style="color: #e6db74;">"["</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_square_ket</span>() { as_push(str2jo(<span style="color: #e6db74;">"]"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_flower_bar</span>() { as_push(str2jo(<span style="color: #e6db74;">"{"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_flower_ket</span>() { as_push(str2jo(<span style="color: #e6db74;">"}"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_double_quote</span>() { as_push(str2jo(<span style="color: #e6db74;">"\""</span>)); }
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9b276e" class="outline-3">
<h3 id="orga9b276e">p_cell_size</h3>
<div class="outline-text-3" id="text-orga9b276e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_cell_size</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; cell)</span>
  as_push(cell_size);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6694fd" class="outline-3">
<h3 id="orgc6694fd">p_newline</h3>
<div class="outline-text-3" id="text-orgc6694fd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_newline</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org43a3a79" class="outline-3">
<h3 id="org43a3a79">export_mise</h3>
<div class="outline-text-3" id="text-org43a3a79">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_mise</span>() {
  defprim(<span style="color: #e6db74;">"here"</span>, p_here);
  defprim(<span style="color: #e6db74;">"jo/apply"</span>, p_jo_apply);
  defprim(<span style="color: #e6db74;">"apply"</span>, p_apply);
  defprim(<span style="color: #e6db74;">"jotable/report"</span>, jotable_report);

  defprim(<span style="color: #e6db74;">"round-bar"</span>, p_round_bar);
  defprim(<span style="color: #e6db74;">"round-ket"</span>, p_round_ket);
  defprim(<span style="color: #e6db74;">"square-bar"</span>, p_square_bar);
  defprim(<span style="color: #e6db74;">"square-ket"</span>, p_square_ket);
  defprim(<span style="color: #e6db74;">"flower-bar"</span>, p_flower_bar);
  defprim(<span style="color: #e6db74;">"flower-ket"</span>, p_flower_ket);
  defprim(<span style="color: #e6db74;">"double-quote"</span>, p_double_quote);

  defprim(<span style="color: #e6db74;">"cell-size"</span>, p_cell_size);
  defprim(<span style="color: #e6db74;">"defprim/report"</span>, defprim_report);
  defprim(<span style="color: #e6db74;">"newline"</span>, p_newline);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9ed714" class="outline-2">
<h2 id="org9ed714"><b>play</b></h2>
<div class="outline-text-2" id="text-org9ed714">
</div><div id="outline-container-orgc0bd4a1" class="outline-3">
<h3 id="orgc0bd4a1">p1</h3>
<div class="outline-text-3" id="text-orgc0bd4a1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p1</span>() {
  printf(<span style="color: #e6db74;">"- p1\n"</span>);
  printf(<span style="color: #e6db74;">"  %ld %ld %ld\n"</span>, <span style="color: #f92672; font-weight: bold;">sizeof</span>(<span style="color: #66d9ef; font-weight: bold;">void</span>*), cell_size, <span style="color: #f92672; font-weight: bold;">sizeof</span>(<span style="color: #66d9ef; font-weight: bold;">unsigned</span>));
  printf(<span style="color: #e6db74;">"  %ld %ld\n"</span>, <span style="color: #f92672; font-weight: bold;">sizeof</span>((cell)-1), <span style="color: #f92672; font-weight: bold;">sizeof</span>(-1));
  printf(<span style="color: #e6db74;">"  %x %x\n"</span>, 16);
  printf(<span style="color: #e6db74;">"  %x %x %x\n"</span>, -1&gt;&gt;2, (cell)-1&gt;&gt;2, (<span style="color: #66d9ef; font-weight: bold;">unsigned</span>)-1&gt;&gt;2);
  printf(<span style="color: #e6db74;">"  %ld %ld\n"</span>, string_to_bin(<span style="color: #e6db74;">"1000"</span>), string_to_hex(<span style="color: #e6db74;">"ffff"</span>));
  printf(<span style="color: #e6db74;">"  %ld %ld %ld %ld\n"</span>, <span style="color: #e6db74;">'0'</span>, <span style="color: #e6db74;">'1'</span>, <span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'a'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a572d2" class="outline-3">
<h3 id="org5a572d2">p2</h3>
<div class="outline-text-3" id="text-org5a572d2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p2</span>() {
  printf(<span style="color: #e6db74;">"- p2\n"</span>);
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, EOF);
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, PATH_MAX);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d88a04" class="outline-3">
<h3 id="org8d88a04">p3</h3>
<div class="outline-text-3" id="text-org8d88a04">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_sum_test</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">sum</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">max_step</span> = 10;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; strlen(str)) {
    sum = sum + ((<span style="color: #66d9ef; font-weight: bold;">unsigned</span> <span style="color: #66d9ef; font-weight: bold;">char</span>) str[i]) * (2 &lt;&lt; min(i, max_step));
    printf(<span style="color: #e6db74;">"| char: %ld | unsigned char: %ld | sum: %ld |\n"</span>, str[i], (<span style="color: #66d9ef; font-weight: bold;">unsigned</span> <span style="color: #66d9ef; font-weight: bold;">char</span>) str[i], sum);
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> sum;
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p3</span>() {
  printf(<span style="color: #e6db74;">"- p3\n"</span>);
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, string_to_sum_test(<span style="color: #e6db74;">"abcabcabc"</span>));
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, string_to_sum_test(<span style="color: #e6db74;">"&#20013;&#20013;"</span>));
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, string_to_sum_test(<span style="color: #e6db74;">"&#20013;&#20013;&#20013;"</span>));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0ab6cc" class="outline-3">
<h3 id="orgc0ab6cc">export_play</h3>
<div class="outline-text-3" id="text-orgc0ab6cc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_play</span>() {
  defprim(<span style="color: #e6db74;">"p1"</span>, p1);
  defprim(<span style="color: #e6db74;">"p2"</span>, p2);
  defprim(<span style="color: #e6db74;">"p3"</span>, p3);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org57df822" class="outline-2">
<h2 id="org57df822">main</h2>
<div class="outline-text-2" id="text-org57df822">
</div><div id="outline-container-orgc1d7f49" class="outline-3">
<h3 id="orgc1d7f49">init_top_repl</h3>
<div class="outline-text-3" id="text-orgc1d7f49">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_top_repl</span>() {
  init_jotable();
  init_compiling_stack();
  init_loading_stack();

  export_stack_operation();
  export_ending();
  export_control();
  export_bool();
  export_bit();
  export_int();
  export_memory();
  export_byte();
  export_jo();
  export_string();
  export_file();
  export_keyword();
  export_system();
  export_module();
  export_ffi();
  export_top_level();
  export_mise();
  export_play();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff947f4" class="outline-3">
<h3 id="orgff947f4">main</h3>
<div class="outline-text-3" id="text-orgff947f4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #a6e22e;">main</span>(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">argc</span>, <span style="color: #66d9ef; font-weight: bold;">string</span>* <span style="color: #fd971f;">argv</span>) {

  argument_counter = argc;
  argument_string_array = argv;

  init_top_repl();

  <span style="color: #f92672; font-weight: bold;">if</span> (argc != 1) {
    <span style="color: #f92672; font-weight: bold;">if</span> (file_readable_p(argv[1])) {
      load_file(argv[1]);
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"- jojo can not load file: %s\n"</span>, argv[1]);
      printf(<span style="color: #e6db74;">"  it is not readable\n"</span>);
      <span style="color: #f92672; font-weight: bold;">return</span> 69;
    }
  }

  p_top_repl();
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
涕执我乎垂丧兮 懼余生之茫苦
</div>
</body>
</html>
