<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-06-18 Sat 02:53 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="XIE Yuheng" />
<link rel="stylesheet" href="http://xieyuheng.github.io/asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
長悲嘆而掩面兮 憐其獨於夢睹
</div>
<div id="content">
<h1 class="title">jojo</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7af4126"><span class="done todo">todo</span> </a></li>
<li><a href="#org832061c">helper</a>
<ul>
<li><a href="#orgc0cb8dc">header</a></li>
<li><a href="#orgad4d7df">bool</a></li>
<li><a href="#org4f65a27">cell</a></li>
<li><a href="#orga104a98">number</a></li>
<li><a href="#org8b3528">char</a></li>
<li><a href="#org1376f6a">string</a>
<ul>
<li><a href="#org6211d76">string</a></li>
<li><a href="#org8d8d2af">string_equal</a></li>
<li><a href="#org1ec584e">nat_string_p</a></li>
<li><a href="#org8f149a1">int_string_p</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7063859">hashtable</a>
<ul>
<li><a href="#org2127994">primitive</a></li>
<li><a href="#orge674030">name &amp; jojo</a></li>
<li><a href="#org545379f">bind &amp; nametable_entry</a></li>
<li><a href="#org7e680dd">new_nametable_entry</a></li>
<li><a href="#orgaa9d4f6">nametable_entry_[occured|entry_used|no_collision]</a></li>
<li><a href="#org8d5b987">nametable</a></li>
<li><a href="#org3f29ff2">string_to_sum</a></li>
<li><a href="#org1fb93b1">nametable_keyeq</a></li>
<li><a href="#orged3dcb">nametable_hash</a></li>
<li><a href="#org3278b00">string_area</a></li>
<li><a href="#org14a0541">copy_to_string_area</a></li>
<li><a href="#org135b8e8">nametable_insert</a></li>
<li><a href="#orgf3f893f">nametable_search</a></li>
<li><a href="#org3999c3f">nametable_entry_print</a></li>
<li><a href="#org3adfcd1">nametable_report_orbit</a></li>
<li><a href="#org370a6a4">nametable_report</a></li>
<li><a href="#orga657513">nametable_print</a></li>
<li><a href="#orgaee1b40">k2n &amp; n2k</a></li>
<li><a href="#orgd554c79">init_nametable</a></li>
<li><a href="#orgc81c372">jojo_area</a></li>
<li><a href="#orge84004d">here</a>
<ul>
<li><a href="#orgba96067">compiling_stack</a></li>
<li><a href="#org9d3d556">init_compiling_stack</a></li>
<li><a href="#org977a625">here</a></li>
</ul>
</li>
<li><a href="#org907c743">nametable_set_cell</a></li>
<li><a href="#org5c40aca">nametable_set_primitive</a></li>
<li><a href="#org1bc60e7">nametable_get_cell</a></li>
<li><a href="#org82f3580">nametable_get_primitive</a></li>
<li><a href="#orgf70e6b6">nametable_get_jojo</a></li>
<li><a href="#org87aedee"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orgd9e8328">as &amp; rs</a>
<ul>
<li><a href="#org4e66c4">as</a></li>
<li><a href="#orgdc43e36">rs</a></li>
</ul>
</li>
<li><a href="#org7528903">define</a>
<ul>
<li><a href="#org668bc78">define_primitive</a></li>
<li><a href="#orgb4bc22e">define_variable</a></li>
</ul>
</li>
<li><a href="#orgcba2081">apply</a>
<ul>
<li><a href="#orga966050">apply</a></li>
<li><a href="#org687b431">p_apply</a></li>
</ul>
</li>
<li><a href="#org1e7efd0">eval</a>
<ul>
<li><a href="#orgdae3f5e">eval</a></li>
<li><a href="#orgdc27797">eval_jo</a></li>
<li><a href="#orgd01377d">eval_jojo</a></li>
</ul>
</li>
<li><a href="#org20cae62"><b>stack_operation</b></a>
<ul>
<li><a href="#orge05bcd5">p_drop</a></li>
<li><a href="#orgec6b4c6">p_dup</a></li>
<li><a href="#org24d1000">p_over</a></li>
<li><a href="#org7ec3054">p_tuck</a></li>
<li><a href="#orgcb46e0f">p_swap</a></li>
<li><a href="#org3ffb06d">p_print_stack</a></li>
<li><a href="#org4f77f76">export_stack_operation</a></li>
</ul>
</li>
<li><a href="#org39886a5"><b>ending</b></a>
<ul>
<li><a href="#orgbbe15c">p_end</a></li>
<li><a href="#org380bd15">p_bye</a></li>
<li><a href="#org6a5da1a">export_ending</a></li>
</ul>
</li>
<li><a href="#org81de845"><b>control</b></a>
<ul>
<li><a href="#orgf3876dc">p_jump_back</a></li>
<li><a href="#orgcfcbb18">p_jump_over</a></li>
<li><a href="#orgf2bacc8">i_lit</a></li>
<li><a href="#org45efe97">i_tail_call</a></li>
<li><a href="#orgb43cd30">p_jump_if_false</a></li>
<li><a href="#org26587ab">export_control</a></li>
</ul>
</li>
<li><a href="#org273470"><b>bool</b></a>
<ul>
<li><a href="#org9128123">p_true</a></li>
<li><a href="#org570792d">p_false</a></li>
<li><a href="#org1dd31fb">p_not</a></li>
<li><a href="#org9992fb2">export_bool</a></li>
</ul>
</li>
<li><a href="#org5ca159f"><b>integer</b></a>
<ul>
<li><a href="#org2ec84b6">p_add</a></li>
<li><a href="#org211713b">p_sub</a></li>
<li><a href="#org999bba">p_mul</a></li>
<li><a href="#org9550150">p_div</a></li>
<li><a href="#org96e174f">p_mod</a></li>
<li><a href="#org5794078">p_eq_p</a></li>
<li><a href="#orgc1a31">p_gt_p</a></li>
<li><a href="#org3bac761">p_lt_p</a></li>
<li><a href="#orgd29b0c4">p_gteq_p</a></li>
<li><a href="#org94690f3">p_lteq_p</a></li>
<li><a href="#org236c227">k_integer</a></li>
<li><a href="#orgbdc825b">p_print_integer</a></li>
<li><a href="#org48be3b7">p_dot</a></li>
<li><a href="#org4a143c5">export_integer</a></li>
</ul>
</li>
<li><a href="#org6ba2a95"><b>memory</b></a>
<ul>
<li><a href="#org4057a0b">p_allocate</a></li>
<li><a href="#org2634250">p_free</a></li>
<li><a href="#orgd2d43f1">export_memory</a></li>
</ul>
</li>
<li><a href="#org811ecf">reading_stack</a>
<ul>
<li><a href="#orgb9a74f8">reading_stack</a></li>
<li><a href="#orged72c98">read_char</a></li>
<li><a href="#org5d5f541">unread_char</a></li>
</ul>
</li>
<li><a href="#orgc811d6a"><b>symbol</b></a>
<ul>
<li><a href="#orgb1ea566">read_symbol</a></li>
<li><a href="#orgd86cdfe">p_read_symbol</a></li>
<li><a href="#org1aed705">export_symbol</a></li>
</ul>
</li>
<li><a href="#orgc9b1193"><b>string</b></a>
<ul>
<li><a href="#orgdd9a319">k_string</a></li>
<li><a href="#orgc234702">p_print_string</a></li>
<li><a href="#orgc0af5d1">export_string</a></li>
</ul>
</li>
<li><a href="#org8a261e9"><b>file</b></a>
<ul>
<li><a href="#org35aa3cb">p_read_file</a></li>
<li><a href="#orga2c5e73">export_file</a></li>
</ul>
</li>
<li><a href="#orgdfc81f7"><b>keyword</b></a>
<ul>
<li><a href="#org55205a">k_comment</a></li>
<li><a href="#orga7ee5a7">k_if</a>
<ul>
<li><a href="#orged3f088"><span class="todo note">note</span> </a></li>
<li><a href="#org65a0a60">compile_question</a></li>
<li><a href="#orgcab35d8">compile_answer</a></li>
<li><a href="#orgc935326">k_if</a></li>
</ul>
</li>
<li><a href="#orga4fafe7">k_tail_call</a></li>
<li><a href="#org8e82d90">export_keyword</a></li>
</ul>
</li>
<li><a href="#org64389d7"><b>top_level</b></a>
<ul>
<li><a href="#orgbd7ae24">p_define_function</a></li>
<li><a href="#org5162266">p_execute</a></li>
<li><a href="#orgb6d78be">p_top_repl</a></li>
<li><a href="#org2a6468e">export_top_level</a></li>
</ul>
</li>
<li><a href="#orga981407"><b>misc</b></a>
<ul>
<li><a href="#orga05a7ac">do_nothing</a></li>
<li><a href="#org84046b3">export_mise</a></li>
</ul>
</li>
<li><a href="#orgc557531"><b>play</b></a>
<ul>
<li><a href="#org467b1ff">p1</a></li>
<li><a href="#orgb581fc7">p2</a></li>
<li><a href="#org2af2183">p3</a></li>
<li><a href="#org2c208ad">export_play</a></li>
</ul>
</li>
<li><a href="#orgaf4308c">epilog</a>
<ul>
<li><a href="#orgffd55c2">run_basic_repl</a></li>
</ul>
</li>
<li><a href="#org7bf2d77">main</a></li>
</ul>
</div>
</div>
<hr  />

<ul class="org-ul">
<li><p>the implementation of the interpreter (<a href="https://github.com/xieyuheng/jojo">source</a>)</p></li></ul>

<hr  />

<div id="outline-container-org7af4126" class="outline-2">
<h2 id="org7af4126"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-org7af4126">
<ul class="org-ul">
<li><p>better nametable for module system</p></li>
<li><p>module system</p></li>
<li><p>debug</p></li>
<li><p>no redefine</p></li>
<li><p>fix jump</p></li></ul>
</div>
</div>

<div id="outline-container-org832061c" class="outline-2">
<h2 id="org832061c">helper</h2>
<div class="outline-text-2" id="text-org832061c">
</div><div id="outline-container-orgc0cb8dc" class="outline-3">
<h3 id="orgc0cb8dc">header</h3>
<div class="outline-text-3" id="text-orgc0cb8dc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdio.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;ctype.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdlib.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdint.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;setjmp.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;string.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;dlfcn.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad4d7df" class="outline-3">
<h3 id="orgad4d7df">bool</h3>
<div class="outline-text-3" id="text-orgad4d7df">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">enum</span> { <span style="color: #ae81ff;">false</span>, <span style="color: #ae81ff;">true</span> } <span style="color: #66d9ef; font-weight: bold;">bool</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f65a27" class="outline-3">
<h3 id="org4f65a27">cell</h3>
<div class="outline-text-3" id="text-org4f65a27">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">intptr_t</span> <span style="color: #66d9ef; font-weight: bold;">cell</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga104a98" class="outline-3">
<h3 id="orga104a98">number</h3>
<div class="outline-text-3" id="text-orga104a98">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">max</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &lt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">min</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &gt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b3528" class="outline-3">
<h3 id="org8b3528">char</h3>
<div class="outline-text-3" id="text-org8b3528">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">isbarcket</span>(<span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (c == <span style="color: #e6db74;">'('</span> ||
          c == <span style="color: #e6db74;">')'</span> ||
          c == <span style="color: #e6db74;">'['</span> ||
          c == <span style="color: #e6db74;">']'</span> ||
          c == <span style="color: #e6db74;">'{'</span> ||
          c == <span style="color: #e6db74;">'}'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1376f6a" class="outline-3">
<h3 id="org1376f6a">string</h3>
<div class="outline-text-3" id="text-org1376f6a">
</div><div id="outline-container-org6211d76" class="outline-4">
<h4 id="org6211d76">string</h4>
<div class="outline-text-4" id="text-org6211d76">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #66d9ef; font-weight: bold;">string</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d8d2af" class="outline-4">
<h4 id="org8d8d2af">string_equal</h4>
<div class="outline-text-4" id="text-org8d8d2af">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">string_equal</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s2</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (strcmp(s1, s2) == 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ec584e" class="outline-4">
<h4 id="org1ec584e">nat_string_p</h4>
<div class="outline-text-4" id="text-org1ec584e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">nat_string_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (str[i] != 0) {
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>isdigit(str[i])) {
      <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
      }
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f149a1" class="outline-4">
<h4 id="org8f149a1">int_string_p</h4>
<div class="outline-text-4" id="text-org8f149a1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">int_string_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (str[0] == <span style="color: #e6db74;">'-'</span> ||
      str[0] == <span style="color: #e6db74;">'+'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str + 1);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str);
  }
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org7063859" class="outline-2">
<h2 id="org7063859">hashtable</h2>
<div class="outline-text-2" id="text-org7063859">
</div><div id="outline-container-org2127994" class="outline-3">
<h3 id="org2127994">primitive</h3>
<div class="outline-text-3" id="text-org2127994">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">void</span> (*<span style="color: #66d9ef; font-weight: bold;">primitive</span>)();
</pre>
</div>
</div>
</div>

<div id="outline-container-orge674030" class="outline-3">
<h3 id="orge674030">name &amp; jojo</h3>
<div class="outline-text-3" id="text-orge674030">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #66d9ef; font-weight: bold;">name</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">size</span>;
  <span style="color: #66d9ef; font-weight: bold;">name</span> *<span style="color: #fd971f;">array</span>;
} <span style="color: #66d9ef; font-weight: bold;">jojo</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org545379f" class="outline-3">
<h3 id="org545379f">bind &amp; nametable_entry</h3>
<div class="outline-text-3" id="text-org545379f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">union</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span>;
  <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>;
  <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span>;
} <span style="color: #66d9ef; font-weight: bold;">bind</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>;
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">type</span>;
  <span style="color: #66d9ef; font-weight: bold;">bind</span> <span style="color: #fd971f;">value</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbit_length</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbiton</span>;
} <span style="color: #66d9ef; font-weight: bold;">nametable_entry</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e680dd" class="outline-3">
<h3 id="org7e680dd">new_nametable_entry</h3>
<div class="outline-text-3" id="text-org7e680dd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #a6e22e;">k2n</span> (<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>);

<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #a6e22e;">new_nametable_entry</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">e</span> = {
    .index = index,
    .key = 0,
    .type = k2n(<span style="color: #e6db74;">"none"</span>),
    .value.cell = 0,
    .orbit_length = 0,
    .orbiton = 0
  };
  <span style="color: #f92672; font-weight: bold;">return</span> e;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa9d4f6" class="outline-3">
<h3 id="orgaa9d4f6">nametable_entry_[occured|entry_used|no_collision]</h3>
<div class="outline-text-3" id="text-orgaa9d4f6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">nametable_entry_occured</span>(<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.key != 0;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">nametable_entry_used</span>(<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.type != k2n(<span style="color: #e6db74;">"none"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">nametable_entry_no_collision</span>(<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.index == e.orbiton;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d5b987" class="outline-3">
<h3 id="org8d5b987">nametable</h3>
<div class="outline-text-3" id="text-org8d5b987">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">prime table size</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000003   about 976 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000033</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100003    about 97 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">997</span>
<span style="color: #a6e22e;">#define</span> <span style="color: #fd971f;">nametable_size</span> 100003
<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">nametable</span>[nametable_size];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">nametable_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f29ff2" class="outline-3">
<h3 id="org3f29ff2">string_to_sum</h3>
<div class="outline-text-3" id="text-org3f29ff2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_sum</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">sum</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">max_step</span> = 10;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; strlen(str)) {
    sum = sum + str[i] * (2 &lt;&lt; min(i, max_step));
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1fb93b1" class="outline-3">
<h3 id="org1fb93b1">nametable_keyeq</h3>
<div class="outline-text-3" id="text-org1fb93b1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">nametable_keyeq</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k2</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> string_equal(k1, k2);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orged3dcb" class="outline-3">
<h3 id="orged3dcb">nametable_hash</h3>
<div class="outline-text-3" id="text-orged3dcb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">nametable_hash</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (counter + string_to_sum(key)) % nametable_size;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3278b00" class="outline-3">
<h3 id="org3278b00">string_area</h3>
<div class="outline-text-3" id="text-org3278b00">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">string_area</span>[4 * 1024 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">string_area_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org14a0541" class="outline-3">
<h3 id="org14a0541">copy_to_string_area</h3>
<div class="outline-text-3" id="text-org14a0541">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">copy_to_string_area</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> *<span style="color: #fd971f;">str1</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  str1 = (string_area + string_area_counter);
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #f92672; font-weight: bold;">if</span> (str[i] == 0) {
      str1[i] = str[i];
      i++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      str1[i] = str[i];
      i++;
    }
  }
  string_area_counter = i + string_area_counter;
  <span style="color: #f92672; font-weight: bold;">return</span> str1;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org135b8e8" class="outline-3">
<h3 id="org135b8e8">nametable_insert</h3>
<div class="outline-text-3" id="text-org135b8e8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes the hash_table is filled</span>
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">nametable_insert</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbit_index</span> = nametable_hash(key, 0);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = nametable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>nametable_entry_occured(nametable[index])) {
      key = copy_to_string_area(key);
      nametable[index].key = key;
      nametable[index].orbiton = orbit_index;
      nametable[orbit_index].orbit_length = 1 + counter;
      nametable_counter = 1 + nametable_counter;
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (nametable_keyeq(key, nametable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == nametable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3f893f" class="outline-3">
<h3 id="orgf3f893f">nametable_search</h3>
<div class="outline-text-3" id="text-orgf3f893f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes key not occured</span>
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">nametable_search</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = nametable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>nametable_entry_occured(nametable[index])) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (nametable_keyeq(key, nametable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == nametable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3999c3f" class="outline-3">
<h3 id="org3999c3f">nametable_entry_print</h3>
<div class="outline-text-3" id="text-org3999c3f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">n2k</span> (<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>);

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">nametable_entry_print</span>(<span style="color: #66d9ef; font-weight: bold;">nametable_entry</span> <span style="color: #fd971f;">entry</span>) {
  printf(<span style="color: #e6db74;">"%s : "</span>, n2k(entry.type));
  <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == k2n(<span style="color: #e6db74;">"cell"</span>)) {
    printf(<span style="color: #e6db74;">"%ld"</span>, entry.value.cell);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == k2n(<span style="color: #e6db74;">"primitive"</span>)) {
    printf(<span style="color: #e6db74;">"%ld"</span>, entry.value.primitive);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == k2n(<span style="color: #e6db74;">"jojo"</span>)) {
    printf(<span style="color: #e6db74;">"%ld "</span>, entry.value.jojo.size);
    printf(<span style="color: #e6db74;">"[ "</span>, entry.value.jojo.size);
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span>;
    <span style="color: #f92672; font-weight: bold;">for</span> (i=0; i &lt; entry.value.jojo.size; i=i+1) {
      printf(<span style="color: #e6db74;">"%ld "</span>, entry.value.jojo.array[i]);
    }
    printf(<span style="color: #e6db74;">"]"</span>, entry.value.jojo.size);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3adfcd1" class="outline-3">
<h3 id="org3adfcd1">nametable_report_orbit</h3>
<div class="outline-text-3" id="text-org3adfcd1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">nametable_report_orbit</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">while</span> (counter &lt; nametable[index].orbit_length) {
    <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span> = nametable[index].key;
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">next_index</span> = nametable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (index == nametable[next_index].orbiton) {
      printf(<span style="color: #e6db74;">"  - %ld %s\n"</span>, next_index, nametable[next_index].key);
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (nametable_entry_used(nametable[next_index])) {
      printf(<span style="color: #e6db74;">"    = "</span>);
      nametable_entry_print(nametable[next_index]);
      printf(<span style="color: #e6db74;">"\n"</span>);
    }
    counter = 1 + counter;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org370a6a4" class="outline-3">
<h3 id="org370a6a4">nametable_report</h3>
<div class="outline-text-3" id="text-org370a6a4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">nametable_report</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- nametable_report\n"</span>);
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; nametable_size) {
    <span style="color: #f92672; font-weight: bold;">if</span> (nametable_entry_occured(nametable[index]) &amp;&amp;
        nametable_entry_no_collision(nametable[index])) {
      printf(<span style="color: #e6db74;">"  - %ld %s // %ld\n"</span>,
             index, nametable[index].key, nametable[index].orbit_length);
      <span style="color: #f92672; font-weight: bold;">if</span> (nametable_entry_used(nametable[index])) {
        printf(<span style="color: #e6db74;">"    = "</span>);
        nametable_entry_print(nametable[index]);
        printf(<span style="color: #e6db74;">"\n"</span>);
      }
      nametable_report_orbit(index, 1);
    }
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %ld\n"</span>, nametable_counter);
  printf(<span style="color: #e6db74;">"- free : %ld\n"</span>, nametable_size - nametable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga657513" class="outline-3">
<h3 id="orga657513">nametable_print</h3>
<div class="outline-text-3" id="text-orga657513">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">nametable_print</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- nametable_print\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; nametable_size) {
    printf(<span style="color: #e6db74;">"  - %ld %s %ld // %ld\n"</span>,
           index,
           nametable[index].key,
           nametable[index].value,
           nametable[index].orbit_length);
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %ld\n"</span>, nametable_counter);
  printf(<span style="color: #e6db74;">"- free : %ld\n"</span>, nametable_size - nametable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaee1b40" class="outline-3">
<h3 id="orgaee1b40">k2n &amp; n2k</h3>
<div class="outline-text-3" id="text-orgaee1b40">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #a6e22e;">k2n</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable_insert(str);
}

<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">n2k</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable[index].key;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd554c79" class="outline-3">
<h3 id="orgd554c79">init_nametable</h3>
<div class="outline-text-3" id="text-orgd554c79">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_nametable</span>() {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; nametable_size) {
    nametable[i] = new_nametable_entry(i);
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc81c372" class="outline-3">
<h3 id="orgc81c372">jojo_area</h3>
<div class="outline-text-3" id="text-orgc81c372">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">jojo_area</span>[1024 * 1024];
</pre>
</div>
</div>
</div>

<div id="outline-container-orge84004d" class="outline-3">
<h3 id="orge84004d">here</h3>
<div class="outline-text-3" id="text-orge84004d">
</div><div id="outline-container-orgba96067" class="outline-4">
<h4 id="orgba96067">compiling_stack</h4>
<div class="outline-text-4" id="text-orgba96067">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #66d9ef; font-weight: bold;">compiling_stack_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">compiling_stack_t</span> <span style="color: #fd971f;">compiling_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">compiling_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">compiling_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compiling_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">value</span>) {
  compiling_stack[compiling_stack_pointer] = value;
  compiling_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #a6e22e;">compiling_stack_pop</span>() {
  compiling_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack[compiling_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compiling_stack_inc</span>() {
  compiling_stack[compiling_stack_pointer - 1] =
    compiling_stack[compiling_stack_pointer - 1] + 1;
}


<span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #a6e22e;">compiling_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack[compiling_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">compiling_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack_pointer == compiling_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d3d556" class="outline-4">
<h4 id="org9d3d556">init_compiling_stack</h4>
<div class="outline-text-4" id="text-org9d3d556">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_compiling_stack</span>() {
  compiling_stack_push(jojo_area);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org977a625" class="outline-4">
<h4 id="org977a625">here</h4>
<div class="outline-text-4" id="text-org977a625">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">here</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span>) {
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">pointer</span> = compiling_stack_pop();
  pointer[0] = n;
  compiling_stack_push(pointer + 1);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org907c743" class="outline-3">
<h3 id="org907c743">nametable_set_cell</h3>
<div class="outline-text-3" id="text-org907c743">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">nametable_set_cell</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span>) {
  nametable[index].type = k2n(<span style="color: #e6db74;">"cell"</span>);
  nametable[index].value.cell = cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c40aca" class="outline-3">
<h3 id="org5c40aca">nametable_set_primitive</h3>
<div class="outline-text-3" id="text-org5c40aca">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">nametable_set_primitive</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>) {
  nametable[index].type = k2n(<span style="color: #e6db74;">"primitive"</span>);
  nametable[index].value.primitive = primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bc60e7" class="outline-3">
<h3 id="org1bc60e7">nametable_get_cell</h3>
<div class="outline-text-3" id="text-org1bc60e7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">nametable_get_cell</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable[index].value.cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org82f3580" class="outline-3">
<h3 id="org82f3580">nametable_get_primitive</h3>
<div class="outline-text-3" id="text-org82f3580">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #a6e22e;">nametable_get_primitive</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable[index].value.primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf70e6b6" class="outline-3">
<h3 id="orgf70e6b6">nametable_get_jojo</h3>
<div class="outline-text-3" id="text-orgf70e6b6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #a6e22e;">nametable_get_jojo</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> nametable[index].value.jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org87aedee" class="outline-3">
<h3 id="org87aedee"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org87aedee">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">nametable_test</span>() {
  k2n(<span style="color: #e6db74;">"testkey0"</span>);
  k2n(<span style="color: #e6db74;">"testkey1"</span>);
  k2n(<span style="color: #e6db74;">"testkey2"</span>);
  k2n(<span style="color: #e6db74;">"testkey3"</span>);
  k2n(<span style="color: #e6db74;">"testkey4"</span>);

  k2n(<span style="color: #e6db74;">"testkey0"</span>);
  k2n(<span style="color: #e6db74;">"testkey1"</span>);
  k2n(<span style="color: #e6db74;">"testkey2"</span>);
  k2n(<span style="color: #e6db74;">"testkey3"</span>);
  k2n(<span style="color: #e6db74;">"testkey4"</span>);

  k2n(<span style="color: #e6db74;">"testtestkey0"</span>);
  k2n(<span style="color: #e6db74;">"testtestkey1"</span>);
  k2n(<span style="color: #e6db74;">"testtestkey2"</span>);
  k2n(<span style="color: #e6db74;">"testtestkey3"</span>);
  k2n(<span style="color: #e6db74;">"testtestkey4"</span>);

  k2n(<span style="color: #e6db74;">"testtesttestkey0"</span>);
  k2n(<span style="color: #e6db74;">"testtesttestkey1"</span>);
  k2n(<span style="color: #e6db74;">"testtesttestkey2"</span>);
  k2n(<span style="color: #e6db74;">"testtesttestkey3"</span>);
  k2n(<span style="color: #e6db74;">"testtesttestkey4"</span>);

  k2n(<span style="color: #e6db74;">"testtesttesttestkey0"</span>);
  k2n(<span style="color: #e6db74;">"testtesttesttestkey1"</span>);
  k2n(<span style="color: #e6db74;">"testtesttesttestkey2"</span>);
  k2n(<span style="color: #e6db74;">"testtesttesttestkey3"</span>);
  k2n(<span style="color: #e6db74;">"testtesttesttestkey4"</span>);

  nametable_set_cell(k2n(<span style="color: #e6db74;">"k1"</span>), 1);
  nametable_report();

  nametable_set_cell(k2n(<span style="color: #e6db74;">"k1"</span>), 0);
  nametable_report();

  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">nametable_print();</span>
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd9e8328" class="outline-2">
<h2 id="orgd9e8328">as &amp; rs</h2>
<div class="outline-text-2" id="text-orgd9e8328">
</div><div id="outline-container-org4e66c4" class="outline-3">
<h3 id="org4e66c4">as</h3>
<div class="outline-text-3" id="text-org4e66c4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #66d9ef; font-weight: bold;">argument_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">argument_stack</span> <span style="color: #fd971f;">as</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">as_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">as_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">as_push</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">value</span>) {
  as[as_pointer] = value;
  as_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">as_pop</span>() {
  as_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> as[as_pointer];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc43e36" class="outline-3">
<h3 id="orgdc43e36">rs</h3>
<div class="outline-text-3" id="text-orgdc43e36">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #66d9ef; font-weight: bold;">return_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">return_stack</span> <span style="color: #fd971f;">rs</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">rs_push</span>(<span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">value</span>) {
  rs[rs_pointer] = value;
  rs_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #a6e22e;">rs_pop</span>() {
  rs_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> rs[rs_pointer];
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7528903" class="outline-2">
<h2 id="org7528903">define</h2>
<div class="outline-text-2" id="text-org7528903">
</div><div id="outline-container-org668bc78" class="outline-3">
<h3 id="org668bc78">define_primitive</h3>
<div class="outline-text-3" id="text-org668bc78">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">define_primitive</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">fun</span>) {
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">index</span> = k2n(str);
  nametable_set_primitive(index, fun);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4bc22e" class="outline-3">
<h3 id="orgb4bc22e">define_variable</h3>
<div class="outline-text-3" id="text-orgb4bc22e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">define_variable</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span>) {
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">index</span> = k2n(str);
  nametable_set_cell(index, cell);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcba2081" class="outline-2">
<h2 id="orgcba2081">apply</h2>
<div class="outline-text-2" id="text-orgcba2081">
</div><div id="outline-container-orga966050" class="outline-3">
<h3 id="orga966050">apply</h3>
<div class="outline-text-3" id="text-orga966050">
<ul class="org-ul">
<li><p>be careful when calling this function in primitive</p><p>because after rs_push a jojo</p><p>one need to exit current primitive to run the jojo</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">apply</span>(<span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>nametable_entry_used(nametable[jo])) {
    printf(<span style="color: #e6db74;">"undefined name : %s\n"</span>, n2k(jo));
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo_type</span> = nametable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = nametable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"jojo"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = nametable_get_jojo(jo);
    rs_push(jojo.array);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"cell"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span> = nametable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org687b431" class="outline-3">
<h3 id="org687b431">p_apply</h3>
<div class="outline-text-3" id="text-org687b431">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_apply</span>() {
  apply(as_pop());
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1e7efd0" class="outline-2">
<h2 id="org1e7efd0">eval</h2>
<div class="outline-text-2" id="text-org1e7efd0">
</div><div id="outline-container-orgdae3f5e" class="outline-3">
<h3 id="orgdae3f5e">eval</h3>
<div class="outline-text-3" id="text-orgdae3f5e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jmp_buf</span> <span style="color: #fd971f;">jmp_buffer</span>;

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">exit_eval</span>() {
  longjmp(jmp_buffer, 666);
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (666 == setjmp(jmp_buffer)) {
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_base</span> = rs_pointer;
    <span style="color: #f92672; font-weight: bold;">while</span> (rs_pointer &gt;= rs_base) {
      <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
      rs_push(function_body + 1);
      <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
      apply(jo);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc27797" class="outline-3">
<h3 id="orgdc27797">eval_jo</h3>
<div class="outline-text-3" id="text-orgdc27797">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_jo</span>(<span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo_type</span> = nametable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = nametable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"jojo"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = nametable_get_jojo(jo);
    rs_push(jojo.array);
    eval();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == k2n(<span style="color: #e6db74;">"cell"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span> = nametable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd01377d" class="outline-3">
<h3 id="orgd01377d">eval_jojo</h3>
<div class="outline-text-3" id="text-orgd01377d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_jojo</span>(<span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">array</span>) {
  rs_push(array);
  eval();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org20cae62" class="outline-2">
<h2 id="org20cae62"><b>stack_operation</b></h2>
<div class="outline-text-2" id="text-org20cae62">
</div><div id="outline-container-orge05bcd5" class="outline-3">
<h3 id="orge05bcd5">p_drop</h3>
<div class="outline-text-3" id="text-orge05bcd5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_drop</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a -&gt;)</span>
  as_pop();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec6b4c6" class="outline-3">
<h3 id="orgec6b4c6">p_dup</h3>
<div class="outline-text-3" id="text-orgec6b4c6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dup</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a a -&gt; a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org24d1000" class="outline-3">
<h3 id="org24d1000">p_over</h3>
<div class="outline-text-3" id="text-org24d1000">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_over</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; a b a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a);
  as_push(b);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ec3054" class="outline-3">
<h3 id="org7ec3054">p_tuck</h3>
<div class="outline-text-3" id="text-org7ec3054">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_tuck</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; b a b)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(b);
  as_push(a);
  as_push(b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcb46e0f" class="outline-3">
<h3 id="orgcb46e0f">p_swap</h3>
<div class="outline-text-3" id="text-orgcb46e0f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_swap</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; b a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(b);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ffb06d" class="outline-3">
<h3 id="org3ffb06d">p_print_stack</h3>
<div class="outline-text-3" id="text-org3ffb06d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_print_stack</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  printf(<span style="color: #e6db74;">"\n"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (as_pointer &lt; as_base) {
    printf(<span style="color: #e6db74;">"  * %ld *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- below the stack --\n"</span>);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    printf(<span style="color: #e6db74;">"  * %ld *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- "</span>);
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = as_base;
    <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; as_pointer) {
      printf(<span style="color: #e6db74;">"%ld "</span>, as[i]);
      i++;
    }
    printf(<span style="color: #e6db74;">"--\n"</span>);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f77f76" class="outline-3">
<h3 id="org4f77f76">export_stack_operation</h3>
<div class="outline-text-3" id="text-org4f77f76">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_stack_operation</span>() {
  define_primitive(<span style="color: #e6db74;">"drop"</span>, p_drop);
  define_primitive(<span style="color: #e6db74;">"dup"</span>, p_dup);
  define_primitive(<span style="color: #e6db74;">"over"</span>, p_over);
  define_primitive(<span style="color: #e6db74;">"tuck"</span>, p_tuck);
  define_primitive(<span style="color: #e6db74;">"swap"</span>, p_swap);
  define_primitive(<span style="color: #e6db74;">"print-stack"</span>, p_print_stack);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org39886a5" class="outline-2">
<h2 id="org39886a5"><b>ending</b></h2>
<div class="outline-text-2" id="text-org39886a5">
</div><div id="outline-container-orgbbe15c" class="outline-3">
<h3 id="orgbbe15c">p_end</h3>
<div class="outline-text-3" id="text-orgbbe15c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_end</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(rs: addr -&gt;)</span>
  rs_pop();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org380bd15" class="outline-3">
<h3 id="org380bd15">p_bye</h3>
<div class="outline-text-3" id="text-org380bd15">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bye</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; [exit])</span>
  printf(<span style="color: #e6db74;">"bye bye ^-^/\n"</span>);
  exit_eval();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a5da1a" class="outline-3">
<h3 id="org6a5da1a">export_ending</h3>
<div class="outline-text-3" id="text-org6a5da1a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_ending</span>() {
  define_primitive(<span style="color: #e6db74;">"end"</span>, p_end);
  define_primitive(<span style="color: #e6db74;">"bye"</span>, p_bye);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org81de845" class="outline-2">
<h2 id="org81de845"><b>control</b></h2>
<div class="outline-text-2" id="text-org81de845">
</div><div id="outline-container-orgf3876dc" class="outline-3">
<h3 id="orgf3876dc">p_jump_back</h3>
<div class="outline-text-3" id="text-orgf3876dc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jump_back</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(offset -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body - as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcfcbb18" class="outline-3">
<h3 id="orgcfcbb18">p_jump_over</h3>
<div class="outline-text-3" id="text-orgcfcbb18">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jump_over</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(offset -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body + as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2bacc8" class="outline-3">
<h3 id="orgf2bacc8">i_lit</h3>
<div class="outline-text-3" id="text-orgf2bacc8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_lit</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body + 1);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
  as_push(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org45efe97" class="outline-3">
<h3 id="org45efe97">i_tail_call</h3>
<div class="outline-text-3" id="text-org45efe97">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_tail_call</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
  apply(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb43cd30" class="outline-3">
<h3 id="orgb43cd30">p_jump_if_false</h3>
<div class="outline-text-3" id="text-orgb43cd30">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jump_if_false</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool addr -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #f92672; font-weight: bold;">if</span> (b == 0) {
    rs_pop();
    rs_push(a);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org26587ab" class="outline-3">
<h3 id="org26587ab">export_control</h3>
<div class="outline-text-3" id="text-org26587ab">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_control</span>() {
  define_primitive(<span style="color: #e6db74;">"jump-back"</span>, p_jump_back);
  define_primitive(<span style="color: #e6db74;">"jump-over"</span>, p_jump_over);
  define_primitive(<span style="color: #e6db74;">"i/lit"</span>, i_lit);
  define_primitive(<span style="color: #e6db74;">"i/tail-call"</span>, i_tail_call);
  define_primitive(<span style="color: #e6db74;">"jump-if-false"</span>, p_jump_if_false);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org273470" class="outline-2">
<h2 id="org273470"><b>bool</b></h2>
<div class="outline-text-2" id="text-org273470">
</div><div id="outline-container-org9128123" class="outline-3">
<h3 id="org9128123">p_true</h3>
<div class="outline-text-3" id="text-org9128123">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_true</span>() {
  as_push(1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org570792d" class="outline-3">
<h3 id="org570792d">p_false</h3>
<div class="outline-text-3" id="text-org570792d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_false</span>() {
  as_push(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1dd31fb" class="outline-3">
<h3 id="org1dd31fb">p_not</h3>
<div class="outline-text-3" id="text-org1dd31fb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_not</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(<span style="color: #960050;">!</span>a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9992fb2" class="outline-3">
<h3 id="org9992fb2">export_bool</h3>
<div class="outline-text-3" id="text-org9992fb2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_bool</span>() {
  define_primitive(<span style="color: #e6db74;">"true"</span>, p_true);
  define_primitive(<span style="color: #e6db74;">"false"</span>, p_false);
  define_primitive(<span style="color: #e6db74;">"not"</span>, p_not);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5ca159f" class="outline-2">
<h2 id="org5ca159f"><b>integer</b></h2>
<div class="outline-text-2" id="text-org5ca159f">
</div><div id="outline-container-org2ec84b6" class="outline-3">
<h3 id="org2ec84b6">p_add</h3>
<div class="outline-text-3" id="text-org2ec84b6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_add</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a + b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org211713b" class="outline-3">
<h3 id="org211713b">p_sub</h3>
<div class="outline-text-3" id="text-org211713b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_sub</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a - b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org999bba" class="outline-3">
<h3 id="org999bba">p_mul</h3>
<div class="outline-text-3" id="text-org999bba">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_mul</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a * b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9550150" class="outline-3">
<h3 id="org9550150">p_div</h3>
<div class="outline-text-3" id="text-org9550150">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_div</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a / b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org96e174f" class="outline-3">
<h3 id="org96e174f">p_mod</h3>
<div class="outline-text-3" id="text-org96e174f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_mod</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a % b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5794078" class="outline-3">
<h3 id="org5794078">p_eq_p</h3>
<div class="outline-text-3" id="text-org5794078">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_eq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a == b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1a31" class="outline-3">
<h3 id="orgc1a31">p_gt_p</h3>
<div class="outline-text-3" id="text-orgc1a31">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_gt_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &gt; b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bac761" class="outline-3">
<h3 id="org3bac761">p_lt_p</h3>
<div class="outline-text-3" id="text-org3bac761">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_lt_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &lt; b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd29b0c4" class="outline-3">
<h3 id="orgd29b0c4">p_gteq_p</h3>
<div class="outline-text-3" id="text-orgd29b0c4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_gteq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &gt;= b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org94690f3" class="outline-3">
<h3 id="org94690f3">p_lteq_p</h3>
<div class="outline-text-3" id="text-org94690f3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_lteq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &lt;= b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org236c227" class="outline-3">
<h3 id="org236c227">k_integer</h3>
<div class="outline-text-3" id="text-org236c227">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #a6e22e;">read_symbol</span>();

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_integer</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(n2k(s))) {
      here(k2n(<span style="color: #e6db74;">"i/lit"</span>));
      here(atoi(n2k(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (# ...) : %s"</span>, n2k(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbdc825b" class="outline-3">
<h3 id="orgbdc825b">p_print_integer</h3>
<div class="outline-text-3" id="text-orgbdc825b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_print_integer</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%ld"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org48be3b7" class="outline-3">
<h3 id="org48be3b7">p_dot</h3>
<div class="outline-text-3" id="text-org48be3b7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dot</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%ld "</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a143c5" class="outline-3">
<h3 id="org4a143c5">export_integer</h3>
<div class="outline-text-3" id="text-org4a143c5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_integer</span>() {
  define_primitive(<span style="color: #e6db74;">"add"</span>, p_add);
  define_primitive(<span style="color: #e6db74;">"sub"</span>, p_sub);

  define_primitive(<span style="color: #e6db74;">"mul"</span>, p_mul);
  define_primitive(<span style="color: #e6db74;">"div"</span>, p_div);
  define_primitive(<span style="color: #e6db74;">"mod"</span>, p_mod);

  define_primitive(<span style="color: #e6db74;">"neg"</span>, p_not);

  define_primitive(<span style="color: #e6db74;">"eq?"</span>, p_eq_p);
  define_primitive(<span style="color: #e6db74;">"gt?"</span>, p_gt_p);
  define_primitive(<span style="color: #e6db74;">"lt?"</span>, p_lt_p);
  define_primitive(<span style="color: #e6db74;">"gteq?"</span>, p_gteq_p);
  define_primitive(<span style="color: #e6db74;">"lteq?"</span>, p_lteq_p);

  define_primitive(<span style="color: #e6db74;">"#"</span>, k_integer);

  define_primitive(<span style="color: #e6db74;">"print-integer"</span>, p_print_integer);
  define_primitive(<span style="color: #e6db74;">"."</span>, p_dot);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6ba2a95" class="outline-2">
<h2 id="org6ba2a95"><b>memory</b></h2>
<div class="outline-text-2" id="text-org6ba2a95">
</div><div id="outline-container-org4057a0b" class="outline-3">
<h3 id="org4057a0b">p_allocate</h3>
<div class="outline-text-3" id="text-org4057a0b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_allocate</span> () {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(size -&gt; addr)</span>
  as_push(calloc(as_pop(), 1));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2634250" class="outline-3">
<h3 id="org2634250">p_free</h3>
<div class="outline-text-3" id="text-org2634250">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_free</span> () {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(addr -&gt;)</span>
  free(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2d43f1" class="outline-3">
<h3 id="orgd2d43f1">export_memory</h3>
<div class="outline-text-3" id="text-orgd2d43f1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_memory</span>() {
  define_primitive(<span style="color: #e6db74;">"allocate"</span>, p_allocate);
  define_primitive(<span style="color: #e6db74;">"free"</span>, p_free);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org811ecf" class="outline-2">
<h2 id="org811ecf">reading_stack</h2>
<div class="outline-text-2" id="text-org811ecf">
</div><div id="outline-container-orgb9a74f8" class="outline-3">
<h3 id="orgb9a74f8">reading_stack</h3>
<div class="outline-text-3" id="text-orgb9a74f8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #66d9ef; font-weight: bold;">reading_stack_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">reading_stack_t</span> <span style="color: #fd971f;">reading_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">reading_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">reading_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">reading_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">value</span>) {
  reading_stack[reading_stack_pointer] = value;
  reading_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #a6e22e;">reading_stack_pop</span>() {
  reading_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack[reading_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #a6e22e;">reading_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack[reading_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">reading_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack_pointer == reading_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orged72c98" class="outline-3">
<h3 id="orged72c98">read_char</h3>
<div class="outline-text-3" id="text-orged72c98">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #a6e22e;">read_char</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    <span style="color: #f92672; font-weight: bold;">return</span> fgetc(stdin);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = fgetc(reading_stack_tos());
    <span style="color: #f92672; font-weight: bold;">if</span> (c == EOF) {
      fclose(reading_stack_pop());
      <span style="color: #f92672; font-weight: bold;">return</span> read_char();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">return</span> c;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d5f541" class="outline-3">
<h3 id="org5d5f541">unread_char</h3>
<div class="outline-text-3" id="text-org5d5f541">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">unread_char</span>(<span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    ungetc(c, stdin);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    ungetc(c, reading_stack_tos());
  }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc811d6a" class="outline-2">
<h2 id="orgc811d6a"><b>symbol</b></h2>
<div class="outline-text-2" id="text-orgc811d6a">
</div><div id="outline-container-orgb1ea566" class="outline-3">
<h3 id="orgb1ea566">read_symbol</h3>
<div class="outline-text-3" id="text-orgb1ea566">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #a6e22e;">read_symbol</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; symbol)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buf</span>[1024];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cur</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">collecting</span> = <span style="color: #ae81ff;">false</span>;
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>;
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">go</span> = <span style="color: #ae81ff;">true</span>;
  <span style="color: #f92672; font-weight: bold;">while</span> (go) {
    c = read_char();
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>collecting) {
      <span style="color: #f92672; font-weight: bold;">if</span> (isspace(c)) {
        <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        collecting = <span style="color: #ae81ff;">true</span>;
        buf[cur] = c;
        cur++;
        <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c)) {
          go = <span style="color: #ae81ff;">false</span>;
        }
      }
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c) ||
          isspace(c)) {
        unread_char(c);
        go = <span style="color: #ae81ff;">false</span>;
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        buf[cur] = c;
        cur++;
      }
    }
  }
  buf[cur] = 0;
  <span style="color: #f92672; font-weight: bold;">return</span> k2n(buf);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd86cdfe" class="outline-3">
<h3 id="orgd86cdfe">p_read_symbol</h3>
<div class="outline-text-3" id="text-orgd86cdfe">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_symbol</span>() {
  as_push(read_symbol());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1aed705" class="outline-3">
<h3 id="org1aed705">export_symbol</h3>
<div class="outline-text-3" id="text-org1aed705">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_symbol</span>() {
  define_primitive(<span style="color: #e6db74;">"read-symbol"</span>, p_read_symbol);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc9b1193" class="outline-2">
<h2 id="orgc9b1193"><b>string</b></h2>
<div class="outline-text-2" id="text-orgc9b1193">
</div><div id="outline-container-orgdd9a319" class="outline-3">
<h3 id="orgdd9a319">k_string</h3>
<div class="outline-text-3" id="text-orgdd9a319">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      k_one_string();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_one_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[1024 * 1024];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cursor</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = read_char();
    <span style="color: #f92672; font-weight: bold;">if</span> (c == <span style="color: #e6db74;">')'</span>) {
      buffer[cursor] = 0;
      cursor++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      buffer[cursor] = c;
      cursor++;
    }
  }
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = malloc(cursor);
  strcpy(str, buffer);
  here(k2n(<span style="color: #e6db74;">"i/lit"</span>));
  here(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc234702" class="outline-3">
<h3 id="orgc234702">p_print_string</h3>
<div class="outline-text-3" id="text-orgc234702">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_print_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%s"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0af5d1" class="outline-3">
<h3 id="orgc0af5d1">export_string</h3>
<div class="outline-text-3" id="text-orgc0af5d1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_string</span>() {
  define_primitive(<span style="color: #e6db74;">"string"</span>, k_string);
  define_primitive(<span style="color: #e6db74;">"print-string"</span>, p_print_string);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8a261e9" class="outline-2">
<h2 id="org8a261e9"><b>file</b></h2>
<div class="outline-text-2" id="text-org8a261e9">
</div><div id="outline-container-org35aa3cb" class="outline-3">
<h3 id="org35aa3cb">p_read_file</h3>
<div class="outline-text-3" id="text-org35aa3cb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_file</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string addr number -&gt; number)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">limit</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">buffer</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">file_name</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">file_handle</span> = fopen(file_name, <span style="color: #e6db74;">"r"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">readed_counter</span> = fread(buffer, 1, limit, file_handle);
  fclose(file_handle);
  as_push(readed_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga2c5e73" class="outline-3">
<h3 id="orga2c5e73">export_file</h3>
<div class="outline-text-3" id="text-orga2c5e73">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_file</span>() {
  define_primitive(<span style="color: #e6db74;">"read-file"</span>, p_read_file);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdfc81f7" class="outline-2">
<h2 id="orgdfc81f7"><b>keyword</b></h2>
<div class="outline-text-2" id="text-orgdfc81f7">
</div><div id="outline-container-org55205a" class="outline-3">
<h3 id="org55205a">k_comment</h3>
<div class="outline-text-3" id="text-org55205a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_comment</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      k_comment();
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7ee5a7" class="outline-3">
<h3 id="orga7ee5a7">k_if</h3>
<div class="outline-text-3" id="text-orga7ee5a7">
</div><div id="outline-container-orged3f088" class="outline-4">
<h4 id="orged3f088"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-orged3f088">
<ul class="org-ul">
<li><p>(if a b p? -&gt; c d)</p><p>a b p?</p><p>[jump] jumk_if_false</p><p>c d</p><p>:jump</p></li>

<li><p>because the use of as_snapshot</p><p>bar can not be nested in antecedent</p></li></ul>
</div>
</div>

<div id="outline-container-org65a0a60" class="outline-4">
<h4 id="org65a0a60">compile_question</h4>
<div class="outline-text-4" id="text-org65a0a60">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compile_question</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      eval_jo(read_symbol());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"-&gt;"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcab35d8" class="outline-4">
<h4 id="orgcab35d8">compile_answer</h4>
<div class="outline-text-4" id="text-orgcab35d8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compile_answer</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  here(k2n(<span style="color: #e6db74;">"i/lit"</span>));
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">offset_place</span> = compiling_stack_tos();
  compiling_stack_inc();
  here(k2n(<span style="color: #e6db74;">"jump-if-false"</span>));
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      eval_jo(read_symbol());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
  offset_place[0] = compiling_stack_tos();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc935326" class="outline-4">
<h4 id="orgc935326">k_if</h4>
<div class="outline-text-4" id="text-orgc935326">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_if</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  compile_question();
  compile_answer();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga4fafe7" class="outline-3">
<h3 id="orga4fafe7">k_tail_call</h3>
<div class="outline-text-3" id="text-orga4fafe7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_tail_call</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  here(k2n(<span style="color: #e6db74;">"i/tail-call"</span>));
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
  here(s);
  k_comment();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e82d90" class="outline-3">
<h3 id="org8e82d90">export_keyword</h3>
<div class="outline-text-3" id="text-org8e82d90">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_keyword</span>() {
  define_primitive(<span style="color: #e6db74;">":"</span>, k_comment);
  define_primitive(<span style="color: #e6db74;">"if"</span>, k_if);
  define_primitive(<span style="color: #e6db74;">"tail-call"</span>, k_tail_call);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org64389d7" class="outline-2">
<h2 id="org64389d7"><b>top_level</b></h2>
<div class="outline-text-2" id="text-org64389d7">
</div><div id="outline-container-orgbd7ae24" class="outline-3">
<h3 id="orgbd7ae24">p_define_function</h3>
<div class="outline-text-3" id="text-orgbd7ae24">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_define_function</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile] [nametable])</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">index</span>;
  index = read_symbol();
  <span style="color: #66d9ef; font-weight: bold;">name</span>* <span style="color: #fd971f;">array</span> = compiling_stack_tos();
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      eval_jo(read_symbol());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      here(k2n(<span style="color: #e6db74;">"end"</span>));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
  nametable[index].type = k2n(<span style="color: #e6db74;">"jojo"</span>);
  nametable[index].value.jojo.size = compiling_stack_tos() - array;
  nametable[index].value.jojo.array = array;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5162266" class="outline-3">
<h3 id="org5162266">p_execute</h3>
<div class="outline-text-3" id="text-org5162266">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_execute</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">array</span>[1024];
  compiling_stack_push(array);
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      eval_jo(read_symbol());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">")"</span>)) {
      here(k2n(<span style="color: #e6db74;">"end"</span>));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
  compiling_stack_pop();
  eval_jojo(array);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb6d78be" class="outline-3">
<h3 id="orgb6d78be">p_top_repl</h3>
<div class="outline-text-3" id="text-orgb6d78be">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_top_repl</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">name</span> <span style="color: #fd971f;">s</span> = read_symbol();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == k2n(<span style="color: #e6db74;">"("</span>)) {
      eval_jo(read_symbol());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a6468e" class="outline-3">
<h3 id="org2a6468e">export_top_level</h3>
<div class="outline-text-3" id="text-org2a6468e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_top_level</span>() {
  define_primitive(<span style="color: #e6db74;">"~"</span>, p_define_function);
  define_primitive(<span style="color: #e6db74;">"!"</span>, p_execute);
  define_primitive(<span style="color: #e6db74;">"top-repl"</span>, p_top_repl);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga981407" class="outline-2">
<h2 id="orga981407"><b>misc</b></h2>
<div class="outline-text-2" id="text-orga981407">
</div><div id="outline-container-orga05a7ac" class="outline-3">
<h3 id="orga05a7ac">do_nothing</h3>
<div class="outline-text-3" id="text-orga05a7ac">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">do_nothing</span>() {
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org84046b3" class="outline-3">
<h3 id="org84046b3">export_mise</h3>
<div class="outline-text-3" id="text-org84046b3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_mise</span>() {
  define_primitive(<span style="color: #e6db74;">"apply"</span>, p_apply);
  define_primitive(<span style="color: #e6db74;">"nametable-report"</span>, nametable_report);
  define_variable(<span style="color: #e6db74;">"round-bar"</span>, k2n(<span style="color: #e6db74;">"("</span>));
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc557531" class="outline-2">
<h2 id="orgc557531"><b>play</b></h2>
<div class="outline-text-2" id="text-orgc557531">
</div><div id="outline-container-org467b1ff" class="outline-3">
<h3 id="org467b1ff">p1</h3>
<div class="outline-text-3" id="text-org467b1ff">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p1</span>() {
  printf(<span style="color: #e6db74;">"k1: %ld %ld\n"</span>, <span style="color: #f92672; font-weight: bold;">sizeof</span>(<span style="color: #66d9ef; font-weight: bold;">void</span>*), <span style="color: #f92672; font-weight: bold;">sizeof</span>(intptr_t));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb581fc7" class="outline-3">
<h3 id="orgb581fc7">p2</h3>
<div class="outline-text-3" id="text-orgb581fc7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p2</span>() {
  printf(<span style="color: #e6db74;">"k1: %ld %ld\n"</span>, <span style="color: #f92672; font-weight: bold;">sizeof</span>(<span style="color: #66d9ef; font-weight: bold;">void</span>*), <span style="color: #f92672; font-weight: bold;">sizeof</span>(intptr_t));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2af2183" class="outline-3">
<h3 id="org2af2183">p3</h3>
<div class="outline-text-3" id="text-org2af2183">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p3</span>() {

}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c208ad" class="outline-3">
<h3 id="org2c208ad">export_play</h3>
<div class="outline-text-3" id="text-org2c208ad">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_play</span>() {
  define_primitive(<span style="color: #e6db74;">"p1"</span>, p1);
  define_primitive(<span style="color: #e6db74;">"p2"</span>, p2);
  define_primitive(<span style="color: #e6db74;">"p3"</span>, p3);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaf4308c" class="outline-2">
<h2 id="orgaf4308c">epilog</h2>
<div class="outline-text-2" id="text-orgaf4308c">
</div><div id="outline-container-orgffd55c2" class="outline-3">
<h3 id="orgffd55c2">run_basic_repl</h3>
<div class="outline-text-3" id="text-orgffd55c2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">run_basic_repl</span>() {
  init_nametable();
  init_compiling_stack();

  export_stack_operation();
  export_ending();
  export_control();
  export_integer();
  export_memory();
  export_symbol();
  export_string();
  export_file();
  export_bool();
  export_keyword();
  export_top_level();
  export_mise();
  export_play();

  p_top_repl();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7bf2d77" class="outline-2">
<h2 id="org7bf2d77">main</h2>
<div class="outline-text-2" id="text-org7bf2d77">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #a6e22e;">main</span>(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">argc</span>, <span style="color: #66d9ef; font-weight: bold;">string</span>* <span style="color: #fd971f;">argv</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (argc == 1) {
    run_basic_repl();
    <span style="color: #f92672; font-weight: bold;">return</span> 0;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">fp</span> = fopen(argv[1], <span style="color: #e6db74;">"r"</span>);
    <span style="color: #f92672; font-weight: bold;">if</span>(<span style="color: #960050;">!</span>fp) {
      perror(<span style="color: #e6db74;">"File opening failed"</span>);
      printf(<span style="color: #e6db74;">"fail to open : %s\n"</span>, argv[1]);
      <span style="color: #f92672; font-weight: bold;">return</span> EXIT_FAILURE;
    }
    reading_stack_push(fp);
    run_basic_repl();
  }
}
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
涕执我乎垂丧兮 懼余生之茫苦
</div>
</body>
</html>
