<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-06-21 Tue 04:56 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="XIE Yuheng" />
<link rel="stylesheet" href="http://xieyuheng.github.io/asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
長悲嘆而掩面兮 憐其獨於夢睹
</div>
<div id="content">
<h1 class="title">jojo</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org58527e8"><span class="done todo">todo</span> </a></li>
<li><a href="#orgc7fe32">helper</a>
<ul>
<li><a href="#org7e5da5b">header</a></li>
<li><a href="#orgb43039a">bool</a></li>
<li><a href="#org5fce846">cell</a></li>
<li><a href="#orgecb1498">number</a></li>
<li><a href="#orgf3f6814">char</a></li>
<li><a href="#org753e872">string</a>
<ul>
<li><a href="#org641a16b">string</a></li>
<li><a href="#org6f5bb5e">string_equal</a></li>
<li><a href="#org9255e40">nat_string_p</a></li>
<li><a href="#org70ddcaf">int_string_p</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga2fba57">jotable</a>
<ul>
<li><a href="#orga01cb4e">primitive</a></li>
<li><a href="#org57de124">jo &amp; jojo</a></li>
<li><a href="#org5cee7ea">bind &amp; jotable_entry</a></li>
<li><a href="#org6618cb8">proto_jotable_entry</a></li>
<li><a href="#org7694160">jotable_entry_[occured|entry_used|no_collision]</a></li>
<li><a href="#orgb30b244">jotable</a></li>
<li><a href="#orgf0b1d2c">string_to_sum</a></li>
<li><a href="#orgedb2736">jotable_keyeq</a></li>
<li><a href="#org89be692">jotable_hash</a></li>
<li><a href="#org9c34697">string_area</a></li>
<li><a href="#orgfcfed38">copy_to_string_area</a></li>
<li><a href="#org6b52d8a">jotable_insert</a></li>
<li><a href="#org14add15">jotable_search</a></li>
<li><a href="#orgb0e436d">jotable_entry_print</a></li>
<li><a href="#orgf5786cf">jotable_report_orbit</a></li>
<li><a href="#org826a837">jotable_report</a></li>
<li><a href="#org526c4f7">jotable_print</a></li>
<li><a href="#org681c3da">str2jo &amp; jo2str</a></li>
<li><a href="#org453a1e9">init_jotable</a></li>
<li><a href="#orga79614a">jojo_area</a></li>
<li><a href="#orgc191a64">here</a>
<ul>
<li><a href="#orgfa40025">compiling_stack</a></li>
<li><a href="#org5c13c90">init_compiling_stack</a></li>
<li><a href="#orgd04e78f">here</a></li>
</ul>
</li>
<li><a href="#org75cbbc8">jotable_set_cell</a></li>
<li><a href="#orgc7cf34a">jotable_set_primitive</a></li>
<li><a href="#org93a2ec0">jotable_get_cell</a></li>
<li><a href="#orgcd63e49">jotable_get_primitive</a></li>
<li><a href="#orgdb67e2f">jotable_get_jojo</a></li>
<li><a href="#org74989b"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#org3383b16">defprim</a>
<ul>
<li><a href="#orgad903a1">defprim_record</a></li>
<li><a href="#orgf9bcb6f">defprim_report</a></li>
<li><a href="#org76e5381">defprim</a></li>
</ul>
</li>
<li><a href="#org1b91e98">as &amp; rs</a>
<ul>
<li><a href="#orga7c78b1">as</a></li>
<li><a href="#org5a92350">rs</a></li>
</ul>
</li>
<li><a href="#orge8a0c4">apply</a>
<ul>
<li><a href="#org613b0ab">apply</a></li>
<li><a href="#orga7a936c">p_apply</a></li>
</ul>
</li>
<li><a href="#org4b2f55e">eval</a>
<ul>
<li><a href="#org9f23a53">eval</a></li>
<li><a href="#org431dfed">eval_jo</a></li>
<li><a href="#org4975350">eval_key</a></li>
<li><a href="#orgd3b83ad">eval_jojo</a></li>
</ul>
</li>
<li><a href="#orgca6e904"><b>stack_operation</b></a>
<ul>
<li><a href="#orgb18e8b5">p_drop</a></li>
<li><a href="#orgc3a2df7">p_dup</a></li>
<li><a href="#org7a02740">p_over</a></li>
<li><a href="#org1c58980">p_tuck</a></li>
<li><a href="#org9571bae">p_swap</a></li>
<li><a href="#orge6c5087">p_print_stack</a></li>
<li><a href="#org2dc5c10">p_stack_base</a></li>
<li><a href="#org301d540">p_stack_pointer</a></li>
<li><a href="#orgf47e654">export_stack_operation</a></li>
</ul>
</li>
<li><a href="#orgae6bb05"><b>ending</b></a>
<ul>
<li><a href="#org566faf1">p_end</a></li>
<li><a href="#org89dd7b4">p_bye</a></li>
<li><a href="#org27b18b8">export_ending</a></li>
</ul>
</li>
<li><a href="#orgd4d79bb"><b>control</b></a>
<ul>
<li><a href="#org237fda2">p_jump_back</a></li>
<li><a href="#org223a5c9">p_jump_over</a></li>
<li><a href="#org7705416">i_lit</a></li>
<li><a href="#org39e457f">i_tail_call</a></li>
<li><a href="#org999a93f">p_jump_if_false</a></li>
<li><a href="#orgb08bdf9">export_control</a></li>
</ul>
</li>
<li><a href="#org84eca6c"><b>bool</b></a>
<ul>
<li><a href="#orgec4653a">p_true</a></li>
<li><a href="#org3183d01">p_false</a></li>
<li><a href="#orge70153">p_not</a></li>
<li><a href="#orge5b846d">export_bool</a></li>
</ul>
</li>
<li><a href="#org74c804c"><b>integer</b></a>
<ul>
<li><a href="#org3a48bbe">p_add</a></li>
<li><a href="#org8f7faab">p_sub</a></li>
<li><a href="#orgdf4b65f">p_mul</a></li>
<li><a href="#orgde33c77">p_div</a></li>
<li><a href="#org9f27f40">p_mod</a></li>
<li><a href="#org2736363">p_eq_p</a></li>
<li><a href="#org565c2f4">p_gt_p</a></li>
<li><a href="#org2d6fbad">p_lt_p</a></li>
<li><a href="#orgf86f613">p_gteq_p</a></li>
<li><a href="#org78186ba">p_lteq_p</a></li>
<li><a href="#org538d74b">k_integer</a></li>
<li><a href="#org4a0597a">p_print_integer</a></li>
<li><a href="#orgf0d812e">p_dot</a></li>
<li><a href="#orgeae3699">export_integer</a></li>
</ul>
</li>
<li><a href="#org34a0b42"><b>memory</b></a>
<ul>
<li><a href="#org68942a8">p_allocate</a></li>
<li><a href="#org6ae07f6">p_free</a></li>
<li><a href="#orgb9289a0">k_var</a></li>
<li><a href="#orge4a605b">p_set</a></li>
<li><a href="#orge4c6319">p_get</a></li>
<li><a href="#org2da0d71">export_memory</a></li>
</ul>
</li>
<li><a href="#orge385c64">read_char</a>
<ul>
<li><a href="#orgd2c2142">reading_stack</a></li>
<li><a href="#org32be627">loading_stack</a></li>
<li><a href="#org8af399e">read_char</a></li>
<li><a href="#org52e3ef7">unread_char</a></li>
</ul>
</li>
<li><a href="#orge455674"><b>jo</b></a>
<ul>
<li><a href="#org6e5b170">alias_add</a></li>
<li><a href="#org73b4c9a">alias_find</a></li>
<li><a href="#org2bcd76c">read_jo</a></li>
<li><a href="#org8a9ac3f">cat_jo</a></li>
<li><a href="#orga78fd88">p_read_jo</a></li>
<li><a href="#org4e1adbb">p_jo_used_p</a></li>
<li><a href="#orgbf10bb0">p_jo_to_string</a></li>
<li><a href="#orgf3c5555">p_string_to_jo</a></li>
<li><a href="#orgbaf124a">p_null</a></li>
<li><a href="#orgeb6a420">k_jo</a></li>
<li><a href="#org3ec6d46">export_jo</a></li>
</ul>
</li>
<li><a href="#org6dd2361"><b>string</b></a>
<ul>
<li><a href="#org304cb92">k_one_string</a></li>
<li><a href="#orgb110e1a">k_string</a></li>
<li><a href="#org4284dbd">p_print_string</a></li>
<li><a href="#org7f94aec">export_string</a></li>
</ul>
</li>
<li><a href="#orgf7627c7"><b>file</b></a>
<ul>
<li><a href="#org4870640">p_read_file</a></li>
<li><a href="#orgf522c">file_readable_p</a></li>
<li><a href="#org29305d6">export_file</a></li>
</ul>
</li>
<li><a href="#org7d87a0c"><b>system</b></a>
<ul>
<li><a href="#org5781dec">p_getcwd</a></li>
<li><a href="#orgf1af501">export_system</a></li>
</ul>
</li>
<li><a href="#org48796d3"><b>module</b></a>
<ul>
<li><a href="#orgce6b1d6">user_module_path</a></li>
<li><a href="#orgbadb84c">system_module_path</a></li>
<li><a href="#org8191185">module_stack</a></li>
<li><a href="#org8b700d0">load_file</a></li>
<li><a href="#org3882ca2">find_module</a></li>
<li><a href="#org308b74c">load_module</a></li>
<li><a href="#org4c4dac8">k_import</a>
<ul>
<li><a href="#orga740e1">k_add_alias</a></li>
<li><a href="#org30eb94f">k_one_module</a></li>
<li><a href="#org2813e73">k_import</a></li>
</ul>
</li>
<li><a href="#org2a919af">export_module</a></li>
</ul>
</li>
<li><a href="#org7c09be5"><b>ffi</b></a>
<ul>
<li><a href="#orge0925b8">get_clib</a></li>
<li><a href="#org5323e8f">ccall</a></li>
<li><a href="#orgc50f25f">k_one_clib</a></li>
<li><a href="#orgf51360">k_clib</a></li>
<li><a href="#org4355e93">export_ffi</a></li>
</ul>
</li>
<li><a href="#org83e7a6d"><b>top_level</b></a>
<ul>
<li><a href="#org75dfaa3">prim_jo_p &amp; fun_jo_p &amp; var_jo_p &amp; used_jo_p</a></li>
<li><a href="#orgb4db679">read_alias_jo</a></li>
<li><a href="#org8ae1f63">k_defun</a>
<ul>
<li><a href="#org366b493">defun_record</a></li>
<li><a href="#org6e5ef1e">p_defun_record</a></li>
<li><a href="#orgd8d63e7">defun_report</a></li>
<li><a href="#orga53aba">defun_stack</a></li>
<li><a href="#org4b414c0">k_defun</a></li>
</ul>
</li>
<li><a href="#org1a17e4f">k_declare</a>
<ul>
<li><a href="#org9e8f98a"><span class="todo note">note</span> </a></li>
<li><a href="#org45801c7">k_one_declare</a></li>
<li><a href="#org43700aa">k_declare</a></li>
</ul>
</li>
<li><a href="#orgce403e9">k_run</a></li>
<li><a href="#org3f15bbd">k_defvar</a>
<ul>
<li><a href="#org110c40">defvar_record</a></li>
<li><a href="#orge3270c7">p_defvar_record</a></li>
<li><a href="#orgd3fac47">defvar_report</a></li>
<li><a href="#orgc5d66f9">k_defvar</a></li>
</ul>
</li>
<li><a href="#org4aecbef">p_top_repl</a></li>
<li><a href="#org9e887f3">export_top_level</a></li>
</ul>
</li>
<li><a href="#org3ec13a4"><b>keyword</b></a>
<ul>
<li><a href="#org2da03">k_ignore</a></li>
<li><a href="#org759e84c">k_jojo</a></li>
<li><a href="#org185a506">k_if</a>
<ul>
<li><a href="#org1557f1f"><span class="todo note">note</span> </a></li>
<li><a href="#orgcbbee9c">compile_question</a></li>
<li><a href="#orgeb12af1">compile_answer</a></li>
<li><a href="#orgdb7bb1f">k_if</a></li>
</ul>
</li>
<li><a href="#org57eccc4">k_tail_call</a></li>
<li><a href="#org2e56bc8">k_loop</a></li>
<li><a href="#orge22c561">k_recur</a></li>
<li><a href="#org217dda6">export_keyword</a></li>
</ul>
</li>
<li><a href="#org5194ecf"><b>misc</b></a>
<ul>
<li><a href="#org9031ea4">do_nothing</a></li>
<li><a href="#org24a372b">p_here</a></li>
<li><a href="#org4fcbe48">bar-ket</a></li>
<li><a href="#org77173e9">p_cell_size</a></li>
<li><a href="#orgd99d26c">p_newline</a></li>
<li><a href="#orgc55e96f">export_mise</a></li>
</ul>
</li>
<li><a href="#orga08dba5"><b>play</b></a>
<ul>
<li><a href="#orgde6d595">p1</a></li>
<li><a href="#orgf1504a1">p2</a></li>
<li><a href="#orgeaa186b">p3</a></li>
<li><a href="#orgf7c5e15">export_play</a></li>
</ul>
</li>
<li><a href="#orga0d0a1b">epilog</a>
<ul>
<li><a href="#org3692073">run_basic_repl</a></li>
<li><a href="#org78f0c3e">main</a></li>
</ul>
</li>
</ul>
</div>
</div>
<hr  />

<ul class="org-ul">
<li><p>the implementation of the interpreter (<a href="https://github.com/xieyuheng/jojo">source</a>)</p></li></ul>

<hr  />

<div id="outline-container-org58527e8" class="outline-2">
<h2 id="org58527e8"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-org58527e8">
<ul class="org-ul">
<li><p>defprim respect module</p></li>
<li><p>linear pattern matching</p></li>
<li><p>a way to load init module</p></li>
<li><p>test framework</p></li>
<li><p>better jotable for being compiler target</p></li>
<li><p>debug</p></li>
<li><p>better structure of code</p></li>
<li><p>factor some functions out to module</p></li>
<li><p>fix jump</p></li>
<li><p>error report for every limited number</p></li></ul>
</div>
</div>

<div id="outline-container-orgc7fe32" class="outline-2">
<h2 id="orgc7fe32">helper</h2>
<div class="outline-text-2" id="text-orgc7fe32">
</div><div id="outline-container-org7e5da5b" class="outline-3">
<h3 id="org7e5da5b">header</h3>
<div class="outline-text-3" id="text-org7e5da5b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdio.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;ctype.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdlib.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdint.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;setjmp.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;string.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;dlfcn.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;unistd.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb43039a" class="outline-3">
<h3 id="orgb43039a">bool</h3>
<div class="outline-text-3" id="text-orgb43039a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">enum</span> { <span style="color: #ae81ff;">false</span>, <span style="color: #ae81ff;">true</span> } <span style="color: #66d9ef; font-weight: bold;">bool</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org5fce846" class="outline-3">
<h3 id="org5fce846">cell</h3>
<div class="outline-text-3" id="text-org5fce846">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">intptr_t</span> <span style="color: #66d9ef; font-weight: bold;">cell</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgecb1498" class="outline-3">
<h3 id="orgecb1498">number</h3>
<div class="outline-text-3" id="text-orgecb1498">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">max</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &lt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">min</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &gt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3f6814" class="outline-3">
<h3 id="orgf3f6814">char</h3>
<div class="outline-text-3" id="text-orgf3f6814">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">isbarcket</span>(<span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (c == <span style="color: #e6db74;">'('</span> ||
          c == <span style="color: #e6db74;">')'</span> ||
          c == <span style="color: #e6db74;">'['</span> ||
          c == <span style="color: #e6db74;">']'</span> ||
          c == <span style="color: #e6db74;">'{'</span> ||
          c == <span style="color: #e6db74;">'}'</span> ||
          c == <span style="color: #e6db74;">'"'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org753e872" class="outline-3">
<h3 id="org753e872">string</h3>
<div class="outline-text-3" id="text-org753e872">
</div><div id="outline-container-org641a16b" class="outline-4">
<h4 id="org641a16b">string</h4>
<div class="outline-text-4" id="text-org641a16b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #66d9ef; font-weight: bold;">string</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f5bb5e" class="outline-4">
<h4 id="org6f5bb5e">string_equal</h4>
<div class="outline-text-4" id="text-org6f5bb5e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">string_equal</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s2</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (strcmp(s1, s2) == 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9255e40" class="outline-4">
<h4 id="org9255e40">nat_string_p</h4>
<div class="outline-text-4" id="text-org9255e40">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">nat_string_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (str[i] != 0) {
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>isdigit(str[i])) {
      <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
      }
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org70ddcaf" class="outline-4">
<h4 id="org70ddcaf">int_string_p</h4>
<div class="outline-text-4" id="text-org70ddcaf">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">int_string_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (str[0] == <span style="color: #e6db74;">'-'</span> ||
      str[0] == <span style="color: #e6db74;">'+'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str + 1);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str);
  }
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orga2fba57" class="outline-2">
<h2 id="orga2fba57">jotable</h2>
<div class="outline-text-2" id="text-orga2fba57">
</div><div id="outline-container-orga01cb4e" class="outline-3">
<h3 id="orga01cb4e">primitive</h3>
<div class="outline-text-3" id="text-orga01cb4e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">void</span> (*<span style="color: #66d9ef; font-weight: bold;">primitive</span>)();
</pre>
</div>
</div>
</div>

<div id="outline-container-org57de124" class="outline-3">
<h3 id="org57de124">jo &amp; jojo</h3>
<div class="outline-text-3" id="text-org57de124">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #66d9ef; font-weight: bold;">jo</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">size</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> *<span style="color: #fd971f;">array</span>;
} <span style="color: #66d9ef; font-weight: bold;">jojo</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cee7ea" class="outline-3">
<h3 id="org5cee7ea">bind &amp; jotable_entry</h3>
<div class="outline-text-3" id="text-org5cee7ea">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">union</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span>;
  <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>;
  <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span>;
} <span style="color: #66d9ef; font-weight: bold;">bind</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">type</span>;
  <span style="color: #66d9ef; font-weight: bold;">bind</span> <span style="color: #fd971f;">value</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbit_length</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbiton</span>;
} <span style="color: #66d9ef; font-weight: bold;">jotable_entry</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6618cb8" class="outline-3">
<h3 id="org6618cb8">proto_jotable_entry</h3>
<div class="outline-text-3" id="text-org6618cb8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">str2jo</span> (<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>);

<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #a6e22e;">proto_jotable_entry</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span> = {
    .index = index,
    .key = 0,
    .type = str2jo(<span style="color: #e6db74;">"none"</span>),
    .value.cell = 0,
    .orbit_length = 0,
    .orbiton = 0
  };
  <span style="color: #f92672; font-weight: bold;">return</span> e;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7694160" class="outline-3">
<h3 id="org7694160">jotable_entry_[occured|entry_used|no_collision]</h3>
<div class="outline-text-3" id="text-org7694160">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_entry_occured</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.key != 0;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_entry_used</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.type != str2jo(<span style="color: #e6db74;">"none"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_entry_no_collision</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.index == e.orbiton;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb30b244" class="outline-3">
<h3 id="orgb30b244">jotable</h3>
<div class="outline-text-3" id="text-orgb30b244">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">prime table size</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000003   about 976 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000033</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100003    about 97 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">997</span>
<span style="color: #a6e22e;">#define</span> <span style="color: #fd971f;">jotable_size</span> 100003
<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">jotable</span>[jotable_size];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jotable_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0b1d2c" class="outline-3">
<h3 id="orgf0b1d2c">string_to_sum</h3>
<div class="outline-text-3" id="text-orgf0b1d2c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_sum</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">sum</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">max_step</span> = 10;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; strlen(str)) {
    sum = sum + str[i] * (2 &lt;&lt; min(i, max_step));
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgedb2736" class="outline-3">
<h3 id="orgedb2736">jotable_keyeq</h3>
<div class="outline-text-3" id="text-orgedb2736">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_keyeq</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k2</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> string_equal(k1, k2);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org89be692" class="outline-3">
<h3 id="org89be692">jotable_hash</h3>
<div class="outline-text-3" id="text-org89be692">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_hash</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (counter + string_to_sum(key)) % jotable_size;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c34697" class="outline-3">
<h3 id="org9c34697">string_area</h3>
<div class="outline-text-3" id="text-org9c34697">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">string_area</span>[4 * 1024 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">string_area_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfcfed38" class="outline-3">
<h3 id="orgfcfed38">copy_to_string_area</h3>
<div class="outline-text-3" id="text-orgfcfed38">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">copy_to_string_area</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> *<span style="color: #fd971f;">str1</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  str1 = (string_area + string_area_counter);
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #f92672; font-weight: bold;">if</span> (str[i] == 0) {
      str1[i] = str[i];
      i++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      str1[i] = str[i];
      i++;
    }
  }
  string_area_counter = i + string_area_counter;
  <span style="color: #f92672; font-weight: bold;">return</span> str1;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b52d8a" class="outline-3">
<h3 id="org6b52d8a">jotable_insert</h3>
<div class="outline-text-3" id="text-org6b52d8a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes the hash_table is filled</span>
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_insert</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbit_index</span> = jotable_hash(key, 0);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = jotable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_occured(jotable[index])) {
      key = copy_to_string_area(key);
      jotable[index].key = key;
      jotable[index].orbiton = orbit_index;
      jotable[orbit_index].orbit_length = 1 + counter;
      jotable_counter = 1 + jotable_counter;
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable_keyeq(key, jotable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == jotable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org14add15" class="outline-3">
<h3 id="org14add15">jotable_search</h3>
<div class="outline-text-3" id="text-org14add15">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes key not occured</span>
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_search</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = jotable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_occured(jotable[index])) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable_keyeq(key, jotable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == jotable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb0e436d" class="outline-3">
<h3 id="orgb0e436d">jotable_entry_print</h3>
<div class="outline-text-3" id="text-orgb0e436d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">jo2str</span> (<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>);

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_entry_print</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">entry</span>) {
  printf(<span style="color: #e6db74;">"%s : "</span>, jo2str(entry.type));
  <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == str2jo(<span style="color: #e6db74;">"variable"</span>)) {
    printf(<span style="color: #e6db74;">"%ld"</span>, entry.value.cell);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == str2jo(<span style="color: #e6db74;">"primitive"</span>)) {
    printf(<span style="color: #e6db74;">"%ld"</span>, entry.value.primitive);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == str2jo(<span style="color: #e6db74;">"function"</span>)) {
    printf(<span style="color: #e6db74;">"%ld "</span>, entry.value.jojo.size);
    printf(<span style="color: #e6db74;">"[ "</span>);
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span>;
    <span style="color: #f92672; font-weight: bold;">for</span> (i=0; i &lt; entry.value.jojo.size; i=i+1) {
      printf(<span style="color: #e6db74;">"%ld "</span>, entry.value.jojo.array[i]);
    }
    printf(<span style="color: #e6db74;">"]"</span>);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5786cf" class="outline-3">
<h3 id="orgf5786cf">jotable_report_orbit</h3>
<div class="outline-text-3" id="text-orgf5786cf">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_report_orbit</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">while</span> (counter &lt; jotable[index].orbit_length) {
    <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span> = jotable[index].key;
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">next_index</span> = jotable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (index == jotable[next_index].orbiton) {
      printf(<span style="color: #e6db74;">"  - %ld %s\n"</span>, next_index, jotable[next_index].key);
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[next_index])) {
      printf(<span style="color: #e6db74;">"    = "</span>);
      jotable_entry_print(jotable[next_index]);
      printf(<span style="color: #e6db74;">"\n"</span>);
    }
    counter = 1 + counter;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org826a837" class="outline-3">
<h3 id="org826a837">jotable_report</h3>
<div class="outline-text-3" id="text-org826a837">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_report</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- jotable_report\n"</span>);
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; jotable_size) {
    <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_occured(jotable[index]) &amp;&amp;
        jotable_entry_no_collision(jotable[index])) {
      printf(<span style="color: #e6db74;">"  - %ld %s // %ld\n"</span>,
             index, jotable[index].key, jotable[index].orbit_length);
      <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[index])) {
        printf(<span style="color: #e6db74;">"    = "</span>);
        jotable_entry_print(jotable[index]);
        printf(<span style="color: #e6db74;">"\n"</span>);
      }
      jotable_report_orbit(index, 1);
    }
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %ld\n"</span>, jotable_counter);
  printf(<span style="color: #e6db74;">"- free : %ld\n"</span>, jotable_size - jotable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org526c4f7" class="outline-3">
<h3 id="org526c4f7">jotable_print</h3>
<div class="outline-text-3" id="text-org526c4f7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_print</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- jotable_print\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; jotable_size) {
    printf(<span style="color: #e6db74;">"  - %ld %s %ld // %ld\n"</span>,
           index,
           jotable[index].key,
           jotable[index].value,
           jotable[index].orbit_length);
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %ld\n"</span>, jotable_counter);
  printf(<span style="color: #e6db74;">"- free : %ld\n"</span>, jotable_size - jotable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org681c3da" class="outline-3">
<h3 id="org681c3da">str2jo &amp; jo2str</h3>
<div class="outline-text-3" id="text-org681c3da">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">str2jo</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable_insert(str);
}

<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">jo2str</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].key;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org453a1e9" class="outline-3">
<h3 id="org453a1e9">init_jotable</h3>
<div class="outline-text-3" id="text-org453a1e9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_jotable</span>() {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; jotable_size) {
    jotable[i] = proto_jotable_entry(i);
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga79614a" class="outline-3">
<h3 id="orga79614a">jojo_area</h3>
<div class="outline-text-3" id="text-orga79614a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jojo_area</span>[1024 * 1024];
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc191a64" class="outline-3">
<h3 id="orgc191a64">here</h3>
<div class="outline-text-3" id="text-orgc191a64">
</div><div id="outline-container-orgfa40025" class="outline-4">
<h4 id="orgfa40025">compiling_stack</h4>
<div class="outline-text-4" id="text-orgfa40025">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #66d9ef; font-weight: bold;">compiling_stack_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">compiling_stack_t</span> <span style="color: #fd971f;">compiling_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">compiling_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">compiling_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compiling_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">value</span>) {
  compiling_stack[compiling_stack_pointer] = value;
  compiling_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">compiling_stack_pop</span>() {
  compiling_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack[compiling_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compiling_stack_inc</span>() {
  compiling_stack[compiling_stack_pointer - 1] =
    compiling_stack[compiling_stack_pointer - 1] + 1;
}


<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">compiling_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack[compiling_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">compiling_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack_pointer == compiling_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c13c90" class="outline-4">
<h4 id="org5c13c90">init_compiling_stack</h4>
<div class="outline-text-4" id="text-org5c13c90">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_compiling_stack</span>() {
  compiling_stack_push(jojo_area);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd04e78f" class="outline-4">
<h4 id="orgd04e78f">here</h4>
<div class="outline-text-4" id="text-orgd04e78f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">here</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">pointer</span> = compiling_stack_pop();
  pointer[0] = n;
  compiling_stack_push(pointer + 1);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org75cbbc8" class="outline-3">
<h3 id="org75cbbc8">jotable_set_cell</h3>
<div class="outline-text-3" id="text-org75cbbc8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_set_cell</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span>) {
  jotable[index].type = str2jo(<span style="color: #e6db74;">"variable"</span>);
  jotable[index].value.cell = cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7cf34a" class="outline-3">
<h3 id="orgc7cf34a">jotable_set_primitive</h3>
<div class="outline-text-3" id="text-orgc7cf34a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_set_primitive</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>) {
  jotable[index].type = str2jo(<span style="color: #e6db74;">"primitive"</span>);
  jotable[index].value.primitive = primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org93a2ec0" class="outline-3">
<h3 id="org93a2ec0">jotable_get_cell</h3>
<div class="outline-text-3" id="text-org93a2ec0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_get_cell</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].value.cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd63e49" class="outline-3">
<h3 id="orgcd63e49">jotable_get_primitive</h3>
<div class="outline-text-3" id="text-orgcd63e49">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #a6e22e;">jotable_get_primitive</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].value.primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdb67e2f" class="outline-3">
<h3 id="orgdb67e2f">jotable_get_jojo</h3>
<div class="outline-text-3" id="text-orgdb67e2f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #a6e22e;">jotable_get_jojo</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].value.jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org74989b" class="outline-3">
<h3 id="org74989b"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org74989b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_test</span>() {
  str2jo(<span style="color: #e6db74;">"testkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testtestkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testtesttestkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testtesttesttestkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey4"</span>);

  jotable_set_cell(str2jo(<span style="color: #e6db74;">"k1"</span>), 1);
  jotable_report();

  jotable_set_cell(str2jo(<span style="color: #e6db74;">"k1"</span>), 0);
  jotable_report();

  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">jotable_print();</span>
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3383b16" class="outline-2">
<h2 id="org3383b16">defprim</h2>
<div class="outline-text-2" id="text-org3383b16">
</div><div id="outline-container-orgad903a1" class="outline-3">
<h3 id="orgad903a1">defprim_record</h3>
<div class="outline-text-3" id="text-orgad903a1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">defprim_record</span>[64 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defprim_record_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9bcb6f" class="outline-3">
<h3 id="orgf9bcb6f">defprim_report</h3>
<div class="outline-text-3" id="text-orgf9bcb6f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defprim_report</span>() {
  printf(<span style="color: #e6db74;">"- defprim_report // counter : %ld\n"</span>, defprim_record_counter);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; defprim_record_counter) {
    printf(<span style="color: #e6db74;">"  %s\n"</span>, jo2str(defprim_record[i]));
    i++;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org76e5381" class="outline-3">
<h3 id="org76e5381">defprim</h3>
<div class="outline-text-3" id="text-org76e5381">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_ignore</span>();
<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">used_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>);

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defprim</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">fun</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = str2jo(str);
  <span style="color: #f92672; font-weight: bold;">if</span> (used_jo_p(index)) {
    printf(<span style="color: #e6db74;">"- defprim can not re-define : %s\n"</span>, jo2str(index));
    printf(<span style="color: #e6db74;">"  it already defined as : %s\n"</span>, jo2str(jotable[index].type));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  defprim_record[defprim_record_counter] = index;
  defprim_record_counter++;
  defprim_record[defprim_record_counter] = 0;
  jotable_set_primitive(index, fun);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1b91e98" class="outline-2">
<h2 id="org1b91e98">as &amp; rs</h2>
<div class="outline-text-2" id="text-org1b91e98">
</div><div id="outline-container-orga7c78b1" class="outline-3">
<h3 id="orga7c78b1">as</h3>
<div class="outline-text-3" id="text-orga7c78b1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #66d9ef; font-weight: bold;">argument_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">argument_stack</span> <span style="color: #fd971f;">as</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">as_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">as_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">as_push</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">value</span>) {
  as[as_pointer] = value;
  as_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">as_pop</span>() {
  as_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> as[as_pointer];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a92350" class="outline-3">
<h3 id="org5a92350">rs</h3>
<div class="outline-text-3" id="text-org5a92350">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #66d9ef; font-weight: bold;">return_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">return_stack</span> <span style="color: #fd971f;">rs</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">rs_push</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">value</span>) {
  rs[rs_pointer] = value;
  rs_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">rs_pop</span>() {
  rs_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> rs[rs_pointer];
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge8a0c4" class="outline-2">
<h2 id="orge8a0c4">apply</h2>
<div class="outline-text-2" id="text-orge8a0c4">
</div><div id="outline-container-org613b0ab" class="outline-3">
<h3 id="org613b0ab">apply</h3>
<div class="outline-text-3" id="text-org613b0ab">
<ul class="org-ul">
<li><p>be careful when calling this function in primitive</p><p>because after rs_push a jojo</p><p>one need to exit current primitive to run the jojo</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">apply</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_used(jotable[jo])) {
    printf(<span style="color: #e6db74;">"undefined jo : %s\n"</span>, jo2str(jo));
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo_type</span> = jotable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = jotable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"function"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = jotable_get_jojo(jo);
    rs_push(jojo.array);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"variable"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span> = jotable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7a936c" class="outline-3">
<h3 id="orga7a936c">p_apply</h3>
<div class="outline-text-3" id="text-orga7a936c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_apply</span>() {
  apply(as_pop());
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4b2f55e" class="outline-2">
<h2 id="org4b2f55e">eval</h2>
<div class="outline-text-2" id="text-org4b2f55e">
</div><div id="outline-container-org9f23a53" class="outline-3">
<h3 id="org9f23a53">eval</h3>
<div class="outline-text-3" id="text-org9f23a53">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jmp_buf</span> <span style="color: #fd971f;">eval_jmp_buffer</span>;

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">exit_eval</span>() {
  longjmp(eval_jmp_buffer, 666);
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (666 == setjmp(eval_jmp_buffer)) {
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_base</span> = rs_pointer;
    <span style="color: #f92672; font-weight: bold;">while</span> (rs_pointer &gt;= rs_base) {
      <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
      rs_push(function_body + 1);
      <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
      apply(jo);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org431dfed" class="outline-3">
<h3 id="org431dfed">eval_jo</h3>
<div class="outline-text-3" id="text-org431dfed">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo_type</span> = jotable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = jotable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"function"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = jotable_get_jojo(jo);
    rs_push(jojo.array);
    eval();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"variable"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span> = jotable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4975350" class="outline-3">
<h3 id="org4975350">eval_key</h3>
<div class="outline-text-3" id="text-org4975350">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_ignore</span>();

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_key</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_used(jotable[jo])) {
    printf(<span style="color: #e6db74;">"undefined keyword : %s\n"</span>, jo2str(jo));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  eval_jo(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3b83ad" class="outline-3">
<h3 id="orgd3b83ad">eval_jojo</h3>
<div class="outline-text-3" id="text-orgd3b83ad">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_jojo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">array</span>) {
  rs_push(array);
  eval();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgca6e904" class="outline-2">
<h2 id="orgca6e904"><b>stack_operation</b></h2>
<div class="outline-text-2" id="text-orgca6e904">
</div><div id="outline-container-orgb18e8b5" class="outline-3">
<h3 id="orgb18e8b5">p_drop</h3>
<div class="outline-text-3" id="text-orgb18e8b5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_drop</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a -&gt;)</span>
  as_pop();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3a2df7" class="outline-3">
<h3 id="orgc3a2df7">p_dup</h3>
<div class="outline-text-3" id="text-orgc3a2df7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dup</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a a -&gt; a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a02740" class="outline-3">
<h3 id="org7a02740">p_over</h3>
<div class="outline-text-3" id="text-org7a02740">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_over</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; a b a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a);
  as_push(b);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c58980" class="outline-3">
<h3 id="org1c58980">p_tuck</h3>
<div class="outline-text-3" id="text-org1c58980">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_tuck</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; b a b)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(b);
  as_push(a);
  as_push(b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9571bae" class="outline-3">
<h3 id="org9571bae">p_swap</h3>
<div class="outline-text-3" id="text-org9571bae">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_swap</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; b a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(b);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6c5087" class="outline-3">
<h3 id="orge6c5087">p_print_stack</h3>
<div class="outline-text-3" id="text-orge6c5087">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_print_stack</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  printf(<span style="color: #e6db74;">"\n"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (as_pointer &lt; as_base) {
    printf(<span style="color: #e6db74;">"  * %ld *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- below the stack --\n"</span>);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    printf(<span style="color: #e6db74;">"  * %ld *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- "</span>);
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = as_base;
    <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; as_pointer) {
      printf(<span style="color: #e6db74;">"%ld "</span>, as[i]);
      i++;
    }
    printf(<span style="color: #e6db74;">"--\n"</span>);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2dc5c10" class="outline-3">
<h3 id="org2dc5c10">p_stack_base</h3>
<div class="outline-text-3" id="text-org2dc5c10">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_stack_base</span>() {
  as_push(as + as_base);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org301d540" class="outline-3">
<h3 id="org301d540">p_stack_pointer</h3>
<div class="outline-text-3" id="text-org301d540">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_stack_pointer</span>() {
  as_push(as + as_pointer);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf47e654" class="outline-3">
<h3 id="orgf47e654">export_stack_operation</h3>
<div class="outline-text-3" id="text-orgf47e654">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_stack_operation</span>() {
  defprim(<span style="color: #e6db74;">"drop"</span>, p_drop);
  defprim(<span style="color: #e6db74;">"dup"</span>, p_dup);
  defprim(<span style="color: #e6db74;">"over"</span>, p_over);
  defprim(<span style="color: #e6db74;">"tuck"</span>, p_tuck);
  defprim(<span style="color: #e6db74;">"swap"</span>, p_swap);
  defprim(<span style="color: #e6db74;">"print-stack"</span>, p_print_stack);
  defprim(<span style="color: #e6db74;">"stack-pointer"</span>, p_stack_pointer);
  defprim(<span style="color: #e6db74;">"stack-base"</span>, p_stack_base);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgae6bb05" class="outline-2">
<h2 id="orgae6bb05"><b>ending</b></h2>
<div class="outline-text-2" id="text-orgae6bb05">
</div><div id="outline-container-org566faf1" class="outline-3">
<h3 id="org566faf1">p_end</h3>
<div class="outline-text-3" id="text-org566faf1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_end</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(rs: addr -&gt;)</span>
  rs_pop();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org89dd7b4" class="outline-3">
<h3 id="org89dd7b4">p_bye</h3>
<div class="outline-text-3" id="text-org89dd7b4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bye</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; [exit])</span>
  printf(<span style="color: #e6db74;">"bye bye ^-^/\n"</span>);
  exit(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org27b18b8" class="outline-3">
<h3 id="org27b18b8">export_ending</h3>
<div class="outline-text-3" id="text-org27b18b8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_ending</span>() {
  defprim(<span style="color: #e6db74;">"end"</span>, p_end);
  defprim(<span style="color: #e6db74;">"bye"</span>, p_bye);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd4d79bb" class="outline-2">
<h2 id="orgd4d79bb"><b>control</b></h2>
<div class="outline-text-2" id="text-orgd4d79bb">
</div><div id="outline-container-org237fda2" class="outline-3">
<h3 id="org237fda2">p_jump_back</h3>
<div class="outline-text-3" id="text-org237fda2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jump_back</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(offset -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body - as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org223a5c9" class="outline-3">
<h3 id="org223a5c9">p_jump_over</h3>
<div class="outline-text-3" id="text-org223a5c9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jump_over</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(offset -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body + as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7705416" class="outline-3">
<h3 id="org7705416">i_lit</h3>
<div class="outline-text-3" id="text-org7705416">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_lit</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body + 1);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
  as_push(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org39e457f" class="outline-3">
<h3 id="org39e457f">i_tail_call</h3>
<div class="outline-text-3" id="text-org39e457f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_tail_call</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
  apply(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org999a93f" class="outline-3">
<h3 id="org999a93f">p_jump_if_false</h3>
<div class="outline-text-3" id="text-org999a93f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jump_if_false</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool addr -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #f92672; font-weight: bold;">if</span> (b == 0) {
    rs_pop();
    rs_push(a);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb08bdf9" class="outline-3">
<h3 id="orgb08bdf9">export_control</h3>
<div class="outline-text-3" id="text-orgb08bdf9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_control</span>() {
  defprim(<span style="color: #e6db74;">"jump-back"</span>, p_jump_back);
  defprim(<span style="color: #e6db74;">"jump-over"</span>, p_jump_over);
  defprim(<span style="color: #e6db74;">"i-lit"</span>, i_lit);
  defprim(<span style="color: #e6db74;">"i-tail-call"</span>, i_tail_call);
  defprim(<span style="color: #e6db74;">"jump-if-false"</span>, p_jump_if_false);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org84eca6c" class="outline-2">
<h2 id="org84eca6c"><b>bool</b></h2>
<div class="outline-text-2" id="text-org84eca6c">
</div><div id="outline-container-orgec4653a" class="outline-3">
<h3 id="orgec4653a">p_true</h3>
<div class="outline-text-3" id="text-orgec4653a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_true</span>() {
  as_push(1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3183d01" class="outline-3">
<h3 id="org3183d01">p_false</h3>
<div class="outline-text-3" id="text-org3183d01">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_false</span>() {
  as_push(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge70153" class="outline-3">
<h3 id="orge70153">p_not</h3>
<div class="outline-text-3" id="text-orge70153">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_not</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(<span style="color: #960050;">!</span>a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5b846d" class="outline-3">
<h3 id="orge5b846d">export_bool</h3>
<div class="outline-text-3" id="text-orge5b846d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_bool</span>() {
  defprim(<span style="color: #e6db74;">"true"</span>, p_true);
  defprim(<span style="color: #e6db74;">"false"</span>, p_false);
  defprim(<span style="color: #e6db74;">"not"</span>, p_not);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org74c804c" class="outline-2">
<h2 id="org74c804c"><b>integer</b></h2>
<div class="outline-text-2" id="text-org74c804c">
</div><div id="outline-container-org3a48bbe" class="outline-3">
<h3 id="org3a48bbe">p_add</h3>
<div class="outline-text-3" id="text-org3a48bbe">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_add</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a + b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f7faab" class="outline-3">
<h3 id="org8f7faab">p_sub</h3>
<div class="outline-text-3" id="text-org8f7faab">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_sub</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a - b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf4b65f" class="outline-3">
<h3 id="orgdf4b65f">p_mul</h3>
<div class="outline-text-3" id="text-orgdf4b65f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_mul</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a * b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde33c77" class="outline-3">
<h3 id="orgde33c77">p_div</h3>
<div class="outline-text-3" id="text-orgde33c77">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_div</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a / b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f27f40" class="outline-3">
<h3 id="org9f27f40">p_mod</h3>
<div class="outline-text-3" id="text-org9f27f40">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_mod</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a % b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2736363" class="outline-3">
<h3 id="org2736363">p_eq_p</h3>
<div class="outline-text-3" id="text-org2736363">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_eq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a == b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org565c2f4" class="outline-3">
<h3 id="org565c2f4">p_gt_p</h3>
<div class="outline-text-3" id="text-org565c2f4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_gt_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &gt; b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d6fbad" class="outline-3">
<h3 id="org2d6fbad">p_lt_p</h3>
<div class="outline-text-3" id="text-org2d6fbad">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_lt_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &lt; b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf86f613" class="outline-3">
<h3 id="orgf86f613">p_gteq_p</h3>
<div class="outline-text-3" id="text-orgf86f613">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_gteq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &gt;= b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org78186ba" class="outline-3">
<h3 id="org78186ba">p_lteq_p</h3>
<div class="outline-text-3" id="text-org78186ba">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_lteq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &lt;= b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org538d74b" class="outline-3">
<h3 id="org538d74b">k_integer</h3>
<div class="outline-text-3" id="text-org538d74b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo</span>();

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_integer</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(jo2str(s))) {
      here(str2jo(<span style="color: #e6db74;">"i-lit"</span>));
      here(atoi(jo2str(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (# ...) : %s"</span>, jo2str(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a0597a" class="outline-3">
<h3 id="org4a0597a">p_print_integer</h3>
<div class="outline-text-3" id="text-org4a0597a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_print_integer</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%ld"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0d812e" class="outline-3">
<h3 id="orgf0d812e">p_dot</h3>
<div class="outline-text-3" id="text-orgf0d812e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dot</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%ld "</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeae3699" class="outline-3">
<h3 id="orgeae3699">export_integer</h3>
<div class="outline-text-3" id="text-orgeae3699">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_integer</span>() {
  defprim(<span style="color: #e6db74;">"add"</span>, p_add);
  defprim(<span style="color: #e6db74;">"sub"</span>, p_sub);

  defprim(<span style="color: #e6db74;">"mul"</span>, p_mul);
  defprim(<span style="color: #e6db74;">"div"</span>, p_div);
  defprim(<span style="color: #e6db74;">"mod"</span>, p_mod);

  defprim(<span style="color: #e6db74;">"neg"</span>, p_not);

  defprim(<span style="color: #e6db74;">"eq?"</span>, p_eq_p);
  defprim(<span style="color: #e6db74;">"gt?"</span>, p_gt_p);
  defprim(<span style="color: #e6db74;">"lt?"</span>, p_lt_p);
  defprim(<span style="color: #e6db74;">"gteq?"</span>, p_gteq_p);
  defprim(<span style="color: #e6db74;">"lteq?"</span>, p_lteq_p);

  defprim(<span style="color: #e6db74;">"#"</span>, k_integer);

  defprim(<span style="color: #e6db74;">"print-integer"</span>, p_print_integer);
  defprim(<span style="color: #e6db74;">"dot"</span>, p_dot);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org34a0b42" class="outline-2">
<h2 id="org34a0b42"><b>memory</b></h2>
<div class="outline-text-2" id="text-org34a0b42">
</div><div id="outline-container-org68942a8" class="outline-3">
<h3 id="org68942a8">p_allocate</h3>
<div class="outline-text-3" id="text-org68942a8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_allocate</span> () {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(size -&gt; addr)</span>
  as_push(calloc(as_pop(), 1));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ae07f6" class="outline-3">
<h3 id="org6ae07f6">p_free</h3>
<div class="outline-text-3" id="text-org6ae07f6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_free</span> () {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(addr -&gt;)</span>
  free(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb9289a0" class="outline-3">
<h3 id="orgb9289a0">k_var</h3>
<div class="outline-text-3" id="text-orgb9289a0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_var</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  here(str2jo(<span style="color: #e6db74;">"i-lit"</span>));
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_jo();
  here(&amp;(jotable[index].value.cell));
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge4a605b" class="outline-3">
<h3 id="orge4a605b">p_set</h3>
<div class="outline-text-3" id="text-orge4a605b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_set</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell addr -&gt;)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">address</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">value</span> = as_pop();
  address[0] = value;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge4c6319" class="outline-3">
<h3 id="orge4c6319">p_get</h3>
<div class="outline-text-3" id="text-orge4c6319">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_get</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(addr -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">address</span> = as_pop();
  as_push(address[0]);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2da0d71" class="outline-3">
<h3 id="org2da0d71">export_memory</h3>
<div class="outline-text-3" id="text-org2da0d71">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_memory</span>() {
  defprim(<span style="color: #e6db74;">"allocate"</span>, p_allocate);
  defprim(<span style="color: #e6db74;">"free"</span>, p_free);
  defprim(<span style="color: #e6db74;">"var"</span>, k_var);
  defprim(<span style="color: #e6db74;">"set"</span>, p_set);
  defprim(<span style="color: #e6db74;">"get"</span>, p_get);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge385c64" class="outline-2">
<h2 id="orge385c64">read_char</h2>
<div class="outline-text-2" id="text-orge385c64">
</div><div id="outline-container-orgd2c2142" class="outline-3">
<h3 id="orgd2c2142">reading_stack</h3>
<div class="outline-text-3" id="text-orgd2c2142">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #66d9ef; font-weight: bold;">reading_stack_t</span>[64];

<span style="color: #66d9ef; font-weight: bold;">reading_stack_t</span> <span style="color: #fd971f;">reading_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">reading_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">reading_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">reading_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">value</span>) {
  reading_stack[reading_stack_pointer] = value;
  reading_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #a6e22e;">reading_stack_pop</span>() {
  reading_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack[reading_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #a6e22e;">reading_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack[reading_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">reading_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack_pointer == reading_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org32be627" class="outline-3">
<h3 id="org32be627">loading_stack</h3>
<div class="outline-text-3" id="text-org32be627">
<ul class="org-ul">
<li><p>a hook for read_jo</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">nick</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>;
} <span style="color: #66d9ef; font-weight: bold;">alias</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #66d9ef; font-weight: bold;">loading_stack_t</span>[64];

<span style="color: #66d9ef; font-weight: bold;">loading_stack_t</span> <span style="color: #fd971f;">loading_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">loading_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">loading_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">loading_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #fd971f;">value</span>) {
  loading_stack[loading_stack_pointer] = value;
  loading_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #a6e22e;">loading_stack_pop</span>() {
  loading_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> loading_stack[loading_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #a6e22e;">loading_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> loading_stack[loading_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">loading_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> loading_stack_pointer == loading_stack_base;
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">alias_record_size</span> = 1024;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_loading_stack</span>() {
  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">record</span>[alias_record_size];
  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">a</span> = {.nick = 0, .name = 0};
  record[0] = a;
  loading_stack_push(record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8af399e" class="outline-3">
<h3 id="org8af399e">read_char</h3>
<div class="outline-text-3" id="text-org8af399e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #a6e22e;">read_char</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    <span style="color: #f92672; font-weight: bold;">return</span> fgetc(stdin);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = fgetc(reading_stack_tos());
    <span style="color: #f92672; font-weight: bold;">if</span> (c == EOF) {
      fclose(reading_stack_pop());
      loading_stack_pop();
      <span style="color: #f92672; font-weight: bold;">return</span> read_char();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">return</span> c;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org52e3ef7" class="outline-3">
<h3 id="org52e3ef7">unread_char</h3>
<div class="outline-text-3" id="text-org52e3ef7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">unread_char</span>(<span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    ungetc(c, stdin);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    ungetc(c, reading_stack_tos());
  }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge455674" class="outline-2">
<h2 id="orge455674"><b>jo</b></h2>
<div class="outline-text-2" id="text-orge455674">
</div><div id="outline-container-org6e5b170" class="outline-3">
<h3 id="org6e5b170">alias_add</h3>
<div class="outline-text-3" id="text-org6e5b170">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">alias_add</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">nick</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #fd971f;">alias_record</span> = loading_stack_tos();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; alias_record_size) {
    <span style="color: #f92672; font-weight: bold;">if</span> (alias_record[i].nick == 0 &amp;&amp;
        alias_record[i].name == 0) {
      alias_record[i].nick = nick;
      alias_record[i].name = name;
      alias_record[i+1].nick = 0;
      alias_record[i+1].name = 0;
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      i++;
    }
  }
  printf(<span style="color: #e6db74;">"alias_add fail alias_record is full\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org73b4c9a" class="outline-3">
<h3 id="org73b4c9a">alias_find</h3>
<div class="outline-text-3" id="text-org73b4c9a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">alias_find</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">nick</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #fd971f;">alias_record</span> = loading_stack_tos();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #f92672; font-weight: bold;">if</span> (alias_record[i].nick == 0 &amp;&amp;
        alias_record[i].name == 0) {
      <span style="color: #f92672; font-weight: bold;">return</span> 0;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (alias_record[i].nick == nick) {
      <span style="color: #f92672; font-weight: bold;">return</span> alias_record[i].name;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      i++;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2bcd76c" class="outline-3">
<h3 id="org2bcd76c">read_jo</h3>
<div class="outline-text-3" id="text-org2bcd76c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buf</span>[1024];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cur</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">collecting</span> = <span style="color: #ae81ff;">false</span>;
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>;
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">go</span> = <span style="color: #ae81ff;">true</span>;
  <span style="color: #f92672; font-weight: bold;">while</span> (go) {
    c = read_char();
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>collecting) {
      <span style="color: #f92672; font-weight: bold;">if</span> (isspace(c)) {
        <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        collecting = <span style="color: #ae81ff;">true</span>;
        buf[cur] = c;
        cur++;
        <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c)) {
          go = <span style="color: #ae81ff;">false</span>;
        }
      }
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c) ||
          isspace(c)) {
        unread_char(c);
        go = <span style="color: #ae81ff;">false</span>;
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        buf[cur] = c;
        cur++;
      }
    }
  }
  buf[cur] = 0;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo0</span> = str2jo(buf);
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo1</span> = alias_find(jo0);
  <span style="color: #f92672; font-weight: bold;">if</span> (jo1 != 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> jo1;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> jo0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a9ac3f" class="outline-3">
<h3 id="org8a9ac3f">cat_jo</h3>
<div class="outline-text-3" id="text-org8a9ac3f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">cat_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">x</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">y</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">str</span>[1024];
  str[0] = 0;
  strcat(str, jo2str(x));
  strcat(str, jo2str(y));
  <span style="color: #f92672; font-weight: bold;">return</span> str2jo(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga78fd88" class="outline-3">
<h3 id="orga78fd88">p_read_jo</h3>
<div class="outline-text-3" id="text-orga78fd88">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_jo</span>() {
  as_push(read_jo());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e1adbb" class="outline-3">
<h3 id="org4e1adbb">p_jo_used_p</h3>
<div class="outline-text-3" id="text-org4e1adbb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_used_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span> = as_pop();
  as_push(jotable_entry_used(jotable[jo]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf10bb0" class="outline-3">
<h3 id="orgbf10bb0">p_jo_to_string</h3>
<div class="outline-text-3" id="text-orgbf10bb0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_to_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span> = as_pop();
  as_push(jo2str(jo));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3c5555" class="outline-3">
<h3 id="orgf3c5555">p_string_to_jo</h3>
<div class="outline-text-3" id="text-orgf3c5555">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_to_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = as_pop();
  as_push(str2jo(str));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbaf124a" class="outline-3">
<h3 id="orgbaf124a">p_null</h3>
<div class="outline-text-3" id="text-orgbaf124a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_null</span>() {
  as_push(str2jo(<span style="color: #e6db74;">"null"</span>));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb6a420" class="outline-3">
<h3 id="orgeb6a420">k_jo</h3>
<div class="outline-text-3" id="text-orgeb6a420">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(str2jo(<span style="color: #e6db74;">"i-lit"</span>));
      here(s);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ec6d46" class="outline-3">
<h3 id="org3ec6d46">export_jo</h3>
<div class="outline-text-3" id="text-org3ec6d46">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_jo</span>() {
  defprim(<span style="color: #e6db74;">"null"</span>, p_null);
  defprim(<span style="color: #e6db74;">"read-jo"</span>, p_read_jo);
  defprim(<span style="color: #e6db74;">"jo-used?"</span>, p_jo_used_p);
  defprim(<span style="color: #e6db74;">"jo-&gt;string"</span>, p_jo_to_string);
  defprim(<span style="color: #e6db74;">"string-&gt;jo"</span>, p_string_to_jo);
  defprim(<span style="color: #e6db74;">"jo"</span>, k_jo);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6dd2361" class="outline-2">
<h2 id="org6dd2361"><b>string</b></h2>
<div class="outline-text-2" id="text-org6dd2361">
</div><div id="outline-container-org304cb92" class="outline-3">
<h3 id="org304cb92">k_one_string</h3>
<div class="outline-text-3" id="text-org304cb92">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_one_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[1024 * 1024];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cursor</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = read_char();
    <span style="color: #f92672; font-weight: bold;">if</span> (c == <span style="color: #e6db74;">'"'</span>) {
      buffer[cursor] = 0;
      cursor++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      buffer[cursor] = c;
      cursor++;
    }
  }
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = malloc(cursor);
  strcpy(str, buffer);
  here(str2jo(<span style="color: #e6db74;">"i-lit"</span>));
  here(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb110e1a" class="outline-3">
<h3 id="orgb110e1a">k_string</h3>
<div class="outline-text-3" id="text-orgb110e1a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"\""</span>)) {
      k_one_string();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4284dbd" class="outline-3">
<h3 id="org4284dbd">p_print_string</h3>
<div class="outline-text-3" id="text-org4284dbd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_print_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%s"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f94aec" class="outline-3">
<h3 id="org7f94aec">export_string</h3>
<div class="outline-text-3" id="text-org7f94aec">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_string</span>() {
  defprim(<span style="color: #e6db74;">"string"</span>, k_string);
  defprim(<span style="color: #e6db74;">"print-string"</span>, p_print_string);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf7627c7" class="outline-2">
<h2 id="orgf7627c7"><b>file</b></h2>
<div class="outline-text-2" id="text-orgf7627c7">
</div><div id="outline-container-org4870640" class="outline-3">
<h3 id="org4870640">p_read_file</h3>
<div class="outline-text-3" id="text-org4870640">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_file</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string addr number -&gt; number)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">limit</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">buffer</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">path</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">fp</span> = fopen(path, <span style="color: #e6db74;">"r"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span>(<span style="color: #960050;">!</span>fp) {
    perror(<span style="color: #e6db74;">"p_read_file file to open file"</span>);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">readed_counter</span> = fread(buffer, 1, limit, fp);
  fclose(fp);
  as_push(readed_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf522c" class="outline-3">
<h3 id="orgf522c">file_readable_p</h3>
<div class="outline-text-3" id="text-orgf522c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">file_readable_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>) {
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">fp</span> = fopen(path, <span style="color: #e6db74;">"r"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>fp) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    fclose(fp);
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org29305d6" class="outline-3">
<h3 id="org29305d6">export_file</h3>
<div class="outline-text-3" id="text-org29305d6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_file</span>() {
  defprim(<span style="color: #e6db74;">"read-file"</span>, p_read_file);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7d87a0c" class="outline-2">
<h2 id="org7d87a0c"><b>system</b></h2>
<div class="outline-text-2" id="text-org7d87a0c">
</div><div id="outline-container-org5781dec" class="outline-3">
<h3 id="org5781dec">p_getcwd</h3>
<div class="outline-text-3" id="text-org5781dec">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_getcwd</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buf</span>[1024];
  as_push(getcwd(buf, 1024));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1af501" class="outline-3">
<h3 id="orgf1af501">export_system</h3>
<div class="outline-text-3" id="text-orgf1af501">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_system</span>() {
  defprim(<span style="color: #e6db74;">"getcwd"</span>, p_getcwd);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org48796d3" class="outline-2">
<h2 id="org48796d3"><b>module</b></h2>
<div class="outline-text-2" id="text-org48796d3">
</div><div id="outline-container-orgce6b1d6" class="outline-3">
<h3 id="orgce6b1d6">user_module_path</h3>
<div class="outline-text-3" id="text-orgce6b1d6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">user_module_path</span> = <span style="color: #e6db74;">"/home/xyh/.jojo/module/"</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbadb84c" class="outline-3">
<h3 id="orgbadb84c">system_module_path</h3>
<div class="outline-text-3" id="text-orgbadb84c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">system_module_path</span> = <span style="color: #e6db74;">""</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org8191185" class="outline-3">
<h3 id="org8191185">module_stack</h3>
<div class="outline-text-3" id="text-org8191185">
<ul class="org-ul">
<li><p>just record what modules are loaded</p><p>and their meta-data :</p><p><ul class="org-ul"></p><p><li><p>path</p></li></ul></p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>;
} <span style="color: #66d9ef; font-weight: bold;">module</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #66d9ef; font-weight: bold;">module_stack_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">module_stack_t</span> <span style="color: #fd971f;">module_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">value</span>) {
  module_stack[module_stack_pointer] = value;
  module_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #a6e22e;">module_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> module_stack[module_stack_pointer - 1];
}


<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">module_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> module_stack_pointer == module_stack_base;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">module_stack_find</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; module_stack_pointer) {
    <span style="color: #f92672; font-weight: bold;">if</span> (name == module_stack[i].name) {
      <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b700d0" class="outline-3">
<h3 id="org8b700d0">load_file</h3>
<div class="outline-text-3" id="text-org8b700d0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">load_file</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>) {
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">fp</span> = fopen(path, <span style="color: #e6db74;">"r"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span>(<span style="color: #960050;">!</span>fp) {
    perror(<span style="color: #e6db74;">"File opening failed"</span>);
    printf(<span style="color: #e6db74;">"load_file fail : %s\n"</span>, path);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  reading_stack_push(fp);
  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">record</span>[alias_record_size];
  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">a</span> = {.nick = 0, .name = 0};
  record[0] = a;
  loading_stack_push(record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3882ca2" class="outline-3">
<h3 id="org3882ca2">find_module</h3>
<div class="outline-text-3" id="text-org3882ca2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">find_module</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">path</span>[1024];
  getcwd(path, 1024);
  strcat(path, <span style="color: #e6db74;">"/"</span>);
  strcat(path, jo2str(name));
  strcat(path, <span style="color: #e6db74;">".jo"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (file_readable_p(path)) {
    <span style="color: #f92672; font-weight: bold;">return</span> copy_to_string_area(path);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> 0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org308b74c" class="outline-3">
<h3 id="org308b74c">load_module</h3>
<div class="outline-text-3" id="text-org308b74c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">load_module</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span> = find_module(name);
  <span style="color: #f92672; font-weight: bold;">if</span> (path == 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
  load_file(path);
  <span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">m</span> = {
    .name = name,
    .path = path
  };
  module_stack_push(m);
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c4dac8" class="outline-3">
<h3 id="org4c4dac8">k_import</h3>
<div class="outline-text-3" id="text-org4c4dac8">
</div><div id="outline-container-orga740e1" class="outline-4">
<h4 id="orga740e1">k_add_alias</h4>
<div class="outline-text-4" id="text-orga740e1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_add_alias</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">prefix</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [loading_stack])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>alias_find(s) == 0) {
      printf(<span style="color: #e6db74;">"k_add_alias fail, alias used : %s\n"</span>, jo2str(s));
      k_ignore();
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">str</span>[1024];
      str[0] = 0;
      strcat(str, jo2str(prefix));
      strcat(str, <span style="color: #e6db74;">"/"</span>);
      strcat(str, jo2str(s));
      alias_add(s, str2jo(str));
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org30eb94f" class="outline-4">
<h4 id="org30eb94f">k_one_module</h4>
<div class="outline-text-4" id="text-org30eb94f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_one_module</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [loading_stack])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span> = read_jo();
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>module_stack_find(name)) {
    <span style="color: #f92672; font-weight: bold;">if</span>(<span style="color: #960050;">!</span>load_module(name)) {
      printf(<span style="color: #e6db74;">"k_one_module fail to load module : %s\n"</span>, jo2str(name));
      k_ignore();
    }
  }
  k_add_alias(name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2813e73" class="outline-4">
<h4 id="org2813e73">k_import</h4>
<div class="outline-text-4" id="text-org2813e73">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_import</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [loading_stack])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      k_one_module();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2a919af" class="outline-3">
<h3 id="org2a919af">export_module</h3>
<div class="outline-text-3" id="text-org2a919af">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_module</span>() {
  defprim(<span style="color: #e6db74;">"import"</span>, k_import);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7c09be5" class="outline-2">
<h2 id="org7c09be5"><b>ffi</b></h2>
<div class="outline-text-2" id="text-org7c09be5">
</div><div id="outline-container-orge0925b8" class="outline-3">
<h3 id="orge0925b8">get_clib</h3>
<div class="outline-text-3" id="text-orge0925b8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>* <span style="color: #a6e22e;">get_clib</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>) {
  <span style="color: #66d9ef; font-weight: bold;">void</span>* <span style="color: #fd971f;">lib</span> = dlopen(path, RTLD_LAZY);
  <span style="color: #f92672; font-weight: bold;">if</span> (lib == <span style="color: #ae81ff;">NULL</span>) {
    printf(<span style="color: #e6db74;">"fail to open library : %s : %s\n"</span>,
           path, dlerror());
  };
  <span style="color: #f92672; font-weight: bold;">return</span> lib;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5323e8f" class="outline-3">
<h3 id="org5323e8f">ccall</h3>
<div class="outline-text-3" id="text-org5323e8f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">ccall</span> (<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">void</span>* <span style="color: #fd971f;">lib</span>) {
  <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">fun</span> = dlsym(lib, str);
  <span style="color: #f92672; font-weight: bold;">if</span> (fun == <span style="color: #ae81ff;">NULL</span>) {
    printf(<span style="color: #e6db74;">"can not find %s function lib : %s\n"</span>,
           str, dlerror());
  };
  fun();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc50f25f" class="outline-3">
<h3 id="orgc50f25f">k_one_clib</h3>
<div class="outline-text-3" id="text-orgc50f25f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_one_clib</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[1024];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cursor</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = read_char();
    <span style="color: #f92672; font-weight: bold;">if</span> (c == <span style="color: #e6db74;">')'</span>) {
      buffer[cursor] = 0;
      cursor++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      buffer[cursor] = c;
      cursor++;
    }
  }
  ccall(<span style="color: #e6db74;">"export"</span>, get_clib(buffer));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf51360" class="outline-3">
<h3 id="orgf51360">k_clib</h3>
<div class="outline-text-3" id="text-orgf51360">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_clib</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      k_one_clib();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4355e93" class="outline-3">
<h3 id="org4355e93">export_ffi</h3>
<div class="outline-text-3" id="text-org4355e93">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_ffi</span>() {
  defprim(<span style="color: #e6db74;">"clib"</span>, k_clib);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org83e7a6d" class="outline-2">
<h2 id="org83e7a6d"><b>top_level</b></h2>
<div class="outline-text-2" id="text-org83e7a6d">
</div><div id="outline-container-org75dfaa3" class="outline-3">
<h3 id="org75dfaa3">prim_jo_p &amp; fun_jo_p &amp; var_jo_p &amp; used_jo_p</h3>
<div class="outline-text-3" id="text-org75dfaa3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">prim_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].type == str2jo(<span style="color: #e6db74;">"primitive"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">fun_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].type == str2jo(<span style="color: #e6db74;">"function"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">var_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].type == str2jo(<span style="color: #e6db74;">"variable"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">used_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span>
    prim_jo_p(index) ||
    fun_jo_p(index) ||
    var_jo_p(index);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4db679" class="outline-3">
<h3 id="orgb4db679">read_alias_jo</h3>
<div class="outline-text-3" id="text-orgb4db679">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_alias_jo</span>() {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">alias_jo</span> = read_jo();
  <span style="color: #f92672; font-weight: bold;">if</span> (module_stack_empty_p()) {
    <span style="color: #f92672; font-weight: bold;">return</span> alias_jo;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">new_jo</span> = cat_jo(cat_jo(module_stack_tos().name,
                                     str2jo(<span style="color: #e6db74;">"/"</span>)),
                              alias_jo);
    alias_add(alias_jo, new_jo);
    <span style="color: #f92672; font-weight: bold;">return</span> new_jo;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ae1f63" class="outline-3">
<h3 id="org8ae1f63">k_defun</h3>
<div class="outline-text-3" id="text-org8ae1f63">
</div><div id="outline-container-org366b493" class="outline-4">
<h4 id="org366b493">defun_record</h4>
<div class="outline-text-4" id="text-org366b493">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">defun_record</span>[64 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defun_record_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e5ef1e" class="outline-4">
<h4 id="org6e5ef1e">p_defun_record</h4>
<div class="outline-text-4" id="text-org6e5ef1e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_defun_record</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; addr)</span>
  as_push(defun_record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8d63e7" class="outline-4">
<h4 id="orgd8d63e7">defun_report</h4>
<div class="outline-text-4" id="text-orgd8d63e7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defun_report</span>() {
  printf(<span style="color: #e6db74;">"- defun_report // counter : %ld\n"</span>, defun_record_counter);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; defun_record_counter) {
    printf(<span style="color: #e6db74;">"  %s\n"</span>, jo2str(defun_record[i]));
    i++;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga53aba" class="outline-4">
<h4 id="orga53aba">defun_stack</h4>
<div class="outline-text-4" id="text-orga53aba">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #66d9ef; font-weight: bold;">defun_stack_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">defun_stack_t</span> <span style="color: #fd971f;">defun_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defun_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defun_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defun_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">value</span>) {
  defun_stack[defun_stack_pointer] = value;
  defun_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">defun_stack_pop</span>() {
  defun_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> defun_stack[defun_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defun_stack_inc</span>() {
  defun_stack[defun_stack_pointer - 1] =
    defun_stack[defun_stack_pointer - 1] + 1;
}


<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">defun_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> defun_stack[defun_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">defun_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> defun_stack_pointer == defun_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b414c0" class="outline-4">
<h4 id="org4b414c0">k_defun</h4>
<div class="outline-text-4" id="text-org4b414c0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_defun</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile] [jotable])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_alias_jo();
  <span style="color: #f92672; font-weight: bold;">if</span> (used_jo_p(index)) {
    printf(<span style="color: #e6db74;">"- defun can not re-define : %s\n"</span>, jo2str(index));
    printf(<span style="color: #e6db74;">"  it already defined as : %s\n"</span>, jo2str(jotable[index].type));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  defun_stack_push(index);
  defun_record[defun_record_counter] = index;
  defun_record_counter++;
  defun_record[defun_record_counter] = 0;
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">array</span> = compiling_stack_tos();
  k_jojo();
  here(str2jo(<span style="color: #e6db74;">"end"</span>));
  jotable[index].type = str2jo(<span style="color: #e6db74;">"function"</span>);
  jotable[index].value.jojo.size = compiling_stack_tos() - array;
  jotable[index].value.jojo.array = array;
  defun_stack_pop();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1a17e4f" class="outline-3">
<h3 id="org1a17e4f">k_declare</h3>
<div class="outline-text-3" id="text-org1a17e4f">
</div><div id="outline-container-org9e8f98a" class="outline-4">
<h4 id="org9e8f98a"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-org9e8f98a">
<ul class="org-ul">
<li><p>no compile before define</p><p>declare helps mutual recursive function</p></li></ul>
</div>
</div>

<div id="outline-container-org45801c7" class="outline-4">
<h4 id="org45801c7">k_one_declare</h4>
<div class="outline-text-4" id="text-org45801c7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_one_declare</span>() {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_alias_jo();
  jotable[index].type = str2jo(<span style="color: #e6db74;">"declared"</span>);
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org43700aa" class="outline-4">
<h4 id="org43700aa">k_declare</h4>
<div class="outline-text-4" id="text-org43700aa">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_declare</span>() {
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      k_one_declare();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgce403e9" class="outline-3">
<h3 id="orgce403e9">k_run</h3>
<div class="outline-text-3" id="text-orgce403e9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_run</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">array</span>[64 * 1024];
  compiling_stack_push(array);
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      here(str2jo(<span style="color: #e6db74;">"end"</span>));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
  compiling_stack_pop();
  eval_jojo(array);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f15bbd" class="outline-3">
<h3 id="org3f15bbd">k_defvar</h3>
<div class="outline-text-3" id="text-org3f15bbd">
</div><div id="outline-container-org110c40" class="outline-4">
<h4 id="org110c40">defvar_record</h4>
<div class="outline-text-4" id="text-org110c40">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">defvar_record</span>[64 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defvar_record_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge3270c7" class="outline-4">
<h4 id="orge3270c7">p_defvar_record</h4>
<div class="outline-text-4" id="text-orge3270c7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_defvar_record</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; addr)</span>
  as_push(defvar_record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3fac47" class="outline-4">
<h4 id="orgd3fac47">defvar_report</h4>
<div class="outline-text-4" id="text-orgd3fac47">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defvar_report</span>() {
  printf(<span style="color: #e6db74;">"- defvar_report // counter : %ld\n"</span>, defvar_record_counter);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; defvar_record_counter) {
    printf(<span style="color: #e6db74;">"  %s\n"</span>, jo2str(defvar_record[i]));
    i++;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5d66f9" class="outline-4">
<h4 id="orgc5d66f9">k_defvar</h4>
<div class="outline-text-4" id="text-orgc5d66f9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_defvar</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile] [jotable])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_alias_jo();
  <span style="color: #f92672; font-weight: bold;">if</span> (used_jo_p(index)) {
    printf(<span style="color: #e6db74;">"- defvar can not re-define : %s\n"</span>, jo2str(index));
    printf(<span style="color: #e6db74;">"  it already defined as : %s\n"</span>, jo2str(jotable[index].type));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  defvar_record[defvar_record_counter] = index;
  defvar_record_counter++;
  defvar_record[defvar_record_counter] = 0;
  k_run();
  jotable_set_cell(index, as_pop());
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4aecbef" class="outline-3">
<h3 id="org4aecbef">p_top_repl</h3>
<div class="outline-text-3" id="text-org4aecbef">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_top_repl</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e887f3" class="outline-3">
<h3 id="org9e887f3">export_top_level</h3>
<div class="outline-text-3" id="text-org9e887f3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_top_level</span>() {
  defprim(<span style="color: #e6db74;">"defun-record"</span>, p_defun_record);
  defprim(<span style="color: #e6db74;">"defun-report"</span>, defun_report);

  defprim(<span style="color: #e6db74;">"defun"</span>, k_defun);

  defprim(<span style="color: #e6db74;">"declare"</span>, k_declare);

  defprim(<span style="color: #e6db74;">"run"</span>, k_run);

  defprim(<span style="color: #e6db74;">"defvar-record"</span>, p_defvar_record);
  defprim(<span style="color: #e6db74;">"defvar-report"</span>, defvar_report);
  defprim(<span style="color: #e6db74;">"defvar"</span>, k_defvar);

  defprim(<span style="color: #e6db74;">"top-repl"</span>, p_top_repl);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3ec13a4" class="outline-2">
<h2 id="org3ec13a4"><b>keyword</b></h2>
<div class="outline-text-2" id="text-org3ec13a4">
</div><div id="outline-container-org2da03" class="outline-3">
<h3 id="org2da03">k_ignore</h3>
<div class="outline-text-3" id="text-org2da03">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_ignore</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      k_ignore();
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org759e84c" class="outline-3">
<h3 id="org759e84c">k_jojo</h3>
<div class="outline-text-3" id="text-org759e84c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_jojo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[s]) ||
             defun_stack_empty_p() ||
             defun_stack_tos() == s) {
      here(s);
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">no compile before define</span>
      printf(<span style="color: #e6db74;">"- k_jojo undefined : %s\n"</span>, jo2str(s));
      k_ignore();
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org185a506" class="outline-3">
<h3 id="org185a506">k_if</h3>
<div class="outline-text-3" id="text-org185a506">
</div><div id="outline-container-org1557f1f" class="outline-4">
<h4 id="org1557f1f"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-org1557f1f">
<ul class="org-ul">
<li><p>(if a b p? -&gt; c d)</p></li>

<li><p>a b p?</p><p>[jump] jumk_if_false</p><p>c d</p><p>:jump</p></li>

<li><p>because the use of as_snapshot</p><p>bar can not be nested in antecedent</p></li></ul>
</div>
</div>

<div id="outline-container-orgcbbee9c" class="outline-4">
<h4 id="orgcbbee9c">compile_question</h4>
<div class="outline-text-4" id="text-orgcbbee9c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compile_question</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"-&gt;"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb12af1" class="outline-4">
<h4 id="orgeb12af1">compile_answer</h4>
<div class="outline-text-4" id="text-orgeb12af1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compile_answer</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  here(str2jo(<span style="color: #e6db74;">"i-lit"</span>));
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">offset_place</span> = compiling_stack_tos();
  compiling_stack_inc();
  here(str2jo(<span style="color: #e6db74;">"jump-if-false"</span>));
  k_jojo();
  offset_place[0] = compiling_stack_tos();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdb7bb1f" class="outline-4">
<h4 id="orgdb7bb1f">k_if</h4>
<div class="outline-text-4" id="text-orgdb7bb1f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_if</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  compile_question();
  compile_answer();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org57eccc4" class="outline-3">
<h3 id="org57eccc4">k_tail_call</h3>
<div class="outline-text-3" id="text-org57eccc4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_tail_call</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">no check for "no compile before define"</span>
  here(str2jo(<span style="color: #e6db74;">"i-tail-call"</span>));
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
  here(s);
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e56bc8" class="outline-3">
<h3 id="org2e56bc8">k_loop</h3>
<div class="outline-text-3" id="text-org2e56bc8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_loop</span>() {
  here(str2jo(<span style="color: #e6db74;">"i-tail-call"</span>));
  here(defun_stack_tos());
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge22c561" class="outline-3">
<h3 id="orge22c561">k_recur</h3>
<div class="outline-text-3" id="text-orge22c561">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_recur</span>() {
 here(defun_stack_tos());
 k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org217dda6" class="outline-3">
<h3 id="org217dda6">export_keyword</h3>
<div class="outline-text-3" id="text-org217dda6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_keyword</span>() {
  defprim(<span style="color: #e6db74;">":"</span>, k_ignore);
  defprim(<span style="color: #e6db74;">"note"</span>, k_ignore);
  defprim(<span style="color: #e6db74;">"if"</span>, k_if);
  defprim(<span style="color: #e6db74;">"jojo"</span>, k_jojo);
  defprim(<span style="color: #e6db74;">"else"</span>, k_jojo);
  defprim(<span style="color: #e6db74;">"tail-call"</span>, k_tail_call);
  defprim(<span style="color: #e6db74;">"loop"</span>, k_loop);
  defprim(<span style="color: #e6db74;">"recur"</span>, k_recur);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5194ecf" class="outline-2">
<h2 id="org5194ecf"><b>misc</b></h2>
<div class="outline-text-2" id="text-org5194ecf">
</div><div id="outline-container-org9031ea4" class="outline-3">
<h3 id="org9031ea4">do_nothing</h3>
<div class="outline-text-3" id="text-org9031ea4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">do_nothing</span>() {
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org24a372b" class="outline-3">
<h3 id="org24a372b">p_here</h3>
<div class="outline-text-3" id="text-org24a372b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_here</span>() {
  here(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fcbe48" class="outline-3">
<h3 id="org4fcbe48">bar-ket</h3>
<div class="outline-text-3" id="text-org4fcbe48">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_round_bar</span>() { as_push(str2jo(<span style="color: #e6db74;">"("</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_round_ket</span>() { as_push(str2jo(<span style="color: #e6db74;">")"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_square_bar</span>() { as_push(str2jo(<span style="color: #e6db74;">"["</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_square_ket</span>() { as_push(str2jo(<span style="color: #e6db74;">"]"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_flower_bar</span>() { as_push(str2jo(<span style="color: #e6db74;">"{"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_flower_ket</span>() { as_push(str2jo(<span style="color: #e6db74;">"}"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_double_quote</span>() { as_push(str2jo(<span style="color: #e6db74;">"\""</span>)); }
</pre>
</div>
</div>
</div>

<div id="outline-container-org77173e9" class="outline-3">
<h3 id="org77173e9">p_cell_size</h3>
<div class="outline-text-3" id="text-org77173e9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_cell_size</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; cell)</span>
  as_push(<span style="color: #f92672; font-weight: bold;">sizeof</span>(cell));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd99d26c" class="outline-3">
<h3 id="orgd99d26c">p_newline</h3>
<div class="outline-text-3" id="text-orgd99d26c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_newline</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc55e96f" class="outline-3">
<h3 id="orgc55e96f">export_mise</h3>
<div class="outline-text-3" id="text-orgc55e96f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_mise</span>() {
  defprim(<span style="color: #e6db74;">"here"</span>, p_here);
  defprim(<span style="color: #e6db74;">"apply"</span>, p_apply);
  defprim(<span style="color: #e6db74;">"jotable-report"</span>, jotable_report);

  defprim(<span style="color: #e6db74;">"round-bar"</span>, p_round_bar);
  defprim(<span style="color: #e6db74;">"round-ket"</span>, p_round_ket);
  defprim(<span style="color: #e6db74;">"square-bar"</span>, p_square_bar);
  defprim(<span style="color: #e6db74;">"square-ket"</span>, p_square_ket);
  defprim(<span style="color: #e6db74;">"flower-bar"</span>, p_flower_bar);
  defprim(<span style="color: #e6db74;">"flower-ket"</span>, p_flower_ket);
  defprim(<span style="color: #e6db74;">"double-quote"</span>, p_double_quote);

  defprim(<span style="color: #e6db74;">"cell-size"</span>, p_cell_size);
  defprim(<span style="color: #e6db74;">"defprim-report"</span>, defprim_report);
  defprim(<span style="color: #e6db74;">"newline"</span>, p_newline);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga08dba5" class="outline-2">
<h2 id="orga08dba5"><b>play</b></h2>
<div class="outline-text-2" id="text-orga08dba5">
</div><div id="outline-container-orgde6d595" class="outline-3">
<h3 id="orgde6d595">p1</h3>
<div class="outline-text-3" id="text-orgde6d595">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p1</span>() {
  printf(<span style="color: #e6db74;">"p1 : %ld %ld\n"</span>, <span style="color: #f92672; font-weight: bold;">sizeof</span>(<span style="color: #66d9ef; font-weight: bold;">void</span>*), <span style="color: #f92672; font-weight: bold;">sizeof</span>(intptr_t));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1504a1" class="outline-3">
<h3 id="orgf1504a1">p2</h3>
<div class="outline-text-3" id="text-orgf1504a1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p2</span>() {

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeaa186b" class="outline-3">
<h3 id="orgeaa186b">p3</h3>
<div class="outline-text-3" id="text-orgeaa186b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p3</span>() {

}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7c5e15" class="outline-3">
<h3 id="orgf7c5e15">export_play</h3>
<div class="outline-text-3" id="text-orgf7c5e15">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_play</span>() {
  defprim(<span style="color: #e6db74;">"p1"</span>, p1);
  defprim(<span style="color: #e6db74;">"p2"</span>, p2);
  defprim(<span style="color: #e6db74;">"p3"</span>, p3);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga0d0a1b" class="outline-2">
<h2 id="orga0d0a1b">epilog</h2>
<div class="outline-text-2" id="text-orga0d0a1b">
</div><div id="outline-container-org3692073" class="outline-3">
<h3 id="org3692073">run_basic_repl</h3>
<div class="outline-text-3" id="text-org3692073">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">run_basic_repl</span>() {
  init_jotable();
  init_compiling_stack();
  init_loading_stack();

  export_stack_operation();
  export_ending();
  export_control();
  export_integer();
  export_memory();
  export_jo();
  export_string();
  export_file();
  export_bool();
  export_keyword();
  export_system();
  export_module();
  export_ffi();
  export_top_level();
  export_mise();
  export_play();

  p_top_repl();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org78f0c3e" class="outline-3">
<h3 id="org78f0c3e">main</h3>
<div class="outline-text-3" id="text-org78f0c3e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #a6e22e;">main</span>(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">argc</span>, <span style="color: #66d9ef; font-weight: bold;">string</span>* <span style="color: #fd971f;">argv</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (argc == 1) {
    run_basic_repl();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    load_file(argv[1]);
    run_basic_repl();
  }
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
涕执我乎垂丧兮 懼余生之茫苦
</div>
</body>
</html>
