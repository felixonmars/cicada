<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-07-08 Fri 18:14 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="XIE Yuheng" />
<link rel="stylesheet" href="http://xieyuheng.github.io/asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
長悲嘆而掩面兮 憐其獨於夢睹
</div>
<div id="content">
<h1 class="title">jojo</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9bfaf5b"><span class="done todo">todo</span> </a></li>
<li><a href="#orgf28a492"><span class="todo note">note</span> </a>
<ul>
<li><a href="#orgebbe71e">about</a></li>
<li><a href="#org4c21c83">naming convention</a></li>
</ul>
</li>
<li><a href="#org3bc7c5e">helper</a>
<ul>
<li><a href="#org5e97691">header</a></li>
<li><a href="#orge7d3c12">bool</a></li>
<li><a href="#org172c32b">cell</a></li>
<li><a href="#org3073ab">int</a></li>
<li><a href="#orgbd035e4">byte</a></li>
<li><a href="#org8356735">char</a></li>
<li><a href="#orgcf82629">char_to_nat</a></li>
<li><a href="#org5be0346">string</a>
<ul>
<li><a href="#orge21798e">string</a></li>
<li><a href="#org6068da4">string_equal</a></li>
<li><a href="#orga0d3e71">nat_string_p</a></li>
<li><a href="#org1069630">int_string_p</a></li>
<li><a href="#org669273b">string_to_based_[nat|int]</a></li>
<li><a href="#org46b640a">string_to_[dec|bin|oct|hex]</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfb22d30">jotable</a>
<ul>
<li><a href="#orgae12d2f">primitive</a></li>
<li><a href="#orgab864f0">jo &amp; jojo</a></li>
<li><a href="#orga498d3b">bind &amp; jotable_entry</a></li>
<li><a href="#org39c3d50">proto_jotable_entry</a></li>
<li><a href="#org8582a4">jotable_entry_[occured|entry_used|no_collision]</a></li>
<li><a href="#org9ae67a9">jotable</a></li>
<li><a href="#orgfb49214">string_to_sum</a></li>
<li><a href="#org6c630ff">jotable_keyeq</a></li>
<li><a href="#org2990a3e">jotable_hash</a></li>
<li><a href="#orgacb65d1">string_area</a></li>
<li><a href="#org2e424ea">copy_to_string_area</a></li>
<li><a href="#orgba3e5a4">jotable_insert</a></li>
<li><a href="#org4d916ea">jotable_search</a></li>
<li><a href="#orgc7c116f">jotable_entry_print</a></li>
<li><a href="#org896291b">jotable_report_orbit</a></li>
<li><a href="#org86e93a">jotable_report</a></li>
<li><a href="#orgccd0c47">jotable_print</a></li>
<li><a href="#org1f6e9c1">str2jo &amp; jo2str</a></li>
<li><a href="#orgc84d046">init_jotable</a></li>
<li><a href="#orgc61d6d">jojo_area</a></li>
<li><a href="#orgc5b7be9">here</a>
<ul>
<li><a href="#orgd15b64f">compiling_stack</a></li>
<li><a href="#org57a183a">init_compiling_stack</a></li>
<li><a href="#org8cb7390">here</a></li>
</ul>
</li>
<li><a href="#org355461">jotable_set_cell</a></li>
<li><a href="#orgc5408dd">jotable_set_primitive</a></li>
<li><a href="#orgbd95e8">jotable_get_cell</a></li>
<li><a href="#org272236f">jotable_get_primitive</a></li>
<li><a href="#org658a673">jotable_get_jojo</a></li>
<li><a href="#orgcb2e861"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#org78a9e9f">defprim</a>
<ul>
<li><a href="#org7c777fd">defprim_record</a></li>
<li><a href="#org304aac6">defprim_report</a></li>
<li><a href="#org461b89d">defprim</a></li>
</ul>
</li>
<li><a href="#orgd297415">as &amp; rs</a>
<ul>
<li><a href="#orgc9088fb">as</a></li>
<li><a href="#org93a045b">rs</a></li>
</ul>
</li>
<li><a href="#org9754dbe"><b>apply</b></a>
<ul>
<li><a href="#org8cebf4d"><span class="todo note">note</span> </a></li>
<li><a href="#orgf0531f1">apply</a></li>
<li><a href="#org5e8e533">p_apply</a></li>
<li><a href="#org954eb33">jo_apply</a></li>
<li><a href="#org60385fd">p_jo_apply</a></li>
<li><a href="#org76d474a">key_jo_apply</a></li>
<li><a href="#org82d9afb">p_key_jo_apply</a></li>
<li><a href="#org5e1e3c7">export_apply</a></li>
</ul>
</li>
<li><a href="#orgc2d8857">eval</a>
<ul>
<li><a href="#org94661fa">eval</a></li>
<li><a href="#orga7615aa">eval_jo</a></li>
<li><a href="#orgce0a3f5">eval_key</a></li>
<li><a href="#orgffaeae">eval_jojo</a></li>
</ul>
</li>
<li><a href="#org26efd64"><b>stack_operation</b></a>
<ul>
<li><a href="#orge8da8a6">cell_copy</a></li>
<li><a href="#orgdaad8a9">p_drop</a></li>
<li><a href="#orgbf1edbd">p_dup</a></li>
<li><a href="#org41681f1">p_over</a></li>
<li><a href="#org89c3e2a">p_tuck</a></li>
<li><a href="#org2e51234">p_swap</a></li>
<li><a href="#orgbce6ed2">p_xy_swap</a></li>
<li><a href="#org1a2cd9a">p_as_print</a></li>
<li><a href="#org55b3c01">p_stack_base</a></li>
<li><a href="#org3f7d374">p_stack_pointer</a></li>
<li><a href="#orga18ec2e">export_stack_operation</a></li>
</ul>
</li>
<li><a href="#org4a44f9c"><b>ending</b></a>
<ul>
<li><a href="#org5008ea2">p_end</a></li>
<li><a href="#org4fd399a">p_bye</a></li>
<li><a href="#org46a2cad">export_ending</a></li>
</ul>
</li>
<li><a href="#orgb77288c"><b>control</b></a>
<ul>
<li><a href="#orge6f463e">i_lit</a></li>
<li><a href="#orga5fbbeb">i_tail_call</a></li>
<li><a href="#orgae666f8">p_jump_if_false</a></li>
<li><a href="#orgea3c8fd">export_control</a></li>
</ul>
</li>
<li><a href="#org5271976"><b>bool</b></a>
<ul>
<li><a href="#org3b00b53">p_true</a></li>
<li><a href="#orgcf4a1d8">p_false</a></li>
<li><a href="#org37b2cb8">p_not</a></li>
<li><a href="#org1544243">p_and</a></li>
<li><a href="#org345a7c4">p_or</a></li>
<li><a href="#org34a1a48">export_bool</a></li>
</ul>
</li>
<li><a href="#org316e1a"><b>bit</b></a>
<ul>
<li><a href="#orge9b9f56">p_true_bit</a></li>
<li><a href="#orgb088f3d">p_false_bit</a></li>
<li><a href="#orgeaa63e8">p_bit_and</a></li>
<li><a href="#orgb7a6fce">p_bit_or</a></li>
<li><a href="#org918d453">p_bit_xor</a></li>
<li><a href="#org391e8d5">p_bit_not</a></li>
<li><a href="#orgd2d49e1">p_bit_shift_left</a></li>
<li><a href="#org71a9b65"><span class="todo note">note</span> shift_right &amp; arithmetic_shift_right</a></li>
<li><a href="#org9dbdd1a">export_bit</a></li>
</ul>
</li>
<li><a href="#org65a1a5d"><b>int</b></a>
<ul>
<li><a href="#orgd3822dc">p_add</a></li>
<li><a href="#org28f62ab">p_sub</a></li>
<li><a href="#org8bfe41c">p_mul</a></li>
<li><a href="#org57802c7">p_div</a></li>
<li><a href="#orge68a0d9">p_mod</a></li>
<li><a href="#orge5272e3">p_n_eq_p</a></li>
<li><a href="#org6297a71">p_eq_p</a></li>
<li><a href="#org590a67e">p_gt_p</a></li>
<li><a href="#org98173fe">p_lt_p</a></li>
<li><a href="#orgbcf63e4">p_gteq_p</a></li>
<li><a href="#org876ad6e">p_lteq_p</a></li>
<li><a href="#org55c9500">k_int</a></li>
<li><a href="#org5c48e8f">k_bin</a></li>
<li><a href="#orgb5bcd11">k_oct</a></li>
<li><a href="#org6316a0e">k_hex</a></li>
<li><a href="#org68ae65e"><span class="todo _gt__lt_">&gt;&lt;</span> p_[int|bin|oct|hex]_print</a></li>
<li><a href="#orgf61e524"><span class="todo _gt__lt_">&gt;&lt;</span> p_[int|bin|oct|hex]_dot</a></li>
<li><a href="#orgbfc6932">export_int</a></li>
</ul>
</li>
<li><a href="#orga56f3ee"><b>memory</b></a>
<ul>
<li><a href="#orgd539ddc">p_allocate</a></li>
<li><a href="#orgb21257c">p_free</a></li>
<li><a href="#orgb10cff8">k_var</a></li>
<li><a href="#org9b3279d">p_set</a></li>
<li><a href="#org7b8dc63">p_get</a></li>
<li><a href="#orgb88e290">p_set_byte</a></li>
<li><a href="#org3bd0a0e">p_get_byte</a></li>
<li><a href="#org4bfdfce">export_memory</a></li>
</ul>
</li>
<li><a href="#orga71c228"><b>byte</b></a>
<ul>
<li><a href="#orgdc5bb67">reading_stack</a></li>
<li><a href="#org3551ac6">real_reading_path</a></li>
<li><a href="#org9daba1">read_byte</a></li>
<li><a href="#orgdec5986">byte_unread</a></li>
<li><a href="#org3ac8482">p_read_byte</a></li>
<li><a href="#org1865b45">p_byte_unread</a></li>
<li><a href="#orge146aea">p_byte_print</a></li>
<li><a href="#orgba8f75c">export_byte</a></li>
</ul>
</li>
<li><a href="#org8544254"><b>jo</b></a>
<ul>
<li><a href="#orge256e14">loading_stack</a></li>
<li><a href="#orgd7601d8">alias_add</a></li>
<li><a href="#org5d344e0">alias_find</a></li>
<li><a href="#org29d2597">read_jo_without_prefix</a></li>
<li><a href="#org212b54b">read_jo</a></li>
<li><a href="#org2fca5e7">p_read_jo_without_prefix</a></li>
<li><a href="#orgd15caab">p_read_jo</a></li>
<li><a href="#orgf67356f">cat_2_jo</a></li>
<li><a href="#org7e6b6f4">cat_3_jo</a></li>
<li><a href="#org8354833">p_jo_used_p</a></li>
<li><a href="#org9a862d3">p_jo_to_string</a></li>
<li><a href="#org7d65998">p_string_length_to_jo</a></li>
<li><a href="#orgbd05bde">p_string_to_jo</a></li>
<li><a href="#org897ba3d">p_null</a></li>
<li><a href="#orgb4bf930">k_jo</a></li>
<li><a href="#orgf9124dc">p_jo_print</a></li>
<li><a href="#orgdc02790">p_jo_dot</a></li>
<li><a href="#org585ff0f">export_jo</a></li>
</ul>
</li>
<li><a href="#orgd8f995e"><b>string</b></a>
<ul>
<li><a href="#org5c3705f">k_string_one</a></li>
<li><a href="#org9ca13e2">k_string</a></li>
<li><a href="#org2dad482">p_string_length</a></li>
<li><a href="#orgd223547">p_string_print</a></li>
<li><a href="#orga758c5a">p_string_dot</a></li>
<li><a href="#org8248c57">p_string_append_to_buffer</a></li>
<li><a href="#orge419dab">export_string</a></li>
</ul>
</li>
<li><a href="#org754533e"><b>file</b></a>
<ul>
<li><a href="#org5fd0a13">file_readable_p</a></li>
<li><a href="#org9291390">dir_ok_p</a></li>
<li><a href="#org441d9bf">p_file_readable_p</a></li>
<li><a href="#orge9fb83c">p_dir_ok_p</a></li>
<li><a href="#orgadbf745">file_size</a></li>
<li><a href="#org950e1c">p_file_size</a></li>
<li><a href="#org643e3fc">p_file_copy_to_buffer</a></li>
<li><a href="#org12bcc0">export_file</a></li>
</ul>
</li>
<li><a href="#org12231fd"><b>system</b></a>
<ul>
<li><a href="#orgc2c2c06">p_current_dir</a></li>
<li><a href="#org96b8aa8">p_command_run</a></li>
<li><a href="#org883fce0">p_n_command_run</a></li>
<li><a href="#orgd7ef820">p_argument_counter</a></li>
<li><a href="#orgd4d5f56">p_index_to_argument_string</a></li>
<li><a href="#org2646ce8">p_var_string_to_env_string</a></li>
<li><a href="#org18e1b9f">export_system</a></li>
</ul>
</li>
<li><a href="#orgf7cbdb0"><b>module</b></a>
<ul>
<li><a href="#org3972d82">module_record</a></li>
<li><a href="#orgaf2a2af">module_stack</a></li>
<li><a href="#orgc378c18">load_file</a></li>
<li><a href="#org2e4dc0b">p_load_file</a></li>
<li><a href="#orgc40a22d">k_include_one</a></li>
<li><a href="#orgf18c634">k_include</a></li>
<li><a href="#org2653653">find_module_file_jo</a></li>
<li><a href="#orgd6e493d">find_module_dir_jo</a></li>
<li><a href="#org91a34df">p_find_module_file_jo</a></li>
<li><a href="#org7198d9a">p_find_module_dir_jo</a></li>
<li><a href="#orga9cce0c">import_module</a></li>
<li><a href="#org603b149">k_dep_load</a></li>
<li><a href="#org195cace">k_dep</a></li>
<li><a href="#orgd87b063">k_module</a></li>
<li><a href="#org5a2628a">module_report_one</a></li>
<li><a href="#orgf902cdc">module_report</a></li>
<li><a href="#org3827820">export_module</a></li>
</ul>
</li>
<li><a href="#org670330b"><b>ffi</b></a>
<ul>
<li><a href="#org51972b3">ccall</a></li>
<li><a href="#org856367c">get_clib</a></li>
<li><a href="#orgef6e59b">k_clib_one</a></li>
<li><a href="#orgded6f28">k_clib</a></li>
<li><a href="#org3b6e2d0">export_ffi</a></li>
</ul>
</li>
<li><a href="#org5f21b0b"><b>top_level</b></a>
<ul>
<li><a href="#orgd93d0fd">prim_jo_p &amp; fun_jo_p &amp; var_jo_p &amp; used_jo_p</a></li>
<li><a href="#orgb047a0e">jo_to_jo_in_module</a></li>
<li><a href="#orgcbb6eb4">read_jo_in_module</a></li>
<li><a href="#orgc808dab">k_defun</a>
<ul>
<li><a href="#org5db6ef9">defun_record</a></li>
<li><a href="#org12a5b60">p_defun_record</a></li>
<li><a href="#org13e7cbb">defun_report</a></li>
<li><a href="#orge8fcbbc">defun_stack</a></li>
<li><a href="#org94c90f4">k_defun</a></li>
</ul>
</li>
<li><a href="#orgf72b32e">k_declare</a>
<ul>
<li><a href="#org9eb35f"><span class="todo note">note</span> </a></li>
<li><a href="#orgd624f9e">k_declare_one</a></li>
<li><a href="#orge364f36">k_declare</a></li>
</ul>
</li>
<li><a href="#org4b455fb">k_run</a></li>
<li><a href="#org9eaf00c"><span class="done test">test</span> ing_flag</a></li>
<li><a href="#org8d3e5f6">about test</a></li>
<li><a href="#org930c3fc">k_defvar</a>
<ul>
<li><a href="#org2bb723d">defvar_record</a></li>
<li><a href="#org4002952">p_defvar_record</a></li>
<li><a href="#org17ad8d6">defvar_report</a></li>
<li><a href="#org61f5542">k_defvar</a></li>
</ul>
</li>
<li><a href="#org424b893">p_top_repl</a></li>
<li><a href="#org28bdb5d">p_top_repl_printing_flag</a></li>
<li><a href="#org56d275c">export_top_level</a></li>
</ul>
</li>
<li><a href="#org4ad27a7"><b>keyword</b></a>
<ul>
<li><a href="#orgde14bec">k_ignore</a></li>
<li><a href="#orgc06699b">compile_jojo_until_meet_jo</a></li>
<li><a href="#org3200289">k_compile_jojo_until_meet_jo</a></li>
<li><a href="#org560a4a8">k_compile_jojo</a></li>
<li><a href="#orgb542620">k_if</a></li>
<li><a href="#org9f8f91d">k_tail_call</a></li>
<li><a href="#org7fcdf0d">k_loop</a></li>
<li><a href="#org1fa1102">k_recur</a></li>
<li><a href="#orge48591d">p_compiling_stack_tos</a></li>
<li><a href="#org5de536e">i_jojo</a></li>
<li><a href="#org293ab9">k_jojo</a></li>
<li><a href="#org9d04f20">export_keyword</a></li>
</ul>
</li>
<li><a href="#orgb81b831"><b>misc</b></a>
<ul>
<li><a href="#org12a1b06">do_nothing</a></li>
<li><a href="#org86347af">p_here</a></li>
<li><a href="#org48ed927">bar-ket</a></li>
<li><a href="#orgcac688e">p_cell_size</a></li>
<li><a href="#orgd3d9f4b">p_newline</a></li>
<li><a href="#org8f0efae">export_mise</a></li>
</ul>
</li>
<li><a href="#org3fba6c6"><b>play</b></a>
<ul>
<li><a href="#orgcbe108a">p1</a></li>
<li><a href="#org58a5c14">p2</a></li>
<li><a href="#orgd5fc4a5">p3</a></li>
<li><a href="#orgcb1716c">export_play</a></li>
</ul>
</li>
<li><a href="#org6676b42">main</a>
<ul>
<li><a href="#org2c45ab1">init_top_repl</a></li>
<li><a href="#org136fb6d">main</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org9bfaf5b" class="outline-2">
<h2 id="org9bfaf5b"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-org9bfaf5b">
<ul class="org-ul">
<li><p>[tool] what kinds of tools are needed ?</p></li>
<li><p>[test] assert</p></li>
<li><p>[module.jo] make good use of the separated module.jo</p><p><ul class="org-ul"></p><p><li><p>functions to get metadate in module.jo</p></li></ul></p></li>
<li><p>(loop) and (recur) in jojo</p></li>
<li><p>fix semantic of case no "in between"</p></li>
<li><p>[safe] error report for every limited number</p><p>jo-max-length</p></li>
<li><p>[safe] to handle all the error</p></li>
<li><p>[debug] print jojo body</p></li>
<li><p>[debug] print return-stack</p></li>
<li><p>[debug] debug repl</p></li>
<li><p>[debug] trace</p></li>
<li><p>[debug] step</p></li>
<li><p>[doc] [maybe] by teaching</p></li>
<li><p>[maybe] package manager</p></li>
<li><p>better jotable for being compiler target</p></li></ul>
</div>
</div>

<div id="outline-container-orgf28a492" class="outline-2">
<h2 id="orgf28a492"><span class="todo note">note</span> </h2>
<div class="outline-text-2" id="text-orgf28a492">
</div><div id="outline-container-orgebbe71e" class="outline-3">
<h3 id="orgebbe71e">about</h3>
<div class="outline-text-3" id="text-orgebbe71e">
<ul class="org-ul">
<li><p>the implementation of the interpreter of jojo (<a href="https://github.com/xieyuheng/jojo">source</a>)</p></li></ul>
</div>
</div>

<div id="outline-container-org4c21c83" class="outline-3">
<h3 id="org4c21c83">naming convention</h3>
<div class="outline-text-3" id="text-org4c21c83">
<ul class="org-ul">
<li><p>"-" phrase</p><p>verb/type (&#x2026; -&gt; type) (&#x2026; -&gt; [type])</p><p>type/verb (type -&gt; &#x2026;) ([type] -&gt; &#x2026;)</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-org3bc7c5e" class="outline-2">
<h2 id="org3bc7c5e">helper</h2>
<div class="outline-text-2" id="text-org3bc7c5e">
</div><div id="outline-container-org5e97691" class="outline-3">
<h3 id="org5e97691">header</h3>
<div class="outline-text-3" id="text-org5e97691">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;sys/stat.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;sys/types.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdio.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;ctype.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdlib.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;stdint.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;setjmp.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;string.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;dlfcn.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;unistd.h&gt;</span>
<span style="color: #a6e22e;">#include</span> <span style="color: #e6db74;">&lt;dirent.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7d3c12" class="outline-3">
<h3 id="orge7d3c12">bool</h3>
<div class="outline-text-3" id="text-orge7d3c12">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">enum</span> { <span style="color: #ae81ff;">false</span>, <span style="color: #ae81ff;">true</span> } <span style="color: #66d9ef; font-weight: bold;">bool</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org172c32b" class="outline-3">
<h3 id="org172c32b">cell</h3>
<div class="outline-text-3" id="text-org172c32b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">intptr_t</span> <span style="color: #66d9ef; font-weight: bold;">cell</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell_size</span> = <span style="color: #f92672; font-weight: bold;">sizeof</span>(cell);
</pre>
</div>
</div>
</div>

<div id="outline-container-org3073ab" class="outline-3">
<h3 id="org3073ab">int</h3>
<div class="outline-text-3" id="text-org3073ab">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">max</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &lt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">min</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (a &gt; b) {
    <span style="color: #f92672; font-weight: bold;">return</span> b;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> a;
  }
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">power</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">result</span> = 1;
  <span style="color: #f92672; font-weight: bold;">while</span> (n &gt;= 1) {
    result = result * a;
    n--;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd035e4" class="outline-3">
<h3 id="orgbd035e4">byte</h3>
<div class="outline-text-3" id="text-orgbd035e4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">unsigned</span> <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #66d9ef; font-weight: bold;">byte</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org8356735" class="outline-3">
<h3 id="org8356735">char</h3>
<div class="outline-text-3" id="text-org8356735">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">isbarcket</span>(<span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (c == <span style="color: #e6db74;">'('</span> ||
          c == <span style="color: #e6db74;">')'</span> ||
          c == <span style="color: #e6db74;">'['</span> ||
          c == <span style="color: #e6db74;">']'</span> ||
          c == <span style="color: #e6db74;">'{'</span> ||
          c == <span style="color: #e6db74;">'}'</span> ||
          c == <span style="color: #e6db74;">'"'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf82629" class="outline-3">
<h3 id="orgcf82629">char_to_nat</h3>
<div class="outline-text-3" id="text-orgcf82629">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">char_to_nat</span>(<span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (c &gt;= <span style="color: #e6db74;">'0'</span> &amp;&amp; c &lt;= <span style="color: #e6db74;">'9'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> (c - <span style="color: #e6db74;">'0'</span>);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (c &gt;= <span style="color: #e6db74;">'A'</span> &amp;&amp; c &lt;= <span style="color: #e6db74;">'Z'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> (c - <span style="color: #e6db74;">'A'</span>) + 10;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (c &gt;= <span style="color: #e6db74;">'a'</span> &amp;&amp; c &lt;= <span style="color: #e6db74;">'z'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> (c - <span style="color: #e6db74;">'a'</span>) + 10;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> 0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5be0346" class="outline-3">
<h3 id="org5be0346">string</h3>
<div class="outline-text-3" id="text-org5be0346">
</div><div id="outline-container-orge21798e" class="outline-4">
<h4 id="orge21798e">string</h4>
<div class="outline-text-4" id="text-orge21798e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #66d9ef; font-weight: bold;">string</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6068da4" class="outline-4">
<h4 id="org6068da4">string_equal</h4>
<div class="outline-text-4" id="text-org6068da4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">string_equal</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">s2</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (strcmp(s1, s2) == 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga0d3e71" class="outline-4">
<h4 id="orga0d3e71">nat_string_p</h4>
<div class="outline-text-4" id="text-orga0d3e71">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">nat_string_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (str[i] != 0) {
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>isdigit(str[i])) {
      <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
      }
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1069630" class="outline-4">
<h4 id="org1069630">int_string_p</h4>
<div class="outline-text-4" id="text-org1069630">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">int_string_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (str[0] == <span style="color: #e6db74;">'-'</span> ||
      str[0] == <span style="color: #e6db74;">'+'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str + 1);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(str);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org669273b" class="outline-4">
<h4 id="org669273b">string_to_based_[nat|int]</h4>
<div class="outline-text-4" id="text-org669273b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_based_nat</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">base</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">result</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">len</span> = strlen(str);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; len) {
    result = result + (char_to_nat(str[i]) * power(base, (len - i - 1)));
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> result;
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_based_int</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">base</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (str[0] == <span style="color: #e6db74;">'-'</span>) {
    <span style="color: #f92672; font-weight: bold;">return</span> - string_to_based_nat(str, base);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_nat(str, base);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org46b640a" class="outline-4">
<h4 id="org46b640a">string_to_[dec|bin|oct|hex]</h4>
<div class="outline-text-4" id="text-org46b640a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_dec</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) { <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_int(str, 10); }
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_bin</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) { <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_int(str,  2); }
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_oct</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) { <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_int(str,  8); }
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_hex</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) { <span style="color: #f92672; font-weight: bold;">return</span> string_to_based_int(str, 16); }
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb22d30" class="outline-2">
<h2 id="orgfb22d30">jotable</h2>
<div class="outline-text-2" id="text-orgfb22d30">
</div><div id="outline-container-orgae12d2f" class="outline-3">
<h3 id="orgae12d2f">primitive</h3>
<div class="outline-text-3" id="text-orgae12d2f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">void</span> (*<span style="color: #66d9ef; font-weight: bold;">primitive</span>)();
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab864f0" class="outline-3">
<h3 id="orgab864f0">jo &amp; jojo</h3>
<div class="outline-text-3" id="text-orgab864f0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #66d9ef; font-weight: bold;">jo</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">size</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> *<span style="color: #fd971f;">array</span>;
} <span style="color: #66d9ef; font-weight: bold;">jojo</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga498d3b" class="outline-3">
<h3 id="orga498d3b">bind &amp; jotable_entry</h3>
<div class="outline-text-3" id="text-orga498d3b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">union</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span>;
  <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>;
  <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span>;
} <span style="color: #66d9ef; font-weight: bold;">bind</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">type</span>;
  <span style="color: #66d9ef; font-weight: bold;">bind</span> <span style="color: #fd971f;">value</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbit_length</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbiton</span>;
} <span style="color: #66d9ef; font-weight: bold;">jotable_entry</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org39c3d50" class="outline-3">
<h3 id="org39c3d50">proto_jotable_entry</h3>
<div class="outline-text-3" id="text-org39c3d50">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">str2jo</span> (<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>);

<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #a6e22e;">proto_jotable_entry</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span> = {
    .index = index,
    .key = 0,
    .type = str2jo(<span style="color: #e6db74;">"none"</span>),
    .value.cell = 0,
    .orbit_length = 0,
    .orbiton = 0
  };
  <span style="color: #f92672; font-weight: bold;">return</span> e;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8582a4" class="outline-3">
<h3 id="org8582a4">jotable_entry_[occured|entry_used|no_collision]</h3>
<div class="outline-text-3" id="text-org8582a4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_entry_occured</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.key != 0;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_entry_used</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.type != str2jo(<span style="color: #e6db74;">"none"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_entry_no_collision</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">e</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> e.index == e.orbiton;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ae67a9" class="outline-3">
<h3 id="org9ae67a9">jotable</h3>
<div class="outline-text-3" id="text-org9ae67a9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">prime table size</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000003   about 976 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000033</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">1000333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100003    about 97 k</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">100333</span>
<span style="color: #FF8888;">//   </span><span style="color: #FF8888;">997</span>
<span style="color: #a6e22e;">#define</span> <span style="color: #fd971f;">jotable_size</span> 100003
<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">jotable</span>[jotable_size];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jotable_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb49214" class="outline-3">
<h3 id="orgfb49214">string_to_sum</h3>
<div class="outline-text-3" id="text-orgfb49214">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_sum</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">sum</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">max_step</span> = 10;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; strlen(str)) {
    sum = sum + ((<span style="color: #66d9ef; font-weight: bold;">byte</span>) str[i]) * (2 &lt;&lt; min(i, max_step));
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> sum;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c630ff" class="outline-3">
<h3 id="org6c630ff">jotable_keyeq</h3>
<div class="outline-text-3" id="text-org6c630ff">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">jotable_keyeq</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k1</span>, <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">k2</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> string_equal(k1, k2);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2990a3e" class="outline-3">
<h3 id="org2990a3e">jotable_hash</h3>
<div class="outline-text-3" id="text-org2990a3e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_hash</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> (counter + string_to_sum(key)) % jotable_size;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgacb65d1" class="outline-3">
<h3 id="orgacb65d1">string_area</h3>
<div class="outline-text-3" id="text-orgacb65d1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">string_area</span>[4 * 1024 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">string_area_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e424ea" class="outline-3">
<h3 id="org2e424ea">copy_to_string_area</h3>
<div class="outline-text-3" id="text-org2e424ea">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">copy_to_string_area</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> *<span style="color: #fd971f;">str1</span>;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  str1 = (string_area + string_area_counter);
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #f92672; font-weight: bold;">if</span> (str[i] == 0) {
      str1[i] = str[i];
      i++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      str1[i] = str[i];
      i++;
    }
  }
  string_area_counter = i + string_area_counter;
  <span style="color: #f92672; font-weight: bold;">return</span> str1;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba3e5a4" class="outline-3">
<h3 id="orgba3e5a4">jotable_insert</h3>
<div class="outline-text-3" id="text-orgba3e5a4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes the hash_table is filled</span>
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_insert</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">orbit_index</span> = jotable_hash(key, 0);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = jotable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_occured(jotable[index])) {
      key = copy_to_string_area(key);
      jotable[index].key = key;
      jotable[index].orbiton = orbit_index;
      jotable[orbit_index].orbit_length = 1 + counter;
      jotable_counter = 1 + jotable_counter;
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable_keyeq(key, jotable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == jotable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d916ea" class="outline-3">
<h3 id="org4d916ea">jotable_search</h3>
<div class="outline-text-3" id="text-org4d916ea">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #FF8888;">// </span><span style="color: #FF8888;">-1 denotes key not occured</span>
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_search</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = jotable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_occured(jotable[index])) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable_keyeq(key, jotable[index].key)) {
      <span style="color: #f92672; font-weight: bold;">return</span> index;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (counter == jotable_size) {
      <span style="color: #f92672; font-weight: bold;">return</span> -1;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      counter = 1 + counter;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7c116f" class="outline-3">
<h3 id="orgc7c116f">jotable_entry_print</h3>
<div class="outline-text-3" id="text-orgc7c116f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">jo2str</span> (<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>);

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_entry_print</span>(<span style="color: #66d9ef; font-weight: bold;">jotable_entry</span> <span style="color: #fd971f;">entry</span>) {
  printf(<span style="color: #e6db74;">"%s : "</span>, jo2str(entry.type));
  <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == str2jo(<span style="color: #e6db74;">"variable"</span>)) {
    printf(<span style="color: #e6db74;">"%ld"</span>, entry.value.cell);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == str2jo(<span style="color: #e6db74;">"primitive"</span>)) {
    printf(<span style="color: #e6db74;">"%ld"</span>, entry.value.primitive);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (entry.type == str2jo(<span style="color: #e6db74;">"function"</span>)) {
    printf(<span style="color: #e6db74;">"%ld "</span>, entry.value.jojo.size);
    printf(<span style="color: #e6db74;">"[ "</span>);
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span>;
    <span style="color: #f92672; font-weight: bold;">for</span> (i=0; i &lt; entry.value.jojo.size; i=i+1) {
      printf(<span style="color: #e6db74;">"%ld "</span>, entry.value.jojo.array[i]);
    }
    printf(<span style="color: #e6db74;">"]"</span>);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org896291b" class="outline-3">
<h3 id="org896291b">jotable_report_orbit</h3>
<div class="outline-text-3" id="text-org896291b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_report_orbit</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">counter</span>) {
  <span style="color: #f92672; font-weight: bold;">while</span> (counter &lt; jotable[index].orbit_length) {
    <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">key</span> = jotable[index].key;
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">next_index</span> = jotable_hash(key, counter);
    <span style="color: #f92672; font-weight: bold;">if</span> (index == jotable[next_index].orbiton) {
      printf(<span style="color: #e6db74;">"  | %ld %s\n"</span>, next_index, jotable[next_index].key);
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[next_index])) {
      printf(<span style="color: #e6db74;">"    = "</span>);
      jotable_entry_print(jotable[next_index]);
      printf(<span style="color: #e6db74;">"\n"</span>);
    }
    counter = 1 + counter;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org86e93a" class="outline-3">
<h3 id="org86e93a">jotable_report</h3>
<div class="outline-text-3" id="text-org86e93a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_report</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- jotable_report\n"</span>);
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; jotable_size) {
    <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_occured(jotable[index]) &amp;&amp;
        jotable_entry_no_collision(jotable[index])) {
      printf(<span style="color: #e6db74;">"  - %ld %s // %ld\n"</span>,
             index, jotable[index].key, jotable[index].orbit_length);
      <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[index])) {
        printf(<span style="color: #e6db74;">"    = "</span>);
        jotable_entry_print(jotable[index]);
        printf(<span style="color: #e6db74;">"\n"</span>);
      }
      jotable_report_orbit(index, 1);
    }
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"  : &lt;index&gt; &lt;key&gt; // &lt;orbit-length&gt;\n"</span>);
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %ld\n"</span>, jotable_counter);
  printf(<span style="color: #e6db74;">"- free : %ld\n"</span>, jotable_size - jotable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgccd0c47" class="outline-3">
<h3 id="orgccd0c47">jotable_print</h3>
<div class="outline-text-3" id="text-orgccd0c47">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_print</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- jotable_print\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (index &lt; jotable_size) {
    printf(<span style="color: #e6db74;">"  - %ld %s %ld // %ld\n"</span>,
           index,
           jotable[index].key,
           jotable[index].value,
           jotable[index].orbit_length);
    index = 1 + index;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
  printf(<span style="color: #e6db74;">"- used : %ld\n"</span>, jotable_counter);
  printf(<span style="color: #e6db74;">"- free : %ld\n"</span>, jotable_size - jotable_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f6e9c1" class="outline-3">
<h3 id="org1f6e9c1">str2jo &amp; jo2str</h3>
<div class="outline-text-3" id="text-org1f6e9c1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">str2jo</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable_insert(str);
}

<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #a6e22e;">jo2str</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].key;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc84d046" class="outline-3">
<h3 id="orgc84d046">init_jotable</h3>
<div class="outline-text-3" id="text-orgc84d046">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_jotable</span>() {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; jotable_size) {
    jotable[i] = proto_jotable_entry(i);
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc61d6d" class="outline-3">
<h3 id="orgc61d6d">jojo_area</h3>
<div class="outline-text-3" id="text-orgc61d6d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jojo_area</span>[1024 * 1024];
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5b7be9" class="outline-3">
<h3 id="orgc5b7be9">here</h3>
<div class="outline-text-3" id="text-orgc5b7be9">
</div><div id="outline-container-orgd15b64f" class="outline-4">
<h4 id="orgd15b64f">compiling_stack</h4>
<div class="outline-text-4" id="text-orgd15b64f">
<ul class="org-ul">
<li><p>to redirect compiling location for "run"</p><p>"run" compiles function to a temporary place and run it</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #66d9ef; font-weight: bold;">compiling_stack_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">compiling_stack_t</span> <span style="color: #fd971f;">compiling_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">compiling_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">compiling_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compiling_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">value</span>) {
  compiling_stack[compiling_stack_pointer] = value;
  compiling_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">compiling_stack_pop</span>() {
  compiling_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack[compiling_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compiling_stack_inc</span>() {
  compiling_stack[compiling_stack_pointer - 1] =
    compiling_stack[compiling_stack_pointer - 1] + 1;
}


<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">compiling_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack[compiling_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">compiling_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> compiling_stack_pointer == compiling_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org57a183a" class="outline-4">
<h4 id="org57a183a">init_compiling_stack</h4>
<div class="outline-text-4" id="text-org57a183a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_compiling_stack</span>() {
  compiling_stack_push(jojo_area);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8cb7390" class="outline-4">
<h4 id="org8cb7390">here</h4>
<div class="outline-text-4" id="text-org8cb7390">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">here</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">pointer</span> = compiling_stack_pop();
  pointer[0] = n;
  compiling_stack_push(pointer + 1);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org355461" class="outline-3">
<h3 id="org355461">jotable_set_cell</h3>
<div class="outline-text-3" id="text-org355461">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_set_cell</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span>) {
  jotable[index].type = str2jo(<span style="color: #e6db74;">"variable"</span>);
  jotable[index].value.cell = cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5408dd" class="outline-3">
<h3 id="orgc5408dd">jotable_set_primitive</h3>
<div class="outline-text-3" id="text-orgc5408dd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_set_primitive</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span>) {
  jotable[index].type = str2jo(<span style="color: #e6db74;">"primitive"</span>);
  jotable[index].value.primitive = primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd95e8" class="outline-3">
<h3 id="orgbd95e8">jotable_get_cell</h3>
<div class="outline-text-3" id="text-orgbd95e8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">jotable_get_cell</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].value.cell;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org272236f" class="outline-3">
<h3 id="org272236f">jotable_get_primitive</h3>
<div class="outline-text-3" id="text-org272236f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #a6e22e;">jotable_get_primitive</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].value.primitive;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org658a673" class="outline-3">
<h3 id="org658a673">jotable_get_jojo</h3>
<div class="outline-text-3" id="text-org658a673">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #a6e22e;">jotable_get_jojo</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].value.jojo;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcb2e861" class="outline-3">
<h3 id="orgcb2e861"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-orgcb2e861">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jotable_test</span>() {
  str2jo(<span style="color: #e6db74;">"testkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testtestkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testtestkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testtesttestkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttestkey4"</span>);

  str2jo(<span style="color: #e6db74;">"testtesttesttestkey0"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey1"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey2"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey3"</span>);
  str2jo(<span style="color: #e6db74;">"testtesttesttestkey4"</span>);

  jotable_set_cell(str2jo(<span style="color: #e6db74;">"k1"</span>), 1);
  jotable_report();

  jotable_set_cell(str2jo(<span style="color: #e6db74;">"k1"</span>), 0);
  jotable_report();

  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">jotable_print();</span>
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org78a9e9f" class="outline-2">
<h2 id="org78a9e9f">defprim</h2>
<div class="outline-text-2" id="text-org78a9e9f">
</div><div id="outline-container-org7c777fd" class="outline-3">
<h3 id="org7c777fd">defprim_record</h3>
<div class="outline-text-3" id="text-org7c777fd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">defprim_record</span>[64 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defprim_record_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org304aac6" class="outline-3">
<h3 id="org304aac6">defprim_report</h3>
<div class="outline-text-3" id="text-org304aac6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defprim_report</span>() {
  printf(<span style="color: #e6db74;">"- defprim_report // counter : %ld\n"</span>, defprim_record_counter);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; defprim_record_counter) {
    printf(<span style="color: #e6db74;">"  %s\n"</span>, jo2str(defprim_record[i]));
    i++;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org461b89d" class="outline-3">
<h3 id="org461b89d">defprim</h3>
<div class="outline-text-3" id="text-org461b89d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_ignore</span>();
<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">used_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>);
<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">jo_to_jo_in_module</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">alias_jo</span>);

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defprim</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">fun</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = jo_to_jo_in_module(str2jo(str));
  <span style="color: #f92672; font-weight: bold;">if</span> (used_jo_p(index)) {
    printf(<span style="color: #e6db74;">"- defprim can not re-define : %s\n"</span>, jo2str(index));
    printf(<span style="color: #e6db74;">"  it already defined as : %s\n"</span>, jo2str(jotable[index].type));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  defprim_record[defprim_record_counter] = index;
  defprim_record_counter++;
  defprim_record[defprim_record_counter] = 0;
  jotable_set_primitive(index, fun);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd297415" class="outline-2">
<h2 id="orgd297415">as &amp; rs</h2>
<div class="outline-text-2" id="text-orgd297415">
</div><div id="outline-container-orgc9088fb" class="outline-3">
<h3 id="orgc9088fb">as</h3>
<div class="outline-text-3" id="text-orgc9088fb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #66d9ef; font-weight: bold;">argument_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">argument_stack</span> <span style="color: #fd971f;">as</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">as_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">as_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">as_push</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">value</span>) {
  as[as_pointer] = value;
  as_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">as_pop</span>() {
  as_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> as[as_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">as_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> as[as_pointer - 1];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org93a045b" class="outline-3">
<h3 id="org93a045b">rs</h3>
<div class="outline-text-3" id="text-org93a045b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #66d9ef; font-weight: bold;">return_stack</span>[1024 * 4];

<span style="color: #66d9ef; font-weight: bold;">return_stack</span> <span style="color: #fd971f;">rs</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_base</span> = 64;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_pointer</span> = 64;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">rs_push</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">value</span>) {
  rs[rs_pointer] = value;
  rs_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">rs_pop</span>() {
  rs_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> rs[rs_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">rs_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> rs[rs_pointer - 1];
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9754dbe" class="outline-2">
<h2 id="org9754dbe"><b>apply</b></h2>
<div class="outline-text-2" id="text-org9754dbe">
</div><div id="outline-container-org8cebf4d" class="outline-3">
<h3 id="org8cebf4d"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org8cebf4d">
<ul class="org-ul">
<li><p>be careful when calling apply function in primitive</p><p>because after rs_push a jojo</p><p>one need to exit current primitive to run the jojo</p></li></ul>
</div>
</div>

<div id="outline-container-orgf0531f1" class="outline-3">
<h3 id="orgf0531f1">apply</h3>
<div class="outline-text-3" id="text-orgf0531f1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">apply</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">jojo_array</span>) {
  rs_push(jojo_array);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e8e533" class="outline-3">
<h3 id="org5e8e533">p_apply</h3>
<div class="outline-text-3" id="text-org5e8e533">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_apply</span>() {
  apply(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org954eb33" class="outline-3">
<h3 id="org954eb33">jo_apply</h3>
<div class="outline-text-3" id="text-org954eb33">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">jo_apply</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_used(jotable[jo])) {
    printf(<span style="color: #e6db74;">"undefined jo : %s\n"</span>, jo2str(jo));
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo_type</span> = jotable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = jotable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"function"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = jotable_get_jojo(jo);
    rs_push(jojo.array);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"variable"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span> = jotable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org60385fd" class="outline-3">
<h3 id="org60385fd">p_jo_apply</h3>
<div class="outline-text-3" id="text-org60385fd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_apply</span>() {
  jo_apply(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org76d474a" class="outline-3">
<h3 id="org76d474a">key_jo_apply</h3>
<div class="outline-text-3" id="text-org76d474a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">key_jo_apply</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[jo])) {
    jo_apply(jo);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    printf(<span style="color: #e6db74;">"- key_jo_apply undefined key : %s\n"</span>, jo2str(jo));
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org82d9afb" class="outline-3">
<h3 id="org82d9afb">p_key_jo_apply</h3>
<div class="outline-text-3" id="text-org82d9afb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_key_jo_apply</span>() {
  key_jo_apply(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e1e3c7" class="outline-3">
<h3 id="org5e1e3c7">export_apply</h3>
<div class="outline-text-3" id="text-org5e1e3c7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_apply</span>() {
  defprim(<span style="color: #e6db74;">"apply"</span>, p_apply);
  defprim(<span style="color: #e6db74;">"jo/apply"</span>, p_jo_apply);
  defprim(<span style="color: #e6db74;">"key-jo/apply"</span>, p_key_jo_apply);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc2d8857" class="outline-2">
<h2 id="orgc2d8857">eval</h2>
<div class="outline-text-2" id="text-orgc2d8857">
</div><div id="outline-container-org94661fa" class="outline-3">
<h3 id="org94661fa">eval</h3>
<div class="outline-text-3" id="text-org94661fa">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jmp_buf</span> <span style="color: #fd971f;">eval_jmp_buffer</span>;

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">exit_eval</span>() {
  longjmp(eval_jmp_buffer, 666);
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (666 == setjmp(eval_jmp_buffer)) {
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">rs_base</span> = rs_pointer;
    <span style="color: #f92672; font-weight: bold;">while</span> (rs_pointer &gt;= rs_base) {
      <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
      rs_push(function_body + 1);
      <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
      jo_apply(jo);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7615aa" class="outline-3">
<h3 id="orga7615aa">eval_jo</h3>
<div class="outline-text-3" id="text-orga7615aa">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo_type</span> = jotable[jo].type;
  <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"primitive"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">primitive</span> = jotable_get_primitive(jo);
    primitive();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"function"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">jojo</span> <span style="color: #fd971f;">jojo</span> = jotable_get_jojo(jo);
    rs_push(jojo.array);
    eval();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jo_type == str2jo(<span style="color: #e6db74;">"variable"</span>)) {
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cell</span> = jotable_get_cell(jo);
    as_push(cell);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgce0a3f5" class="outline-3">
<h3 id="orgce0a3f5">eval_key</h3>
<div class="outline-text-3" id="text-orgce0a3f5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_ignore</span>();

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_key</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>jotable_entry_used(jotable[jo])) {
    printf(<span style="color: #e6db74;">"undefined keyword : %s\n"</span>, jo2str(jo));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  eval_jo(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffaeae" class="outline-3">
<h3 id="orgffaeae">eval_jojo</h3>
<div class="outline-text-3" id="text-orgffaeae">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">eval_jojo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">array</span>) {
  rs_push(array);
  eval();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org26efd64" class="outline-2">
<h2 id="org26efd64"><b>stack_operation</b></h2>
<div class="outline-text-2" id="text-org26efd64">
</div><div id="outline-container-orge8da8a6" class="outline-3">
<h3 id="orge8da8a6">cell_copy</h3>
<div class="outline-text-3" id="text-orge8da8a6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">cell_copy</span>(<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">length</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">from</span>, <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">to</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; length) {
    to[i] = from[i];
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdaad8a9" class="outline-3">
<h3 id="orgdaad8a9">p_drop</h3>
<div class="outline-text-3" id="text-orgdaad8a9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_drop</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a -&gt;)</span>
  as_pop();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf1edbd" class="outline-3">
<h3 id="orgbf1edbd">p_dup</h3>
<div class="outline-text-3" id="text-orgbf1edbd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dup</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a a -&gt; a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org41681f1" class="outline-3">
<h3 id="org41681f1">p_over</h3>
<div class="outline-text-3" id="text-org41681f1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_over</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; a b a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a);
  as_push(b);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org89c3e2a" class="outline-3">
<h3 id="org89c3e2a">p_tuck</h3>
<div class="outline-text-3" id="text-org89c3e2a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_tuck</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; b a b)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(b);
  as_push(a);
  as_push(b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e51234" class="outline-3">
<h3 id="org2e51234">p_swap</h3>
<div class="outline-text-3" id="text-org2e51234">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_swap</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a b -&gt; b a)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(b);
  as_push(a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbce6ed2" class="outline-3">
<h3 id="orgbce6ed2">p_xy_swap</h3>
<div class="outline-text-3" id="text-orgbce6ed2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_xy_swap</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(xxx yyy x y -&gt; yyy xxx)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">y</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">x</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">yp</span> = calloc(y, cell_size);
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">xp</span> = calloc(x, cell_size);
  cell_copy(y, (as + (as_pointer - y)), yp);
  cell_copy(x, (as + (as_pointer - y - x)), xp);
  cell_copy(y, yp, (as + (as_pointer - y - x)));
  cell_copy(x, xp, (as + (as_pointer - x)));
  free(yp);
  free(xp);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a2cd9a" class="outline-3">
<h3 id="org1a2cd9a">p_as_print</h3>
<div class="outline-text-3" id="text-org1a2cd9a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_as_print</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  printf(<span style="color: #e6db74;">"\n"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (as_pointer &lt; as_base) {
    printf(<span style="color: #e6db74;">"  * %ld *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- below the stack --\n"</span>);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    printf(<span style="color: #e6db74;">"  * %ld *  "</span>, (as_pointer - as_base));
    printf(<span style="color: #e6db74;">"-- "</span>);
    <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = as_base;
    <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; as_pointer) {
      printf(<span style="color: #e6db74;">"%ld "</span>, as[i]);
      i++;
    }
    printf(<span style="color: #e6db74;">"--\n"</span>);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org55b3c01" class="outline-3">
<h3 id="org55b3c01">p_stack_base</h3>
<div class="outline-text-3" id="text-org55b3c01">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_stack_base</span>() {
  as_push(as + as_base);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f7d374" class="outline-3">
<h3 id="org3f7d374">p_stack_pointer</h3>
<div class="outline-text-3" id="text-org3f7d374">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_stack_pointer</span>() {
  as_push(as + as_pointer);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga18ec2e" class="outline-3">
<h3 id="orga18ec2e">export_stack_operation</h3>
<div class="outline-text-3" id="text-orga18ec2e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_stack_operation</span>() {
  defprim(<span style="color: #e6db74;">"drop"</span>, p_drop);
  defprim(<span style="color: #e6db74;">"dup"</span>, p_dup);
  defprim(<span style="color: #e6db74;">"over"</span>, p_over);
  defprim(<span style="color: #e6db74;">"tuck"</span>, p_tuck);
  defprim(<span style="color: #e6db74;">"swap"</span>, p_swap);
  defprim(<span style="color: #e6db74;">"xy-swap"</span>, p_xy_swap);
  defprim(<span style="color: #e6db74;">"as/print"</span>, p_as_print);
  defprim(<span style="color: #e6db74;">"stack-pointer"</span>, p_stack_pointer);
  defprim(<span style="color: #e6db74;">"stack-base"</span>, p_stack_base);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4a44f9c" class="outline-2">
<h2 id="org4a44f9c"><b>ending</b></h2>
<div class="outline-text-2" id="text-org4a44f9c">
</div><div id="outline-container-org5008ea2" class="outline-3">
<h3 id="org5008ea2">p_end</h3>
<div class="outline-text-3" id="text-org5008ea2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_end</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(rs: addr -&gt;)</span>
  rs_pop();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fd399a" class="outline-3">
<h3 id="org4fd399a">p_bye</h3>
<div class="outline-text-3" id="text-org4fd399a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bye</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; [exit])</span>
  printf(<span style="color: #e6db74;">"bye bye ^-^/\n"</span>);
  exit(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org46a2cad" class="outline-3">
<h3 id="org46a2cad">export_ending</h3>
<div class="outline-text-3" id="text-org46a2cad">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_ending</span>() {
  defprim(<span style="color: #e6db74;">"end"</span>, p_end);
  defprim(<span style="color: #e6db74;">"bye"</span>, p_bye);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb77288c" class="outline-2">
<h2 id="orgb77288c"><b>control</b></h2>
<div class="outline-text-2" id="text-orgb77288c">
</div><div id="outline-container-orge6f463e" class="outline-3">
<h3 id="orge6f463e">i_lit</h3>
<div class="outline-text-3" id="text-orge6f463e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_lit</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body + 1);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
  as_push(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5fbbeb" class="outline-3">
<h3 id="orga5fbbeb">i_tail_call</h3>
<div class="outline-text-3" id="text-orga5fbbeb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_tail_call</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">jo</span> = *(<span style="color: #66d9ef; font-weight: bold;">cell</span>*)function_body;
  jo_apply(jo);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae666f8" class="outline-3">
<h3 id="orgae666f8">p_jump_if_false</h3>
<div class="outline-text-3" id="text-orgae666f8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jump_if_false</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool addr -&gt; [rs])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #f92672; font-weight: bold;">if</span> (b == 0) {
    rs_pop();
    rs_push(a);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea3c8fd" class="outline-3">
<h3 id="orgea3c8fd">export_control</h3>
<div class="outline-text-3" id="text-orgea3c8fd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_control</span>() {
  defprim(<span style="color: #e6db74;">"instruction/lit"</span>, i_lit);
  defprim(<span style="color: #e6db74;">"instruction/tail-call"</span>, i_tail_call);
  defprim(<span style="color: #e6db74;">"jump-if-false"</span>, p_jump_if_false);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5271976" class="outline-2">
<h2 id="org5271976"><b>bool</b></h2>
<div class="outline-text-2" id="text-org5271976">
</div><div id="outline-container-org3b00b53" class="outline-3">
<h3 id="org3b00b53">p_true</h3>
<div class="outline-text-3" id="text-org3b00b53">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_true</span>() {
  as_push(1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf4a1d8" class="outline-3">
<h3 id="orgcf4a1d8">p_false</h3>
<div class="outline-text-3" id="text-orgcf4a1d8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_false</span>() {
  as_push(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org37b2cb8" class="outline-3">
<h3 id="org37b2cb8">p_not</h3>
<div class="outline-text-3" id="text-org37b2cb8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_not</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(<span style="color: #960050;">!</span>a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1544243" class="outline-3">
<h3 id="org1544243">p_and</h3>
<div class="outline-text-3" id="text-org1544243">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_and</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool bool -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  as_push(a&amp;&amp;b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org345a7c4" class="outline-3">
<h3 id="org345a7c4">p_or</h3>
<div class="outline-text-3" id="text-org345a7c4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_or</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(bool bool -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  as_push(a||b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org34a1a48" class="outline-3">
<h3 id="org34a1a48">export_bool</h3>
<div class="outline-text-3" id="text-org34a1a48">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_bool</span>() {
  defprim(<span style="color: #e6db74;">"true"</span>, p_true);
  defprim(<span style="color: #e6db74;">"false"</span>, p_false);
  defprim(<span style="color: #e6db74;">"not"</span>, p_not);
  defprim(<span style="color: #e6db74;">"and"</span>, p_and);
  defprim(<span style="color: #e6db74;">"or"</span>, p_or);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org316e1a" class="outline-2">
<h2 id="org316e1a"><b>bit</b></h2>
<div class="outline-text-2" id="text-org316e1a">
</div><div id="outline-container-orge9b9f56" class="outline-3">
<h3 id="orge9b9f56">p_true_bit</h3>
<div class="outline-text-3" id="text-orge9b9f56">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_true_bit</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = -1;
  as_push(i);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb088f3d" class="outline-3">
<h3 id="orgb088f3d">p_false_bit</h3>
<div class="outline-text-3" id="text-orgb088f3d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_false_bit</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; cell)</span>
  as_push(0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeaa63e8" class="outline-3">
<h3 id="orgeaa63e8">p_bit_and</h3>
<div class="outline-text-3" id="text-orgeaa63e8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_and</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a&amp;b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7a6fce" class="outline-3">
<h3 id="orgb7a6fce">p_bit_or</h3>
<div class="outline-text-3" id="text-orgb7a6fce">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_or</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a|b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org918d453" class="outline-3">
<h3 id="org918d453">p_bit_xor</h3>
<div class="outline-text-3" id="text-org918d453">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_xor</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a^b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org391e8d5" class="outline-3">
<h3 id="org391e8d5">p_bit_not</h3>
<div class="outline-text-3" id="text-org391e8d5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_not</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(~a);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2d49e1" class="outline-3">
<h3 id="orgd2d49e1">p_bit_shift_left</h3>
<div class="outline-text-3" id="text-orgd2d49e1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bit_shift_left</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell step -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">s</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a&lt;&lt;s);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org71a9b65" class="outline-3">
<h3 id="org71a9b65"><span class="todo note">note</span> shift_right &amp; arithmetic_shift_right</h3>
<div class="outline-text-3" id="text-org71a9b65">
<ul class="org-ul">
<li><p>must not use &gt;&gt; because its meaning is not sure in c</p></li></ul>
</div>
</div>

<div id="outline-container-org9dbdd1a" class="outline-3">
<h3 id="org9dbdd1a">export_bit</h3>
<div class="outline-text-3" id="text-org9dbdd1a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_bit</span>() {
  defprim(<span style="color: #e6db74;">"true/bit"</span>, p_true_bit);
  defprim(<span style="color: #e6db74;">"false/bit"</span>, p_false_bit);
  defprim(<span style="color: #e6db74;">"bit/not"</span>, p_bit_not);
  defprim(<span style="color: #e6db74;">"bit/and"</span>, p_bit_and);
  defprim(<span style="color: #e6db74;">"bit/xor"</span>, p_bit_xor);
  defprim(<span style="color: #e6db74;">"bit/or"</span>, p_bit_or);
  defprim(<span style="color: #e6db74;">"bit/shift-left"</span>, p_bit_shift_left);
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">defprim("bit/shift-right", p_bit_shift_right);</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">defprim("bit/arithmetic-shift-right", p_bit_arithmetic_shift_right);</span>
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org65a1a5d" class="outline-2">
<h2 id="org65a1a5d"><b>int</b></h2>
<div class="outline-text-2" id="text-org65a1a5d">
</div><div id="outline-container-orgd3822dc" class="outline-3">
<h3 id="orgd3822dc">p_add</h3>
<div class="outline-text-3" id="text-orgd3822dc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_add</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a + b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org28f62ab" class="outline-3">
<h3 id="org28f62ab">p_sub</h3>
<div class="outline-text-3" id="text-org28f62ab">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_sub</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a - b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8bfe41c" class="outline-3">
<h3 id="org8bfe41c">p_mul</h3>
<div class="outline-text-3" id="text-org8bfe41c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_mul</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a * b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org57802c7" class="outline-3">
<h3 id="org57802c7">p_div</h3>
<div class="outline-text-3" id="text-org57802c7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_div</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a / b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge68a0d9" class="outline-3">
<h3 id="orge68a0d9">p_mod</h3>
<div class="outline-text-3" id="text-orge68a0d9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_mod</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a % b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5272e3" class="outline-3">
<h3 id="orge5272e3">p_n_eq_p</h3>
<div class="outline-text-3" id="text-orge5272e3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_n_eq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(a ... b ... n -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">old_n</span> = n;
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">cursor1</span> = (as + as_pointer - n);
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">cursor2</span> = (as + as_pointer - n - n);
  <span style="color: #f92672; font-weight: bold;">while</span> (n &gt; 0) {
    <span style="color: #f92672; font-weight: bold;">if</span> (cursor1[n-1] != cursor2[n-1]) {
      as_pointer = as_pointer - old_n - old_n;
      as_push(<span style="color: #ae81ff;">false</span>);
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    n--;
  }
  as_pointer = as_pointer - old_n - old_n;
  as_push(<span style="color: #ae81ff;">true</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6297a71" class="outline-3">
<h3 id="org6297a71">p_eq_p</h3>
<div class="outline-text-3" id="text-org6297a71">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_eq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a == b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org590a67e" class="outline-3">
<h3 id="org590a67e">p_gt_p</h3>
<div class="outline-text-3" id="text-org590a67e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_gt_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &gt; b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org98173fe" class="outline-3">
<h3 id="org98173fe">p_lt_p</h3>
<div class="outline-text-3" id="text-org98173fe">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_lt_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &lt; b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbcf63e4" class="outline-3">
<h3 id="orgbcf63e4">p_gteq_p</h3>
<div class="outline-text-3" id="text-orgbcf63e4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_gteq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &gt;= b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org876ad6e" class="outline-3">
<h3 id="org876ad6e">p_lteq_p</h3>
<div class="outline-text-3" id="text-org876ad6e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_lteq_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell cell -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">b</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">a</span> = as_pop();
  as_push(a &lt;= b);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org55c9500" class="outline-3">
<h3 id="org55c9500">k_int</h3>
<div class="outline-text-3" id="text-org55c9500">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo</span>();

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_int</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(jo2str(s))) {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(string_to_dec(jo2str(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (int ...) : %s"</span>, jo2str(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c48e8f" class="outline-3">
<h3 id="org5c48e8f">k_bin</h3>
<div class="outline-text-3" id="text-org5c48e8f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_bin</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(jo2str(s))) {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(string_to_bin(jo2str(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (int ...) : %s"</span>, jo2str(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5bcd11" class="outline-3">
<h3 id="orgb5bcd11">k_oct</h3>
<div class="outline-text-3" id="text-orgb5bcd11">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_oct</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(jo2str(s))) {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(string_to_oct(jo2str(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (int ...) : %s"</span>, jo2str(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6316a0e" class="outline-3">
<h3 id="org6316a0e">k_hex</h3>
<div class="outline-text-3" id="text-org6316a0e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_hex</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (int_string_p(jo2str(s))) {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(string_to_hex(jo2str(s)));
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"meet non-cell string in (int ...) : %s"</span>, jo2str(s));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org68ae65e" class="outline-3">
<h3 id="org68ae65e"><span class="todo _gt__lt_">&gt;&lt;</span> p_[int|bin|oct|hex]_print</h3>
<div class="outline-text-3" id="text-org68ae65e">
<ul class="org-ul">
<li><p>&gt;&lt;&gt;&lt;&gt;&lt;</p><p>default print should be signed number</p><p>for unsigned number</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_int_print</span>() { printf(<span style="color: #e6db74;">"%ld"</span>, as_pop()); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bin_print</span>() { printf(<span style="color: #e6db74;">"%ld"</span>, as_pop()); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_oct_print</span>() { printf(<span style="color: #e6db74;">"%lo"</span>, as_pop()); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_hex_print</span>() { printf(<span style="color: #e6db74;">"%lx"</span>, as_pop()); }
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf61e524" class="outline-3">
<h3 id="orgf61e524"><span class="todo _gt__lt_">&gt;&lt;</span> p_[int|bin|oct|hex]_dot</h3>
<div class="outline-text-3" id="text-orgf61e524">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dot</span>() { printf(<span style="color: #e6db74;">"%ld "</span>, as_pop()); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_int_dot</span>() { printf(<span style="color: #e6db74;">"%ld "</span>, as_pop()); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_bin_dot</span>() { printf(<span style="color: #e6db74;">"%ld "</span>, as_pop()); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_oct_dot</span>() { printf(<span style="color: #e6db74;">"%lo "</span>, as_pop()); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_hex_dot</span>() { printf(<span style="color: #e6db74;">"%lx "</span>, as_pop()); }
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbfc6932" class="outline-3">
<h3 id="orgbfc6932">export_int</h3>
<div class="outline-text-3" id="text-orgbfc6932">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_int</span>() {
  defprim(<span style="color: #e6db74;">"add"</span>, p_add);
  defprim(<span style="color: #e6db74;">"sub"</span>, p_sub);

  defprim(<span style="color: #e6db74;">"mul"</span>, p_mul);
  defprim(<span style="color: #e6db74;">"div"</span>, p_div);
  defprim(<span style="color: #e6db74;">"mod"</span>, p_mod);

  defprim(<span style="color: #e6db74;">"neg"</span>, p_not);

  defprim(<span style="color: #e6db74;">"n-eq?"</span>, p_n_eq_p);

  defprim(<span style="color: #e6db74;">"eq?"</span>, p_eq_p);
  defprim(<span style="color: #e6db74;">"gt?"</span>, p_gt_p);
  defprim(<span style="color: #e6db74;">"lt?"</span>, p_lt_p);
  defprim(<span style="color: #e6db74;">"gteq?"</span>, p_gteq_p);
  defprim(<span style="color: #e6db74;">"lteq?"</span>, p_lteq_p);

  defprim(<span style="color: #e6db74;">"int"</span>, k_int);
  defprim(<span style="color: #e6db74;">"bin"</span>, k_bin);
  defprim(<span style="color: #e6db74;">"oct"</span>, k_oct);
  defprim(<span style="color: #e6db74;">"hex"</span>, k_hex);

  defprim(<span style="color: #e6db74;">"int/print"</span>, p_int_print);
  defprim(<span style="color: #e6db74;">"bin/print"</span>, p_bin_print);
  defprim(<span style="color: #e6db74;">"oct/print"</span>, p_oct_print);
  defprim(<span style="color: #e6db74;">"hex/print"</span>, p_hex_print);

  defprim(<span style="color: #e6db74;">"dot"</span>, p_dot);
  defprim(<span style="color: #e6db74;">"int/dot"</span>, p_int_dot);
  defprim(<span style="color: #e6db74;">"bin/dot"</span>, p_bin_dot);
  defprim(<span style="color: #e6db74;">"oct/dot"</span>, p_oct_dot);
  defprim(<span style="color: #e6db74;">"hex/dot"</span>, p_hex_dot);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga56f3ee" class="outline-2">
<h2 id="orga56f3ee"><b>memory</b></h2>
<div class="outline-text-2" id="text-orga56f3ee">
</div><div id="outline-container-orgd539ddc" class="outline-3">
<h3 id="orgd539ddc">p_allocate</h3>
<div class="outline-text-3" id="text-orgd539ddc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_allocate</span> () {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(size -&gt; addr)</span>
  as_push(calloc(as_pop(), 1));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb21257c" class="outline-3">
<h3 id="orgb21257c">p_free</h3>
<div class="outline-text-3" id="text-orgb21257c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_free</span> () {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(addr -&gt;)</span>
  free(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb10cff8" class="outline-3">
<h3 id="orgb10cff8">k_var</h3>
<div class="outline-text-3" id="text-orgb10cff8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_var</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_jo();
  here(&amp;(jotable[index].value.cell));
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b3279d" class="outline-3">
<h3 id="org9b3279d">p_set</h3>
<div class="outline-text-3" id="text-org9b3279d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_set</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell addr -&gt;)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">address</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">value</span> = as_pop();
  address[0] = value;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b8dc63" class="outline-3">
<h3 id="org7b8dc63">p_get</h3>
<div class="outline-text-3" id="text-org7b8dc63">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_get</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(addr -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">address</span> = as_pop();
  as_push(address[0]);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb88e290" class="outline-3">
<h3 id="orgb88e290">p_set_byte</h3>
<div class="outline-text-3" id="text-orgb88e290">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_set_byte</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(cell addr -&gt;)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">address</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">value</span> = as_pop();
  address[0] = value;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bd0a0e" class="outline-3">
<h3 id="org3bd0a0e">p_get_byte</h3>
<div class="outline-text-3" id="text-org3bd0a0e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_get_byte</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(addr -&gt; cell)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">address</span> = as_pop();
  as_push(address[0]);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4bfdfce" class="outline-3">
<h3 id="org4bfdfce">export_memory</h3>
<div class="outline-text-3" id="text-org4bfdfce">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_memory</span>() {
  defprim(<span style="color: #e6db74;">"allocate"</span>, p_allocate);
  defprim(<span style="color: #e6db74;">"free"</span>, p_free);
  defprim(<span style="color: #e6db74;">"var"</span>, k_var);
  defprim(<span style="color: #e6db74;">"set"</span>, p_set);
  defprim(<span style="color: #e6db74;">"get"</span>, p_get);
  defprim(<span style="color: #e6db74;">"set-byte"</span>, p_set_byte);
  defprim(<span style="color: #e6db74;">"get-byte"</span>, p_get_byte);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga71c228" class="outline-2">
<h2 id="orga71c228"><b>byte</b></h2>
<div class="outline-text-2" id="text-orga71c228">
</div><div id="outline-container-orgdc5bb67" class="outline-3">
<h3 id="orgdc5bb67">reading_stack</h3>
<div class="outline-text-3" id="text-orgdc5bb67">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">file_handle</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">file</span>;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">dir</span>;
} <span style="color: #66d9ef; font-weight: bold;">reading_point</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #66d9ef; font-weight: bold;">reading_stack_t</span>[64];

<span style="color: #66d9ef; font-weight: bold;">reading_stack_t</span> <span style="color: #fd971f;">reading_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">reading_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">reading_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">reading_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #fd971f;">value</span>) {
  reading_stack[reading_stack_pointer] = value;
  reading_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #a6e22e;">reading_stack_pop</span>() {
  reading_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack[reading_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #a6e22e;">reading_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack[reading_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">reading_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> reading_stack_pointer == reading_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3551ac6" class="outline-3">
<h3 id="org3551ac6">real_reading_path</h3>
<div class="outline-text-3" id="text-org3551ac6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">real_reading_path</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>, <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">buffer</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (path[0] == <span style="color: #e6db74;">'/'</span>) {
    realpath(path, buffer);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    realpath(path, buffer);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    buffer[0] = 0;
    strcat(buffer, reading_stack_tos().dir);
    strcat(buffer, <span style="color: #e6db74;">"/"</span>);
    strcat(buffer, path);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9daba1" class="outline-3">
<h3 id="org9daba1">read_byte</h3>
<div class="outline-text-3" id="text-org9daba1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #a6e22e;">read_byte</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    <span style="color: #f92672; font-weight: bold;">return</span> fgetc(stdin);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = fgetc(reading_stack_tos().file_handle);
    <span style="color: #f92672; font-weight: bold;">if</span> (c == EOF) {
      <span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #fd971f;">rp</span> = reading_stack_pop();
      fclose(rp.file_handle);
      free(rp.file);
      free(rp.dir);
      <span style="color: #f92672; font-weight: bold;">return</span> read_byte();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">return</span> c;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdec5986" class="outline-3">
<h3 id="orgdec5986">byte_unread</h3>
<div class="outline-text-3" id="text-orgdec5986">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">byte_unread</span>(<span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #fd971f;">c</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (reading_stack_empty_p()) {
    ungetc(c, stdin);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    ungetc(c, reading_stack_tos().file_handle);
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ac8482" class="outline-3">
<h3 id="org3ac8482">p_read_byte</h3>
<div class="outline-text-3" id="text-org3ac8482">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_byte</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; byte)</span>
  as_push(read_byte());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1865b45" class="outline-3">
<h3 id="org1865b45">p_byte_unread</h3>
<div class="outline-text-3" id="text-org1865b45">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_byte_unread</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(byte -&gt; [reading_stack])</span>
  byte_unread(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge146aea" class="outline-3">
<h3 id="orge146aea">p_byte_print</h3>
<div class="outline-text-3" id="text-orge146aea">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_byte_print</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(byte -&gt;)</span>
  printf(<span style="color: #e6db74;">"%c"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba8f75c" class="outline-3">
<h3 id="orgba8f75c">export_byte</h3>
<div class="outline-text-3" id="text-orgba8f75c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_byte</span>() {
  defprim(<span style="color: #e6db74;">"read/byte"</span>, p_read_byte);
  defprim(<span style="color: #e6db74;">"byte/unread"</span>, p_byte_unread);
  defprim(<span style="color: #e6db74;">"byte/print"</span>, p_byte_print);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8544254" class="outline-2">
<h2 id="org8544254"><b>jo</b></h2>
<div class="outline-text-2" id="text-org8544254">
</div><div id="outline-container-orge256e14" class="outline-3">
<h3 id="orge256e14">loading_stack</h3>
<div class="outline-text-3" id="text-orge256e14">
<ul class="org-ul">
<li><p>a hook for read_jo</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">nick</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>;
} <span style="color: #66d9ef; font-weight: bold;">alias</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #66d9ef; font-weight: bold;">loading_stack_t</span>[64];

<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">alias_record_size</span> = 1024;

<span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">loading_stack_area</span>[64][1024];

<span style="color: #66d9ef; font-weight: bold;">loading_stack_t</span> <span style="color: #fd971f;">loading_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">loading_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">loading_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">loading_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #fd971f;">value</span>) {
  loading_stack[loading_stack_pointer] = value;
  loading_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #a6e22e;">loading_stack_pop</span>() {
  loading_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> loading_stack[loading_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #a6e22e;">loading_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> loading_stack[loading_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">loading_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> loading_stack_pointer == loading_stack_base;
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_loading_stack</span>() {
  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">record</span>[alias_record_size];
  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">a</span> = {.nick = 0, .name = 0};
  record[0] = a;
  loading_stack_push(record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7601d8" class="outline-3">
<h3 id="orgd7601d8">alias_add</h3>
<div class="outline-text-3" id="text-orgd7601d8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">alias_add</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">nick</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #fd971f;">alias_record</span> = loading_stack_tos();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; alias_record_size) {
    <span style="color: #f92672; font-weight: bold;">if</span> (alias_record[i].nick == 0 &amp;&amp;
        alias_record[i].name == 0) {
      alias_record[i].nick = nick;
      alias_record[i].name = name;
      alias_record[i+1].nick = 0;
      alias_record[i+1].name = 0;
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      i++;
    }
  }
  printf(<span style="color: #e6db74;">"alias_add fail alias_record is full\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d344e0" class="outline-3">
<h3 id="org5d344e0">alias_find</h3>
<div class="outline-text-3" id="text-org5d344e0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">alias_find</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">nick</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">alias</span>* <span style="color: #fd971f;">alias_record</span> = loading_stack_tos();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #f92672; font-weight: bold;">if</span> (alias_record[i].nick == 0 &amp;&amp;
        alias_record[i].name == 0) {
      <span style="color: #f92672; font-weight: bold;">return</span> 0;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (alias_record[i].nick == nick) {
      <span style="color: #f92672; font-weight: bold;">return</span> alias_record[i].name;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      i++;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org29d2597" class="outline-3">
<h3 id="org29d2597">read_jo_without_prefix</h3>
<div class="outline-text-3" id="text-org29d2597">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo_without_prefix</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #fd971f;">buf</span>[1024];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cur</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">collecting</span> = <span style="color: #ae81ff;">false</span>;
  <span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #fd971f;">c</span>;
  <span style="color: #66d9ef; font-weight: bold;">byte</span> <span style="color: #fd971f;">go</span> = <span style="color: #ae81ff;">true</span>;
  <span style="color: #f92672; font-weight: bold;">while</span> (go) {
    c = read_byte();
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>collecting) {
      <span style="color: #f92672; font-weight: bold;">if</span> (isspace(c)) {
        <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        collecting = <span style="color: #ae81ff;">true</span>;
        buf[cur] = c;
        cur++;
        <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c)) {
          go = <span style="color: #ae81ff;">false</span>;
        }
      }
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">if</span> (isbarcket(c) ||
          isspace(c)) {
        byte_unread(c);
        go = <span style="color: #ae81ff;">false</span>;
      }
      <span style="color: #f92672; font-weight: bold;">else</span> {
        buf[cur] = c;
        cur++;
      }
    }
  }
  buf[cur] = 0;
  <span style="color: #f92672; font-weight: bold;">return</span> str2jo(buf);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org212b54b" class="outline-3">
<h3 id="org212b54b">read_jo</h3>
<div class="outline-text-3" id="text-org212b54b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo0</span> = read_jo_without_prefix();
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo1</span> = alias_find(jo0);
  <span style="color: #f92672; font-weight: bold;">if</span> (jo1 != 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> jo1;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> jo0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2fca5e7" class="outline-3">
<h3 id="org2fca5e7">p_read_jo_without_prefix</h3>
<div class="outline-text-3" id="text-org2fca5e7">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_jo_without_prefix</span>() {
  as_push(read_jo_without_prefix());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd15caab" class="outline-3">
<h3 id="orgd15caab">p_read_jo</h3>
<div class="outline-text-3" id="text-orgd15caab">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_read_jo</span>() {
  as_push(read_jo());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf67356f" class="outline-3">
<h3 id="orgf67356f">cat_2_jo</h3>
<div class="outline-text-3" id="text-orgf67356f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">cat_2_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">x</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">y</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">str</span>[2 * 1024];
  str[0] = 0;
  strcat(str, jo2str(x));
  strcat(str, jo2str(y));
  <span style="color: #f92672; font-weight: bold;">return</span> str2jo(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e6b6f4" class="outline-3">
<h3 id="org7e6b6f4">cat_3_jo</h3>
<div class="outline-text-3" id="text-org7e6b6f4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">cat_3_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">x</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">y</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">z</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">str</span>[3 * 1024];
  str[0] = 0;
  strcat(str, jo2str(x));
  strcat(str, jo2str(y));
  strcat(str, jo2str(z));
  <span style="color: #f92672; font-weight: bold;">return</span> str2jo(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8354833" class="outline-3">
<h3 id="org8354833">p_jo_used_p</h3>
<div class="outline-text-3" id="text-org8354833">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_used_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; bool)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span> = as_pop();
  as_push(jotable_entry_used(jotable[jo]));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a862d3" class="outline-3">
<h3 id="org9a862d3">p_jo_to_string</h3>
<div class="outline-text-3" id="text-org9a862d3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_to_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">jo</span> = as_pop();
  as_push(jo2str(jo));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d65998" class="outline-3">
<h3 id="org7d65998">p_string_length_to_jo</h3>
<div class="outline-text-3" id="text-org7d65998">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_length_to_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string length -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">len</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">str</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[2 * 1024];
  strncpy(buffer, str, len);
  buffer[len] = 0;
  as_push(str2jo(buffer));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd05bde" class="outline-3">
<h3 id="orgbd05bde">p_string_to_jo</h3>
<div class="outline-text-3" id="text-orgbd05bde">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_to_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; jo)</span>
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = as_pop();
  as_push(str2jo(str));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org897ba3d" class="outline-3">
<h3 id="org897ba3d">p_null</h3>
<div class="outline-text-3" id="text-org897ba3d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_null</span>() {
  as_push(str2jo(<span style="color: #e6db74;">"null"</span>));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4bf930" class="outline-3">
<h3 id="orgb4bf930">k_jo</h3>
<div class="outline-text-3" id="text-orgb4bf930">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
      here(s);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9124dc" class="outline-3">
<h3 id="orgf9124dc">p_jo_print</h3>
<div class="outline-text-3" id="text-orgf9124dc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_print</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%s"</span>, jo2str(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc02790" class="outline-3">
<h3 id="orgdc02790">p_jo_dot</h3>
<div class="outline-text-3" id="text-orgdc02790">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_jo_dot</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%s "</span>, jo2str(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org585ff0f" class="outline-3">
<h3 id="org585ff0f">export_jo</h3>
<div class="outline-text-3" id="text-org585ff0f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_jo</span>() {
  defprim(<span style="color: #e6db74;">"null"</span>, p_null);
  defprim(<span style="color: #e6db74;">"read/jo"</span>, p_read_jo);
  defprim(<span style="color: #e6db74;">"read/jo/without-prefix"</span>, p_read_jo_without_prefix);
  defprim(<span style="color: #e6db74;">"jo/used?"</span>, p_jo_used_p);
  defprim(<span style="color: #e6db74;">"jo-&gt;string"</span>, p_jo_to_string);
  defprim(<span style="color: #e6db74;">"string-&gt;jo"</span>, p_string_to_jo);
  defprim(<span style="color: #e6db74;">"string/length-&gt;jo"</span>, p_string_length_to_jo);
  defprim(<span style="color: #e6db74;">"jo"</span>, k_jo);
  defprim(<span style="color: #e6db74;">"jo/print"</span>, p_jo_print);
  defprim(<span style="color: #e6db74;">"jo/dot"</span>, p_jo_dot);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd8f995e" class="outline-2">
<h2 id="orgd8f995e"><b>string</b></h2>
<div class="outline-text-2" id="text-orgd8f995e">
</div><div id="outline-container-org5c3705f" class="outline-3">
<h3 id="org5c3705f">k_string_one</h3>
<div class="outline-text-3" id="text-org5c3705f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_string_one</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[1024 * 1024];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cursor</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = read_byte();
    <span style="color: #f92672; font-weight: bold;">if</span> (c == <span style="color: #e6db74;">'"'</span>) {
      buffer[cursor] = 0;
      cursor++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      buffer[cursor] = c;
      cursor++;
    }
  }
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = malloc(cursor);
  strcpy(str, buffer);
  here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
  here(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ca13e2" class="outline-3">
<h3 id="org9ca13e2">k_string</h3>
<div class="outline-text-3" id="text-org9ca13e2">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"\""</span>)) {
      k_string_one();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2dad482" class="outline-3">
<h3 id="org2dad482">p_string_length</h3>
<div class="outline-text-3" id="text-org2dad482">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_length</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; length)</span>
  as_push(strlen(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd223547" class="outline-3">
<h3 id="orgd223547">p_string_print</h3>
<div class="outline-text-3" id="text-orgd223547">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_print</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"%s"</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga758c5a" class="outline-3">
<h3 id="orga758c5a">p_string_dot</h3>
<div class="outline-text-3" id="text-orga758c5a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_dot</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; [io])</span>
  printf(<span style="color: #e6db74;">"\"%s \""</span>, as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8248c57" class="outline-3">
<h3 id="org8248c57">p_string_append_to_buffer</h3>
<div class="outline-text-3" id="text-org8248c57">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_string_append_to_buffer</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(buffer, string -&gt; buffer)</span>
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">buffer</span> = as_tos();
  strcat(buffer, str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge419dab" class="outline-3">
<h3 id="orge419dab">export_string</h3>
<div class="outline-text-3" id="text-orge419dab">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_string</span>() {
  defprim(<span style="color: #e6db74;">"string"</span>, k_string);
  defprim(<span style="color: #e6db74;">"string/print"</span>, p_string_print);
  defprim(<span style="color: #e6db74;">"string/dot"</span>, p_string_dot);
  defprim(<span style="color: #e6db74;">"string/length"</span>, p_string_length);
  defprim(<span style="color: #e6db74;">"string/append-to-buffer"</span>, p_string_append_to_buffer);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org754533e" class="outline-2">
<h2 id="org754533e"><b>file</b></h2>
<div class="outline-text-2" id="text-org754533e">
</div><div id="outline-container-org5fd0a13" class="outline-3">
<h3 id="org5fd0a13">file_readable_p</h3>
<div class="outline-text-3" id="text-org5fd0a13">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">file_readable_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>) {
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">fp</span> = fopen(path, <span style="color: #e6db74;">"r"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>fp) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    fclose(fp);
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9291390" class="outline-3">
<h3 id="org9291390">dir_ok_p</h3>
<div class="outline-text-3" id="text-org9291390">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">dir_ok_p</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>) {
  <span style="color: #66d9ef; font-weight: bold;">DIR</span>* <span style="color: #fd971f;">dir</span> = opendir(path);
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>dir) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    closedir(dir);
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org441d9bf" class="outline-3">
<h3 id="org441d9bf">p_file_readable_p</h3>
<div class="outline-text-3" id="text-org441d9bf">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_file_readable_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(file -&gt; bool)</span>
  as_push(file_readable_p(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge9fb83c" class="outline-3">
<h3 id="orge9fb83c">p_dir_ok_p</h3>
<div class="outline-text-3" id="text-orge9fb83c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_dir_ok_p</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(dir -&gt; bool)</span>
  as_push(dir_ok_p(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgadbf745" class="outline-3">
<h3 id="orgadbf745">file_size</h3>
<div class="outline-text-3" id="text-orgadbf745">
<ul class="org-ul">
<li><p>abstract "struct stat" out</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">file_size</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">file_name</span>) {
  <span style="color: #f92672; font-weight: bold;">struct</span> <span style="color: #66d9ef; font-weight: bold;">stat</span> <span style="color: #fd971f;">st</span>;
  stat(file_name, &amp;st);
  <span style="color: #f92672; font-weight: bold;">return</span> st.st_size;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org950e1c" class="outline-3">
<h3 id="org950e1c">p_file_size</h3>
<div class="outline-text-3" id="text-org950e1c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_file_size</span>() {
  as_push(file_size(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org643e3fc" class="outline-3">
<h3 id="org643e3fc">p_file_copy_to_buffer</h3>
<div class="outline-text-3" id="text-org643e3fc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_file_copy_to_buffer</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(file-name addr -&gt; number)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">buffer</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">path</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">limit</span> = file_size(path);
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">fp</span> = fopen(path, <span style="color: #e6db74;">"r"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span>(<span style="color: #960050;">!</span>fp) {
    printf(<span style="color: #e6db74;">"- p_file_copy_to_buffer file to open file : %s\n"</span>, path);
    perror(<span style="color: #e6db74;">"  "</span>);
    as_push(0);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">readed_counter</span> = fread(buffer, 1, limit, fp);
  fclose(fp);
  as_push(readed_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org12bcc0" class="outline-3">
<h3 id="org12bcc0">export_file</h3>
<div class="outline-text-3" id="text-org12bcc0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_file</span>() {
  defprim(<span style="color: #e6db74;">"file/readable?"</span>, p_file_readable_p);
  defprim(<span style="color: #e6db74;">"dir/ok?"</span>, p_dir_ok_p);
  defprim(<span style="color: #e6db74;">"file/size"</span>, p_file_size);
  defprim(<span style="color: #e6db74;">"file/copy-to-buffer"</span>, p_file_copy_to_buffer);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org12231fd" class="outline-2">
<h2 id="org12231fd"><b>system</b></h2>
<div class="outline-text-2" id="text-org12231fd">
</div><div id="outline-container-orgc2c2c06" class="outline-3">
<h3 id="orgc2c2c06">p_current_dir</h3>
<div class="outline-text-3" id="text-orgc2c2c06">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_current_dir</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buf</span>[1024];
  as_push(getcwd(buf, 1024));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org96b8aa8" class="outline-3">
<h3 id="org96b8aa8">p_command_run</h3>
<div class="outline-text-3" id="text-org96b8aa8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_command_run</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; *)</span>
  system(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org883fce0" class="outline-3">
<h3 id="org883fce0">p_n_command_run</h3>
<div class="outline-text-3" id="text-org883fce0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_n_command_run</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(..., string, n -&gt; *)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">n</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span> = malloc(4 * 1024);
  str[0] = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; n) {
    strcat(str, as[as_pointer - n + i]);
    i++;
  }
  as_pointer = as_pointer - n;
  system(str);
  free(str);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7ef820" class="outline-3">
<h3 id="orgd7ef820">p_argument_counter</h3>
<div class="outline-text-3" id="text-orgd7ef820">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">argument_counter</span>;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_argument_counter</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; argument_counter)</span>
  as_push(argument_counter);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd4d5f56" class="outline-3">
<h3 id="orgd4d5f56">p_index_to_argument_string</h3>
<div class="outline-text-3" id="text-orgd4d5f56">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span>* <span style="color: #fd971f;">argument_string_array</span>;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_index_to_argument_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(index -&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">index</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">argument_string</span> = argument_string_array[index];
  as_push(argument_string);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2646ce8" class="outline-3">
<h3 id="org2646ce8">p_var_string_to_env_string</h3>
<div class="outline-text-3" id="text-org2646ce8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_var_string_to_env_string</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; string)</span>
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">var_string</span> = as_pop();
  <span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">env_string</span> = getenv(var_string);
  as_push(env_string);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org18e1b9f" class="outline-3">
<h3 id="org18e1b9f">export_system</h3>
<div class="outline-text-3" id="text-org18e1b9f">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_system</span>() {
  defprim(<span style="color: #e6db74;">"current-dir"</span>, p_current_dir);
  defprim(<span style="color: #e6db74;">"command/run"</span>, p_command_run);
  defprim(<span style="color: #e6db74;">"n-command/run"</span>, p_n_command_run);
  defprim(<span style="color: #e6db74;">"argument-counter"</span>, p_argument_counter);
  defprim(<span style="color: #e6db74;">"index-&gt;argument-string"</span>, p_index_to_argument_string);
  defprim(<span style="color: #e6db74;">"var-string-&gt;env-string"</span>, p_var_string_to_env_string);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf7cbdb0" class="outline-2">
<h2 id="orgf7cbdb0"><b>module</b></h2>
<div class="outline-text-2" id="text-orgf7cbdb0">
</div><div id="outline-container-org3972d82" class="outline-3">
<h3 id="org3972d82">module_record</h3>
<div class="outline-text-3" id="text-org3972d82">
<ul class="org-ul">
<li><p>just record what modules are loaded</p><p>and their meta-data</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #f92672; font-weight: bold;">struct</span> {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">dir</span>;
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">export</span>;
} <span style="color: #66d9ef; font-weight: bold;">module</span>;

<span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #66d9ef; font-weight: bold;">module_record_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">module_record_t</span> <span style="color: #fd971f;">module_record</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_record_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_record_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_record_push</span>(<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">value</span>) {
  module_record[module_record_pointer] = value;
  module_record_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">module_record_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> module_record_pointer == module_record_base;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">module_record_find</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; module_record_pointer) {
    <span style="color: #f92672; font-weight: bold;">if</span> (name == module_record[i].name) {
      <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
    }
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">module_record_get_export</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = module_record_base;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; module_record_pointer) {
    <span style="color: #f92672; font-weight: bold;">if</span> (name == module_record[i].name) {
      <span style="color: #f92672; font-weight: bold;">return</span> module_record[i].export;
    }
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_record_set_export</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>, <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">export</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = module_record_base;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; module_record_pointer) {
    <span style="color: #f92672; font-weight: bold;">if</span> (name == module_record[i].name) {
      module_record[i].export = export;
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    i++;
  }
  printf(<span style="color: #e6db74;">"- module_record_set_export fail\n"</span>);
  printf(<span style="color: #e6db74;">"  can not find module: %s\n"</span>, jo2str(name));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf2a2af" class="outline-3">
<h3 id="orgaf2a2af">module_stack</h3>
<div class="outline-text-3" id="text-orgaf2a2af">
<ul class="org-ul">
<li><p>just record what modules are loaded</p><p>and their meta-data</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #66d9ef; font-weight: bold;">module_stack_t</span>[128];

<span style="color: #66d9ef; font-weight: bold;">module_stack_t</span> <span style="color: #fd971f;">module_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">module_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">value</span>) {
  module_stack[module_stack_pointer] = value;
  module_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">module_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> module_stack_pointer == module_stack_base;
}

<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #a6e22e;">module_stack_pop</span>() {
  module_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> module_stack[module_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #a6e22e;">module_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> module_stack[module_stack_pointer - 1];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc378c18" class="outline-3">
<h3 id="orgc378c18">load_file</h3>
<div class="outline-text-3" id="text-orgc378c18">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">load_file</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">path</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">[reading_stack]</span>
  <span style="color: #66d9ef; font-weight: bold;">FILE</span>* <span style="color: #fd971f;">fp</span> = fopen(path, <span style="color: #e6db74;">"r"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span>(<span style="color: #960050;">!</span>fp) {
    perror(<span style="color: #e6db74;">"File opening failed"</span>);
    printf(<span style="color: #e6db74;">"load_file fail : %s\n"</span>, path);
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">file_buffer</span> = malloc(PATH_MAX);
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">dir_buffer</span> = malloc(PATH_MAX);
  realpath(path, file_buffer);
  realpath(path, dir_buffer);
  <span style="color: #66d9ef; font-weight: bold;">char</span>* <span style="color: #fd971f;">dir_addr</span> = dirname(dir_buffer);
  <span style="color: #66d9ef; font-weight: bold;">reading_point</span> <span style="color: #fd971f;">rp</span> = {
    .file_handle = fp,
    .file = file_buffer,
    .dir = dir_addr
  };
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">{ printf("- load_file\n");</span>
  <span style="color: #FF8888;">//   </span><span style="color: #FF8888;">printf("  fp: %d\n", fp);</span>
  <span style="color: #FF8888;">//   </span><span style="color: #FF8888;">printf("  file: %s\n", file_buffer);</span>
  <span style="color: #FF8888;">//   </span><span style="color: #FF8888;">printf("  dir_buffer: %s #%ld\n", dir_buffer, dir_buffer);</span>
  <span style="color: #FF8888;">//   </span><span style="color: #FF8888;">printf("  dir_addr: %s #%ld\n", dir_addr, dir_addr);</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">}</span>
  reading_stack_push(rp);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e4dc0b" class="outline-3">
<h3 id="org2e4dc0b">p_load_file</h3>
<div class="outline-text-3" id="text-org2e4dc0b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_load_file</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(string -&gt; [reading_stack])</span>
  load_file(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc40a22d" class="outline-3">
<h3 id="orgc40a22d">k_include_one</h3>
<div class="outline-text-3" id="text-orgc40a22d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_include_one</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[PATH_MAX];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cursor</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = read_byte();
    <span style="color: #f92672; font-weight: bold;">if</span> (c == <span style="color: #e6db74;">'"'</span>) {
      buffer[cursor] = 0;
      cursor++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      buffer[cursor] = c;
      cursor++;
    }
  }
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer1</span>[PATH_MAX];
  real_reading_path(buffer, buffer1);
  load_file(buffer1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf18c634" class="outline-3">
<h3 id="orgf18c634">k_include</h3>
<div class="outline-text-3" id="text-orgf18c634">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_include</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"\""</span>)) {
      k_include_one();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2653653" class="outline-3">
<h3 id="org2653653">find_module_file_jo</h3>
<div class="outline-text-3" id="text-org2653653">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">user_module_dir</span> = <span style="color: #e6db74;">"/.jojo/module/"</span>;
<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">system_module_dir</span> = <span style="color: #e6db74;">""</span>;

<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">find_module_file_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">path</span>[4 * 1024];
  path[0] = 0;
  strcat(path, getenv(<span style="color: #e6db74;">"HOME"</span>));
  strcat(path, user_module_dir);
  strcat(path, jo2str(name));
  strcat(path, <span style="color: #e6db74;">"/"</span>);
  strcat(path, <span style="color: #e6db74;">"module.jo"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (file_readable_p(path)) {
    <span style="color: #f92672; font-weight: bold;">return</span> str2jo(path);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> 0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6e493d" class="outline-3">
<h3 id="orgd6e493d">find_module_dir_jo</h3>
<div class="outline-text-3" id="text-orgd6e493d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">find_module_dir_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">path</span>[4 * 1024];
  path[0] = 0;
  strcat(path, getenv(<span style="color: #e6db74;">"HOME"</span>));
  strcat(path, user_module_dir);
  strcat(path, jo2str(name));
  strcat(path, <span style="color: #e6db74;">"/"</span>);
  <span style="color: #f92672; font-weight: bold;">if</span> (dir_ok_p(path)) {
    <span style="color: #f92672; font-weight: bold;">return</span> str2jo(path);
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #f92672; font-weight: bold;">return</span> 0;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org91a34df" class="outline-3">
<h3 id="org91a34df">p_find_module_file_jo</h3>
<div class="outline-text-3" id="text-org91a34df">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_find_module_file_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(prefix-jo -&gt; module-file-jo)</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  as_push(find_module_file_jo(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7198d9a" class="outline-3">
<h3 id="org7198d9a">p_find_module_dir_jo</h3>
<div class="outline-text-3" id="text-org7198d9a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_find_module_dir_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(prefix-jo -&gt; module-dir-jo)</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">return 0 -- not found</span>
  as_push(find_module_dir_jo(as_pop()));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9cce0c" class="outline-3">
<h3 id="orga9cce0c">import_module</h3>
<div class="outline-text-3" id="text-orga9cce0c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">import_module</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">export</span> = module_record_get_export(name);
  <span style="color: #f92672; font-weight: bold;">if</span> (export == 0) {
    printf(<span style="color: #e6db74;">"import_module fail to import: %s\n"</span>, jo2str(name));
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (export[i] != 0) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">new_jo</span> = cat_3_jo(name,
                         str2jo(<span style="color: #e6db74;">"/"</span>),
                         export[i]);
    alias_add(export[i], new_jo);
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org603b149" class="outline-3">
<h3 id="org603b149">k_dep_load</h3>
<div class="outline-text-3" id="text-org603b149">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">k_dep_load</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span>) {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">module_file_jo</span> = find_module_file_jo(name);
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">module_dir_jo</span> = find_module_dir_jo(name);
  <span style="color: #f92672; font-weight: bold;">if</span> (module_file_jo == 0) {
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">false</span>;
  }

  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">export</span>[1];
  export[0] = 0;
  <span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">m</span> = {
    .name = name,
    .dir = module_dir_jo,
    .export = export
  };
  module_record_push(m);
  module_stack_push(m);

  <span style="color: #66d9ef; font-weight: bold;">alias</span> <span style="color: #fd971f;">a</span> = {.nick = 0, .name = 0};
  loading_stack_area[loading_stack_pointer][0] = a;
  loading_stack_push(loading_stack_area[loading_stack_pointer]);

  load_file(jo2str(module_file_jo));

  <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">true</span>;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org195cace" class="outline-3">
<h3 id="org195cace">k_dep</h3>
<div class="outline-text-3" id="text-org195cace">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_dep</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [loading_stack])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span> = read_jo_without_prefix();
  <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>module_record_find(name)) {
    <span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #fd971f;">result</span> = k_dep_load(name);
    <span style="color: #f92672; font-weight: bold;">if</span> (result == <span style="color: #ae81ff;">false</span>) {
      printf(<span style="color: #e6db74;">"- k_dep fail to load module : %s\n"</span>, jo2str(name));
      k_ignore();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
        <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
        <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
          eval_key(read_jo());
        }
        <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
          loading_stack_pop();
          module_stack_pop();
          <span style="color: #f92672; font-weight: bold;">break</span>;
        }
        <span style="color: #f92672; font-weight: bold;">else</span> {
          <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
        }
      }
    }
  }
  import_module(name);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd87b063" class="outline-3">
<h3 id="orgd87b063">k_module</h3>
<div class="outline-text-3" id="text-orgd87b063">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_module</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [loading_stack_tos])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">name</span> = read_jo_without_prefix();
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">&gt;&lt;&gt;&lt;&gt;&lt; check module name</span>

  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">export</span> = compiling_stack_tos();
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo_without_prefix();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      here(0);
      module_record_set_export(name, export);
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #960050;">!</span>alias_find(s) == 0) {
      printf(<span style="color: #e6db74;">"k_module fail, alias used : %s\n"</span>, jo2str(s));
      k_ignore();
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a2628a" class="outline-3">
<h3 id="org5a2628a">module_report_one</h3>
<div class="outline-text-3" id="text-org5a2628a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_report_one</span>(<span style="color: #66d9ef; font-weight: bold;">module</span> <span style="color: #fd971f;">m</span>) {
  printf(<span style="color: #e6db74;">"  - %s -- %s\n"</span>, jo2str(m.name), jo2str(m.dir));
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (m.export[i] != 0) {
    printf(<span style="color: #e6db74;">"    %s\n"</span>, jo2str(m.export[i]));
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf902cdc" class="outline-3">
<h3 id="orgf902cdc">module_report</h3>
<div class="outline-text-3" id="text-orgf902cdc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">module_report</span>() {
  printf(<span style="color: #e6db74;">"- module_report\n"</span>);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = module_record_base;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; module_record_pointer) {
    module_report_one(module_record[i]);
    i++;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3827820" class="outline-3">
<h3 id="org3827820">export_module</h3>
<div class="outline-text-3" id="text-org3827820">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_module</span>() {
  defprim(<span style="color: #e6db74;">"load-file"</span>, p_load_file);

  defprim(<span style="color: #e6db74;">"find-module-file-jo"</span>, p_find_module_file_jo);
  defprim(<span style="color: #e6db74;">"find-module-dir-jo"</span>, p_find_module_dir_jo);

  defprim(<span style="color: #e6db74;">"include"</span>, k_include);
  defprim(<span style="color: #e6db74;">"dep"</span>, k_dep);
  defprim(<span style="color: #e6db74;">"module"</span>, k_module);
  defprim(<span style="color: #e6db74;">"module/report"</span>, module_report);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org670330b" class="outline-2">
<h2 id="org670330b"><b>ffi</b></h2>
<div class="outline-text-2" id="text-org670330b">
</div><div id="outline-container-org51972b3" class="outline-3">
<h3 id="org51972b3">ccall</h3>
<div class="outline-text-3" id="text-org51972b3">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">ccall</span> (<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>, <span style="color: #66d9ef; font-weight: bold;">void</span>* <span style="color: #fd971f;">lib</span>) {
  <span style="color: #66d9ef; font-weight: bold;">primitive</span> <span style="color: #fd971f;">fun</span> = dlsym(lib, str);
  <span style="color: #f92672; font-weight: bold;">if</span> (fun == <span style="color: #ae81ff;">NULL</span>) {
    printf(<span style="color: #e6db74;">"can not find %s function lib : %s\n"</span>,
           str, dlerror());
  };
  fun();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org856367c" class="outline-3">
<h3 id="org856367c">get_clib</h3>
<div class="outline-text-3" id="text-org856367c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span>* <span style="color: #a6e22e;">get_clib</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">rel_path</span>) {
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">path</span>[PATH_MAX];
  real_reading_path(rel_path, path);
  <span style="color: #66d9ef; font-weight: bold;">void</span>* <span style="color: #fd971f;">lib</span> = dlopen(path, RTLD_LAZY);
  <span style="color: #f92672; font-weight: bold;">if</span> (lib == <span style="color: #ae81ff;">NULL</span>) {
    printf(<span style="color: #e6db74;">"fail to open library : %s : %s\n"</span>,
           path, dlerror());
  };
  <span style="color: #f92672; font-weight: bold;">return</span> lib;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef6e59b" class="outline-3">
<h3 id="orgef6e59b">k_clib_one</h3>
<div class="outline-text-3" id="text-orgef6e59b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_clib_one</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">buffer</span>[PATH_MAX];
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">cursor</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">char</span> <span style="color: #fd971f;">c</span> = read_byte();
    <span style="color: #f92672; font-weight: bold;">if</span> (c == <span style="color: #e6db74;">'"'</span>) {
      buffer[cursor] = 0;
      cursor++;
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      buffer[cursor] = c;
      cursor++;
    }
  }
  ccall(<span style="color: #e6db74;">"export"</span>, get_clib(buffer));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgded6f28" class="outline-3">
<h3 id="orgded6f28">k_clib</h3>
<div class="outline-text-3" id="text-orgded6f28">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_clib</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"\""</span>)) {
      k_clib_one();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b6e2d0" class="outline-3">
<h3 id="org3b6e2d0">export_ffi</h3>
<div class="outline-text-3" id="text-org3b6e2d0">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_ffi</span>() {
  defprim(<span style="color: #e6db74;">"clib"</span>, k_clib);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5f21b0b" class="outline-2">
<h2 id="org5f21b0b"><b>top_level</b></h2>
<div class="outline-text-2" id="text-org5f21b0b">
</div><div id="outline-container-orgd93d0fd" class="outline-3">
<h3 id="orgd93d0fd">prim_jo_p &amp; fun_jo_p &amp; var_jo_p &amp; used_jo_p</h3>
<div class="outline-text-3" id="text-orgd93d0fd">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">prim_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].type == str2jo(<span style="color: #e6db74;">"primitive"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">fun_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].type == str2jo(<span style="color: #e6db74;">"function"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">var_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span> jotable[index].type == str2jo(<span style="color: #e6db74;">"variable"</span>);
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">used_jo_p</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span>) {
  <span style="color: #f92672; font-weight: bold;">return</span>
    prim_jo_p(index) ||
    fun_jo_p(index) ||
    var_jo_p(index);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb047a0e" class="outline-3">
<h3 id="orgb047a0e">jo_to_jo_in_module</h3>
<div class="outline-text-3" id="text-orgb047a0e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">jo_to_jo_in_module</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">alias_jo</span>) {
  <span style="color: #f92672; font-weight: bold;">if</span> (module_stack_empty_p()) {
    <span style="color: #f92672; font-weight: bold;">return</span> alias_jo;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable[alias_jo].type == str2jo(<span style="color: #e6db74;">"declared"</span>)) {
    <span style="color: #f92672; font-weight: bold;">return</span> alias_jo;
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">new_jo</span> = cat_3_jo(module_stack_tos().name,
                         str2jo(<span style="color: #e6db74;">"/"</span>),
                         alias_jo);
    alias_add(alias_jo, new_jo);
    <span style="color: #f92672; font-weight: bold;">return</span> new_jo;
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbb6eb4" class="outline-3">
<h3 id="orgcbb6eb4">read_jo_in_module</h3>
<div class="outline-text-3" id="text-orgcbb6eb4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #a6e22e;">read_jo_in_module</span>() {
  jo_to_jo_in_module(read_jo());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc808dab" class="outline-3">
<h3 id="orgc808dab">k_defun</h3>
<div class="outline-text-3" id="text-orgc808dab">
</div><div id="outline-container-org5db6ef9" class="outline-4">
<h4 id="org5db6ef9">defun_record</h4>
<div class="outline-text-4" id="text-org5db6ef9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">defun_record</span>[64 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defun_record_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org12a5b60" class="outline-4">
<h4 id="org12a5b60">p_defun_record</h4>
<div class="outline-text-4" id="text-org12a5b60">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_defun_record</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; addr)</span>
  as_push(defun_record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org13e7cbb" class="outline-4">
<h4 id="org13e7cbb">defun_report</h4>
<div class="outline-text-4" id="text-org13e7cbb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defun_report</span>() {
  printf(<span style="color: #e6db74;">"- defun_report // counter : %ld\n"</span>, defun_record_counter);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; defun_record_counter) {
    printf(<span style="color: #e6db74;">"  %s\n"</span>, jo2str(defun_record[i]));
    i++;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8fcbbc" class="outline-4">
<h4 id="orge8fcbbc">defun_stack</h4>
<div class="outline-text-4" id="text-orge8fcbbc">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #f92672; font-weight: bold;">typedef</span> <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #66d9ef; font-weight: bold;">defun_stack_t</span>[1024];

<span style="color: #66d9ef; font-weight: bold;">defun_stack_t</span> <span style="color: #fd971f;">defun_stack</span>;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defun_stack_base</span> = 0;
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defun_stack_pointer</span> = 0;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defun_stack_push</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">value</span>) {
  defun_stack[defun_stack_pointer] = value;
  defun_stack_pointer++;
}

<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">defun_stack_pop</span>() {
  defun_stack_pointer--;
  <span style="color: #f92672; font-weight: bold;">return</span> defun_stack[defun_stack_pointer];
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defun_stack_inc</span>() {
  defun_stack[defun_stack_pointer - 1] =
    defun_stack[defun_stack_pointer - 1] + 1;
}


<span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #a6e22e;">defun_stack_tos</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> defun_stack[defun_stack_pointer - 1];
}

<span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #a6e22e;">defun_stack_empty_p</span>() {
  <span style="color: #f92672; font-weight: bold;">return</span> defun_stack_pointer == defun_stack_base;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org94c90f4" class="outline-4">
<h4 id="org94c90f4">k_defun</h4>
<div class="outline-text-4" id="text-org94c90f4">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_compile_jojo</span>();

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_defun</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile] [jotable])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_jo_in_module();
  <span style="color: #f92672; font-weight: bold;">if</span> (used_jo_p(index)) {
    printf(<span style="color: #e6db74;">"- defun can not re-define : %s\n"</span>, jo2str(index));
    printf(<span style="color: #e6db74;">"  it already defined as : %s\n"</span>, jo2str(jotable[index].type));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  defun_stack_push(index);
  defun_record[defun_record_counter] = index;
  defun_record_counter++;
  defun_record[defun_record_counter] = 0;
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">array</span> = compiling_stack_tos();
  k_compile_jojo();
  here(str2jo(<span style="color: #e6db74;">"end"</span>));
  jotable[index].type = str2jo(<span style="color: #e6db74;">"function"</span>);
  jotable[index].value.jojo.size = compiling_stack_tos() - array;
  jotable[index].value.jojo.array = array;
  defun_stack_pop();
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf72b32e" class="outline-3">
<h3 id="orgf72b32e">k_declare</h3>
<div class="outline-text-3" id="text-orgf72b32e">
</div><div id="outline-container-org9eb35f" class="outline-4">
<h4 id="org9eb35f"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-org9eb35f">
<ul class="org-ul">
<li><p>no compile before define</p><p>declare helps mutual recursive function</p></li></ul>
</div>
</div>

<div id="outline-container-orgd624f9e" class="outline-4">
<h4 id="orgd624f9e">k_declare_one</h4>
<div class="outline-text-4" id="text-orgd624f9e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_declare_one</span>() {
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_jo_in_module();
  jotable[index].type = str2jo(<span style="color: #e6db74;">"declared"</span>);
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge364f36" class="outline-4">
<h4 id="orge364f36">k_declare</h4>
<div class="outline-text-4" id="text-orge364f36">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_declare</span>() {
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      k_declare_one();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4b455fb" class="outline-3">
<h3 id="org4b455fb">k_run</h3>
<div class="outline-text-3" id="text-org4b455fb">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_run</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">array</span>[64 * 1024];
  compiling_stack_push(array);
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      here(str2jo(<span style="color: #e6db74;">"end"</span>));
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      here(s);
    }
  }
  compiling_stack_pop();
  eval_jojo(array);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9eaf00c" class="outline-3">
<h3 id="org9eaf00c"><span class="done test">test</span> ing_flag</h3>
<div class="outline-text-3" id="text-org9eaf00c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #fd971f;">testing_flag</span> = <span style="color: #ae81ff;">false</span>;
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_testing_flag</span>() { as_push(testing_flag); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_testing_flag_on</span>() { testing_flag = <span style="color: #ae81ff;">true</span>; }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_testing_flag_off</span>() { testing_flag = <span style="color: #ae81ff;">false</span>; }
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d3e5f6" class="outline-3">
<h3 id="org8d3e5f6">about test</h3>
<div class="outline-text-3" id="text-org8d3e5f6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_test</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (testing_flag) {
    k_run();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    k_ignore();
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org930c3fc" class="outline-3">
<h3 id="org930c3fc">k_defvar</h3>
<div class="outline-text-3" id="text-org930c3fc">
</div><div id="outline-container-org2bb723d" class="outline-4">
<h4 id="org2bb723d">defvar_record</h4>
<div class="outline-text-4" id="text-org2bb723d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">defvar_record</span>[64 * 1024];
<span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">defvar_record_counter</span> = 0;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4002952" class="outline-4">
<h4 id="org4002952">p_defvar_record</h4>
<div class="outline-text-4" id="text-org4002952">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_defvar_record</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; addr)</span>
  as_push(defvar_record);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org17ad8d6" class="outline-4">
<h4 id="org17ad8d6">defvar_report</h4>
<div class="outline-text-4" id="text-org17ad8d6">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">defvar_report</span>() {
  printf(<span style="color: #e6db74;">"- defvar_report // counter : %ld\n"</span>, defvar_record_counter);
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; defvar_record_counter) {
    printf(<span style="color: #e6db74;">"  %s\n"</span>, jo2str(defvar_record[i]));
    i++;
  }
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org61f5542" class="outline-4">
<h4 id="org61f5542">k_defvar</h4>
<div class="outline-text-4" id="text-org61f5542">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_defvar</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile] [jotable])</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">index</span> = read_jo_in_module();
  <span style="color: #f92672; font-weight: bold;">if</span> (used_jo_p(index)) {
    printf(<span style="color: #e6db74;">"- defvar can not re-define : %s\n"</span>, jo2str(index));
    printf(<span style="color: #e6db74;">"  it already defined as : %s\n"</span>, jo2str(jotable[index].type));
    k_ignore();
    <span style="color: #f92672; font-weight: bold;">return</span>;
  }
  defvar_record[defvar_record_counter] = index;
  defvar_record_counter++;
  defvar_record[defvar_record_counter] = 0;
  k_run();
  jotable_set_cell(index, as_pop());
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org424b893" class="outline-3">
<h3 id="org424b893">p_top_repl</h3>
<div class="outline-text-3" id="text-org424b893">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">bool</span> <span style="color: #fd971f;">top_repl_printing_flag</span> = <span style="color: #ae81ff;">false</span>;

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_as_print_by_flag</span>() {
  <span style="color: #f92672; font-weight: bold;">if</span> (top_repl_printing_flag) {
    p_as_print();
  }
  <span style="color: #f92672; font-weight: bold;">else</span> {
    <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
  }
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_top_repl</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; *)</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
      p_as_print_by_flag();
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">do nothing</span>
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org28bdb5d" class="outline-3">
<h3 id="org28bdb5d">p_top_repl_printing_flag</h3>
<div class="outline-text-3" id="text-org28bdb5d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_top_repl_printing_flag</span>() { as_push(top_repl_printing_flag); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_top_repl_printing_flag_on</span>() { top_repl_printing_flag = <span style="color: #ae81ff;">true</span>; }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_top_repl_printing_flag_off</span>() { top_repl_printing_flag = <span style="color: #ae81ff;">false</span>; }
</pre>
</div>
</div>
</div>

<div id="outline-container-org56d275c" class="outline-3">
<h3 id="org56d275c">export_top_level</h3>
<div class="outline-text-3" id="text-org56d275c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_top_level</span>() {
  defprim(<span style="color: #e6db74;">"defun-record"</span>, p_defun_record);
  defprim(<span style="color: #e6db74;">"defun/report"</span>, defun_report);

  defprim(<span style="color: #e6db74;">"defun"</span>, k_defun);

  defprim(<span style="color: #e6db74;">"declare"</span>, k_declare);

  defprim(<span style="color: #e6db74;">"run"</span>, k_run);

  defprim(<span style="color: #e6db74;">"test"</span>, k_test);
  defprim(<span style="color: #e6db74;">"testing-flag"</span>, p_testing_flag);
  defprim(<span style="color: #e6db74;">"testing-flag/on"</span>, p_testing_flag_on);
  defprim(<span style="color: #e6db74;">"testing-flag/off"</span>, p_testing_flag_off);

  defprim(<span style="color: #e6db74;">"defvar-record"</span>, p_defvar_record);
  defprim(<span style="color: #e6db74;">"defvar/report"</span>, defvar_report);
  defprim(<span style="color: #e6db74;">"defvar"</span>, k_defvar);

  defprim(<span style="color: #e6db74;">"as/print-by-flag"</span>, p_as_print_by_flag);
  defprim(<span style="color: #e6db74;">"top-repl"</span>, p_top_repl);
  defprim(<span style="color: #e6db74;">"top-repl/printing-flag"</span>, p_top_repl_printing_flag);
  defprim(<span style="color: #e6db74;">"top-repl/printing-flag/on"</span>, p_top_repl_printing_flag_on);
  defprim(<span style="color: #e6db74;">"top-repl/printing-flag/off"</span>, p_top_repl_printing_flag_off);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4ad27a7" class="outline-2">
<h2 id="org4ad27a7"><b>keyword</b></h2>
<div class="outline-text-2" id="text-org4ad27a7">
</div><div id="outline-container-orgde14bec" class="outline-3">
<h3 id="orgde14bec">k_ignore</h3>
<div class="outline-text-3" id="text-orgde14bec">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_ignore</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt;)</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      k_ignore();
    }
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">")"</span>)) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc06699b" class="outline-3">
<h3 id="orgc06699b">compile_jojo_until_meet_jo</h3>
<div class="outline-text-3" id="text-orgc06699b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">compile_jojo_until_meet_jo</span>(<span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">end</span>) {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #f92672; font-weight: bold;">while</span> (<span style="color: #ae81ff;">true</span>) {
    <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
    <span style="color: #f92672; font-weight: bold;">if</span> (s == str2jo(<span style="color: #e6db74;">"("</span>)) {
      eval_key(read_jo());
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (s == end) {
      <span style="color: #f92672; font-weight: bold;">break</span>;
    }
    <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #f92672; font-weight: bold;">if</span> (jotable_entry_used(jotable[s]) ||
             defun_stack_empty_p() ||
             defun_stack_tos() == s) {
      here(s);
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      <span style="color: #FF8888;">// </span><span style="color: #FF8888;">no compile before define</span>
      printf(<span style="color: #e6db74;">"- k_compile_jojo undefined : %s\n"</span>, jo2str(s));
      k_ignore();
      <span style="color: #f92672; font-weight: bold;">return</span>;
    }
  }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org3200289" class="outline-3">
<h3 id="org3200289">k_compile_jojo_until_meet_jo</h3>
<div class="outline-text-3" id="text-org3200289">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_compile_jojo_until_meet_jo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(jo -&gt; [compile])</span>
  compile_jojo_until_meet_jo(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org560a4a8" class="outline-3">
<h3 id="org560a4a8">k_compile_jojo</h3>
<div class="outline-text-3" id="text-org560a4a8">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_compile_jojo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  compile_jojo_until_meet_jo(str2jo(<span style="color: #e6db74;">")"</span>));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb542620" class="outline-3">
<h3 id="orgb542620">k_if</h3>
<div class="outline-text-3" id="text-orgb542620">
<ul class="org-ul">
<li><p>(if a b p? -&gt; c d)</p></li>

<li><p>a b p?</p><p>[jump] jumk_if_false</p><p>c d</p><p>:jump</p></li>

<li><p>because the use of as_snapshot</p><p>bar can not be nested in antecedent</p></li></ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_if</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  compile_jojo_until_meet_jo(str2jo(<span style="color: #e6db74;">"-&gt;"</span>));
  here(str2jo(<span style="color: #e6db74;">"instruction/lit"</span>));
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">offset_place</span> = compiling_stack_tos();
  compiling_stack_inc();
  here(str2jo(<span style="color: #e6db74;">"jump-if-false"</span>));
  k_compile_jojo();
  offset_place[0] = compiling_stack_tos();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f8f91d" class="outline-3">
<h3 id="org9f8f91d">k_tail_call</h3>
<div class="outline-text-3" id="text-org9f8f91d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_tail_call</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">no check for "no compile before define"</span>
  here(str2jo(<span style="color: #e6db74;">"instruction/tail-call"</span>));
  <span style="color: #66d9ef; font-weight: bold;">jo</span> <span style="color: #fd971f;">s</span> = read_jo();
  here(s);
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7fcdf0d" class="outline-3">
<h3 id="org7fcdf0d">k_loop</h3>
<div class="outline-text-3" id="text-org7fcdf0d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_loop</span>() {
  here(str2jo(<span style="color: #e6db74;">"instruction/tail-call"</span>));
  here(defun_stack_tos());
  k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1fa1102" class="outline-3">
<h3 id="org1fa1102">k_recur</h3>
<div class="outline-text-3" id="text-org1fa1102">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_recur</span>() {
 here(defun_stack_tos());
 k_ignore();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge48591d" class="outline-3">
<h3 id="orge48591d">p_compiling_stack_tos</h3>
<div class="outline-text-3" id="text-orge48591d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_compiling_stack_tos</span>() {
  as_push(compiling_stack_tos());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org5de536e" class="outline-3">
<h3 id="org5de536e">i_jojo</h3>
<div class="outline-text-3" id="text-org5de536e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">i_jojo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([rs] -&gt; int)</span>
  <span style="color: #66d9ef; font-weight: bold;">jo</span>* <span style="color: #fd971f;">function_body</span> = rs_pop();
  rs_push(function_body[0]);
  as_push(function_body + 1);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org293ab9" class="outline-3">
<h3 id="org293ab9">k_jojo</h3>
<div class="outline-text-3" id="text-org293ab9">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">k_jojo</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">([io] -&gt; [compile])</span>
  here(str2jo(<span style="color: #e6db74;">"instruction/jojo"</span>));
  <span style="color: #66d9ef; font-weight: bold;">cell</span>* <span style="color: #fd971f;">offset_place</span> = compiling_stack_tos();
  compiling_stack_inc();
  k_compile_jojo();
  here(str2jo(<span style="color: #e6db74;">"end"</span>));
  offset_place[0] = compiling_stack_tos();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d04f20" class="outline-3">
<h3 id="org9d04f20">export_keyword</h3>
<div class="outline-text-3" id="text-org9d04f20">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_keyword</span>() {
  defprim(<span style="color: #e6db74;">"ignore"</span>, k_ignore);
  defprim(<span style="color: #e6db74;">":"</span>, k_ignore);

  defprim(<span style="color: #e6db74;">"compiling-stack/tos"</span>, p_compiling_stack_tos);
  defprim(<span style="color: #e6db74;">"compiling-stack/inc"</span>, compiling_stack_inc);

  defprim(<span style="color: #e6db74;">"if"</span>, k_if);
  defprim(<span style="color: #e6db74;">"do"</span>, k_compile_jojo);
  defprim(<span style="color: #e6db74;">"compile-jojo/until-meet-jo"</span>, k_compile_jojo_until_meet_jo);
  defprim(<span style="color: #e6db74;">"else"</span>, k_compile_jojo);
  defprim(<span style="color: #e6db74;">"tail-call"</span>, k_tail_call);
  defprim(<span style="color: #e6db74;">"loop"</span>, k_loop);
  defprim(<span style="color: #e6db74;">"recur"</span>, k_recur);

  defprim(<span style="color: #e6db74;">"jojo"</span>, k_jojo);
  defprim(<span style="color: #e6db74;">"instruction/jojo"</span>, i_jojo);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb81b831" class="outline-2">
<h2 id="orgb81b831"><b>misc</b></h2>
<div class="outline-text-2" id="text-orgb81b831">
</div><div id="outline-container-org12a1b06" class="outline-3">
<h3 id="org12a1b06">do_nothing</h3>
<div class="outline-text-3" id="text-org12a1b06">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">do_nothing</span>() {
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org86347af" class="outline-3">
<h3 id="org86347af">p_here</h3>
<div class="outline-text-3" id="text-org86347af">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_here</span>() {
  here(as_pop());
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org48ed927" class="outline-3">
<h3 id="org48ed927">bar-ket</h3>
<div class="outline-text-3" id="text-org48ed927">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_round_bar</span>() { as_push(str2jo(<span style="color: #e6db74;">"("</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_round_ket</span>() { as_push(str2jo(<span style="color: #e6db74;">")"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_square_bar</span>() { as_push(str2jo(<span style="color: #e6db74;">"["</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_square_ket</span>() { as_push(str2jo(<span style="color: #e6db74;">"]"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_flower_bar</span>() { as_push(str2jo(<span style="color: #e6db74;">"{"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_flower_ket</span>() { as_push(str2jo(<span style="color: #e6db74;">"}"</span>)); }
<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_double_quote</span>() { as_push(str2jo(<span style="color: #e6db74;">"\""</span>)); }
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcac688e" class="outline-3">
<h3 id="orgcac688e">p_cell_size</h3>
<div class="outline-text-3" id="text-orgcac688e">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_cell_size</span>() {
  <span style="color: #FF8888;">// </span><span style="color: #FF8888;">(-&gt; cell)</span>
  as_push(cell_size);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3d9f4b" class="outline-3">
<h3 id="orgd3d9f4b">p_newline</h3>
<div class="outline-text-3" id="text-orgd3d9f4b">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p_newline</span>() {
  printf(<span style="color: #e6db74;">"\n"</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f0efae" class="outline-3">
<h3 id="org8f0efae">export_mise</h3>
<div class="outline-text-3" id="text-org8f0efae">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_mise</span>() {
  defprim(<span style="color: #e6db74;">"here"</span>, p_here);
  defprim(<span style="color: #e6db74;">"jotable/report"</span>, jotable_report);

  defprim(<span style="color: #e6db74;">"round-bar"</span>, p_round_bar);
  defprim(<span style="color: #e6db74;">"round-ket"</span>, p_round_ket);
  defprim(<span style="color: #e6db74;">"square-bar"</span>, p_square_bar);
  defprim(<span style="color: #e6db74;">"square-ket"</span>, p_square_ket);
  defprim(<span style="color: #e6db74;">"flower-bar"</span>, p_flower_bar);
  defprim(<span style="color: #e6db74;">"flower-ket"</span>, p_flower_ket);
  defprim(<span style="color: #e6db74;">"double-quote"</span>, p_double_quote);

  defprim(<span style="color: #e6db74;">"cell-size"</span>, p_cell_size);
  defprim(<span style="color: #e6db74;">"defprim/report"</span>, defprim_report);
  defprim(<span style="color: #e6db74;">"newline"</span>, p_newline);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3fba6c6" class="outline-2">
<h2 id="org3fba6c6"><b>play</b></h2>
<div class="outline-text-2" id="text-org3fba6c6">
</div><div id="outline-container-orgcbe108a" class="outline-3">
<h3 id="orgcbe108a">p1</h3>
<div class="outline-text-3" id="text-orgcbe108a">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p1</span>() {
  printf(<span style="color: #e6db74;">"- p1\n"</span>);
  printf(<span style="color: #e6db74;">"  %ld %ld %ld\n"</span>, <span style="color: #f92672; font-weight: bold;">sizeof</span>(<span style="color: #66d9ef; font-weight: bold;">void</span>*), cell_size, <span style="color: #f92672; font-weight: bold;">sizeof</span>(<span style="color: #66d9ef; font-weight: bold;">unsigned</span>));
  printf(<span style="color: #e6db74;">"  %ld %ld\n"</span>, <span style="color: #f92672; font-weight: bold;">sizeof</span>((cell)-1), <span style="color: #f92672; font-weight: bold;">sizeof</span>(-1));
  printf(<span style="color: #e6db74;">"  %x %x\n"</span>, 16);
  printf(<span style="color: #e6db74;">"  %x %x %x\n"</span>, -1&gt;&gt;2, (cell)-1&gt;&gt;2, (<span style="color: #66d9ef; font-weight: bold;">unsigned</span>)-1&gt;&gt;2);
  printf(<span style="color: #e6db74;">"  %ld %ld\n"</span>, string_to_bin(<span style="color: #e6db74;">"1000"</span>), string_to_hex(<span style="color: #e6db74;">"ffff"</span>));
  printf(<span style="color: #e6db74;">"  %ld %ld %ld %ld\n"</span>, <span style="color: #e6db74;">'0'</span>, <span style="color: #e6db74;">'1'</span>, <span style="color: #e6db74;">'A'</span>, <span style="color: #e6db74;">'a'</span>);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org58a5c14" class="outline-3">
<h3 id="org58a5c14">p2</h3>
<div class="outline-text-3" id="text-org58a5c14">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p2</span>() {
  printf(<span style="color: #e6db74;">"- p2\n"</span>);
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, EOF);
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, PATH_MAX);

  <span style="color: #f92672; font-weight: bold;">struct</span> <span style="color: #66d9ef; font-weight: bold;">stat</span> <span style="color: #fd971f;">st</span>;
  stat(<span style="color: #e6db74;">"READM"</span>, &amp;st);
  printf(<span style="color: #e6db74;">"  file-size of README : %ld\n"</span>, st.st_size);
  printf(<span style="color: #e6db74;">"  sizeof &amp;st : %ld\n"</span>, <span style="color: #f92672; font-weight: bold;">sizeof</span>(&amp;st));
  printf(<span style="color: #e6db74;">"  sizeof st : %ld\n"</span>, <span style="color: #f92672; font-weight: bold;">sizeof</span>(st));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5fc4a5" class="outline-3">
<h3 id="orgd5fc4a5">p3</h3>
<div class="outline-text-3" id="text-orgd5fc4a5">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #a6e22e;">string_to_sum_test</span>(<span style="color: #66d9ef; font-weight: bold;">string</span> <span style="color: #fd971f;">str</span>) {
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">sum</span> = 0;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">max_step</span> = 10;
  <span style="color: #66d9ef; font-weight: bold;">cell</span> <span style="color: #fd971f;">i</span> = 0;
  <span style="color: #f92672; font-weight: bold;">while</span> (i &lt; strlen(str)) {
    sum = sum + ((<span style="color: #66d9ef; font-weight: bold;">unsigned</span> <span style="color: #66d9ef; font-weight: bold;">char</span>) str[i]) * (2 &lt;&lt; min(i, max_step));
    printf(<span style="color: #e6db74;">"| char: %ld | unsigned char: %ld | sum: %ld |\n"</span>, str[i], (<span style="color: #66d9ef; font-weight: bold;">unsigned</span> <span style="color: #66d9ef; font-weight: bold;">char</span>) str[i], sum);
    i++;
  }
  <span style="color: #f92672; font-weight: bold;">return</span> sum;
}

<span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">p3</span>() {
  printf(<span style="color: #e6db74;">"- p3\n"</span>);
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, string_to_sum_test(<span style="color: #e6db74;">"abcabcabc"</span>));
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, string_to_sum_test(<span style="color: #e6db74;">"&#20013;&#20013;"</span>));
  printf(<span style="color: #e6db74;">"  %ld\n"</span>, string_to_sum_test(<span style="color: #e6db74;">"&#20013;&#20013;&#20013;"</span>));
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcb1716c" class="outline-3">
<h3 id="orgcb1716c">export_play</h3>
<div class="outline-text-3" id="text-orgcb1716c">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">export_play</span>() {
  defprim(<span style="color: #e6db74;">"p1"</span>, p1);
  defprim(<span style="color: #e6db74;">"p2"</span>, p2);
  defprim(<span style="color: #e6db74;">"p3"</span>, p3);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6676b42" class="outline-2">
<h2 id="org6676b42">main</h2>
<div class="outline-text-2" id="text-org6676b42">
</div><div id="outline-container-org2c45ab1" class="outline-3">
<h3 id="org2c45ab1">init_top_repl</h3>
<div class="outline-text-3" id="text-org2c45ab1">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">void</span> <span style="color: #a6e22e;">init_top_repl</span>() {
  init_jotable();
  init_compiling_stack();
  init_loading_stack();

  export_apply();
  export_stack_operation();
  export_ending();
  export_control();
  export_bool();
  export_bit();
  export_int();
  export_memory();
  export_byte();
  export_jo();
  export_string();
  export_file();
  export_keyword();
  export_system();
  export_module();
  export_ffi();
  export_top_level();
  export_mise();
  export_play();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org136fb6d" class="outline-3">
<h3 id="org136fb6d">main</h3>
<div class="outline-text-3" id="text-org136fb6d">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #a6e22e;">main</span>(<span style="color: #66d9ef; font-weight: bold;">int</span> <span style="color: #fd971f;">argc</span>, <span style="color: #66d9ef; font-weight: bold;">string</span>* <span style="color: #fd971f;">argv</span>) {

  argument_counter = argc;
  argument_string_array = argv;

  init_top_repl();

  <span style="color: #f92672; font-weight: bold;">if</span> (argc != 1) {
    <span style="color: #f92672; font-weight: bold;">if</span> (file_readable_p(argv[1])) {
      load_file(argv[1]);
    }
    <span style="color: #f92672; font-weight: bold;">else</span> {
      printf(<span style="color: #e6db74;">"- jojo can not load file: %s\n"</span>, argv[1]);
      printf(<span style="color: #e6db74;">"  it is not readable\n"</span>);
      <span style="color: #f92672; font-weight: bold;">return</span> 69;
    }
  }

  p_top_repl();
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
涕执我乎垂丧兮 懼余生之茫苦
</div>
</body>
</html>
